<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="MM_MSEG" Caption="物料凭证" FormType="Entity" FormulaCaption="IIFS(GetPara('NewCaption') != '', GetPara('NewCaption'), GetEntryPara('TCode')=='MB1C', '其他收货', GetEntryPara('TCode')=='MB1A', '其他发货', GetEntryPara('TCode')=='MB31', '生产收货', true, '一般物料凭证')" InitState="New" Version="733">
    <DataSource RefObjectKey="MM_MSEG"/>
    <OperationCollection>
        <Operation Key="BillEdit" Caption="修改" Visible="true" Enable="ReadOnly()" Activity="02">
            <Action>
                <![CDATA[Macro_BillEdit();]]>
            </Action>
        </Operation>
        <Operation Key="BillSave" Caption="保存" Enable="!ReadOnly()">
            <Action>
                <![CDATA[UICheck();Macro_MidSave();ResetEditBill();Macro_ShowInfo();]]>
            </Action>
        </Operation>
        <Operation Key="BillCancel" Caption="取消" RefKey="BillCancel"/>
        <Operation Key="ShowBillFlow" Caption="显示凭证流" RefKey="ShowBillFlow"/>
        <Operation Key="QueryVoucher" Caption="凭证查看" Enable="ReadOnly()">
            <Action>
                <![CDATA[UICheck();ERPShowModal('IntegrationQueryVoucher',GetCallFormula('Macro_Integration_Normal_ShowEvent',GetOID(),GetFormKey()))]]>
            </Action>
        </Operation>
        <Operation Key="QueryStockOverview" Caption="查询库存" RefKey="QueryStockOverview"/>
        <Operation Key="QueryInspectionLot" Caption="检验批" Activity="02">
            <Action>
                <![CDATA[UICheck();IIFS(InspectionLotSOID<=0, ConfirmMsg('QA320','无分配的检验批',{},'OK'), Macro_QueryInspectionLot_RunAsExp(), ERPShowModal('QM_InspectionLot',GetCallFormula('Macro_MSEG_ShowEvent',InspectionLotSOID),'newtab'), true, ERPShowModal('QM_SelectInspectionLotList','Macro_LoadObject()'))]]>
            </Action>
        </Operation>
        <OperationCollection Key="Quote" Caption="上引" Enable="IIF(HasParent()&amp;&amp;parent.GetPara('RO_OID')&gt;0,false,true)" Visible="Macro_Is_Show()" SelfDisable="true">
            <Operation Key="MM_Reservation2MM_Document_Quote_Opt" Caption="上引预留" Enable="IsNew()&amp;&amp;Macro_GetStatusEnable()&amp;&amp;!ReadOnly()&amp;&amp;GetDictValue('TCode', TCodeID, 'Code')!='MB31'&amp;&amp;GetDictValue('TCode', TCodeID, 'Code')!='MBST'">
                <Action>
                    <![CDATA[Macro_PP_ReferenceBillShowEvent()]]>
                </Action>
            </Operation>
            <Operation Key="MM_ProductionOrder2MM_Document_Quote_Opt" Caption="上引订单" Enable="IsNew()&amp;&amp;Macro_GetStatusEnable()&amp;&amp;!ReadOnly()&amp;&amp;IIF(GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB31',true,MoveTypeID_NODB4Other&gt;0&amp;&amp;GetDictValue('MoveType', MoveTypeID_NODB4Other, 'PPOrderNo')!=2)">
                <Action>
                    <![CDATA[Macro_LeadProductionOrder()]]>
                </Action>
            </Operation>
            <Operation Key="PP_PickApplySelect2MM_Document_Quote_Opt" Caption="上引领料申请单" Visible="Macro_JudgeMoveType(MoveTypeID_NODB4Other,'261',-1)">
                <Action>
                    <![CDATA[ERPShowModal('PP_ApplySelect_Query','Macro_SetPara_PickApply()');]]>
                </Action>
            </Operation>
            <Operation Key="PP_ReturnApplySelect2MM_Document_Quote_Opt" Caption="上引退料申请单" Visible="Macro_JudgeMoveType(MoveTypeID_NODB4Other,'261',1)">
                <Action>
                    <![CDATA[ERPShowModal('PP_ApplySelect_Query','Macro_SetPara_ReturnApply()');]]>
                </Action>
            </Operation>
        </OperationCollection>
        <Operation Key="QuantitySplitting" Caption="明细数量拆分" Visible="GetDictValue('TCode', ActiveTCodeID, 'Code')=='MB1A'">
            <Action>
                <![CDATA[IIF(Dtl_OID>0,ERPShowModal('MM_QuantitySplitting',GetCallFormula('Macro_MM_QuantitySplitting_ShowEvent',MaterialID,PlantID,SrcPurchaseOrderDtlOID,StockType,StorageLocationID,StoragePointID,BatchCode,BatchCodeSOID,Dtl_GlobalValuationTypeID,Direction,SpecialIdentity,DynIdentityID)),true)]]>
            </Action>
        </Operation>
        <OperationCollection Key="NewPrint" Caption="打印" SelfDisable="true">
            <Operation Key="NewPrintDefault" Caption="默认模板打印" RefKey="NewPrintDefault" Activity="04"/>
            <Operation Key="NewPrintSelect" Caption="其他模板选择" RefKey="NewPrintSelect" Activity="04"/>
            <Operation Key="ManagePrint" Caption="打印模板管理" RefKey="ManagePrint" Activity="04"/>
        </OperationCollection>
        <OperationCollection Key="NewPrePrint" Caption="打印预览" SelfDisable="true">
            <Operation Key="NewPrePrintDefault" Caption="默认模板预览" RefKey="NewPrePrintDefault" Activity="Y09"/>
            <Operation Key="NewPrePrintSelect" Caption="其他模板选择" RefKey="NewPrePrintSelect" Activity="Y09"/>
        </OperationCollection>
        <Operation Key="ERPExportExcel" Caption="导出" RefKey="ERPExportExcel" Activity="Y11"/>
        <Operation Key="Attachment" Caption="附件" RefKey="Attachment" Activity="Y12"/>
        <Operation Key="ShowDataLog" Caption="查看数据日志" RefKey="ShowDataLog" Activity="Y08"/>
        <Operation Key="UIClose" Caption="关闭" RefKey="UIClose"/>
    </OperationCollection>
    <Body>
        <Block>
            <FlexFlowLayoutPanel Key="root">
                <ToolBar Key="ToolBar" Caption="ToolBar1" Height="pref">
                    <ToolBarItemCollection/>
                </ToolBar>
                <SplitPanel Key="main_container" Orientation="Vertical" Height="100%">
                    <TabPanel Key="Top">
                        <FlexGridLayoutPanel Key="BaseDataFlexFlowLayoutPanel" Caption="基本数据" ColumnCount="6" ColumnGap="16" Height="pref" OverflowY="Auto" Padding="8px" RowGap="24" TopPadding="24px" Visible="IIF(parent.GetPara('IsDistribution'), true, !Macro_IsShowMSEG())">
                            <Dict Key="MoveTypeID_NODB4Other" Caption="移动类型" LabelType="M" Visible="!GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB31'" Enable="false" ItemKey="MoveType" OneTimeCompute="true">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="MoveTypeID_NODB4Other" DefaultFormulaValue="GetPara('MoveTypeID')"/>
                                <ItemFilter ItemKey="MoveType">
                                    <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                        <FilterValue Index="1" ParaValue="&quot; IsAllow=&quot;&amp;SqlPara(1)&amp;&quot; and soid in (select soid from EMM_MoveType4TCode where MoveTypeSrcFormKey=&quot;&amp;SqlPara(GetSourceFormKey())&amp;&quot; and TCodeID=&quot;&amp;SqlPara(TCodeID)&amp;')'"/>
                                    </Filter>
                                </ItemFilter>
                            </Dict>
                            <ComboBox Key="SpecialIdentity_NODB4Other" Caption="特殊库存标识" LabelType="M" Enable="false" SourceType="Formula" OneTimeCompute="true">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="SpecialIdentity_NODB4Other">
                                    <DefaultFormulaValue>
                                        <![CDATA[com.bokesoft.erp.mm.stock.MovementTypeFormula.getDefaultSpecialIdentityByMoveTypeID(MoveTypeID_NODB4Other)]]>
                                    </DefaultFormulaValue>
                                </DataBinding>
                                <FormulaItems>
                                    <![CDATA[Macro_GetSpecialIdentity(MoveTypeID_NODB4Other)]]>
                                </FormulaItems>
                            </ComboBox>
                            <TextEditor Key="Head_IdentityIDDEKey" Caption="特殊库存(表头)字典标识" Visible="false">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_IdentityIDDEKey">
                                    <DefaultFormulaValue>
                                        <![CDATA[Macro_GetIdentityDataElementKey(SpecialIdentity_NODB4Other)]]>
                                    </DefaultFormulaValue>
                                </DataBinding>
                            </TextEditor>
                            <DynamicDict Key="Head_IdentityID" Caption="特殊库存(表头)" LabelType="M" Enable="IIF(HasParent()&amp;&amp;parent.GetPara('RO_OID')&gt;0,false,SpecialIdentity_NODB4Other!='_')" FormulaCaption="IIFS(SpecialIdentity_NODB4Other=='B', '客户',SpecialIdentity_NODB4Other=='E', '现有订单', SpecialIdentity_NODB4Other=='K', '(寄售)供应商', SpecialIdentity_NODB4Other=='P', '(管道)供应商',SpecialIdentity_NODB4Other=='O', '分包供应商', SpecialIdentity_NODB4Other=='Q', '项目库存', SpecialIdentity_NODB4Other=='W', '(寄售)客户', SpecialIdentity_NODB4Other=='V', '(可回收包装物)客户',SpecialIdentity_NODB4Other=='M','供应商', SpecialIdentity_NODB4Other=='_', '特殊库存',true,'')" IsDynamic="true" RefDataElementKey="Head_IdentityIDDEKey" X="2" Y="0" StateMask="Enable|Disable|Discard">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_IdentityID">
                                    <CheckRule>
                                        <![CDATA[IIFS(SpecialIdentity_NODB4Other=='_', true, SpecialIdentity_NODB4Other=='B'&&Head_IdentityID<=0, '请输入有关特殊库存B的客户',
                                                                                                                                                                        SpecialIdentity_NODB4Other=='E'&&Head_IdentityID<=0, MessageFacade('MM_MSEG001','请输入订单'), SpecialIdentity_NODB4Other=='K'&&Head_IdentityID<=0, MessageFacade('MM_MSEG002','请输入(寄售)供应商'), SpecialIdentity_NODB4Other=='P'&&Head_IdentityID<=0, MessageFacade('MM_MSEG002','请输入供应商'), SpecialIdentity_NODB4Other=='O'&&Head_IdentityID<=0, MessageFacade('MM_MSEG003','请输入分包供应商'), SpecialIdentity_NODB4Other=='Q'&&Head_IdentityID<=0, MessageFacade('MM_MSEG004','请输入项目库存'), SpecialIdentity_NODB4Other=='W'&&Head_IdentityID<=0, MessageFacade('MM_MSEG005','请输入(寄售)客户'), SpecialIdentity_NODB4Other=='V'&&Head_IdentityID<=0, MessageFacade('MM_MSEG006','请输入(可回收包装物)客户'),SpecialIdentity_NODB4Other=='M'&&Head_IdentityID<=0, MessageFacade('MM_MSEG007','请输入(可退回的包装)供应商'), true, true)]]>
                                    </CheckRule>
                                </DataBinding>
                                <ItemFilter>
                                    <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                        <FilterValue Index="1" ParaValue="IIF(SpecialIdentity_NODB4Other=='E',&quot;SpecialIdentity=&quot;&amp;SqlPara('E'),'')"/>
                                    </Filter>
                                </ItemFilter>
                            </DynamicDict>
                            <UTCDatePicker Key="HeadPostingDate" Caption="过账日期" LabelType="M" Format="yyyy-MM-dd">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="PostingDate" DefaultFormulaValue="DateLong()" Required="true" ValueChanged="Macro_ATPWarnMsg();"/>
                            </UTCDatePicker>
                            <UTCDatePicker Key="Head_DocumentDate" Caption="凭证日期" LabelType="M" Format="yyyy-MM-dd">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="DocumentDate" Required="true"/>
                            </UTCDatePicker>
                            <TextEditor Key="Head_Notes" Caption="摘要" Trim="true">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Notes"/>
                            </TextEditor>
                            <Dict Key="CostCenterID" Caption="成本中心" LabelType="M" Enable="!ReadOnly()&amp;&amp;IIF(parent.GetPara('IsDistribution'), true, Macro_GetHeadFieldVisibleByList('CostCenter'))" ItemKey="CostCenter">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="CostCenterID">
                                    <CheckRule>
                                        <![CDATA[IIFS(Macro_GetFieldValueByMoveTypeID(MoveTypeID_NODB4Other,SpecialIdentity_NODB4Other,'CostCenter')==1&&CostCenterID<=0, MessageFacade('MM_MSEG017','请输入成本中心'), true, true)]]>
                                    </CheckRule>
                                </DataBinding>
                                <ItemFilter ItemKey="CostCenter">
                                    <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                        <FilterValue Index="1" ParaValue="IIF(HeadPlantID&gt;0,' ControllingAreaID in ( SELECT ControllingAreaID FROM EGS_COACAssignCpyCodeDtl WHERE CompanyCodeID = '&amp;SqlPara(GetDictValue('Plant', HeadPlantID, 'CompanyCodeID'))&amp;')',' 1=1 ')"/>
                                    </Filter>
                                </ItemFilter>
                            </Dict>
                            <ComboBox Key="Head_OrderCategory" Caption="订单类别" LabelType="M" Enable="IIF(HasParent()&amp;&amp;parent.GetPara('RO_OID')&gt;0,false,!ReadOnly()&amp;&amp;Macro_GetHeadFieldVisibleByHead('PPOrderNo'))" SourceType="ParaGroup" GroupKey="OrderCategoryGroup">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_OrderCategory">
                                    <ValueChanged>
                                        <![CDATA[SetValue('SrcDoNumber', '');SetValue('Head_PPOrderNoID', 0);]]>
                                    </ValueChanged>
                                    <DefaultFormulaValue>
                                        <![CDATA[IIF(GetPara('OrderCategory')=='',10,GetPara('OrderCategory'))]]>
                                    </DefaultFormulaValue>
                                </DataBinding>
                                <ComboFilter>
                                    <Item Key="01" Caption="内部订单" Value="01"/>
                                    <Item Key="04" Caption="成本控制生产订单" Value="04"/>
                                    <Item Key="05" Caption="生产成本归集器" Value="05"/>
                                    <Item Key="06" Caption="质量订单" Value="06"/>
                                    <Item Key="10" Caption="生产订单" Value="10"/>
                                    <Item Key="30" Caption="维护订单" Value="30"/>
                                    <Item Key="40" Caption="流程订单" Value="40"/>
                                </ComboFilter>
                            </ComboBox>
                            <DynamicDict Key="Head_PPOrderNoID" Caption="订单" LabelType="M" IsDynamic="true" RefDataElementKey="Head_PPOrderNoIDDEKey" Visible="false">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_PPOrderNoID">
                                    <CheckRule>
                                        <![CDATA[IIF((GetEntryPara('T_Sign')=='SIGN')&&(Length(Head_PPOrderNoID)<2), MessageFacade('MM_MSEG011','订单不能为空'), true);]]>
                                    </CheckRule>
                                </DataBinding>
                            </DynamicDict>
                            <TextEditor Key="Head_PPOrderNoIDDEKey" Caption="生产订单字典标识" Visible="false">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_PPOrderNoIDDEKey">
                                    <DefaultFormulaValue>
                                        <![CDATA[com.bokesoft.erp.mm.purchase.MigoFormula.getOrdeDataElementKey(Head_OrderCategory)]]>
                                    </DefaultFormulaValue>
                                </DataBinding>
                            </TextEditor>
                            <TextButton Key="SrcDoNumber" Caption="订单" Enable="!ReadOnly()&amp;&amp;Macro_GetHeadFieldVisibleByHead('PPOrderNo')">
                                <DataBinding ValueChangeAction="Macro_DisposeCostCenter();">
                                    <ValueChanged>
                                        <![CDATA[IIFS(Length(SrcDoNumber)==0, SetValue('Head_PPOrderNoID', 0, true), ToBool(GetPara('SelectFromCond')), SetValue('Head_PPOrderNoID', GetDictOID(Macro_GetItemKeyByDataElementKey(Head_PPOrderNoIDDEKey),Macro_OrderCategoryCode(Head_OrderCategory),SrcDoNumber), true), com.bokesoft.erp.basis.dictionary.DictionaryFunction.checkDictValid(Macro_CommonFilter_Rst(), GetDictOID(Macro_GetItemKeyByDataElementKey(Head_PPOrderNoIDDEKey),Macro_OrderCategoryCode(Head_OrderCategory),SrcDoNumber)), SetValue('Head_PPOrderNoID', GetDictOID(Macro_GetItemKeyByDataElementKey(Head_PPOrderNoIDDEKey),Macro_OrderCategoryCode(Head_OrderCategory),SrcDoNumber), true), true, SetValue('Head_PPOrderNoID', 0, true));SetPara('SelectFromCond', false);]]>
                                    </ValueChanged>
                                    <CheckRule>
                                        <![CDATA[IIF(GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB31'&&GetDictValue('MoveType', MoveTypeID_NODB4Other, 'PPOrderNo')==1 && Head_PPOrderNoID<=0,IIFS(Length(SrcDoNumber)==0, MessageFacade('MM_MSEG012','请输入订单'), GetDictOID(Macro_GetItemKeyByDataElementKey(Head_PPOrderNoIDDEKey),Macro_OrderCategoryCode(Head_OrderCategory),SrcDoNumber)==0, MessageFacade('MM_MSEG013','不存在该订单'), GetDictOID(Macro_GetItemKeyByDataElementKey(Head_PPOrderNoIDDEKey),Macro_OrderCategoryCode(Head_OrderCategory),SrcDoNumber)>0, MessageFacade('MM_MSEG014','该订单无效'), true, true),IIF(Head_PPOrderNoID<=0&&Length(SrcDoNumber)>0,IIFS(GetDictOID(Macro_GetItemKeyByDataElementKey(Head_PPOrderNoIDDEKey),Macro_OrderCategoryCode(Head_OrderCategory),SrcDoNumber)==0, MessageFacade('MM_MSEG013','不存在该订单'), GetDictOID(Macro_GetItemKeyByDataElementKey(Head_PPOrderNoIDDEKey),Macro_OrderCategoryCode(Head_OrderCategory),SrcDoNumber)>0, MessageFacade('MM_MSEG014','该订单无效'),true,true)))]]>
                                    </CheckRule>
                                    <DefaultFormulaValue>
                                        <![CDATA[IIF(Head_PPOrderNoID>0&&Length(SrcDoNumber)==0,GetDictValue(Macro_GetItemKeyByDataElementKey(Head_PPOrderNoIDDEKey),Head_PPOrderNoID,'Code'),SrcDoNumber)]]>
                                    </DefaultFormulaValue>
                                </DataBinding>
                                <OnClick>
                                    <![CDATA[ERPShowModal(Macro_HeadOrderCategorySelect(),GetCallFormula('Macro_Common_Filter_ShowEvent',Macro_Filter(),'SrcDoNumber'))]]>
                                </OnClick>
                            </TextButton>
                            <Dict Key="Head_WBSElementID" Caption="WBS元素" LabelType="M" Enable="!ReadOnly()&amp;&amp;MoveTypeID_NODB4Other&gt;0&amp;&amp;GetDictValue('MoveType', MoveTypeID_NODB4Other, 'WBSElement')!=2&amp;&amp;SpecialIdentity_NODB4Other!='Q'" ItemKey="PS_WBSElement">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_WBSElementID">
                                    <CheckRule>
                                        <![CDATA[IIFS(GetDictValue('MoveType', MoveTypeID_NODB4Other, 'WBSElement')==1&&Head_WBSElementID<=0&&SpecialIdentity_NODB4Other!='Q', MessageFacade('MM_MSEG018','请输入WBS元素'), true, true)]]>
                                    </CheckRule>
                                </DataBinding>
                                <ItemFilter ItemKey="PS_WBSElement">
                                    <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                        <FilterValue Index="1" ParaValue="IIF(HeadPlantID&gt;0, 'CompanyCodeID='&amp;SqlPara(GetDictValue('Plant', HeadPlantID, 'CompanyCodeID')), '1=2')"/>
                                    </Filter>
                                </ItemFilter>
                            </Dict>
                            <Dict Key="Head_NetworkID" Caption="网络" LabelType="M" Enable="!ReadOnly()&amp;&amp;Head_WBSElementID&lt;=0&amp;&amp;Macro_GetHeadFieldVisibleByHead('Network')" ItemKey="PS_Network">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_NetworkID">
                                    <CheckRule>
                                        <![CDATA[IIFS(GetDictValue('MoveType', MoveTypeID_NODB4Other, 'Network')==1&&Head_NetworkID<=0, MessageFacade('M7294','请输入网络'), true, true)]]>
                                    </CheckRule>
                                </DataBinding>
                                <ItemFilter ItemKey="PS_Network">
                                    <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                        <FilterValue Index="1" ParaValue="IIF(WBSElementID&gt;0,'soid in ( select soid from EPS_Network where WBSElementID='&amp;SqlPara(WBSElementID)&amp;')','CompanyCodeID='&amp;SqlPara(GetDictValue('Plant', HeadPlantID, 'CompanyCodeID')))"/>
                                    </Filter>
                                </ItemFilter>
                            </Dict>
                            <Dict Key="Head_ActivityID" Caption="作业" LabelType="M" Enable="!ReadOnly()&amp;&amp;Head_WBSElementID&lt;=0&amp;&amp;Macro_GetHeadFieldVisibleByHead('Network')" ItemKey="PS_Activity">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_ActivityID"/>
                                <ItemFilter ItemKey="PS_Activity">
                                    <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                        <FilterValue Index="1" ParaValue="IIF(Head_NetworkID&gt;0, 'NetworkID='&amp;SqlPara(Head_NetworkID), '1=2')"/>
                                    </Filter>
                                </ItemFilter>
                            </Dict>
                            <Dict Key="Head_VendorID" Caption="供应商" LabelType="M" Enable="!ReadOnly()&amp;&amp;SpecialIdentity_NODB4Other!='M'&amp;&amp;Macro_GetHeadFieldVisibleByHead('Vendor')" ItemKey="Vendor">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_VendorID">
                                    <CheckRule>
                                        <![CDATA[IIFS(SpecialIdentity_NODB4Other!='M'&&GetDictValue('MoveType', MoveTypeID_NODB4Other, 'Vendor')==1&&Head_VendorID<=0, MessageFacade('M7071','请输入供应商'), true, true)]]>
                                    </CheckRule>
                                    <DefaultFormulaValue>
                                        <![CDATA[IIF(SpecialIdentity_NODB4Other=='M',Head_IdentityID,Head_VendorID)]]>
                                    </DefaultFormulaValue>
                                </DataBinding>
                            </Dict>
                            <Dict Key="Head_AssetCardSOID" Caption="资产" LabelType="M" Enable="!ReadOnly()&amp;&amp;Macro_GetHeadFieldVisibleByHead('AssetsCard')" ItemKey="AM_AssetCard__Dic" StateMask="Enable|Disable|Discard">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_AssetCardSOID">
                                    <CheckRule>
                                        <![CDATA[IIFS(GetDictValue('MoveType', MoveTypeID_NODB4Other, 'AssetsCard')==1&&Head_AssetCardSOID<=0, MessageFacade('MM_MSEG020','请输入资产'), true, true)]]>
                                    </CheckRule>
                                </DataBinding>
                                <ItemFilter ItemKey="AM_AssetCard__Dic">
                                    <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                        <FilterValue Index="1" ParaValue="IIF(HeadPlantID&gt;0, 'AssetCardStatus&lt;'&amp;SqlPara(2)&amp;' and IsBlock = '&amp;SqlPara(0)&amp;' and CompanyCodeID='&amp;SqlPara(GetDictValue('Plant', HeadPlantID, 'CompanyCodeID')), '1=2')"/>
                                    </Filter>
                                </ItemFilter>
                            </Dict>
                            <Dict Key="Head_GLAccountID" Caption="总账科目" LabelType="M" Enable="!ReadOnly()&amp;&amp;IIF(parent.GetPara('IsDistribution'), true, Macro_GetHeadFieldVisibleByHead('AccountControl'))" ItemKey="Account">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_GLAccountID">
                                    <CheckRule>
                                        <![CDATA[IIFS(Head_GLAccountID>0&&GetDictValue('Account', Head_GLAccountID, 'NodeType')!=0, '不能选择汇总节点', GetDictValue('MoveType', MoveTypeID_NODB4Other, 'AccountControl')==1&&Head_GLAccountID<=0, MessageFacade('MM_MSEG015','请输入总账科目'), true, true)]]>
                                    </CheckRule>
                                    <DefaultFormulaValue>
                                        <![CDATA[IIF(PickingCostTypeID>0,GetDictValue('DM_PickingCostType',PickingCostTypeID,'AccountID'),Head_GLAccountID)]]>
                                    </DefaultFormulaValue>
                                </DataBinding>
                                <ItemFilter>
                                    <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                        <FilterValue Index="1" ParaValue="IIF(HeadPlantID&gt;0,' AccountChartID in ( select distinct t1.OID from bk_accountchart t1 join bk_companycode t2 on t1.OID = t2.AccountChartID join bk_plant t3 on t2.OID = t3.CompanyCodeID where t3.OID='&amp;SqlPara(HeadPlantID)&amp;')',' 1=1 ')"/>
                                    </Filter>
                                </ItemFilter>
                            </Dict>
                            <Dict Key="Head_PartnerBusinessAreaID" Caption="业务范围" LabelType="M" Enable="IIF(com.bokesoft.erp.fi.voucher.VoucherFormula.getBusinessAreaID(HeadPostingDate,Head_AssetCardSOID,0,CostCenterID,Head_OrderCategory,Head_PPOrderNoID,Head_WBSElementID,Head_NetworkID,Head_ActivityID,true)&gt;0,false,!ReadOnly()&amp;&amp;Macro_GetHeadFieldVisibleByList('BusinessArea'))" ItemKey="BusinessArea" OneTimeCompute="true">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_PartnerBusinessAreaID">
                                    <CheckRule>
                                        <![CDATA[IIFS(Macro_GetFieldValueByMoveTypeID(MoveTypeID_NODB4Other,SpecialIdentity_NODB4Other,'BusinessArea')==1&&Head_PartnerBusinessAreaID<=0, MessageFacade('MM_MSEG016','请输入业务范围'), true, true)]]>
                                    </CheckRule>
                                    <DefaultFormulaValue>
                                        <![CDATA[com.bokesoft.erp.fi.voucher.VoucherFormula.getBusinessAreaID(HeadPostingDate,Head_AssetCardSOID,0,CostCenterID,Head_OrderCategory,Head_PPOrderNoID,Head_WBSElementID,Head_NetworkID,Head_ActivityID,true)]]>
                                    </DefaultFormulaValue>
                                </DataBinding>
                            </Dict>
                            <Dict Key="Head_PartnerProfitCenterID" Caption="利润中心" LabelType="M" Enable="IIF(com.bokesoft.erp.fi.voucher.VoucherFormula.getProfitCenterID(0,HeadPostingDate,Head_AssetCardSOID,0,Head_GLAccountID,0,CostCenterID,Head_OrderCategory,Head_PPOrderNoID,Head_WBSElementID,Head_NetworkID,Head_ActivityID,true)&gt;0,false,!ReadOnly()&amp;&amp;(Macro_GetHeadFieldVisibleByHead('AccountControl'))||(Macro_GetHeadFieldVisibleByList('BusinessArea'))||(Macro_GetHeadFieldVisibleByList('CostCenter'))||IIF(parent.GetPara('IsDistribution'), true, false))" ItemKey="ProfitCenter" OneTimeCompute="true">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_PartnerProfitCenterID">
                                    <DefaultFormulaValue>
                                        <![CDATA[com.bokesoft.erp.fi.voucher.VoucherFormula.getProfitCenterID(0,HeadPostingDate,Head_AssetCardSOID,0,Head_GLAccountID,0,CostCenterID,Head_OrderCategory,Head_PPOrderNoID,Head_WBSElementID,Head_NetworkID,Head_ActivityID,true)]]>
                                    </DefaultFormulaValue>
                                </DataBinding>
                            </Dict>
                            <Dict Key="Head_Reference2ReservationID" Caption="预留" LabelType="M" Enable="false" ItemKey="MM_Reservation__Dic" StateMask="Enable|Disable|Discard">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_Reference2ReservationID"/>
                            </Dict>
                            <Dict Key="Head_SaleOrderDtlOID" Caption="销售订单-行号" LabelType="M" Visible="Macro_GetHeadFieldVisibleByList('SaleOrder')" ItemKey="SD_SaleOrderDtl__Dic" StateMask="Enable|Disable|Discard">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_SaleOrderDtlOID">
                                    <CheckRule>
                                        <![CDATA[IIFS(Macro_GetFieldValueByMoveTypeID(MoveTypeID_NODB4Other,SpecialIdentity_NODB4Other,'SaleOrder')==1&&Head_SaleOrderDtlOID<=0, MessageFacade('M7073','请输入销售订单-行号'), true, true)]]>
                                    </CheckRule>
                                </DataBinding>
                            </Dict>
                            <Dict Key="Head_CustomerID" Caption="客户" LabelType="M" Visible="Macro_GetHeadFieldVisibleByHead('Customer')" ItemKey="Customer">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_CustomerID">
                                    <CheckRule>
                                        <![CDATA[IIFS(GetDictValue('MoveType', MoveTypeID_NODB4Other, 'Customer')==1&&Head_CustomerID<=0, MessageFacade('M7072','请输入客户'), true, true)]]>
                                    </CheckRule>
                                </DataBinding>
                            </Dict>
                            <Dict Key="Head_SrcUBPurchaseOrderSOID" Caption="采购订单" LabelType="M" Visible="Macro_GetHeadFieldVisibleByList('POOrder')" Enable="true" ItemKey="MM_PurchaseOrder__Dic" StateMask="Enable|Disable|Discard">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Head_SrcUBPurchaseOrderSOID" ValueChanged="IIF(isWFMapping(),true,Macro_Ub351Allocate());"/>
                            </Dict>
                            <ComboBox Key="BusinessType" Caption="业务类型" LabelType="M" Visible="IIF(parent.GetPara('IsDistribution'), true, false)" SourceType="ParaGroup" GroupKey="PickingBusinessType">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="BusinessType"/>
                            </ComboBox>
                            <Dict Key="BusinessEmployeeID" Caption="业务员" LabelType="M" Visible="IIF(parent.GetPara('IsDistribution'), true, false)" ItemKey="HR_Employee">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="BusinessEmployeeID"/>
                            </Dict>
                            <Dict Key="PickingCostTypeID" Caption="领货费用类型" LabelType="M" Visible="IIF(parent.GetPara('IsDistribution'), true, false)" ItemKey="DM_PickingCostType">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="PickingCostTypeID"/>
                            </Dict>
                            <Dict Key="PickingOperatorID" Caption="领货人" LabelType="M" Visible="IIF(parent.GetPara('IsDistribution'), true, false)" ItemKey="HR_Employee">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="PickingOperatorID"/>
                            </Dict>
                            <TextEditor Key="PickingReason" Caption="领货原因" LabelType="M" Visible="IIF(parent.GetPara('IsDistribution'), true, false)">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="PickingReason"/>
                            </TextEditor>
                            <Dict Key="MoveTypeID" Caption="移动类型" LabelType="M" Visible="IIF(parent.GetPara('IsDistribution'), true, false)" Enable="false" ItemKey="MoveType">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="MoveTypeID" DefaultFormulaValue="MoveTypeID_NODB4Other"/>
                            </Dict>
                        </FlexGridLayoutPanel>
                        <GridLayoutPanel Key="ScanMaterialDtlGridLayoutPanel" Caption="物料明细扫码" Height="pref" Padding="8px" OverflowY="Auto" TopPadding="24px" Visible="!Macro_Is_Show();">
                            <TextButton Key="MaterialID_Btn" Caption="物料" X="0" Y="0" Visible="true" Enable="true" MaxLength="100" Trim="true">
                                <DataBinding ValueChanged="Macro_MM_MSEGgetMaterial();"/>
                                <OnClick>
                                    <![CDATA[ERPShowModal('Material_Dic_Browser',GetCallFormula('Macro_Material_ShowEvent','MaterialID_Btn'))]]>
                                </OnClick>
                            </TextButton>
                            <RowDefCollection RowGap="24">
                                <RowDef Height="32px"/>
                            </RowDefCollection>
                            <ColumnDefCollection ColumnGap="16">
                                <ColumnDef Width="250px"/>
                            </ColumnDefCollection>
                        </GridLayoutPanel>
                        <GridLayoutPanel Key="BasicInfoGridLayoutPanel" Caption="基本信息" Padding="8px" OverflowY="Auto" TopPadding="24px" Visible="Macro_IsShowMSEG()">
                            <UTCDatePicker Key="Head_MSEGDocumentDate" Caption="凭证日期" LabelType="M" X="0" Y="0" Visible="true" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('HeadDocumentDate')" Format="yyyy-MM-dd">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="DocumentDate"/>
                            </UTCDatePicker>
                            <UTCDatePicker Key="HeadMSEGPostingDate" Caption="过账日期" LabelType="M" X="1" Y="0" Visible="true" Enable="!ReadOnly()&amp;&amp;(Macro_GetMSEGFieldEnable('HeadPostingDate')||IsNew())&amp;&amp;ToInt(IsFromReverse)!=1" Format="yyyy-MM-dd">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="PostingDate"/>
                            </UTCDatePicker>
                            <TextEditor Key="DocumentNumber_MSEG" Caption="凭证编号" X="2" Y="0" Visible="true" Enable="!ReadOnly()&amp;&amp;com.bokesoft.erp.documentNumber.DocumentNumber.docNumberFieldEnable('DocumentNumber')" MaxLength="50" Trim="true">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="DocumentNumber">
                                    <CheckRule>
                                        <![CDATA[IIFS(com.bokesoft.erp.documentNumber.DocumentNumber.docNumberFieldEnable('DocumentNumber')&&DocumentNumber=='', '采用外部给号编码规则，请输入代码', true, true)]]>
                                    </CheckRule>
                                </DataBinding>
                            </TextEditor>
                            <NumberEditor Key="MSEGFiscalYear" Caption="物料凭证年度" LabelType="M" X="3" Y="0" Visible="true" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('DocFiscalYear')" IntegerValue="true" Precision="9" Scale="0" UseGroupingSeparator="false">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="MSEGFiscalYear">
                                    <DefaultFormulaValue>
                                        <![CDATA[IIF(PlantID<=0,0,com.bokesoft.erp.basis.date.PeriodFormula.getYearByDate(GetDictValue('CompanyCode', GetDictValue('Plant', PlantID, 'CompanyCodeID'), 'PeriodTypeID'),HeadPostingDate))]]>
                                    </DefaultFormulaValue>
                                </DataBinding>
                            </NumberEditor>
                            <TextEditor Key="Notes" Caption="抬头文本" X="4" Y="0" Visible="true" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('Notes')" Trim="true" XSpan="2">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Notes"/>
                            </TextEditor>
                            <TextEditor Key="DeliverySlip_MSEG" Caption="交货单" LabelType="M" X="0" Y="1" Visible="Length(DeliverySlip)&gt;0" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('DeliverySlip')" MaxLength="100" Trim="true">
                                <DataBinding TableKey="EMM_MaterialDocument" ColumnKey="DeliverySlip"/>
                            </TextEditor>
                            <TextEditor Key="BillofLadingNo" Caption="提货单" LabelType="M" X="0" Y="1" Visible="Length(BillofLadingNo)&gt;0" MaxLength="100" Trim="true">
                                <DataBinding TableKey="EMM_MaterialDocument" ColumnKey="BillofLadingNo"/>
                            </TextEditor>
                            <RowDefCollection RowGap="24">
                                <RowDef Height="32px"/>
                                <RowDef Height="32px"/>
                            </RowDefCollection>
                            <ColumnDefCollection ColumnGap="16">
                                <ColumnDef Width="16%"/>
                                <ColumnDef Width="16%"/>
                                <ColumnDef Width="17%"/>
                                <ColumnDef Width="17%"/>
                                <ColumnDef Width="17%"/>
                                <ColumnDef Width="17%"/>
                            </ColumnDefCollection>
                        </GridLayoutPanel>
                        <SplitPanel Key="BatchManagement" Caption="批次管理" Orientation="Vertical" Visible="ToBool(IsBatchManagement)&amp;&amp;!Macro_IsShowMSEG()">
                            <SubDetail Key="BatchManagementCondition" BindingGridKey="MaterialDocumentDtl">
                                <GridLayoutPanel Key="CreateBatchMangement" Padding="8px" OverflowY="Auto" TopPadding="24px">
                                    <Dict Key="PlantID__mirror" Caption="工厂" X="0" Y="0" Visible="true" BindingCellKey="PlantID" ItemKey="Plant"/>
                                    <Dict Key="StorageLocationID__mirror" Caption="库存地点" X="1" Y="0" Visible="true" BindingCellKey="StorageLocationID" ItemKey="StorageLocation">
                                        <ItemFilter ItemKey="StorageLocation">
                                            <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                <FilterValue Index="1" ParaValue="IIF(PlantID&gt;0, 'PlantID='&amp;SqlPara(PlantID), '1=2')"/>
                                            </Filter>
                                        </ItemFilter>
                                    </Dict>
                                    <Dict Key="MaterialID__mirror" Caption="物料" X="2" Y="0" Visible="true" BindingCellKey="MaterialID" ItemKey="Material"/>
                                    <TextButton Key="BatchCode__mirror" Caption="批次" X="0" Y="1" Visible="true" BindingCellKey="BatchCode" Case="Upper" MaxLength="30" Trim="true">
                                        <OnClick>
                                            <![CDATA[Macro_SetBatchCode(Direction, PlantID, MaterialID, 'StorageLocationID', 'StoragePointID', StockType, SpecialIdentity, DynIdentityID, 'BatchCode', 'Quantity')]]>
                                        </OnClick>
                                    </TextButton>
                                    <Button Key="CreateBatchCodeNumber" Caption="生成批次" X="1" Y="1" Visible="Direction&gt;0" Type="Normal">
                                        <OnClick>
                                            <![CDATA[var batchCode=Macro_CreateBatchCodeNumber_ButtonClickTrg();                                    if(batchCode!='' && batchCode!='_'){                                   SetValue('BatchCodeType', 0);SetValue('BatchCode', batchCode);Macro_BatchCode_ValueChange();                              }]]>
                                        </OnClick>
                                    </Button>
                                    <Dict Key="GlobalValuationTypeID__mirror" Caption="评估类型" X="0" Y="2" Visible="Macro_isActivateSplitValuation()" Enable="!ReadOnly()&amp;&amp;Macro_IsSplitValuation()&amp;&amp;!Macro_ReservationOrderHaveValuationtype()&amp;&amp;IIF(Direction==1,!(GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB31'&amp;&amp;Macro_ProductionOrderIsReceipted()),!ToBool(IsBatchManagement))" BindingCellKey="Dtl_GlobalValuationTypeID" ItemKey="MM_GlobalValuationType"/>
                                    <UTCDatePicker Key="ManufactureDate__mirror" Caption="生产日期" X="1" Y="2" Visible="Macro_ManufactureDateOrShelfLifeExpirationDateVisible(Dtl_MoveTypeID,PlantID,MaterialID,ToBool(IsBatchManagement))" BindingCellKey="ManufactureDate" Format="yyyy-MM-dd"/>
                                    <UTCDatePicker Key="ShelfLifeDate__mirror" Caption="货架寿命到期日" X="2" Y="2" Visible="Macro_ManufactureDateOrShelfLifeExpirationDateVisible(Dtl_MoveTypeID,PlantID,MaterialID,ToBool(IsBatchManagement))" BindingCellKey="ShelfLifeDate" Format="yyyy-MM-dd"/>
                                    <Dict Key="Dtl_CategoryTypeID__mirror" Caption="类别种类" X="0" Y="3" Visible="true" Enable="false" BindingCellKey="Dtl_CategoryTypeID" ItemKey="MM_CategoryType"/>
                                    <!--<ItemFilter ItemKey="MM_CategoryType">
                                            <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                <FilterValue Index="1" ParaValue="' IsAllow = '&amp;SqlPara(1)"/>
                                            </Filter>
                                        </ItemFilter>-->
                                    <RowDefCollection RowGap="24">
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                    </RowDefCollection>
                                    <ColumnDefCollection ColumnGap="16">
                                        <ColumnDef Width="33%"/>
                                        <ColumnDef Width="33%"/>
                                        <ColumnDef Width="34%"/>
                                    </ColumnDefCollection>
                                </GridLayoutPanel>
                            </SubDetail>
                            <SubDetail Key="BatchManagementDtl" BindingGridKey="MaterialDocumentDtl">
                                <FlexFlowLayoutPanel Key="MSEGCharacteInputPanel" Caption="P2" Visible="true" Padding="8px">
                                    <Embed Key="MM_CharacteristicInput" FormKey="MM_CharacteristicInput" RootKey="Charact_InputFlexFlowLayoutPanel" Height="100%">
                                        <Var Key="ParentKey" Value="EMM_MaterialDocument"/>
                                    </Embed>
                                </FlexFlowLayoutPanel>
                            </SubDetail>
                            <SplitSize Size="125px"/>
                            <SplitSize Size="250px"/>
                        </SplitPanel>
                        <SplitPanel Key="BatchSelect" Caption="选择批" Orientation="Vertical" Visible="ToBool(IsBatchManagement)&amp;&amp;Direction==-1&amp;&amp;!Macro_IsShowMSEG()">
                            <SubDetail Key="BatchSelectDtl" BindingGridKey="MaterialDocumentDtl">
                                <GridLayoutPanel Key="BatchSelectCondition" Padding="8px" OverflowY="Auto" TopPadding="24px" Visible="Direction==-1&amp;&amp;(BatchCode=='*'||BatchCode=='**')">
                                    <Dict Key="PlantID__mirror1" Caption="工厂" X="0" Y="0" Visible="true" Enable="false" BindingCellKey="PlantID" ItemKey="Plant" XSpan="2"/>
                                    <Dict Key="MaterialID__mirror1" Caption="物料" X="2" Y="0" Visible="true" Enable="false" BindingCellKey="MaterialID" ItemKey="Material" XSpan="2"/>
                                    <UTCDatePicker Key="PostingDate" Caption="需求日期" X="4" Y="0" Visible="true" Enable="false" Format="yyyy-MM-dd" XSpan="2">
                                        <DataBinding DefaultFormulaValue="HeadPostingDate"/>
                                    </UTCDatePicker>
                                    <NumberEditor Key="Quantity__mirror" Caption="需求数量" X="0" Y="1" Visible="true" Enable="false" BindingCellKey="Quantity" Scale="3"/>
                                    <Dict Key="UnitID__mirror" Caption="单位" X="1" Y="1" Visible="true" Enable="false" BindingCellKey="UnitID" ItemKey="Unit">
                                        <ItemFilter ItemKey="Unit">
                                            <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                <FilterValue Index="1" ParaValue="IIF(MaterialID&gt;0, 'soid in ('&amp;com.bokesoft.erp.basis.unit.UnitFormula.getUnitFmMaterial(MaterialID)&amp;')', '1=2')"/>
                                            </Filter>
                                        </ItemFilter>
                                    </Dict>
                                    <NumberEditor Key="OutstandingQuantity" Caption="未清数量" LabelType="M" X="2" Y="1" Visible="true" Enable="false" Scale="3">
                                        <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="OutstandingQuantity">
                                            <CheckRule>
                                                <![CDATA[IIF(OutstandingQuantity>=0, true, MessageFacade('MM_MSEG021','请输入大于等于0的未清数量'))]]>
                                            </CheckRule>
                                        </DataBinding>
                                    </NumberEditor>
                                    <Dict Key="UnitID__mirror1" Caption="单位" X="3" Y="1" Visible="true" Enable="false" BindingCellKey="UnitID" ItemKey="Unit">
                                        <ItemFilter ItemKey="Unit">
                                            <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                <FilterValue Index="1" ParaValue="IIF(MaterialID&gt;0, 'soid in ('&amp;com.bokesoft.erp.basis.unit.UnitFormula.getUnitFmMaterial(MaterialID)&amp;')', '1=2')"/>
                                            </Filter>
                                        </ItemFilter>
                                    </Dict>
                                    <Button Key="UseThose" Caption="使用" X="4" Y="1" Visible="true" Type="Normal">
                                        <OnClick>
                                            <![CDATA[Macro_UseThose_OnClick()]]>
                                        </OnClick>
                                    </Button>
                                    <Button Key="ConditionRecordAnalyse" Caption="分析" X="5" Y="1" Visible="true" Enable="true" Type="Normal">
                                        <OnClick>
                                            <![CDATA[SetPara('conditionRecordParentGridItemOID',Dtl_OID);ERPShowModal('ConditionProcessDetail_Rpt');]]>
                                        </OnClick>
                                    </Button>
                                    <ComboBox Key="BatchOutboundSequence__mirror" Caption="批次出库顺序" X="6" Y="1" Visible="true" Enable="!ReadOnly()&amp;&amp;IIF(Macro_IsShowMSEG(),Macro_GetMSEGFieldEnable('BatchCode'),true)&amp;&amp;ToBool(IsBatchManagement)&amp;&amp;!Macro_ReservationOrderHaveBatchCode()&amp;&amp;!Macro_ProductOrderHaveBatchCode()" SourceType="ParaGroup" GroupKey="BatchOutboundSequenceGroup" IntegerValue="true" BindingCellKey="BatchOutboundSequence"/>
                                    <RowDefCollection RowGap="24">
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                    </RowDefCollection>
                                    <ColumnDefCollection ColumnGap="16">
                                        <ColumnDef Width="18%"/>
                                        <ColumnDef Width="7%"/>
                                        <ColumnDef Width="18%"/>
                                        <ColumnDef Width="7%"/>
                                        <ColumnDef Width="13%"/>
                                        <ColumnDef Width="12%"/>
                                        <ColumnDef Width="25%"/>
                                    </ColumnDefCollection>
                                </GridLayoutPanel>
                            </SubDetail>
                            <SubDetail Key="MateralBatchCodeSplit" BindingGridKey="MaterialDocumentDtl">
                                <FlexFlowLayoutPanel Key="MateralBatchCodeSplitDtlFlexFlowLayoutPanel" Caption="P10" Visible="true" Padding="8px">
                                    <Embed Key="MM_BatchCodeSplitGrid_Impl" FormKey="MM_BatchCodeSplitGrid_Impl" RootKey="BS_BatchCodeSplitGridPanel" Height="100%">
                                        <Var Key="ParentKey" Value="EMM_MaterialDocument"/>
                                    </Embed>
                                </FlexFlowLayoutPanel>
                            </SubDetail>
                            <SplitSize Size="120px"/>
                            <SplitSize Size="250px"/>
                        </SplitPanel>
                        <SplitPanel Key="SerialNumber" Caption="序列号" Orientation="Vertical" Visible="com.bokesoft.erp.mm.masterdata.SerialNumberFormula.isSNNumberVisible(MaterialID,PlantID,'MMSL')">
                            <SubDetail Key="SerialNumberDtl" BindingGridKey="MaterialDocumentDtl">
                                <GridLayoutPanel Key="SerialNumberGridLayoutPanel" Padding="8px" OverflowY="Auto" TopPadding="24px">
                                    <Dict Key="MaterialID__mirror4" Caption="物料" X="0" Y="0" Visible="true" Enable="false" BindingCellKey="MaterialID" ItemKey="Material"/>
                                    <Dict Key="PlantID__mirror4" Caption="工厂" X="1" Y="0" Visible="true" Enable="false" BindingCellKey="PlantID" ItemKey="Plant"/>
                                    <Button Key="AutoCreateSNNumber" Caption="自动创建序列号" X="2" Y="0" Visible="true" Enable="!IsEmptyRow('MaterialDocumentDtl', -1)&amp;&amp;!ReadOnly()" Type="Normal">
                                        <OnClick>
                                            <![CDATA[Macro_AutoCreateSNNumber_ButtonClickTrg();]]>
                                        </OnClick>
                                    </Button>
                                    <RowDefCollection RowGap="24">
                                        <RowDef Height="32px"/>
                                    </RowDefCollection>
                                    <ColumnDefCollection ColumnGap="16">
                                        <ColumnDef Width="25%"/>
                                        <ColumnDef Width="25%"/>
                                        <ColumnDef Width="150px"/>
                                        <ColumnDef Width="25%"/>
                                        <ColumnDef Width="25%"/>
                                    </ColumnDefCollection>
                                </GridLayoutPanel>
                            </SubDetail>
                            <SubDetail Key="SNNumberInputDtl" BindingGridKey="MaterialDocumentDtl">
                                <FlexFlowLayoutPanel Key="SNNumberInputFlexFlowLayoutPanel" Caption="P6" Visible="true" Padding="8px">
                                    <Embed Key="MM_SNNumberInput" FormKey="MM_SNNumberInput" RootKey="MM_SNNumberInputRoot" Height="100%">
                                        <Var Key="ParentKey" Value="EMM_MaterialDocument"/>
                                    </Embed>
                                </FlexFlowLayoutPanel>
                            </SubDetail>
                            <SplitSize Size="60px"/>
                            <SplitSize Size="200px"/>
                        </SplitPanel>
                        <SubDetail Key="BatchStrategyAnalysis" Caption="批次策略分析过程" BindingGridKey="MaterialDocumentDtl" Visible="false">
                            <FlexFlowLayoutPanel Key="BatchStrategyAnalysisFlexFlowLayoutPanel" Caption="批次策略分析过程" Visible="false">
                                <Embed Key="ConditionProcessDetail" FormKey="ConditionProcessDetail" RootKey="ConditionProcessDetailRoot" Height="100%">
                                    <Var Key="CndTechCndTypesTableKey" Value="EMM_MD_CndTechCndTypes"/>
                                    <Var Key="CndTechCndTypesIndexPrefix" Value="EMM_MD_CndTechCndTypes"/>
                                    <Var Key="CndTechCndTypesParentTableKey" Value="EMM_MaterialDocument"/>
                                    <Var Key="CndTechCndTypesPrimaryKey" Value="EMM_MD_CndTechCndTypes"/>
                                    <Var Key="CndTechCndAccSqnsTableKey" Value="EMM_MD_CndTechCndAccSqns"/>
                                    <Var Key="CndTechCndAccSqnsIndexPrefix" Value="EMM_MD_CndTechCndAccSqns"/>
                                    <Var Key="CndTechCndAccSqnsParentTableKey" Value="EMM_MD_CndTechCndTypes"/>
                                    <Var Key="CndTechCndAccSqnsPrimaryKey" Value="EMM_MD_CndTechCndAccSqns"/>
                                    <Var Key="CndTechCndFieldsTableKey" Value="EMM_MD_CndTechCndFields"/>
                                    <Var Key="CndTechCndFieldsIndexPrefix" Value="EMM_MD_CndTechCndFields"/>
                                    <Var Key="CndTechCndFieldsParentTableKey" Value="EMM_MD_CndTechCndAccSqns"/>
                                    <Var Key="CndTechCndFieldsPrimaryKey" Value="EMM_MD_CndTechCndFields"/>
                                </Embed>
                            </FlexFlowLayoutPanel>
                        </SubDetail>
                        <FlexFlowLayoutPanel Key="BodySystem" Caption="系统信息" Padding="8px">
                            <Embed Key="BodySystemEmbed" FormKey="BodySystemEntityForm" RootKey="SystemInfoPanel">
                                <Var Key="SystemInfoTableKey" Value="EMM_MaterialDocumentHead"/>
                            </Embed>
                        </FlexFlowLayoutPanel>
                        <FlexGridLayoutPanel Key="HiddenInformation" Caption="隐藏信息" ColumnCount="3" ColumnGap="16" OverflowY="Auto" RowGap="24" Visible="false">
                            <CheckBox Key="IsFromReverse" Caption="来自冲销" LabelType="M" X="4" Y="0" Visible="true">
                                <DataBinding TableKey="EMM_MaterialDocument" ColumnKey="IsFromReverse"/>
                            </CheckBox>
                            <CheckBox Key="IsFromReservation" Caption="来源预留" LabelType="M" X="0" Y="1" Visible="true">
                                <DataBinding TableKey="EMM_MaterialDocument" ColumnKey="IsFromReservation"/>
                            </CheckBox>
                            <CheckBox Key="IsFromBOM" Caption="来源BOM" LabelType="M" X="4" Y="1" Visible="true">
                                <DataBinding TableKey="EMM_MaterialDocument" ColumnKey="IsFromBOM"/>
                            </CheckBox>
                            <CheckBox Key="IsFromMSEG" Caption="来源物料凭证" LabelType="M" X="0" Y="2" Visible="true">
                                <DataBinding TableKey="EMM_MaterialDocument" ColumnKey="IsFromMSEG"/>
                            </CheckBox>
                            <CheckBox Key="IsVestBill" Caption="马甲" LabelType="M" X="2" Y="2" Visible="true">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="IsVestBill" DefaultFormulaValue="Macro_IsVestBill()"/>
                            </CheckBox>
                            <Dict Key="TCodeID" Caption="TCodeID" X="2" Y="3" Visible="true" ItemKey="TCode">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="TCodeID" DefaultFormulaValue="IIF(TCodeID &gt; 0,TCodeID,ActiveTCodeID)"/>
                            </Dict>
                            <Dict Key="CheckingRuleID" Caption="检查规则" LabelType="M" X="4" Y="4" Visible="true" ItemKey="MM_CheckingRule">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="CheckingRuleID">
                                    <DefaultFormulaValue>
                                        <![CDATA[com.bokesoft.erp.sd.function.ATPControlFormula.findCheckingRule(Dtl_TCodeID)]]>
                                    </DefaultFormulaValue>
                                </DataBinding>
                            </Dict>
                            <TextEditor Key="DocumentNumber" Caption="单据编号" LabelType="M" X="0" Y="6" Visible="true" Enable="false" MaxLength="50" Trim="true" XSpan="2">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="DocumentNumber"/>
                            </TextEditor>
                            <UTCDatePicker Key="HeadDocumentDate" Caption="凭证日期" LabelType="M" X="2" Y="6" Visible="true" Format="yyyy-MM-dd" XSpan="2">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="DocumentDate" DefaultFormulaValue="DateLong()"/>
                            </UTCDatePicker>
                            <TextEditor Key="MaterialSlip" Caption="物料单" LabelType="M" X="4" Y="6" Visible="true" MaxLength="100" Trim="true" XSpan="2">
                                <DataBinding TableKey="EMM_MaterialDocument" ColumnKey="MaterialSlip" DefaultFormulaValue="HeadMaterialSlip"/>
                            </TextEditor>
                            <TextEditor Key="HeadMaterialSlip" Caption="物料单" LabelType="M" X="4" Y="6" Visible="true" MaxLength="100" Trim="true" XSpan="2">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="HeadMaterialSlip"/>
                            </TextEditor>
                            <Dict Key="HeadStorageLocationID" Caption="库存地点" LabelType="M" X="2" Y="7" Visible="true" ItemKey="StorageLocation" XSpan="2">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="HeadStorageLocationID"/>
                                <ItemFilter ItemKey="StorageLocation">
                                    <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                        <FilterValue Index="1" ParaValue="IIF(HeadPlantID&gt;0, 'PlantID='&amp;SqlPara(HeadPlantID), '1=2')"/>
                                    </Filter>
                                </ItemFilter>
                            </Dict>
                            <Dict Key="HeadReason4MovementID" Caption="移动原因" LabelType="M" X="4" Y="7" Visible="MoveTypeID_NODB4Other&gt;0&amp;&amp;GetDictValue('MoveType', MoveTypeID_NODB4Other, 'ControlReason')!=2" ItemKey="MM_Reason4Movement" XSpan="2">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="HeadReason4MovementID"/>
                                <ItemFilter ItemKey="MM_Reason4Movement">
                                    <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                        <FilterValue Index="1" ParaValue="IIF(MoveTypeID_NODB4Other&gt;0, 'EMM_Reason4Movement.soid in(Select soid from EMM_Reason4MovementDtl where MoveTypeID='&amp;SqlPara(MoveTypeID_NODB4Other)&amp;')', '1=2')"/>
                                    </Filter>
                                </ItemFilter>
                            </Dict>
                            <Dict Key="HeadPlantID" Caption="工厂" X="0" Y="8" Visible="true" ItemKey="Plant" XSpan="2">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="HeadPlantID"/>
                            </Dict>
                            <Dict Key="ToMSEGSOID" Caption="到物料凭证" X="0" Y="9" Visible="true" ItemKey="MM_MSEG__Dic" StateMask="Enable|Disable|Discard">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="ToMSEGSOID"/>
                            </Dict>
                            <TextEditor Key="HeadDeliverySlip" Caption="交货单" LabelType="M" X="2" Y="9" Visible="true" MaxLength="100" Trim="true">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="HeadDeliverySlip"/>
                            </TextEditor>
                            <TextEditor Key="DeliverySlip" Caption="交货单" LabelType="M" X="2" Y="9" Visible="true" MaxLength="100" Trim="true">
                                <DataBinding TableKey="EMM_MaterialDocument" ColumnKey="DeliverySlip" DefaultFormulaValue="HeadDeliverySlip"/>
                            </TextEditor>
                            <CheckBox Key="IsReverse4Migration" Caption="冲销（迁移）" LabelType="M" X="4" Y="2" Visible="true">
                                <DataBinding TableKey="EMM_MaterialDocument" ColumnKey="IsReverse4Migration"/>
                            </CheckBox>
                            <NumberEditor Key="SrcGoodsReceiptSOID" Caption="SrcGoodsReceiptSOID" X="2" Y="5" Visible="true" Scale="0" UseGroupingSeparator="false">
                                <DataBinding TableKey="EMM_MaterialDocument" ColumnKey="SrcGoodsReceiptSOID"/>
                            </NumberEditor>
                            <NumberEditor Key="SrcAllocateSOID" Caption="SrcAllocateSOID" X="0" Y="5" Visible="true" Scale="0" UseGroupingSeparator="false">
                                <DataBinding TableKey="EMM_MaterialDocument" ColumnKey="SrcAllocateSOID"/>
                            </NumberEditor>
                            <TextEditor Key="DeliveryNo" Caption="交货单" LabelType="M" X="4" Y="10" Visible="true" MaxLength="100" Trim="true">
                                <DataBinding TableKey="EMM_MaterialDocument" ColumnKey="DeliveryNo"/>
                            </TextEditor>
                            <CheckBox Key="IsShowMSEG" Caption="显示凭证" LabelType="M" X="0" Y="11" Visible="true">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="IsShowMSEG">
                                    <DefaultFormulaValue>
                                        <![CDATA[IIF(GetDictValue('TCode', ActiveTCodeID, 'Code')=='MB31'||GetDictValue('TCode', ActiveTCodeID, 'Code')=='MB1C'||GetDictValue('TCode', ActiveTCodeID, 'Code')=='MB1A'||GetDictValue('TCode', ActiveTCodeID, 'Code')=='MB1B',0,1)]]>
                                    </DefaultFormulaValue>
                                </DataBinding>
                            </CheckBox>
                            <ComboBox Key="LeadOrderCategory" Caption="到类型" X="0" Y="12" Visible="true" SourceType="ParaGroup" GroupKey="OrderCategoryGroup">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="LeadOrderCategory" ValueChanged="SetValue('Head_PPOrderNoID', 0);"/>
                                <ComboFilter>
                                    <Item Key="01" Caption="内部订单" Value="01"/>
                                    <Item Key="04" Caption="成本控制生产订单" Value="04"/>
                                    <Item Key="05" Caption="生产成本归集器" Value="05"/>
                                    <Item Key="06" Caption="质量订单" Value="06"/>
                                    <Item Key="10" Caption="生产订单" Value="10"/>
                                    <Item Key="30" Caption="维护订单" Value="30"/>
                                    <Item Key="40" Caption="流程订单" Value="40"/>
                                </ComboFilter>
                            </ComboBox>
                            <TextEditor Key="LeadPPOrderNoIDDEKey" Caption="订单字典标识" X="4" Y="12" Visible="false">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="LeadPPOrderNoIDDEKey">
                                    <DefaultFormulaValue>
                                        <![CDATA[com.bokesoft.erp.mm.purchase.MigoFormula.getOrdeDataElementKey(LeadOrderCategory)]]>
                                    </DefaultFormulaValue>
                                </DataBinding>
                            </TextEditor>
                            <DynamicDict Key="LeadPPOrderNoID" Caption="订单" LabelType="M" IsDynamic="true" RefDataElementKey="LeadPPOrderNoIDDEKey" StateMask="Enable|Disable|Discard" Visible="true" X="4" Y="12">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="LeadPPOrderNoID" ValueChanged="if(LeadPPOrderNoID&gt;0){Macro_LeadPPOrderNoID();}"/>
                            </DynamicDict>
                            <TextEditor Key="LeadPPOrderNoProcess" Caption="选择需要下推工序" LabelType="M" X="4" Y="13" Visible="true" MaxLength="100" Trim="true">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="LeadPPOrderNoProcess"/>
                            </TextEditor>
                            <Dict Key="SrcTCodeID" Caption="SrcTCodeID" X="4" Y="8" Visible="true" ItemKey="TCode">
                                <DataBinding TableKey="EMM_MaterialDocument" ColumnKey="SrcTCodeID"/>
                            </Dict>
                            <Dict Key="ActiveTCodeID" Caption="ActiveTCodeID" X="2" Y="11" Visible="true" ItemKey="TCode">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="ActiveTCodeID">
                                    <DefaultFormulaValue>
                                        <![CDATA[IIF(GetEntryPara('TCode')=='',0,GetDictOID('TCode','Code', GetEntryPara('TCode')))]]>
                                    </DefaultFormulaValue>
                                </DataBinding>
                            </Dict>
                            <CheckBox Key="IsEditBill" Caption="IsEditBill" X="4" Y="11" Visible="true">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="IsEditBill">
                                    <DefaultFormulaValue>
                                        <![CDATA[IIF(GetDictValue('TCode', ActiveTCodeID, 'Code')=='MB02'||GetDictValue('TCode', ActiveTCodeID, 'Code')=='MB03',1,0)]]>
                                    </DefaultFormulaValue>
                                </DataBinding>
                            </CheckBox>
                            <CheckBox Key="IsHeadSuggestZeroLines" Caption="建议零行" X="2" Y="8" Visible="true">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="IsHeadSuggestZeroLines"/>
                            </CheckBox>
                            <NumberEditor Key="SrcPPProcessConfirmSOID" Caption="工序确认单ID" LabelType="M" X="0" Y="13" Visible="true" Scale="0" UseGroupingSeparator="false">
                                <DataBinding TableKey="EMM_MaterialDocument" ColumnKey="SrcPPProcessConfirmSOID"/>
                            </NumberEditor>
                            <Dict Key="MaterialConfigProfileID" Caption="配置参数文件" LabelType="M" X="0" Y="14" Visible="true" ItemKey="PP_MaterialConfigProfile">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="MaterialConfigProfileID"/>
                            </Dict>
                            <CheckBox Key="IsCreatedByBatchCodeConversion" Caption="来源批次" LabelType="M" X="2" Y="14">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="IsCreatedByBatchCodeConversion"/>
                            </CheckBox>
                            <TextEditor Key="MoveTypeCode_NODB4Other" Caption="移动类型" LabelType="M" X="2" Y="1" OneTimeCompute="true">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="MoveTypeCode_NODB4Other">
                                    <DefaultFormulaValue>
                                        <![CDATA[GetDictValue('MoveType', MoveTypeID_NODB4Other, 'Code')]]>
                                    </DefaultFormulaValue>
                                </DataBinding>
                            </TextEditor>
                            <NumberEditor Key="MaterialDocumentHeadSOID" Caption="BillID" X="4" Y="15">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="OID"/>
                                <Format HAlign="Right"/>
                            </NumberEditor>
                            <ComboBox Key="Status" Caption="状态" X="2" Y="1" Visible="false" Enable="false" SourceType="Status" CopyNew="false" IntegerValue="true" TextShowType="Caption">
                                <DataBinding TableKey="EMM_MaterialDocumentHead" ColumnKey="Status"/>
                            </ComboBox>
                        </FlexGridLayoutPanel>
                    </TabPanel>
                    <Grid Key="MaterialDocumentDtl" Caption="物料凭证明细" NewEmptyRow="IIF(HasParent()&amp;&amp;parent.GetPara('RO_OID')&gt;0,false,true)" Height="100%" SerialSeq="true" DisabledOption="insert" Padding="8px">
                        <GridColumnCollection>
                            <GridColumn Key="Dtl_OID" Caption="Dtl_OID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="IsSelect" Width="32px"/>
                            <GridColumn Key="ItemNumber" Caption="行项目" Width="80px"/>
                            <GridColumn Key="SuperiorLineOID" Caption="上级行" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="Dtl_MoveTypeID" Caption="移动类型" LabelType="M" Visible="Macro_DebugMode()||GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB31'" Width="80px" Sortable="true"/>
                            <GridColumn Key="Direction" Caption="方向" LabelType="H" Width="80px" Sortable="true"/>
                            <GridColumn Key="IsReversalMoveType" Caption="反向移动标识" Visible="Macro_DebugMode()" Width="120px" Sortable="true"/>
                            <GridColumn Key="GRBlockedStock" Caption="GR冻结库存" LabelType="M" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="PlantID" Caption="工厂" LabelType="H" Width="80px" Sortable="true"/>
                            <GridColumn Key="CompanyCodeID" Caption="公司代码" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="LocalCurrencyID" Caption="本位币" LabelType="M" Visible="Macro_DebugMode()" Width="80px"/>
                            <GridColumn Key="FiscalYear" Caption="会计年度" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="FiscalPeriod" Caption="会计期间" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="FiscalYearPeriod" Caption="会计期年度期间" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="MaterialID" Caption="物料" LabelType="H" Width="80px" Sortable="true"/>
                            <GridColumn Key="ShortText" Caption="描述" Visible="IIF(GetDictValue('TCode', ActiveTCodeID, 'Code')=='MB31'||GetDictValue('TCode', ActiveTCodeID, 'Code')=='MB1C'||GetDictValue('TCode', ActiveTCodeID, 'Code')=='MB1A'||GetDictValue('TCode', ActiveTCodeID, 'Code')=='MB1B',false,true)" Width="80px" Sortable="true"/>
                            <GridColumn Key="CheckingGroupID" Caption="检查组" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="MaterialTypeID" Caption="物料类型" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="IsUpdateQuantity" Caption="数量更新" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="IsValueUpdate" Caption="价值更新" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="MovementIndicator" Caption="移动标识" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="ReceiptIndicator" Caption="收货标识" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="ConsumptionIndicator" Caption="消耗过账" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="Quantity" Caption="数量" LabelType="H" Width="100px" Sortable="true"/>
                            <GridColumn Key="UnitID" Caption="单位" LabelType="H" Enable="IIF(HasParent()&amp;&amp;parent.GetPara('RO_OID')&gt;0,false,true)" Width="80px" Sortable="true"/>
                            <GridColumn Key="BrandID" Caption="品牌" LabelType="H" Visible="false" Width="80px"/>
                            <GridColumn Key="SrcPickingQuantity" Caption="原领货数量" LabelType="H" Visible="false" Enable="false" Width="100px"/>
                            <GridColumn Key="ReturnedQuantity" Caption="已退货数量" LabelType="H" Visible="false" Enable="false" Width="100px"/>
                            <GridColumn Key="Dtl_BusinessType" Caption="业务类型" LabelType="M" Visible="false" Width="80px"/>
                            <GridColumn Key="BaseQuantity" Caption="基本数量" LabelType="M" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="BaseUnitID" Caption="基本单位" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="DivisionID" Caption="产品部门" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="BaseUnitNumerator" Caption="订单到基本单位-分子" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="BaseUnitDenominator" Caption="订单到基本单位-分母" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="PriceUnitID" Caption="价格单位" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="PriceQuantity" Caption="价格数量" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="PriceUnitNumerator" Caption="订单到价格单位-分子" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="PriceUnitDenominator" Caption="订单到价格单位-分母" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="CurrencyID" Caption="币种" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="Money561" Caption="金额" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="StorageLocationID" Caption="库存地点" LabelType="M" Width="80px" Sortable="true"/>
                            <GridColumn Key="StoragePointID" Caption="子库" LabelType="H" Visible="true" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcStoragePointID" Caption="子库" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="StockType" Caption="库存类型" LabelType="M" Visible="Macro_DebugMode()||GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB31'||Macro_IsShowMSEG()||GetDictValue('MoveType', MoveTypeID_NODB4Other, 'Code')=='511'||GetDictValue('MoveType', MoveTypeID_NODB4Other, 'Code')=='512'" Width="80px" Sortable="true"/>
                            <GridColumn Key="BatchCode" Caption="批次" LabelType="H" Width="80px" Sortable="true"/>
                            <GridColumn Key="BatchCodeType" Caption="批次生成来源" LabelType="H" Visible="false" Enable="false" Width="120px"/>
                            <GridColumn Key="IsBatchRestricted" Caption="批次限制" LabelType="L" Width="80px"/>
                            <GridColumn Key="BatchLastGRGITime" Caption="批次最后入库出库时间" Visible="Macro_DebugMode()" Width="160px" Sortable="true"/>
                            <GridColumn Key="BatchCodeSOID" Caption="批次SOID" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="Dtl_CategoryTypeID" Caption="类别种类" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="Dtl_GlobalValuationTypeID" Caption="评估类型" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="GLAccountID" Caption="总账科目" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="BusinessAreaID" Caption="业务范围" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="PartnerBusinessAreaID" Caption="伙伴业务范围" LabelType="L" Visible="Macro_DebugMode()" Width="120px" Sortable="true"/>
                            <GridColumn Key="ProfitSegmentSOID" Caption="获利能力段" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="IsAllowReverse" Caption="允许冲销" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SourceFormKey" Caption="数据来源单据" Visible="Macro_DebugMode()" Width="120px" Sortable="true"/>
                            <GridColumn Key="Dtl_TCodeID" Caption="Dtl_TCodeID" Visible="false" Width="80px" Sortable="true"/>
                            <GridColumn Key="AccountAssignmentCategoryID" Caption="科目分配类别" LabelType="M" Visible="Macro_DebugMode()" Width="120px" Sortable="true"/>
                            <GridColumn Key="SpecialIdentity" Caption="特殊库存标识" LabelType="M" Width="120px" Sortable="true"/>
                            <GridColumn Key="DynIdentityID" Caption="特殊库存" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="DynIdentityIDDEKey" Caption="特殊库存字典Key" LabelType="H" Visible="false" Width="80px" Sortable="true"/>
                            <GridColumn Key="ManufactureDate" Caption="生产日期" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="ShelfLifeDate" Caption="货架寿命到期日" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="IsFinalSendGoods" Caption="该预留的最后发货" Visible="Head_Reference2ReservationID&gt;0" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcReservationDocNo" Caption="预留编号" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="SrcReservationRequirementDate" Caption="预留的需求日期" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="SrcReservationBaseQuantity" Caption="预留的需求数量" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="SrcReservationPickupBaseQuantity" Caption="预留的提货数量" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="IsDeliveryCompleted" Caption="交货已完成标识" Visible="Macro_IsShowMSEG()||(SrcProductionOrderSOID&gt;0&amp;&amp;GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB31')" Width="80px" Sortable="true"/>
                            <GridColumn Key="Dtl_Notes" Caption="文本" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="ProfitCenterID" Caption="利润中心" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="PartnerProfitCenterID" Caption="伙伴利润中心" LabelType="L" Visible="Macro_DebugMode()" Width="120px" Sortable="true"/>
                            <GridColumn Key="OrderCategory" Caption="订单类别" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="DynOrderID" Caption="订单" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="DynOrderIDDEKey" Caption="订单字典Key" Visible="false" Width="80px" Sortable="true"/>
                            <GridColumn Key="Reason4MovementID" Caption="移动原因" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="ConsumptionPosting" Caption="消耗记账" LabelType="M" Visible="false" Width="80px" Sortable="true"/>
                            <GridColumn Key="IsUpdateTotalConsumption" Caption="迁移到总消耗" LabelType="H" Visible="false" Width="120px" Sortable="true"/>
                            <GridColumn Key="IsUpdateUnplanConsumption" Caption="迁移到计划外消耗" LabelType="H" Visible="false" Width="80px" Sortable="true"/>
                            <GridColumn Key="Dtl_DocumentNumber" Caption="单据编号" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="Dtl_DocumentDate" Caption="凭证日期" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="Dtl_PostingDate" Caption="过账日期" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="Dtl_ClientID" Caption="集团" LabelType="S" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="PPOrderQuantity" Caption="已订购" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="PPRecipientQuantity" Caption="已接受" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="VendorID" Caption="供应商" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="CustomerID" Caption="客户" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcSaleOrderDtlOID" Caption="销售订单-行号" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="AssetCardSOID" Caption="资产" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="DocumentNumber_An" Caption="采购订单号" Visible="Macro_DebugMode()" Width="100px"/>
                            <GridColumn Key="SrcUBPurchaseOrderSOID" Caption="采购订单" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="Dtl_CostCenterID" Caption="成本中心" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="WBSElementID" Caption="WBS元素" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="NetworkID" Caption="网络" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="ActivityID" Caption="作业" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="Assessment" Caption="评估" LabelType="M" Visible="Macro_DebugMode()" Width="80px"/>
                            <GridColumn Key="IsSettleK" Caption="k库存结算" LabelType="H" Visible="Macro_DebugMode()" Width="90px" Sortable="true"/>
                            <GridColumn Key="IsSettleW" Caption="库存结算" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="IsReturnItem" Caption="退货项目" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcPurchaseOrderSOID" Caption="采购订单" LabelType="H" Visible="Macro_DebugMode()||GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MIGO'" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcPurchaseOrderDtlOID" Caption="SrcPurchaseOrderDtlOID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcPurchaseOrderDocNo" Caption="采购订单" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcPOItemNo" Caption="行项目" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="MapKey" Caption="MapKey" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcSOID" Caption="源单SOID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcOID" Caption="源单OID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="IsMaintenanceOrder" Caption="IsMaintenanceOrder" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcMaintenanceSOID" Caption="SrcMaintenanceBillID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcMaintenanceOID" Caption="SrcMaintenanceBillIDtlID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcReservationSOID" Caption="SrcReservationBillID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcReservationDtlOID" Caption="SrcReservationBillDtlID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcPhysicalInventorySOID" Caption="SrcPhysicalInventoryBillID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcPhysicalInventoryDtlOID" Caption="SrcPhysicalInventoryBillDtlID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcAllocateDtlOID" Caption="SrcAllocateBillDtlID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcPickingListDtlOID" Caption="SrcPickingListBillDtlID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcSaleOrderSOID" Caption="SrcSaleOrderSOID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcPOSubDtlOID" Caption="SrcSaleOrderDtlOID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcPOConfirmOID" Caption="SrcPOSubBillDtlID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcMSEGSOID" Caption="SrcPOConfirmBillDtlID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcMaterialDocumentOID" Caption="SrcMSEGBillID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SourceMSEGSOID" Caption="原始物料凭证ID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SourceMaterialDocumentOID" Caption="原始物料凭证明细ID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcGoodsReceiptDtlOID" Caption="SrcGRBillDtlID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcInboundDeliverySOID" Caption="SrcInboundDeliverySOID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcInboundDeliveryDtlOID" Caption="SrcInboundDeliveryBillDtlID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcOutboundDeliverySOID" Caption="SrcOutboundDeliveryBillID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcOutboundDeliveryDtlOID" Caption="SrcOutboundDeliveryBillDtlID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcSaleBillingSOID" Caption="SrcSaleBillingSOID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcSaleBillingDtlOID" Caption="SrcSaleBillingDtlOID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcLRPSOID" Caption="srcLRPBillID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcLRPOID" Caption="SrcLRPBillDtlID" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcServiceConfirmDtlOID" Caption="SrcServiceConfirmDtlID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcServiceAssignOID" Caption="SrcServiceAssignDtlID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcServiceAccountAssignOID" Caption="SrcServiceAccountAssignDtlID" Visible="false" Width="80px"/>
                            <GridColumn Key="SrcProductionOrderSOID" Caption="SrcProductionOrderSOID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="Dtl_PerentProductCostCollectorID" Caption="成本收集器" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="SrcProductionOrderBOMOID" Caption="SrcPPOrderBOMBillDtlID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="PushedGRQuantity102" Caption="已冲销数量102" LabelType="H" Visible="Macro_DebugMode()" Width="100px"/>
                            <GridColumn Key="PushedGRQuantity104" Caption="已下推采购收货数量104" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="PushedGRQuantity105" Caption="已下推采购收货数量105" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="PushedGRQuantity108" Caption="已下推采购收货数量108" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="PushedGRQuantity109" Caption="已下推采购收货数量109" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="PushedGRQuantity122" Caption="已下推采购收货数量122" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="PushedGRQuantity124" Caption="已下推采购收货数量124" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="PushedGRQuantity162" Caption="已下推采购收货数量162" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="PushedGIQuantity1" Caption="已经开票数量(1-发票)" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="PushedGIQuantity2" Caption="已经开票数量(2-贷项发票)" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="PushedGIQuantity3" Caption="已经开票数量(3-后续借记)" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="PushedGIQuantity4" Caption="已经开票数量(4-后续贷记)" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="IsMBSHideShow" Caption="MBST显示时候隐藏" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="InspectionLotSOID" Caption="检验批" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="InspectionGenerateMsegType" Caption="类型" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="InspectionLotPostingType" Caption="检验批决策时候生成物料凭证规则类型" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="IsEstimatedPrice" Caption="GR非估价" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="AutoCreate" Caption="自动建立" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="ValueStringID" Caption="价值串" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="LocalMoney" Caption="按本位币计的金额" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="DeliveryCost" Caption="用本币计算的交货成本" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="RevaluationDirection" Caption="重新评估中的借项/贷项标识" LabelType="M" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="RevaluationMoney" Caption="上一期间返回记账中的重估金额" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="PreviousStockQuantity" Caption="过账前总计估价库存" LabelType="H" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="PreviousStockMoney" Caption="过账前总计评估的库存的价值" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="LocalDeliveryCost" Caption="本币交货成本" LabelType="H" Visible="Macro_DebugMode()" Width="120px" Sortable="true"/>
                            <GridColumn Key="FromPlantID" Caption="工厂" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="FromStorageLocationID" Caption="地点" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="FromStoragePointID" Caption="子库" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="FromBatchCode" Caption="批次" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="FromMaterialID" Caption="物料" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="IsNoStock" Caption="不入库存" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="IsReversed" Caption="已经冲销" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="IsSuggestZeroLine" Caption="建议零行" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="ConsignmentPrice" Caption="寄售单价" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="TaxMoney" Caption="税额" LabelType="H" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcBOMDtlOID" Caption="subParentBillDtlID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="SrcDocumentNumber" Caption="SrcDocumentNumber" Visible="Macro_DebugMode()" Width="100px" Sortable="true"/>
                            <GridColumn Key="SrcFormKey" Caption="SrcFormKey" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                            <GridColumn Key="Dtl_SOID" Caption="物料凭证单据ID" Visible="false" Width="80px" Sortable="true"/>
                            <GridColumn Key="ATPcheck" Caption="ATP检查" Width="80px" Sortable="true"/>
                            <GridColumn Key="ReferenceDocNo" Caption="参考凭证" LabelType="H" Visible="false" Width="80px"/>
                            <GridColumn Key="FundID" Caption="基金" LabelType="H" Visible="Macro_IsFundActive()" Width="80px"/>
                            <GridColumn Key="FundCenterID" Caption="基金中心" LabelType="M" Width="80px"/>
                            <GridColumn Key="CommitmentItemID" Caption="承诺项目" LabelType="H" Width="80px"/>
                            <GridColumn Key="FunctionalAreaID" Caption="功能范围" LabelType="H" Width="80px"/>
                            <GridColumn Key="ShipToPartyID" Caption="收货方" Visible="Macro_DebugMode()" Width="80px"/>
                            <GridColumn Key="IsCoProduct" Caption="联产品标识" Visible="false" Width="100px"/>
                            <GridColumn Key="IsDeemedSale" Caption="视同销售" LabelType="H" Visible="false" Width="80px"/>
                            <GridColumn Key="TaxCodeID" Caption="税码" LabelType="M" Visible="IsDeemedSale==1" Width="80px"/>
                            <GridColumn Key="MinimumRemainingShelfLife" Caption="剩余货架寿命" LabelType="M" Visible="Macro_DebugMode()" Width="120px" Sortable="true"/>
                            <GridColumn Key="IsOutPlanSendMaterial" Caption="计划外发料" LabelType="H" Visible="false" Width="80px"/>
                            <GridColumn Key="TCode2" Caption="TCode2" Visible="false" Enable="false" Width="80px"/>
                            <GridColumn Key="IsBatchManagement" Caption="批次管理" LabelType="S" Visible="Macro_DebugMode()" Width="80px"/>
                            <GridColumn Key="ControlCycleID" Caption="控制周期ID" LabelType="M" Visible="false" Width="100px"/>
                            <GridColumn Key="BulletinBoardID" Caption="看板ID" LabelType="M" Visible="false" Width="80px"/>
                            <GridColumn Key="DeliveryCompleted" Caption="交货已完成标识" LabelType="H" Visible="Macro_DebugMode()" Width="80px"/>
                            <GridColumn Key="BatchOutboundSequence" Caption="批次出库顺序" LabelType="H" Visible="Macro_DebugMode()" Width="80px"/>
                            <GridColumn Key="IsChangeBatchOutboundSequence" Caption="更改批次出库顺序" LabelType="H" Visible="Macro_DebugMode()" Width="80px"/>
                            <GridColumn Key="SrcGlobalValuationTypeID" Caption="来源数据是否有评估类型" Visible="Macro_DebugMode()" Width="80px"/>
                            <GridColumn Key="Dtl_ExternalSystemPrimaryKey" Caption="外部系统关键字" LabelType="H" Visible="false" Width="100px"/>
                            <GridColumn Key="LogisticsAssistQuantity" Caption="物流辅助数量" LabelType="H" Visible="false" Width="80px"/>
                            <GridColumn Key="LogisticsAssistUnitID" Caption="物流辅助单位" LabelType="H" Visible="false" Width="80px"/>
                        </GridColumnCollection>
                        <GridRowCollection>
                            <GridRow Key="MaterialDocumentRow" TableKey="EMM_MaterialDocument">
                                <GridCell Key="Dtl_OID" Caption="Dtl_OID" CellType="NumberEditor" Enable="false" Scale="0">
                                    <DataBinding ColumnKey="OID"/>
                                </GridCell>
                                <GridCell Key="IsSelect" Caption="选择" CellType="CheckBox" Enable="true" IsSelect="true">
                                    <DataBinding>
                                        <ValueChanged>
                                            <![CDATA[IIF(GetDictValue('TCode', TCodeID, 'Code')=='MBST', com.bokesoft.erp.mm.stock.MSEGFormula.reverseMSEGSelectRow(), true)]]>
                                        </ValueChanged>
                                    </DataBinding>
                                </GridCell>
								<GridCell Key="ItemNumber" Caption="行项目" CellType="NumberEditor" Enable="!ReadOnly() &amp;&amp; IsNewDtl(false)" Precision="9" Scale="0" IntegerValue="true">
									<DataBinding ColumnKey="ItemNumber" DefaultFormulaValue="Macro_GenItemNumber('MaterialDocumentDtl');"/>
								</GridCell>
                                <GridCell Key="SuperiorLineOID" Caption="上级行" CellType="NumberEditor" Enable="false" Scale="0">
                                    <DataBinding ColumnKey="SuperiorLineOID"/>
                                </GridCell>
                                <GridCell Key="Dtl_MoveTypeID" Caption="移动类型" CellType="Dict" Enable="false" ItemKey="MoveType">
                                    <DataBinding ColumnKey="MoveTypeID" Required="true">
                                        <DefaultFormulaValue>
                                            <![CDATA[IIF(ToInt(IsShowMSEG)==1||(Dtl_MoveTypeID>0&&isWFMapping()),Dtl_MoveTypeID,MoveTypeID_NODB4Other)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="Direction" Caption="方向" CellType="ComboBox" Enable="false" IntegerValue="true" TextShowType="Caption" GroupKey="MoveDirection" SourceType="ParaGroup">
                                    <DataBinding ColumnKey="Direction">
                                        <DefaultFormulaValue>
                                            <![CDATA[GetDictValue('MoveType', Dtl_MoveTypeID, 'Direction')]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="IsReversalMoveType" Caption="反向移动标识" CellType="CheckBox" Enable="false">
                                    <DataBinding ColumnKey="IsReversalMoveType">
                                        <DefaultFormulaValue>
                                            <![CDATA[GetDictValue('MoveType', Dtl_MoveTypeID, 'IsReversalMoveType')]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="GRBlockedStock" Caption="GR冻结库存" CellType="ComboBox" GroupKey="GRBlockedStockGroup" SourceType="ParaGroup">
                                    <DataBinding ColumnKey="GRBlockedStock">
                                        <DefaultFormulaValue>
                                            <![CDATA[GetDictValue('MoveType', Dtl_MoveTypeID, 'GRBlockedStock')]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="PlantID" Caption="工厂" CellType="Dict" Enable="Macro_Plant_Material_Enablewhen()&amp;&amp;IIF(Macro_IsShowMSEG(),Macro_GetMSEGFieldEnable('PlantID'),true)&amp;&amp;IIF(HasParent()&amp;&amp;parent.GetPara('RO_OID')&gt;0,false,true)" ItemKey="Plant">
                                    <DataBinding ColumnKey="PlantID" DefaultFormulaValue="HeadPlantID" Required="true">
                                        <ValueChanged>
                                            <![CDATA[Macro_ATPWarnMsgConfirm();IIF(SpecialIdentity=='P'&&PlantID>0&&MaterialID>0&&DynIdentityID<=0,com.bokesoft.erp.mm.purchase.MigoFormula.calculateVendor(PlantID,MaterialID,PostingDate),true)]]>
                                        </ValueChanged>
                                        <ValueChangeAction>
                                            <![CDATA[IIF(GetPara('_WarmMsg')!='',ConfirmMsg('MM_MSEG041','{1}',{{GetPara('_WarmMsg')}}),'')]]>
                                        </ValueChangeAction>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="CompanyCodeID" Caption="公司代码" CellType="Dict" ItemKey="CompanyCode">
                                    <DataBinding ColumnKey="CompanyCodeID" DefaultFormulaValue="GetDictValue('Plant', PlantID, 'CompanyCodeID')"/>
                                </GridCell>
                                <GridCell Key="LocalCurrencyID" Caption="本位币" CellType="Dict" ItemKey="Currency">
                                    <DataBinding ColumnKey="LocalCurrencyID">
                                        <DefaultFormulaValue>
                                            <![CDATA[com.bokesoft.erp.basis.dictionary.DictionaryFunction.getDicProp('CompanyCode',CompanyCodeID,'CurrencyID')]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="FiscalYear" Caption="会计年度" CellType="NumberEditor" Enable="false" Precision="9" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="FiscalYear">
                                        <DefaultFormulaValue>
                                            <![CDATA[IIF(PlantID<=0,0,com.bokesoft.erp.basis.date.PeriodFormula.getYearByDate(GetDictValue('CompanyCode', GetDictValue('Plant', PlantID, 'CompanyCodeID'), 'PeriodTypeID'),HeadPostingDate))]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="FiscalPeriod" Caption="会计期间" CellType="NumberEditor" Enable="false" Precision="9" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="FiscalPeriod">
                                        <DefaultFormulaValue>
                                            <![CDATA[IIF(PlantID<=0,0,com.bokesoft.erp.basis.date.PeriodFormula.getPeriodByDate(GetDictValue('CompanyCode', GetDictValue('Plant', PlantID, 'CompanyCodeID'), 'PeriodTypeID'),HeadPostingDate))]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="FiscalYearPeriod" Caption="会计期年度期间" CellType="NumberEditor" Enable="false" Precision="9" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="FiscalYearPeriod" DefaultFormulaValue="FiscalYear*1000+FiscalPeriod"/>
                                </GridCell>
                                <GridCell Key="MaterialID" Caption="物料" CellType="Dict" Enable="Macro_Plant_Material_Enablewhen()&amp;&amp;IIF(Macro_IsShowMSEG(),Macro_GetMSEGFieldEnable('MaterialID'),true)&amp;&amp;IIF(HasParent()&amp;&amp;parent.GetPara('RO_OID')&gt;0,false,true)" ItemKey="Material">
                                    <DataBinding ColumnKey="MaterialID">
                                        <ValueChanged>
                                            <![CDATA[Macro_ShowCharacteristicGrid();Macro_ATPWarnMsgConfirm();IIF(SpecialIdentity=='P'&&PlantID>0&&MaterialID>0&&DynIdentityID<=0,com.bokesoft.erp.mm.purchase.MigoFormula.calculateVendor(PlantID,MaterialID,PostingDate),true)]]>
                                        </ValueChanged>
                                        <CheckRule>
                                            <![CDATA[IIFS(AccountAssignmentCategoryID<=0&&MaterialID<=0,MessageFacade('MM_MSEG023','请输入物料'),MaterialID>0,Macro_CheckMaterialStatus(PlantID, MaterialID, 'StockControl', Head_MSEGDocumentDate, 'EMM_MaterialDocument', 'MaterialID'))]]>
                                        </CheckRule>
                                        <ValueChangeAction>
                                            <![CDATA[IIF(GetPara('_WarmMsg')!='',ConfirmMsg('MM_MSEG041','{1}',{{GetPara('_WarmMsg')}}),'')]]>
                                        </ValueChangeAction>
                                    </DataBinding>
                                    <ItemFilter>
                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="IIF(PlantID&gt;0, 'SOID in (select SOID from egs_Material_Plant where PlantID='&amp;SqlPara(PlantID)&amp;' and Status_Plant&lt;&gt;'&amp;SqlPara(2)&amp;' )', '1=1')"/>
                                        </Filter>
                                    </ItemFilter>
                                </GridCell>
                                <GridCell Key="ShortText" Caption="描述" CellType="TextEditor" Trim="true">
                                    <DataBinding ColumnKey="ShortText" DefaultFormulaValue="GetDictValue('Material', MaterialID, 'Name')"/>
                                </GridCell>
                                <GridCell Key="CheckingGroupID" Caption="检查组" CellType="Dict" ItemKey="SD_CheckingGroup">
                                    <DataBinding ColumnKey="CheckingGroupID">
                                        <DefaultFormulaValue>
                                            <![CDATA[Macro_GetOrgProp('MaterialID', 'SD_CheckingGroupsID', PlantID)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="MaterialTypeID" Caption="物料类型" CellType="Dict" Enable="false" ItemKey="MaterialType">
                                    <DataBinding ColumnKey="MaterialTypeID">
                                        <DefaultFormulaValue>
                                            <![CDATA[GetDictValue('Material', MaterialID, 'MaterialTypeID')]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="IsUpdateQuantity" Caption="数量更新" CellType="CheckBox" Enable="false">
                                    <DataBinding ColumnKey="IsUpdateQuantity">
                                        <DefaultFormulaValue>
                                            <![CDATA[com.bokesoft.erp.mm.masterdata.MaterialFormula.setQuantityValueUpdate(MaterialTypeID,PlantID,1)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="IsValueUpdate" Caption="价值更新" CellType="CheckBox" Enable="false">
                                    <DataBinding ColumnKey="IsValueUpdate">
                                        <DefaultFormulaValue>
                                            <![CDATA[com.bokesoft.erp.mm.masterdata.MaterialFormula.setQuantityValueUpdate(MaterialTypeID,PlantID,2)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="MovementIndicator" Caption="移动标识" CellType="ComboBox" GroupKey="MovementIndicator" SourceType="ParaGroup">
                                    <DataBinding ColumnKey="MovementIndicator" DefaultValue="_"/>
                                </GridCell>
                                <GridCell Key="ReceiptIndicator" Caption="收货标识" CellType="ComboBox" SourceType="ParaGroup" GroupKey="ReceiptIndicatorGroup">
                                    <DataBinding ColumnKey="ReceiptIndicator" DefaultValue="_"/>
                                </GridCell>
                                <GridCell Key="ConsumptionIndicator" Caption="消耗过账" CellType="ComboBox" SourceType="ParaGroup" GroupKey="ConsumptionIndicator">
                                    <DataBinding ColumnKey="ConsumptionIndicator" DefaultValue="_"/>
                                </GridCell>
                                <GridCell Key="Quantity" Caption="数量" CellType="NumberEditor" Enable="!ReadOnly()&amp;&amp;IIF(Macro_IsShowMSEG(),Macro_GetMSEGFieldEnable('MaterialID'),true)&amp;&amp;IIF(HasParent()&amp;&amp;parent.GetPara('RO_OID')&gt;0,false,true)" Scale="3">
                                    <DataBinding ColumnKey="Quantity">
                                        <ValueChanged>
                                            <![CDATA[Macro_ATPWarnMsgConfirm();IIF(BatchCode=='*'||BatchCode=='**',Macro_BatchCode_ValueChange(),true);]]>
                                        </ValueChanged>
                                        <CheckRule>
                                            <![CDATA[IIFS(Macro_IsShowMSEG(), true, Quantity<=0, MessageFacade('MM_MSEG024','请输入一个大于0的数'), Macro_IsATPcheck()&&Macro_ATP4Error(), com.bokesoft.erp.sd.function.ATPControlFormula.resetATPQuantity(PlantID,MaterialID,StorageLocationID,BatchCode,HeadPostingDate,Dtl_OID,SrcReservationDtlOID,CheckingRuleID,Quantity,BaseUnitNumerator,BaseUnitDenominator,'MB1A',Dtl_SOID,SpecialIdentity,DynIdentityID), GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')=='101'&&GetDictValue('MoveType', Dtl_MoveTypeID, 'Direction')==1&&com.bokesoft.erp.mm.stock.MSEGFormula.checkExcessivePush(Dtl_OID,Quantity,StorageLocationID), true, ((GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')=='101'&&GetDictValue('MoveType', Dtl_MoveTypeID, 'Direction')==-1)||(GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')=='122'&&GetDictValue('MoveType', Dtl_MoveTypeID, 'Direction')==-1))&&com.bokesoft.erp.mm.stock.MSEGFormula.checkReturnGoodsPush(Dtl_OID,Quantity,StorageLocationID), true, true, true,SpecialIdentity,DynIdentityID)]]>
                                        </CheckRule>
                                        <ValueChangeAction>
                                            <![CDATA[IIF(GetPara('_WarmMsg')!='',ConfirmMsg('MM_MSEG041','{1}',{{GetPara('_WarmMsg')}}),'')]]>
                                        </ValueChangeAction>
                                    </DataBinding>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="UnitID" Caption="单位" CellType="Dict" Enable="!ReadOnly()&amp;&amp;IIF(Macro_IsShowMSEG(),Macro_GetMSEGFieldEnable('UnitID'),true)&amp;&amp;IIF(HasParent()&amp;&amp;parent.GetPara('RO_OID')&gt;0,false,true)" ItemKey="Unit">
                                    <DataBinding ColumnKey="UnitID">
                                        <ValueChanged>
                                            <![CDATA[Macro_BatchCode_ValueChange();Macro_ATPWarnMsg();Macro_CharacteristicValueChange(Dtl_OID)]]>
                                        </ValueChanged>
                                        <CheckRule>
                                            <![CDATA[IIFS(Macro_Plant_Material_Enablewhen()&&UnitID<=0, MessageFacade('MM_MSEG025','请输入单位'), true, true)]]>
                                        </CheckRule>
                                        <DefaultFormulaValue>
                                            <![CDATA[IIF(UnitID>0,UnitID,IIF(Macro_GetOrgProp('MaterialID', 'IssueUnitID', PlantID)>0,Macro_GetOrgProp('MaterialID', 'IssueUnitID', PlantID),GetDictValue('Material', MaterialID, 'BaseUnitID')))]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                    <ItemFilter ItemKey="Unit">
                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="IIF(MaterialID&gt;0,'soid in ('&amp;com.bokesoft.erp.basis.unit.UnitFormula.getUnitFmMaterial(MaterialID)&amp;')','')"/>
                                        </Filter>
                                    </ItemFilter>
                                </GridCell>
                                <GridCell Key="BrandID" Caption="品牌" CellType="Dict" ItemKey="DM_Brand">
                                    <DataBinding ColumnKey="BrandID"/>
                                    <ItemFilter>
                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="IIF(MaterialID&gt;0, 'soid in (select BrandID from BK_Material where oid='&amp;SqlPara(MaterialID)&amp;')', '1=2')"/>
                                        </Filter>
                                    </ItemFilter>
                                </GridCell>
                                <GridCell Key="SrcPickingQuantity" Caption="原领货数量" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="SrcPickingQuantity"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="ReturnedQuantity" Caption="已退货数量" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="ReturnedQuantity"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="Dtl_BusinessType" Caption="业务类型" CellType="ComboBox" Enable="false" GroupKey="PickingBusinessType" SourceType="ParaGroup">
                                    <DataBinding ColumnKey="BusinessType" DefaultFormulaValue="BusinessType"/>
                                </GridCell>
                                <GridCell Key="BaseQuantity" Caption="基本数量" CellType="NumberEditor" Enable="false" Scale="3">
                                    <DataBinding ColumnKey="BaseQuantity">
                                        <ValueChanged>
                                            <![CDATA[IIFS(Quantity==0, SetValue('Quantity', IIF(BaseUnitNumerator>0,BaseQuantity*BaseUnitDenominator/BaseUnitNumerator,0)), true, true);]]>
                                        </ValueChanged>
                                        <CheckRule>
                                            <![CDATA[IIFS(GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')=='121', true, BaseQuantity<=0, MessageFacade('MM_MSEG026','请输入数量!'), true, true)]]>
                                        </CheckRule>
                                        <DefaultFormulaValue>
                                            <![CDATA[IIF(BaseUnitDenominator>0&&!isWFMapping()&&Quantity>0,Quantity*BaseUnitNumerator/BaseUnitDenominator,BaseQuantity)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="BaseUnitID" Caption="基本单位" CellType="Dict" Enable="false" ItemKey="Unit">
                                    <DataBinding ColumnKey="BaseUnitID" DefaultFormulaValue="GetDictValue('Material', MaterialID, 'BaseUnitID')"/>
                                </GridCell>
                                <GridCell Key="DivisionID" Caption="产品部门" CellType="Dict" Enable="!ReadOnly()&amp;&amp;IIF(Macro_IsShowMSEG(),Macro_GetMSEGFieldEnable('DivisionID'),true)" ItemKey="Division">
                                    <DataBinding ColumnKey="DivisionID" DefaultFormulaValue="GetDictValue('Material', MaterialID, 'DivisionID')" ValueChanged="Macro_ATPWarnMsg();"/>
                                </GridCell>
                                <GridCell Key="BaseUnitNumerator" Caption="订单到基本单位-分子" CellType="NumberEditor" Enable="false" Precision="9" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="BaseUnitNumerator">
                                        <DefaultFormulaValue>
                                            <![CDATA[com.bokesoft.erp.basis.unit.UnitFormula.getNume4MaBatchCodeNoErr(UnitID,BaseUnitID,MaterialID,BatchCodeSOID)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="BaseUnitDenominator" Caption="订单到基本单位-分母" CellType="NumberEditor" Enable="false" Precision="9" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="BaseUnitDenominator">
                                        <DefaultFormulaValue>
                                            <![CDATA[com.bokesoft.erp.basis.unit.UnitFormula.getDeno4MaBatchCodeNoErr(UnitID,BaseUnitID,MaterialID,BatchCodeSOID)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="PriceUnitID" Caption="价格单位" CellType="Dict" Enable="false" ItemKey="Unit">
                                    <DataBinding ColumnKey="PriceUnitID"/>
                                </GridCell>
                                <GridCell Key="PriceQuantity" Caption="价格数量" CellType="NumberEditor" Enable="false" Scale="3">
                                    <DataBinding ColumnKey="PriceQuantity"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="PriceUnitNumerator" Caption="订单到价格单位-分子" CellType="NumberEditor" Enable="false" Precision="9" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="PriceUnitNumerator"/>
                                </GridCell>
                                <GridCell Key="PriceUnitDenominator" Caption="订单到价格单位-分母" CellType="NumberEditor" Enable="false" Precision="9" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="PriceUnitDenominator"/>
                                </GridCell>
                                <GridCell Key="CurrencyID" Caption="币种" CellType="Dict" ItemKey="Currency">
                                    <DataBinding ColumnKey="CurrencyID">
                                        <DefaultFormulaValue>
                                            <![CDATA[GetDictValue('CompanyCode', CompanyCodeID, 'CurrencyID')]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="Money561" Caption="金额" CellType="NumberEditor">
                                    <DataBinding ColumnKey="Money561"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="StorageLocationID" Caption="库存地点" CellType="Dict" Enable="Macro_StorageLocationIDEnabledWhen(GetFormKey())" ItemKey="StorageLocation">
                                    <DataBinding ColumnKey="StorageLocationID" CheckRule="Macro_StorageLocationIDCheckRule()" ValueChanged="Macro_ATPWarnMsgConfirm();">
                                        <DefaultFormulaValue>
                                            <![CDATA[IIFS(SpecialIdentity=='O', 0, SpecialIdentity=='W', 0, true, IIF(HeadStorageLocationID>0,HeadStorageLocationID,StorageLocationID))]]>
                                        </DefaultFormulaValue>
                                        <ValueChangeAction>
                                            <![CDATA[IIF(GetPara('_WarmMsg')!='',ConfirmMsg('MM_MSEG041','{1}',{{GetPara('_WarmMsg')}}),'')]]>
                                        </ValueChangeAction>
                                    </DataBinding>
                                    <ItemFilter ItemKey="StorageLocation">
                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="IIF(PlantID&gt;0, 'PlantID='&amp;SqlPara(PlantID), '1=2')"/>
                                        </Filter>
                                    </ItemFilter>
                                </GridCell>
                                <GridCell Key="StoragePointID" Caption="子库" CellType="Dict" Enable="!ReadOnly()&amp;&amp;(com.bokesoft.erp.wmsintegration.WMSIntegrationFormula.activateWMS()&amp;&amp;com.bokesoft.erp.wms.master.WMSMasterData.releationWM(StorageLocationID))||(!com.bokesoft.erp.wmsintegration.WMSIntegrationFormula.activateWMS()&amp;&amp;com.bokesoft.erp.wmsintegration.WMSIntegrationFormula.enabledWhenStoragePoint(PlantID,StorageLocationID))&amp;&amp;IIF(Macro_IsShowMSEG(),Macro_GetMSEGFieldEnable('StorageLocationID'),true)" ItemKey="StoragePoint">
                                    <DataBinding ColumnKey="StoragePointID">
                                        <CheckRule>
                                            <![CDATA[Macro_CheckStoragePoint(PlantID,StorageLocationID,StoragePointID)]]>
                                        </CheckRule>
                                    </DataBinding>
                                    <ItemFilter>
                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="IIF(StorageLocationID&gt;0, 'soid in ('&amp;com.bokesoft.erp.wmsintegration.WMSIntegrationFormula.getStoragePointFilter4StorageLocation(PlantID,StorageLocationID)&amp;')', '1=2')"/>
                                        </Filter>
                                    </ItemFilter>
                                </GridCell>
                                <GridCell Key="SrcStoragePointID" Caption="子库" CellType="Dict" ItemKey="StoragePoint">
                                    <DataBinding ColumnKey="SrcStoragePointID" DefaultFormulaValue="StoragePointID"/>
                                </GridCell>
                                <GridCell Key="StockType" Caption="库存类型" CellType="ComboBox" Enable="!Macro_IsShowMSEG()&amp;&amp;!ReadOnly()" IntegerValue="true" SourceType="ParaGroup" GroupKey="StockTypeGroup">
                                    <DataBinding ColumnKey="StockType" CheckRule="Macro_StorageLocationIDCheckRule()">
                                        <DefaultFormulaValue>
                                            <![CDATA[com.bokesoft.erp.mm.stock.MovementTypeFormula.getStockTypeByMoveTypeID(Dtl_MoveTypeID)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                    <ComboFilter SourceType="Formula">
                                        <FormulaItems>
                                            <![CDATA[IIF(GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')== '511','1,非限制性;2,质量检查;3,冻结的库存;',Macro_GetAllStockType())]]>
                                        </FormulaItems>
                                    </ComboFilter>
                                </GridCell>
                                <GridCell Key="BatchCode" Caption="批次" CellType="TextButton" Enable="!ReadOnly()&amp;&amp;IIF(Macro_IsShowMSEG(),Macro_GetMSEGFieldEnable('BatchCode'),true)&amp;&amp;ToBool(IsBatchManagement)&amp;&amp;!Macro_ReservationOrderHaveBatchCode()&amp;&amp;!Macro_ProductOrderHaveBatchCode()" Case="Upper" MaxLength="30" Trim="true">
                                    <DataBinding ColumnKey="BatchCode" DefaultFormulaValue="IIF(ToBool(IsBatchManagement),BatchCode,'_')">
                                        <ValueChanged>
                                            <![CDATA[Macro_BatchCode_ValueChange();IIF(isWFMapping(),SetValue('BatchCodeType', 0),SetValue('BatchCodeType', 1))]]>
                                        </ValueChanged>
                                        <CheckRule>
                                            <![CDATA[IIF(ToBool(IsBatchManagement)&&GetDictValue('TCode', Dtl_TCodeID, 'Code')!='QA11'&&com.bokesoft.erp.mm.batchcode.BatchCodeFormula.needBatchCodeInfo(PlantID,MaterialID,Dtl_MoveTypeID,Direction),IIFS(ToInt(IsFromReverse)==1, true, AutoCreate==0, IIFS(com.bokesoft.erp.mm.batchcode.BatchCodeFormula.batchCodeCheckByRules(Dtl_MoveTypeID,PlantID,MaterialID,BatchCode,BatchCodeType)==0, true, com.bokesoft.erp.mm.batchcode.BatchCodeFormula.batchCodeCheckByRules(Dtl_MoveTypeID,PlantID,MaterialID,BatchCode,BatchCodeType)==1, MessageFacade('MM_MSEG027','请录入批次'), com.bokesoft.erp.mm.batchcode.BatchCodeFormula.batchCodeCheckByRules(Dtl_MoveTypeID,PlantID,MaterialID,BatchCode,BatchCodeType)==2, MessageFacade('MM_MSEG028','录入的批次不符合外部编号的设定规则'), com.bokesoft.erp.mm.batchcode.BatchCodeFormula.batchCodeCheckByRules(Dtl_MoveTypeID,PlantID,MaterialID,BatchCode,BatchCodeType)==3, MessageFacade('MM_MSEG029','该移动类型不允许手工创建新的批次'), true, true), true, true),true)]]>
                                        </CheckRule>
                                    </DataBinding>
                                    <OnClick>
                                        <![CDATA[Macro_SetBatchCode(Direction, PlantID, MaterialID, 'StorageLocationID', 'StoragePointID', StockType, SpecialIdentity, DynIdentityID, 'BatchCode', 'Quantity')]]>
                                    </OnClick>
                                </GridCell>
                                <GridCell Key="BatchCodeType" Caption="批次生成来源" CellType="NumberEditor" Precision="9">
                                    <DataBinding ColumnKey="BatchCodeType" DefaultValue="1"/>
                                </GridCell>
                                <GridCell Key="IsBatchRestricted" Caption="批次限制" CellType="CheckBox" Enable="false">
                                    <DataBinding ColumnKey="IsBatchRestricted">
                                        <DefaultFormulaValue>
                                            <![CDATA[com.bokesoft.erp.mm.batchcode.BatchCodeFormula.getBatchRestricted(PlantID, MaterialID, BatchCode)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="BatchLastGRGITime" Caption="批次最后入库出库时间" CellType="DatePicker" Format="yyyy-MM-dd HH:mm:ss">
                                    <DataBinding ColumnKey="BatchLastGRGITime">
                                        <DefaultFormulaValue>
                                            <![CDATA[IIFS(ToBool(IsBatchManagement)&&!Macro_IsShowMSEG()&&GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')=='561',Date());]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="BatchCodeSOID" Caption="批次SOID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="BatchCodeSOID">
                                        <DefaultFormulaValue>
                                            <![CDATA[com.bokesoft.erp.mm.batchcode.BatchCodeFormula.getBatchCodeBillID(MaterialID,PlantID,BatchCode)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="Dtl_CategoryTypeID" Caption="类别种类" CellType="Dict" Enable="false" ItemKey="MM_CategoryType">
                                    <DataBinding ColumnKey="CategoryTypeID" DefaultFormulaValue="Macro_GetBatchCategoryTypeDefaultValue()"/>
                                    <!--<ItemFilter ItemKey="MM_CategoryType">
                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="' IsAllow = '&amp;SqlPara(1)"/>
                                        </Filter>
                                    </ItemFilter>-->
                                </GridCell>
                                <GridCell Key="Dtl_GlobalValuationTypeID" Caption="评估类型" CellType="Dict" Enable="!ReadOnly()&amp;&amp;Macro_IsSplitValuation()&amp;&amp;!Macro_ReservationOrderHaveValuationtype()&amp;&amp;IIF(Direction==1,!(GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB31'&amp;&amp;Macro_ProductionOrderIsReceipted()),!ToBool(IsBatchManagement))" ItemKey="MM_GlobalValuationType">
                                    <DataBinding ColumnKey="GlobalValuationTypeID">
                                        <CheckRule>
                                            <![CDATA[IIF(Macro_IsSplitValuation(),IIF(Direction==1,IIF(ToBool(IsBatchManagement)&&Macro_AutoSetValuationType()==1,true,Macro_ValuationCheckRule()),Macro_ValuationCheckRule()),true)]]>
                                        </CheckRule>
                                        <DefaultFormulaValue>
                                            <![CDATA[IIF(com.bokesoft.erp.mm.function.SplitValuationFormula.getBatchCodeValuationTypeID(PlantID,MaterialID,BatchCode)>0,com.bokesoft.erp.mm.function.SplitValuationFormula.getBatchCodeValuationTypeID(PlantID,MaterialID,BatchCode),IIF(GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')=='101' && IsCoProduct && SrcGlobalValuationTypeID>0,SrcGlobalValuationTypeID,Dtl_GlobalValuationTypeID))]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                    <ItemFilter ItemKey="MM_GlobalValuationType">
                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="IIF(MaterialID&gt;0, 'soid in (SELECT  GlobalValuationTypeID from  EGS_MaterialValuationArea  WHERE soid='&amp;SqlPara(MaterialID)&amp;' And ValuationAreaID='&amp;SqlPara(PlantID)&amp;')', '1=2')"/>
                                        </Filter>
                                    </ItemFilter>
                                </GridCell>
                                <GridCell Key="GLAccountID" Caption="总账科目" CellType="Dict" Enable="IIFS(SrcReservationDtlOID&gt;0, false, true, !ReadOnly())" ItemKey="Account">
                                    <DataBinding ColumnKey="GLAccountID" ValueDependency="MaterialID">
                                        <CheckRule>
                                            <![CDATA[IIFS(GLAccountID>0&&GetDictValue('Account', GLAccountID, 'NodeType')!=0, '不能选择汇总节点', GetDictValue('MoveType', Dtl_MoveTypeID, 'AccountControl')==1&&GLAccountID<=0, MessageFacade('MM_MSEG015','请输入总账科目'), true, true)]]>
                                        </CheckRule>
                                        <DefaultFormulaValue>
                                            <![CDATA[IIFS(SrcAllocateSOID>0, 0, Head_GLAccountID>0, Head_GLAccountID, Dtl_MoveTypeID>0&&MaterialID>0&&PlantID>0, com.bokesoft.erp.basis.integration.function.AccountDeterminate.getGBBAccountIDByMoveType(MaterialID,PlantID,Dtl_MoveTypeID, Dtl_GlobalValuationTypeID, SpecialIdentity), true, true)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="BusinessAreaID" Caption="业务范围" CellType="Dict" Enable="false" ItemKey="BusinessArea">
                                    <DataBinding ColumnKey="BusinessAreaID">
                                        <DefaultFormulaValue>
                                            <![CDATA[com.bokesoft.erp.mm.stock.MSEGFormula.getBusinessArea4MM(PlantID,MaterialID)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="PartnerBusinessAreaID" Caption="伙伴业务范围" CellType="Dict" Enable="!ReadOnly()&amp;&amp;Dtl_MoveTypeID&gt;0&amp;&amp;Macro_GetFieldValueByMoveTypeID(Dtl_MoveTypeID,SpecialIdentity,'BusinessArea')!=2" ItemKey="BusinessArea">
                                    <DataBinding ColumnKey="PartnerBusinessAreaID">
                                        <CheckRule>
                                            <![CDATA[IIFS(Macro_GetFieldValueByMoveTypeID(Dtl_MoveTypeID,SpecialIdentity,'BusinessArea')==1&&BusinessAreaID<=0, MessageFacade('MM_MSEG016','请输入业务范围'), true, true)]]>
                                        </CheckRule>
                                        <DefaultFormulaValue>
                                            <![CDATA[IIFS(PartnerBusinessAreaID>0, PartnerBusinessAreaID, Head_PartnerBusinessAreaID>0,Head_PartnerBusinessAreaID,true, 0)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="ProfitSegmentSOID" CellType="NumberEditor" Scale="0">
                                    <DataBinding ColumnKey="ProfitSegmentSOID"/>
                                </GridCell>
                                <GridCell Key="IsAllowReverse" Caption="允许冲销" CellType="CheckBox" Enable="false">
                                    <DataBinding ColumnKey="IsAllowReverse" DefaultValue="1"/>
                                </GridCell>
                                <GridCell Key="SourceFormKey" Caption="数据来源单据" CellType="TextEditor" Enable="false">
                                    <DataBinding ColumnKey="SourceFormKey" DefaultFormulaValue="GetSourceFormKey()"/>
                                </GridCell>
                                <GridCell Key="Dtl_TCodeID" Caption="Dtl_TCodeID" CellType="Dict" Enable="false" ItemKey="TCode">
                                    <DataBinding ColumnKey="TCodeID" DefaultFormulaValue="TCodeID"/>
                                </GridCell>
                                <GridCell Key="AccountAssignmentCategoryID" Caption="科目分配类别" CellType="Dict" ItemKey="AccountAssignmentCategory">
                                    <DataBinding ColumnKey="AccountAssignmentCategoryID"/>
                                </GridCell>
                                <GridCell Key="SpecialIdentity" Caption="特殊库存标识" CellType="ComboBox" Enable="!Macro_IsShowMSEG()&amp;&amp;!ReadOnly()&amp;&amp;IIF(HasParent()&amp;&amp;parent.GetPara('RO_OID')&gt;0,false,true)&amp;&amp;!GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB31'" SourceType="Formula">
                                    <DataBinding ColumnKey="SpecialIdentity" DefaultFormulaValue="SpecialIdentity_NODB4Other" ValueChanged="SetValue('DynIdentityID', 0);"/>
                                    <FormulaItems>
                                        <![CDATA[Macro_GetAllSpecialIdentity()]]>
                                    </FormulaItems>
                                </GridCell>
                                <GridCell Key="DynIdentityID" Caption="特殊库存" CellType="DynamicDict" Enable="!ReadOnly()&amp;&amp;SpecialIdentity!='_'" IsDynamic="true" RefDataElementKey="DynIdentityIDDEKey">
                                    <DataBinding ColumnKey="DynIdentityID" DefaultFormulaValue="Head_IdentityID">
                                        <CheckRule>
                                            <![CDATA[IIFS(SpecialIdentity=='_', true,SpecialIdentity=='B'&&DynIdentityID<=0, '请输入有关特殊库存B的客户', SpecialIdentity=='E'&&DynIdentityID<=0, MessageFacade('MM_MSEG001','请输入订单'), SpecialIdentity=='K'&&DynIdentityID<=0, MessageFacade('MM_MSEG002','请输入(寄售)供应商'),SpecialIdentity=='P'&&DynIdentityID<=0, MessageFacade('MM_MSEG002','请输入(管道)供应商'), SpecialIdentity=='O'&&DynIdentityID<=0, MessageFacade('MM_MSEG003','请输入分包供应商'), SpecialIdentity=='Q'&&DynIdentityID<=0, MessageFacade('MM_MSEG004','请输入项目库存'), SpecialIdentity=='W'&&DynIdentityID<=0, MessageFacade('MM_MSEG005','请输入(寄售)客户'), SpecialIdentity=='V'&&DynIdentityID<=0, MessageFacade('MM_MSEG006','请输入(可回收包装物)客户'),SpecialIdentity=='M'&&DynIdentityID<=0, MessageFacade('MM_MSEG007','请输入(可退回的包装)供应商'),SpecialIdentity=='P'&&PlantID>0&&MaterialID>0&&DynIdentityID>0&&!com.bokesoft.erp.mm.purchase.MigoFormula.isExistPipeInfoRecord(PlantID,MaterialID,DynIdentityID), MessageFacade('MM_PURCHASEINFORECORD021','未找到({1})采购组织下的管道类型的采购信息记录',com.bokesoft.erp.mm.purchase.MigoFormula.getPurchaseOrganizationCode(PlantID)), true, true)]]>
                                        </CheckRule>
                                    </DataBinding>
                                    <ItemFilter>
                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="IIF(SpecialIdentity=='E'&amp;&amp;SrcAllocateDtlOID&lt;=0,&quot;SpecialIdentity=&quot;&amp;SqlPara('E'),'')"/>
                                        </Filter>
                                    </ItemFilter>
                                </GridCell>
                                <GridCell Key="DynIdentityIDDEKey" Caption="特殊库存字典Key" CellType="TextEditor">
                                    <DataBinding ColumnKey="DynIdentityIDDEKey" DefaultFormulaValue="Macro_GetIdentityDataElementKey(SpecialIdentity)"/>
                                </GridCell>
                                <GridCell Key="ManufactureDate" Caption="生产日期" CellType="UTCDatePicker" Enable="!ReadOnly()&amp;&amp;Direction==1" Format="yyyy-MM-dd">
                                    <DataBinding ColumnKey="ManufactureDate">
                                        <CheckRule>
                                            <![CDATA[IIF(com.bokesoft.erp.mm.purchase.MigoFormula.needInPutSLED(Direction,Dtl_MoveTypeID,PlantID,MaterialID)&&ManufactureDate<=0,MessageFacade('M7217','请输入生产日期'),true)]]>
                                        </CheckRule>
                                        <ValueChangeAction>
                                            <![CDATA[IIFS(ManufactureDate<=0||GetDictValue('Material', MaterialID, 'TotalShelfLife')==0||DateLongAdd(ManufactureDate, 'd', GetDictValue('Material', MaterialID, 'TotalShelfLife'))==ShelfLifeDate||Direction==-1, true, ConfirmMsg('MM_MSEG030','已计算新的货架寿命到期日({1})。与先前的货架寿命到期日({2})不同。是否要采用项目中的新货架寿命到期日?',{{DateLongAdd(ManufactureDate, 'd', GetDictValue('Material', MaterialID, 'TotalShelfLife'))},{ShelfLifeDate}}, 'YES_NO',{
                                                                            YES:{
                                                                                SetValue('ShelfLifeDate', DateLongAdd(ManufactureDate, 'd', GetDictValue('Material', MaterialID, 'TotalShelfLife')),true)
                                                                            },
                                                                            NO:{
                                                                            }
                                                                        })==1, true , true, true);]]>
                                        </ValueChangeAction>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="ShelfLifeDate" Caption="货架寿命到期日" CellType="UTCDatePicker" Enable="!ReadOnly()&amp;&amp;Direction==1" Format="yyyy-MM-dd">
                                    <DataBinding ColumnKey="ShelfLifeDate">
                                        <CheckRule>
                                            <![CDATA[IIF(GetDictValue('MoveType', Dtl_MoveTypeID, 'CheckSLDueDate')==2 || GetDictValue('MoveType', Dtl_MoveTypeID, 'CheckSLDueDate')==3, true,com.bokesoft.erp.mm.purchase.MigoFormula.checkSLED(Direction,Dtl_MoveTypeID,PlantID,ShelfLifeDate,MinimumRemainingShelfLife,MaterialID,HeadPostingDate,0));]]>
                                        </CheckRule>
                                        <DefaultFormulaValue>
                                            <![CDATA[IIF(ShelfLifeDate<=0&&ManufactureDate>0&&GetDictValue('Material', MaterialID, 'TotalShelfLife')>0,DateLongAdd(ManufactureDate, 'd', GetDictValue('Material', MaterialID, 'TotalShelfLife')),ShelfLifeDate)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="IsFinalSendGoods" Caption="该预留的最后发货" CellType="CheckBox">
                                    <DataBinding ColumnKey="IsFinalSendGoods"/>
                                </GridCell>
                                <GridCell Key="SrcReservationDocNo" Caption="预留编号" CellType="TextEditor" Enable="false" MaxLength="100" Trim="true">
                                    <DataBinding ColumnKey="SrcReservationDocNo"/>
                                </GridCell>
                                <GridCell Key="SrcReservationRequirementDate" Caption="预留的需求日期" CellType="UTCDatePicker" Enable="false" Format="yyyy-MM-dd">
                                    <DataBinding ColumnKey="SrcReservationRequirementDate">
                                        <DefaultFormulaValue>
                                            <![CDATA[ToLong(Macro_GetReservationInfo('RequirementDate'))]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="SrcReservationBaseQuantity" Caption="预留的需求数量" CellType="NumberEditor" Enable="false" Scale="3">
                                    <DataBinding ColumnKey="SrcReservationBaseQuantity">
                                        <DefaultFormulaValue>
                                            <![CDATA[ToDecimal(Macro_GetReservationInfo('BaseQuantity'))]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="SrcReservationPickupBaseQuantity" Caption="预留的提货数量" CellType="NumberEditor" Enable="false" Scale="3">
                                    <DataBinding ColumnKey="SrcReservationPickupBaseQuantity">
                                        <DefaultFormulaValue>
                                            <![CDATA[ToDecimal(Macro_GetReservationInfo('PickupBaseQuantity'))]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="IsDeliveryCompleted" Caption="交货已完成标识" CellType="CheckBox" Enable="IIF(IsNew(),true,false)">
                                    <DataBinding ColumnKey="IsDeliveryCompleted" DefaultValue="0"/>
                                </GridCell>
                                <GridCell Key="Dtl_Notes" Caption="文本" CellType="TextEditor" MaxLength="100" Trim="true">
                                    <DataBinding ColumnKey="Notes"/>
                                </GridCell>
                                <GridCell Key="ProfitCenterID" Caption="利润中心" CellType="Dict" Enable="false" ItemKey="ProfitCenter">
                                    <DataBinding ColumnKey="ProfitCenterID">
                                        <DefaultFormulaValue>
                                            <![CDATA[com.bokesoft.erp.mm.purchase.ProfitCenterFormula.getProfitCenterID(PlantID,MaterialID)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="PartnerProfitCenterID" Caption="伙伴利润中心" CellType="Dict" ItemKey="ProfitCenter">
                                    <DataBinding ColumnKey="PartnerProfitCenterID">
                                        <DefaultFormulaValue>
                                            <![CDATA[IIFS(PartnerProfitCenterID>0, PartnerProfitCenterID, Head_PartnerProfitCenterID>0,Head_PartnerProfitCenterID, true, 0)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="OrderCategory" Caption="订单类别" CellType="ComboBox" SourceType="ParaGroup" GroupKey="OrderCategoryGroup">
                                    <DataBinding ColumnKey="OrderCategory" DefaultFormulaValue="Head_OrderCategory"/>
                                    <ComboFilter>
                                        <Item Key="01" Caption="内部订单" Value="01"/>
                                        <Item Key="04" Caption="成本控制生产订单" Value="04"/>
                                        <Item Key="05" Caption="生产成本归集器" Value="05"/>
                                        <Item Key="06" Caption="质量订单" Value="06"/>
                                        <Item Key="10" Caption="生产订单" Value="10"/>
                                        <Item Key="30" Caption="维护订单" Value="30"/>
                                        <Item Key="40" Caption="流程订单" Value="40"/>
                                    </ComboFilter>
                                </GridCell>
                                <GridCell Key="DynOrderID" Caption="订单" CellType="DynamicDict" IsDynamic="true" RefDataElementKey="DynOrderIDDEKey" StateMask="Enable|Disable|Discard">
                                    <DataBinding ColumnKey="DynOrderID">
                                        <CheckRule>
                                            <![CDATA[IIFS(Macro_IsShowMSEG(), true, GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MIGO', true, GetDictValue('MoveType', Dtl_MoveTypeID, 'PPOrderNo')==1&&DynOrderID<=0, MessageFacade('MM_MSEG031','请输入生产订单'), true, true)]]>
                                        </CheckRule>
                                        <DefaultFormulaValue>
                                            <![CDATA[IIF(isWFMapping()&&SrcProductionOrderSOID>0,SrcProductionOrderSOID,IIF(DynOrderID>0,DynOrderID,Head_PPOrderNoID))]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                    <ItemFilter>
                                        <Filter Key="F1_Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="IIF((OrderCategory == '10' || OrderCategory == '30' || OrderCategory == '40')&amp;MoveTypeID_NODB4Other&gt;0, com.bokesoft.erp.mm.purchase.MigoFormula.getStatusFilter_for_PPorPM(OrderCategory,TCodeID,MoveTypeID_NODB4Other,' 1 = 1 '), ' 1 = 1 ')"/>
                                        </Filter>
                                    </ItemFilter>
                                </GridCell>
                                <GridCell Key="DynOrderIDDEKey" Caption="订单字典Key" CellType="TextEditor">
                                    <DataBinding ColumnKey="DynOrderIDDEKey">
                                        <DefaultFormulaValue>
                                            <![CDATA[com.bokesoft.erp.mm.purchase.MigoFormula.getOrdeDataElementKey(OrderCategory)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="Reason4MovementID" Caption="移动原因" CellType="Dict" Enable="Dtl_MoveTypeID&gt;0&amp;&amp;GetDictValue('MoveType', Dtl_MoveTypeID, 'ControlReason')!=2" ItemKey="MM_Reason4Movement">
                                    <DataBinding ColumnKey="Reason4MovementID" DefaultFormulaValue="HeadReason4MovementID">
                                        <CheckRule>
                                            <![CDATA[IIFS(GetDictValue('MoveType', Dtl_MoveTypeID, 'ControlReason')==1&&Reason4MovementID<=0, MessageFacade('MM_MSEG032','请输入移动原因'), true, true)]]>
                                        </CheckRule>
                                    </DataBinding>
                                    <ItemFilter ItemKey="MM_Reason4Movement">
                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="IIF(Dtl_MoveTypeID&gt;0, 'EMM_Reason4Movement.soid in(Select soid from EMM_Reason4MovementDtl where MoveTypeID='&amp;SqlPara(Dtl_MoveTypeID)&amp;')', '1=2')"/>
                                        </Filter>
                                    </ItemFilter>
                                </GridCell>
                                <GridCell Key="ConsumptionPosting" Caption="消耗记账" CellType="ComboBox" Enable="false" GroupKey="ConsumptionPostingGroup" SourceType="ParaGroup">
                                    <DataBinding ColumnKey="ConsumptionPosting">
                                        <DefaultFormulaValue>
                                            <![CDATA[GetDictValue('MoveType', Dtl_MoveTypeID, 'ConsumptionPosting')]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="IsUpdateTotalConsumption" Caption="迁移到总消耗" CellType="NumberEditor" Enable="false" Precision="9" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="IsUpdateTotalConsumption" DefaultFormulaValue="IIF(ConsumptionPosting=='_',0,1)"/>
                                </GridCell>
                                <GridCell Key="IsUpdateUnplanConsumption" Caption="迁移到计划外消耗" CellType="NumberEditor" Enable="false" Precision="9" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="IsUpdateUnplanConsumption">
                                        <DefaultFormulaValue>
                                            <![CDATA[IIFS(ConsumptionPosting=='U', 1, ConsumptionPosting=='R', 1, true, 0)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="Dtl_DocumentNumber" Caption="单据编号" CellType="TextEditor" MaxLength="100" Trim="true">
                                    <DataBinding ColumnKey="DocumentNumber" DefaultFormulaValue="DocumentNumber "/>
                                </GridCell>
                                <GridCell Key="Dtl_DocumentDate" Caption="凭证日期" CellType="UTCDatePicker" Format="yyyy-MM-dd">
                                    <DataBinding ColumnKey="DocumentDate" DefaultFormulaValue="HeadDocumentDate"/>
                                </GridCell>
                                <GridCell Key="Dtl_PostingDate" Caption="过账日期" CellType="UTCDatePicker" Format="yyyy-MM-dd">
                                    <DataBinding ColumnKey="PostingDate" DefaultFormulaValue="HeadPostingDate"/>
                                </GridCell>
                                <GridCell Key="Dtl_ClientID" Caption="集团" CellType="Dict" ItemKey="Client">
                                    <DataBinding ColumnKey="ClientID" DefaultFormulaValue="ClientID"/>
                                </GridCell>
                                <GridCell Key="PPOrderQuantity" Caption="已订购" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="PPOrderQuantity"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="PPRecipientQuantity" Caption="已接受" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="PPRecipientQuantity"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="VendorID" Caption="供应商" CellType="Dict" ItemKey="Vendor">
                                    <DataBinding ColumnKey="VendorID">
                                        <CheckRule>
                                            <![CDATA[IIFS(SpecialIdentity!='M'&&GetDictValue('MoveType', Dtl_MoveTypeID, 'Vendor')==1&&VendorID<=0&&!Macro_IsShowMSEG(), MessageFacade('M7071','请输入供应商'), true, true)]]>
                                        </CheckRule>
                                        <DefaultFormulaValue>
                                            <![CDATA[IIFS(SpecialIdentity=='M',DynIdentityID,VendorID>0,VendorID,true,Head_VendorID)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="CustomerID" Caption="客户" CellType="Dict" ItemKey="Customer">
                                    <DataBinding ColumnKey="CustomerID">
                                        <CheckRule>
                                            <![CDATA[IIFS(GetDictValue('MoveType', Dtl_MoveTypeID, 'Customer')==1&&CustomerID<=0&&!Macro_IsShowMSEG(), MessageFacade('M7072','请输入客户'), true, true)]]>
                                        </CheckRule>
                                        <DefaultFormulaValue>
                                            <![CDATA[IIFS(SpecialIdentity=='B',DynIdentityID,CustomerID>0,CustomerID,true,Head_CustomerID)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="SrcSaleOrderDtlOID" Caption="销售订单-行号" CellType="Dict" ItemKey="SD_SaleOrderDtl__Dic" StateMask="Enable|Disable|Discard">
                                    <DataBinding ColumnKey="SrcSaleOrderDtlOID" DefaultFormulaValue="Head_SaleOrderDtlOID">
                                        <CheckRule>
                                            <![CDATA[IIFS(Macro_GetFieldValueByMoveTypeID(Dtl_MoveTypeID,SpecialIdentity,'SaleOrder')==1&&SrcSaleOrderDtlOID<=0&&!Macro_IsShowMSEG(), MessageFacade('M7073','请输入销售订单-行号'), true, true)]]>
                                        </CheckRule>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="AssetCardSOID" Caption="资产" CellType="Dict" ItemKey="AM_AssetCard__Dic" StateMask="Enable|Disable|Discard">
                                    <DataBinding ColumnKey="AssetCardSOID" DefaultFormulaValue="Head_AssetCardSOID">
                                        <CheckRule>
                                            <![CDATA[IIFS(GetDictValue('MoveType', Dtl_MoveTypeID, 'AssetsCard')==1&&AssetCardSOID<=0, MessageFacade('MM_MSEG020','请输入资产'), true, true)]]>
                                        </CheckRule>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="DocumentNumber_An" Caption="采购订单号" CellType="TextButton">
                                    <DataBinding ColumnKey="DocumentNumber_An"/>
                                    <OnClick>
                                        <![CDATA[ERPShowModal('MM_PurchaseOrder__Dic_Browser','Macro_POExecuteStatus_ShowEvent("DocumentNumber_An")')]]>
                                    </OnClick>
                                </GridCell>
                                <GridCell Key="SrcUBPurchaseOrderSOID" Caption="采购订单" CellType="Dict" ItemKey="MM_PurchaseOrder__Dic" StateMask="Enable|Disable|Discard">
                                    <DataBinding ColumnKey="SrcUBPurchaseOrderSOID"/>
                                </GridCell>
                                <GridCell Key="Dtl_CostCenterID" Caption="成本中心" CellType="Dict" ItemKey="CostCenter">
                                    <DataBinding ColumnKey="CostCenterID" DefaultFormulaValue="CostCenterID">
                                        <CheckRule>
                                            <![CDATA[IIFS(ToInt(IsFromReverse)==0&&Macro_GetFieldValueByMoveTypeID(Dtl_MoveTypeID,SpecialIdentity,'CostCenter')==1&&Dtl_CostCenterID<=0, MessageFacade('MM_MSEG017','请输入成本中心'), true, true)]]>
                                        </CheckRule>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="WBSElementID" Caption="WBS元素" CellType="Dict" ItemKey="PS_WBSElement">
                                    <DataBinding ColumnKey="WBSElementID" DefaultFormulaValue="Head_WBSElementID">
                                        <CheckRule>
                                            <![CDATA[IIFS(GetDictValue('MoveType', Dtl_MoveTypeID, 'WBSElement')==1&&WBSElementID<=0&&SpecialIdentity!='Q', MessageFacade('MM_MSEG018','请输入WBS元素'), AccountAssignmentCategoryID>0&&WBSElementID>0&&com.bokesoft.erp.mm.stock.MSEGFormula.checkProjectStock(AccountAssignmentCategoryID,WBSElementID),MessageFacade('MM_MSEG040','WBS要素 {1} 有不同的存货估价',GetDictValue('PS_WBSElement',WBSElementID,'Code')))]]>
                                        </CheckRule>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="NetworkID" Caption="网络" CellType="Dict" ItemKey="PS_Network">
                                    <DataBinding ColumnKey="NetworkID" DefaultFormulaValue="Head_NetworkID">
                                        <CheckRule>
                                            <![CDATA[IIFS(SrcFormKey=='SD_OutboundDelivery'&&GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')=='281'&&Direction==1,true,GetDictValue('MoveType', Dtl_MoveTypeID, 'Network')==1&&NetworkID<=0, MessageFacade('M7294','请输入网络'), true, true)]]>
                                        </CheckRule>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="ActivityID" Caption="作业" CellType="Dict" ItemKey="PS_Activity">
                                    <DataBinding ColumnKey="ActivityID" DefaultFormulaValue="Head_ActivityID"/>
                                    <ItemFilter ItemKey="PS_Activity">
                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="IIF(NetworkID&gt;0, 'NetworkID='&amp;SqlPara(NetworkID), '1=2')"/>
                                        </Filter>
                                    </ItemFilter>
                                </GridCell>
                                <GridCell Key="Assessment" Caption="评估" CellType="ComboBox" Enable="false" SourceType="ParaGroup" GroupKey="Assessment">
                                    <DataBinding ColumnKey="Assessment"/>
                                </GridCell>
                                <GridCell Key="IsSettleK" Caption="k库存结算" CellType="CheckBox">
                                    <DataBinding ColumnKey="IsSettleK"/>
                                </GridCell>
                                <GridCell Key="IsSettleW" Caption="库存结算" CellType="CheckBox">
                                    <DataBinding ColumnKey="IsSettleW"/>
                                </GridCell>
                                <GridCell Key="IsReturnItem" Caption="退货项目" CellType="CheckBox">
                                    <DataBinding ColumnKey="IsReturnItem"/>
                                </GridCell>
                                <GridCell Key="SrcPurchaseOrderSOID" Caption="采购订单" CellType="Dict" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('SrcPurchaseOrderSOID')" ItemKey="MM_PurchaseOrder__Dic" StateMask="Enable|Disable|Discard">
                                    <DataBinding ColumnKey="SrcPurchaseOrderSOID"/>
                                </GridCell>
                                <GridCell Key="SrcPurchaseOrderDtlOID" Caption="SrcPurchaseOrderDtlOID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcPurchaseOrderDtlOID"/>
                                </GridCell>
                                <GridCell Key="SrcPurchaseOrderDocNo" Caption="采购订单" CellType="TextEditor" MaxLength="100" Trim="true">
                                    <DataBinding ColumnKey="SrcPurchaseOrderDocNo"/>
                                </GridCell>
                                <GridCell Key="SrcPOItemNo" Caption="行项目" CellType="NumberEditor" Precision="9" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcPOItemNo"/>
                                </GridCell>
                                <GridCell Key="MapKey" Caption="MapKey" CellType="TextEditor" MaxLength="100" Trim="true">
                                    <DataBinding ColumnKey="MapKey"/>
                                </GridCell>
                                <GridCell Key="SrcSOID" Caption="源单SOID" CellType="NumberEditor" Enable="false" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcSOID"/>
                                </GridCell>
                                <GridCell Key="SrcOID" Caption="源单OID" CellType="NumberEditor" Enable="false" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcOID"/>
                                </GridCell>
                                <GridCell Key="IsMaintenanceOrder" Caption="IsMaintenanceOrder" CellType="CheckBox">
                                    <DataBinding ColumnKey="IsMaintenanceOrder"/>
                                </GridCell>
                                <GridCell Key="SrcMaintenanceSOID" Caption="SrcMaintenanceBillID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcMaintenanceSOID"/>
                                </GridCell>
                                <GridCell Key="SrcMaintenanceOID" Caption="SrcMaintenanceBillIDtlID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcMaintenanceOID"/>
                                </GridCell>
                                <GridCell Key="SrcReservationSOID" Caption="SrcReservationBillID" CellType="NumberEditor" Enable="false" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcReservationSOID"/>
                                </GridCell>
                                <GridCell Key="SrcReservationDtlOID" Caption="SrcReservationBillDtlID" CellType="NumberEditor" Enable="false" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcReservationDtlOID"/>
                                </GridCell>
                                <GridCell Key="SrcPhysicalInventorySOID" Caption="SrcPhysicalInventoryBillID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcPhysicalInventorySOID"/>
                                </GridCell>
                                <GridCell Key="SrcPhysicalInventoryDtlOID" Caption="SrcPhysicalInventoryBillDtlID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcPhysicalInventoryDtlOID"/>
                                </GridCell>
                                <GridCell Key="SrcAllocateDtlOID" Caption="SrcAllocateBillDtlID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcAllocateDtlOID"/>
                                </GridCell>
                                <GridCell Key="SrcPickingListDtlOID" Caption="SrcPickingListBillDtlID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcPickingListDtlOID"/>
                                </GridCell>
                                <GridCell Key="SrcSaleOrderSOID" Caption="SrcSaleOrderSOID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcSaleOrderSOID"/>
                                </GridCell>
                                <GridCell Key="SrcPOSubDtlOID" Caption="SrcPOSubBillDtlID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcPOSubDtlOID"/>
                                </GridCell>
                                <GridCell Key="SrcPOConfirmOID" Caption="SrcPOConfirmBillDtlID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcPOConfirmOID"/>
                                </GridCell>
                                <GridCell Key="SrcMSEGSOID" Caption="SrcMSEGBillID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcMSEGSOID"/>
                                </GridCell>
                                <GridCell Key="SrcMaterialDocumentOID" Caption="SrcMaterialDocumentOID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcMaterialDocumentOID"/>
                                </GridCell>
                                <GridCell Key="SourceMSEGSOID" Caption="原始物料凭证ID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SourceMSEGSOID"/>
                                </GridCell>
                                <GridCell Key="SourceMaterialDocumentOID" Caption="原始物料凭证明细ID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SourceMaterialDocumentOID"/>
                                </GridCell>
                                <GridCell Key="SrcGoodsReceiptDtlOID" Caption="SrcGRBillDtlID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcGoodsReceiptDtlOID"/>
                                </GridCell>
                                <GridCell Key="SrcInboundDeliverySOID" Caption="SrcInboundDeliverySOID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcInboundDeliverySOID"/>
                                </GridCell>
                                <GridCell Key="SrcInboundDeliveryDtlOID" Caption="SrcInboundDeliveryBillDtlID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcInboundDeliveryDtlOID"/>
                                </GridCell>
                                <GridCell Key="SrcOutboundDeliverySOID" Caption="SrcOutboundDeliveryBillID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcOutboundDeliverySOID"/>
                                </GridCell>
                                <GridCell Key="SrcOutboundDeliveryDtlOID" Caption="SrcOutboundDeliveryBillDtlID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcOutboundDeliveryDtlOID"/>
                                </GridCell>
                                <GridCell Key="SrcSaleBillingSOID" Caption="SrcSaleBillingSOID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcSaleBillingSOID"/>
                                </GridCell>
                                <GridCell Key="SrcSaleBillingDtlOID" Caption="SrcSaleBillingDtlOID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcSaleBillingDtlOID"/>
                                </GridCell>
                                <GridCell Key="SrcLRPSOID" Caption="srcLRPBillID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcLRPSOID"/>
                                </GridCell>
                                <GridCell Key="SrcLRPOID" Caption="SrcLRPBillDtlID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcLRPOID"/>
                                </GridCell>
                                <GridCell Key="SrcServiceConfirmDtlOID" Caption="SrcServiceConfirmDtlID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcServiceConfirmDtlOID"/>
                                </GridCell>
                                <GridCell Key="SrcServiceAssignOID" Caption="SrcServiceAssignDtlID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcServiceAssignOID"/>
                                </GridCell>
                                <GridCell Key="SrcServiceAccountAssignOID" Caption="SrcServiceAccountAssignDtlID" CellType="NumberEditor">
                                    <DataBinding ColumnKey="SrcServiceAccountAssignOID"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="SrcProductionOrderSOID" Caption="SrcPPOrderBillID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcProductionOrderSOID"/>
                                </GridCell>
                                <GridCell Key="SrcProductionOrderBOMOID" Caption="SrcPPOrderBOMBillDtlID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcProductionOrderBOMOID"/>
                                </GridCell>
                                <GridCell Key="Dtl_PerentProductCostCollectorID" Caption="成本收集器ID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="ProductCostCollectorID"/>
                                </GridCell>
                                <GridCell Key="PushedGRQuantity102" Caption="已冲销数量102" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="PushedGRQuantity102"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="PushedGRQuantity104" Caption="已下推采购收货数量104" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="PushedGRQuantity104"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="PushedGRQuantity105" Caption="已下推采购收货数量105" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="PushedGRQuantity105"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="PushedGRQuantity108" Caption="已下推采购收货数量108" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="PushedGRQuantity108"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="PushedGRQuantity109" Caption="已下推采购收货数量109" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="PushedGRQuantity109"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="PushedGRQuantity122" Caption="已下推采购收货数量122" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="PushedGRQuantity122"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="PushedGRQuantity124" Caption="已下推采购收货数量124" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="PushedGRQuantity124"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="PushedGRQuantity162" Caption="已下推采购收货数量162" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="PushedGRQuantity162"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="PushedGIQuantity1" Caption="已经开票数量(1-发票)" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="PushedGIQuantity1"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="PushedGIQuantity2" Caption="已经开票数量(2-贷项发票)" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="PushedGIQuantity2"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="PushedGIQuantity3" Caption="已经开票数量(3-后续借记)" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="PushedGIQuantity3"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="PushedGIQuantity4" Caption="已经开票数量(4-后续贷记)" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="PushedGIQuantity4"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="IsMBSHideShow" Caption="MBST显示时候隐藏" CellType="NumberEditor" Precision="9" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="IsMBSHideShow" DefaultValue="0"/>
                                </GridCell>
                                <GridCell Key="InspectionLotSOID" Caption="检验批" CellType="Dict" ItemKey="QM_InspectionLot__Dic" StateMask="Enable|Disable|Discard">
                                    <DataBinding ColumnKey="InspectionLotSOID"/>
                                </GridCell>
                                <GridCell Key="InspectionGenerateMsegType" Caption="类型" CellType="ComboBox" GroupKey="InspectionGenerateMsegTypeGroup" SourceType="ParaGroup">
                                    <DataBinding ColumnKey="InspectionGenerateMsegType"/>
                                </GridCell>
                                <GridCell Key="InspectionLotPostingType" Caption="检验批决策时候生成物料凭证规则类型" CellType="TextEditor" MaxLength="100" Trim="true">
                                    <DataBinding ColumnKey="InspectionLotPostingType"/>
                                </GridCell>
                                <GridCell Key="IsEstimatedPrice" Caption="GR非估价" CellType="CheckBox">
                                    <DataBinding ColumnKey="IsEstimatedPrice"/>
                                </GridCell>
                                <GridCell Key="AutoCreate" Caption="自动建立" CellType="NumberEditor" Precision="9" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="AutoCreate" DefaultValue="0"/>
                                </GridCell>
                                <GridCell Key="ValueStringID" Caption="价值串" CellType="Dict" ItemKey="ValueString">
                                    <DataBinding ColumnKey="ValueStringID">
                                        <CheckRule>
                                            <![CDATA[IIFS(ValueStringID>0&&GetDictValue('ValueString', ValueStringID, 'NodeType')!=0, '不能选择汇总节点', true, true)]]>
                                        </CheckRule>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="LocalMoney" Caption="按本位币计的金额" CellType="NumberEditor">
                                    <DataBinding ColumnKey="LocalMoney"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="DeliveryCost" Caption="用本币计算的交货成本" CellType="NumberEditor">
                                    <DataBinding ColumnKey="DeliveryCost"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="RevaluationDirection" Caption="重新评估中的借项/贷项标识" CellType="NumberEditor" Precision="9" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="RevaluationDirection"/>
                                </GridCell>
                                <GridCell Key="RevaluationMoney" Caption="上一期间返回记账中的重估金额" CellType="NumberEditor">
                                    <DataBinding ColumnKey="RevaluationMoney"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="PreviousStockQuantity" Caption="过账前总计估价库存" CellType="NumberEditor" Scale="3">
                                    <DataBinding ColumnKey="PreviousStockQuantity"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="PreviousStockMoney" Caption="过账前总计评估的库存的价值" CellType="NumberEditor">
                                    <DataBinding ColumnKey="PreviousStockMoney"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="LocalDeliveryCost" Caption="本币交货成本" CellType="NumberEditor">
                                    <DataBinding ColumnKey="LocalDeliveryCost"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="FromPlantID" Caption="工厂" CellType="Dict" ItemKey="Plant">
                                    <DataBinding ColumnKey="FromPlantID"/>
                                </GridCell>
                                <GridCell Key="FromStorageLocationID" Caption="地点" CellType="Dict" ItemKey="StorageLocation">
                                    <DataBinding ColumnKey="FromStorageLocationID"/>
                                </GridCell>
                                <GridCell Key="FromStoragePointID" Caption="子库" CellType="Dict" ItemKey="StoragePoint">
                                    <DataBinding ColumnKey="FromStoragePointID"/>
                                </GridCell>
                                <GridCell Key="FromBatchCode" Caption="批次" CellType="TextButton" MaxLength="30" Trim="true">
                                    <DataBinding ColumnKey="FromBatchCode"/>
                                </GridCell>
                                <GridCell Key="FromMaterialID" Caption="物料" CellType="Dict" ItemKey="Material">
                                    <DataBinding ColumnKey="FromMaterialID"/>
                                </GridCell>
                                <GridCell Key="IsNoStock" Caption="不入库存" CellType="CheckBox">
                                    <DataBinding ColumnKey="IsNoStock"/>
                                </GridCell>
                                <GridCell Key="IsReversed" Caption="已经冲销" CellType="NumberEditor" Precision="9" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="IsReversed"/>
                                </GridCell>
                                <GridCell Key="IsSuggestZeroLine" Caption="建议零行" CellType="CheckBox">
                                    <DataBinding ColumnKey="IsSuggestZeroLine" DefaultFormulaValue="ToInt(IsHeadSuggestZeroLines)"/>
                                </GridCell>
                                <GridCell Key="ConsignmentPrice" Caption="寄售单价" CellType="NumberEditor" Scale="6">
                                    <DataBinding ColumnKey="ConsignmentPrice"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="TaxMoney" Caption="税额" CellType="NumberEditor">
                                    <DataBinding ColumnKey="TaxMoney"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="SrcBOMDtlOID" Caption="subParentBillDtlID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                    <DataBinding ColumnKey="SrcBOMDtlOID"/>
                                </GridCell>
                                <GridCell Key="SrcDocumentNumber" Caption="SrcDocumentNumber" CellType="TextEditor" Enable="false">
                                    <DataBinding ColumnKey="SrcDocumentNumber"/>
                                </GridCell>
                                <GridCell Key="SrcFormKey" Caption="SrcFormKey" CellType="TextEditor" Enable="false">
                                    <DataBinding ColumnKey="SrcFormKey"/>
                                </GridCell>
                                <GridCell Key="Dtl_SOID" Caption="物料凭证单据ID" CellType="NumberEditor" Scale="0">
                                    <DataBinding ColumnKey="SOID"/>
                                </GridCell>
                                <GridCell Key="ATPcheck" Caption="ATP检查" CellType="Button" Type="Normal">
                                    <DataBinding DefaultValue="ATP检查"/>
                                    <OnClick>
                                        <![CDATA[Macro_ATPCheck();]]>
                                    </OnClick>
                                </GridCell>
                                <GridCell Key="ReferenceDocNo" Caption="参考凭证" CellType="NumberEditor" Enable="false" CellSortType="None" CopyNew="false">
                                    <DataBinding ColumnKey="ReferenceDocNo"/>
                                </GridCell>
                                <GridCell Key="FundID" Caption="基金" CellType="Dict" Enable="Macro_Plant_Material_Enablewhen()&amp;&amp;Macro_IsFMAADerivation(CompanyCodeID)" ItemKey="FM_Fund">
                                    <DataBinding ColumnKey="FundID">
                                        <CheckRule>
                                            <![CDATA[IIF(Macro_GetFinancialManagementAreaID(CompanyCodeID)>0&&Macro_IsFMAADerivation(CompanyCodeID)>0&&Macro_IsFundActive()&&!Macro_IsAllowFundBlank(Macro_GetFinancialManagementAreaID(CompanyCodeID),Dtl_DocumentDate)&&FundID==0, MessageFacade('FM_ACCOUNTASSIGNELEBLANK001','后台配置中基金不允许为空'), true)]]>
                                        </CheckRule>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="FundCenterID" Caption="基金中心" CellType="Dict" Enable="Macro_Plant_Material_Enablewhen()&amp;&amp;Macro_IsFMAADerivation(CompanyCodeID)" ItemKey="FM_FundCenter">
                                    <DataBinding ColumnKey="FundCenterID">
                                        <CheckRule>
                                            <![CDATA[IIF(AccountAssignmentCategoryID==0&&Macro_IsFMAADerivation(CompanyCodeID)&&FundCenterID==0,MessageFacade('MM_MSEG039','已激活基金模块，请输入基金中心'),true)]]>
                                        </CheckRule>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="CommitmentItemID" Caption="承诺项目" CellType="Dict" Enable="Macro_Plant_Material_Enablewhen()&amp;&amp;Macro_IsFMAADerivation(CompanyCodeID)" ItemKey="FM_CommitmentItem">
                                    <DataBinding ColumnKey="CommitmentItemID">
                                        <CheckRule>
                                            <![CDATA[IIF(AccountAssignmentCategoryID==0&&Macro_IsFMAADerivation(CompanyCodeID)&&CommitmentItemID==0,MessageFacade('MM_MSEG033','已激活基金模块，请输入承诺项目'),true)]]>
                                        </CheckRule>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="FunctionalAreaID" Caption="功能范围" CellType="Dict" Enable="Macro_Plant_Material_Enablewhen()&amp;&amp;Macro_IsFMAADerivation(CompanyCodeID)" ItemKey="FunctionalArea">
                                    <DataBinding ColumnKey="FunctionalAreaID">
                                        <CheckRule>
                                            <![CDATA[IIF(Macro_GetFinancialManagementAreaID(CompanyCodeID)>0&&Macro_IsFMAADerivation(CompanyCodeID)>0&&Macro_IsFunctionAreaActive()&&!Macro_IsAllowFunctionalAreaBlank(Macro_GetFinancialManagementAreaID(CompanyCodeID),Dtl_DocumentDate)&&FunctionalAreaID==0, MessageFacade('FM_ACCOUNTASSIGNELEBLANK002','后台配置中功能范围不允许为空'), true)]]>
                                        </CheckRule>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="ShipToPartyID" Caption="收货方" CellType="Dict" ItemKey="Customer">
                                    <DataBinding ColumnKey="ShipToPartyID"/>
                                </GridCell>
                                <GridCell Key="IsCoProduct" Caption="联产品标识" CellType="CheckBox">
                                    <DataBinding ColumnKey="IsCoProduct"/>
                                </GridCell>
                                <GridCell Key="IsDeemedSale" Caption="视同销售" CellType="CheckBox">
                                    <DataBinding ColumnKey="IsDeemedSale">
                                        <DefaultFormulaValue>
                                            <![CDATA[IIF(BusinessType=='E'||BusinessType=='F',com.bokesoft.erp.mm.stock.Formula.getIsDeemedSalesValue(Dtl_MoveTypeID),IsDeemedSale)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="TaxCodeID" Caption="税码" CellType="Dict" Enable="false" ItemKey="TaxCode">
                                    <DataBinding ColumnKey="TaxCodeID">
                                        <CheckRule>
                                            <![CDATA[IIF(IsDeemedSale==1&&TaxCodeID<=0,MessageFacade('MM_MSEG034','发货视同销售为未置产品部门默认的税码，请设置后台【设置产品部门税码】'),true)]]>
                                        </CheckRule>
                                        <DefaultFormulaValue>
                                            <![CDATA[IIF(IsDeemedSale==1,com.bokesoft.erp.mm.stock.Formula.getTaxCodeID(MaterialID),0)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="MinimumRemainingShelfLife" Caption="剩余货架寿命" CellType="NumberEditor" Precision="9">
                                    <DataBinding ColumnKey="MinimumRemainingShelfLife"/>
                                </GridCell>
                                <GridCell Key="IsOutPlanSendMaterial" Caption="计划外发料" CellType="CheckBox">
                                    <DataBinding ColumnKey="IsOutPlanSendMaterial">
                                        <DefaultFormulaValue>
                                            <![CDATA[IIFS(GetEntryPara('T_Sign')=='SIGN', 1,
                                            (OrderCategory == '40' || OrderCategory == '10') && SrcProductionOrderSOID == 0 && DynOrderID > 0, 1,
                                            OrderCategory == '30' && SrcMaintenanceOID == 0 && DynOrderID > 0, 1,
                                            true, 0);]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="TCode2" Caption="TCode2" CellType="TextEditor">
                                    <DataBinding ColumnKey="TCode2"/>
                                </GridCell>
                                <GridCell Key="IsBatchManagement" Caption="批次管理" CellType="CheckBox">
                                    <DataBinding ColumnKey="IsBatchManagement">
                                        <DefaultFormulaValue>
                                            <![CDATA[Macro_MaterialIsBatchManagement(PlantID,MaterialID)]]>
                                        </DefaultFormulaValue>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="ControlCycleID" Caption="控制周期ID" CellType="NumberEditor">
                                    <DataBinding ColumnKey="ControlCycleID"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="BulletinBoardID" Caption="看板ID" CellType="NumberEditor">
                                    <DataBinding ColumnKey="BulletinBoardID"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="DeliveryCompleted" Caption="交货已完成标识" CellType="ComboBox" IntegerValue="true" SourceType="ParaGroup" GroupKey="IsDeliveryCompletedGroup">
                                    <DataBinding ColumnKey="DeliveryCompleted" DefaultValue="1"/>
                                </GridCell>
                                <GridCell Key="BatchOutboundSequence" Caption="批次出库顺序" CellType="ComboBox" SourceType="ParaGroup" GroupKey="BatchOutboundSequenceGroup" IntegerValue="true">
                                    <DataBinding ColumnKey="BatchOutboundSequence" DefaultValue="0">
                                        <ValueChanged>
                                            <![CDATA[SetValue('IsChangeBatchOutboundSequence',1);if (Direction==-1&&(BatchCode=='*'||BatchCode=='**'||BatchCode=='_')) {Macro_BatchOutboundSequence_Trigger();SetValue('OutstandingQuantity', GetPara('_UnDeliveryQuantity'));if (GetPara('_DialogBatchDeterm')==0) {if (GetPara('_UnDeliveryQuantity')>0) {RaiseErrMsg('MM_MSEG022','对所需数量 {1}, {2} {3} 仍然未清',GetDictValue('Material', MaterialID, 'Code'),GetDictValue('Unit', UnitID, 'Code'),GetPara('_UnDeliveryQuantity'))} else {Macro_UseThose_OnClick()}} else {true}} else {true}]]>
                                        </ValueChanged>
                                    </DataBinding>
                                </GridCell>
                                <GridCell Key="IsChangeBatchOutboundSequence" Caption="更改批次出库顺序" CellType="CheckBox">
                                    <DataBinding ColumnKey="IsChangeBatchOutboundSequence"/>
                                </GridCell>
                                <GridCell Key="SrcGlobalValuationTypeID" Caption="评估类型" CellType="Dict" ItemKey="MM_GlobalValuationType">
                                    <DataBinding ColumnKey="SrcGlobalValuationTypeID"/>
                                </GridCell>
                                <GridCell Key="Dtl_ExternalSystemPrimaryKey" Caption="外部系统关键字" CellType="TextEditor">
                                    <DataBinding ColumnKey="ExternalSystemPrimaryKey"/>
                                </GridCell>
                                <GridCell Key="LogisticsAssistQuantity" Caption="物流辅助数量" CellType="NumberEditor" Enable="false" Scale="3">
                                    <DataBinding ColumnKey="LogisticsAssistQuantity"/>
                                    <CellFormat HAlign="Right"/>
                                </GridCell>
                                <GridCell Key="LogisticsAssistUnitID" Caption="物流辅助单位" CellType="Dict" Enable="false" ItemKey="Unit">
                                    <DataBinding ColumnKey="LogisticsAssistUnitID"/>
                                </GridCell>
                            </GridRow>
                        </GridRowCollection>
                        <RowDblClick>
                            <![CDATA[if(!ReadOnly()&&Macro_IsATPcheck()){Macro_ATPCheck()}]]>
                        </RowDblClick>
                        <OnRowDelete>
                            <![CDATA[if(!Macro_IsShowMSEG()||GetDictValue('TCode', ActiveTCodeID, 'Code')=='MBST'){DeleteRow();}]]>
                        </OnRowDelete>
                        <GridFilter>
                            <FilterValue Index="1" FieldKey="IsMBSHideShow" RefValue="0" CondSign="&lt;="/>
                        </GridFilter>
                    </Grid>
                    <TabPanel Key="DownPanel">
                        <SubDetail Key="ProjectDtl" Caption="项目明细" BindingGridKey="MaterialDocumentDtl">
                            <GridLayoutPanel Key="ProjectDtlGridLayoutPanel" Caption="项目明细" Padding="8px" OverflowY="Auto" TopPadding="24px" Visible="!Macro_IsShowMSEG()&amp;&amp;Macro_IsMB31()">
                                <Dict Key="Dtl_MoveTypeID__mirror2" Caption="移动类型" X="0" Y="0" Visible="true" Enable="false" BindingCellKey="Dtl_MoveTypeID" ItemKey="MoveType"/>
                                <Dict Key="PlantID__mirror3" Caption="工厂" X="1" Y="0" Visible="true" Enable="false" BindingCellKey="PlantID" ItemKey="Plant"/>
                                <Dict Key="MaterialID__mirror3" Caption="物料" X="2" Y="0" Visible="true" Enable="false" BindingCellKey="MaterialID" ItemKey="Material"/>
                                <NumberEditor Key="PPOrderQuantity__mirror" Caption="已订购" X="0" Y="1" Visible="true" Enable="false" BindingCellKey="PPOrderQuantity" Scale="3"/>
                                <NumberEditor Key="PPRecipientQuantity__mirror" Caption="已接受" X="1" Y="1" Visible="true" Enable="false" BindingCellKey="PPRecipientQuantity" Scale="3"/>
                                <TextEditor Key="DynOrderIDDEKey__mirror2" Caption="订单字典标识" X="2" Y="1" Visible="false" BindingCellKey="DynOrderIDDEKey"/>
                                <DynamicDict Key="DynOrderID__mirror2" Caption="订单" BindingCellKey="DynOrderID" Enable="false" IsDynamic="true" RefDataElementKey="DynOrderIDDEKey" Visible="true" X="2" Y="1"/>
                                <RowDefCollection RowGap="24">
                                    <RowDef Height="32px"/>
                                    <RowDef Height="32px"/>
                                </RowDefCollection>
                                <ColumnDefCollection ColumnGap="16">
                                    <ColumnDef Width="16%"/>
                                    <ColumnDef Width="16%"/>
                                    <ColumnDef Width="17%"/>
                                    <ColumnDef Width="17%"/>
                                    <ColumnDef Width="17%"/>
                                    <ColumnDef Width="17%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </SubDetail>
                        <SubDetail Key="SpecialProjectDtl" Caption="项目明细" BindingGridKey="MaterialDocumentDtl">
                            <GridLayoutPanel Key="SpecialProjectDtlGridLayoutPanel" Caption="项目明细" Padding="8px" OverflowY="Auto" TopPadding="24px" Visible="Macro_IsShowMSEG()||(!Macro_IsMB31()&amp;&amp;!Macro_IsShowMSEG())">
                                <Dict Key="Dtl_MoveTypeID__mirror1" Caption="移动类型" X="0" Y="0" Visible="true" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('MoveTypeID')" BindingCellKey="Dtl_MoveTypeID" ItemKey="MoveType"/>
                                <Dict Key="MaterialID__mirror5" Caption="物料" X="1" Y="0" Visible="true" Enable="IIF(Macro_IsShowMSEG(),!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('MaterialID'),!ReadOnly())&amp;&amp;IIF(HasParent()&amp;&amp;parent.GetPara('RO_OID')&gt;0,false,true)" BindingCellKey="MaterialID" ItemKey="Material"/>
                                <Dict Key="SrcPurchaseOrderSOID__mirror" Caption="采购订单" X="2" Y="1" Visible="Dtl_MoveTypeID&gt;0&amp;&amp;GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')&lt;'201'&amp;&amp;SrcPurchaseOrderSOID&gt;0" Enable="false" BindingCellKey="SrcPurchaseOrderSOID" ItemKey="MM_PurchaseOrder__Dic" StateMask="Enable|Disable|Discard"/>
                                <TextEditor Key="DynOrderIDDEKey__mirror1" Caption="订单字典标识" X="1" Y="2" Visible="false" BindingCellKey="DynOrderIDDEKey"/>
                                <DynamicDict Key="DynOrderID__mirror1" Caption="订单" StateMask="Enable|Disable|Discard" BindingCellKey="DynOrderID" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('OrderNo')" IsDynamic="true" RefDataElementKey="DynOrderIDDEKey" Visible="Dtl_MoveTypeID&gt;0&amp;&amp;GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')&lt;'201'&amp;&amp;GetDictValue('MoveType', Dtl_MoveTypeID, 'PPOrderNo')!=2&amp;&amp;DynOrderID&gt;0" X="1" Y="2"/>
                                <Dict Key="PlantID__mirror5" Caption="工厂" X="2" Y="0" Visible="PlantID&gt;0" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('PlantID')" BindingCellKey="PlantID" ItemKey="Plant"/>
                                <Dict Key="VendorID__mirror1" Caption="供应商" X="0" Y="2" Visible="SpecialIdentity!='M'&amp;&amp;Dtl_MoveTypeID&gt;0&amp;&amp;GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')&lt;'201'&amp;&amp;SrcPurchaseOrderSOID&gt;0&amp;&amp;VendorID&gt;0" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('VendorID')" BindingCellKey="VendorID" ItemKey="Vendor"/>
                                <TextEditor Key="DynIdentityIDDEKey__mirror" Caption="特殊库存字典标识" X="1" Y="1" Visible="false" BindingCellKey="DynIdentityIDDEKey"/>
                                <DynamicDict Key="DynIdentityID__mirror" Caption="特殊库存" BindingCellKey="DynIdentityID" Enable="IIF(Macro_IsShowMSEG(),!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('SpecialIdentity'),!ReadOnly())&amp;&amp;IIF(HasParent()&amp;&amp;parent.GetPara('RO_OID')&gt;0,false,true)" IsDynamic="true" RefDataElementKey="DynIdentityIDDEKey" Visible="SpecialIdentity!='_'" X="1" Y="1" FormulaCaption="IIFS(SpecialIdentity=='B', '客户',SpecialIdentity=='E', '现有订单', SpecialIdentity=='K', '(寄售)供应商', SpecialIdentity=='P', '(管道)供应商', SpecialIdentity=='O', '分包供应商', SpecialIdentity=='Q', '项目库存', SpecialIdentity=='W', '(寄售)客户', SpecialIdentity=='V', '(可回收包装物)客户', SpecialIdentity=='T', '在途库存',SpecialIdentity=='M','供应商', true,'特殊库存标签')" StateMask="Enable|Disable|Discard">
                                    <ItemFilter>
                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="IIF(SpecialIdentity=='E',&quot;SpecialIdentity=&quot;&amp;SqlPara('E'),'')"/>
                                        </Filter>
                                    </ItemFilter>
                                </DynamicDict>
                                <ComboBox Key="SpecialIdentity__mirror2" Caption="特殊库存标识" X="0" Y="1" Visible="!GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB31'&amp;&amp;SpecialIdentity!='_'" Enable="false" SourceType="Formula" BindingCellKey="SpecialIdentity">
                                    <FormulaItems>
                                        <![CDATA[Macro_GetAllSpecialIdentity()]]>
                                    </FormulaItems>
                                </ComboBox>
                                <Dict Key="SrcOutboundDeliverySOID__mirror" Caption="外向交货单" X="2" Y="2" Visible="Dtl_MoveTypeID&gt;0&amp;&amp;SrcOutboundDeliverySOID&gt;0" Enable="false" BindingCellKey="SrcOutboundDeliverySOID" ItemKey="SD_OutboundDelivery__Dic" StateMask="Enable|Disable|Discard"/>
                                <RowDefCollection RowGap="24">
                                    <RowDef Height="32px"/>
                                    <RowDef Height="32px"/>
                                    <RowDef Height="32px"/>
                                </RowDefCollection>
                                <ColumnDefCollection ColumnGap="16">
                                    <ColumnDef Width="16%"/>
                                    <ColumnDef Width="16%"/>
                                    <ColumnDef Width="17%"/>
                                    <ColumnDef Width="17%"/>
                                    <ColumnDef Width="17%"/>
                                    <ColumnDef Width="17%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </SubDetail>
                        <SubDetail Key="QuantityUnitSubDetail" Caption="数量单位" BindingGridKey="MaterialDocumentDtl">
                            <GridLayoutPanel Key="QuantityUnitGridLayoutPanel" Caption="数量单位" Padding="8px" OverflowY="Auto" TopPadding="24px" Visible="!Macro_IsShowMSEG()">
                                <NumberEditor Key="Quantity__mirror2" Caption="数量" X="0" Y="0" Visible="true" BindingCellKey="Quantity" Scale="3"/>
                                <Dict Key="UnitID__mirror2" Caption="单位" X="1" Y="0" Visible="true" BindingCellKey="UnitID" ItemKey="Unit">
                                    <ItemFilter ItemKey="Unit">
                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="IIF(MaterialID&gt;0, 'soid in ('&amp;com.bokesoft.erp.basis.unit.UnitFormula.getUnitFmMaterial(MaterialID)&amp;')', '1=2')"/>
                                        </Filter>
                                    </ItemFilter>
                                </Dict>
                                <ComboBox Key="StockType__mirror" Caption="库存类型" X="2" Y="0" Visible="Macro_IsMB31()" SourceType="ParaGroup" GroupKey="StockTypeGroup" BindingCellKey="StockType" IntegerValue="true"/>
                                <Dict Key="PlantID__mirror2" Caption="工厂" X="2" Y="0" Visible="!Macro_IsMB31()" BindingCellKey="PlantID" ItemKey="Plant"/>
                                <Dict Key="StorageLocationID__mirror2" Caption="库存地点" X="3" Y="0" Visible="true" Enable="Macro_StorageLocationIDEnabledWhen(GetFormKey())" BindingCellKey="StorageLocationID" ItemKey="StorageLocation">
                                    <ItemFilter ItemKey="StorageLocation">
                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="IIF(PlantID&gt;0, 'PlantID='&amp;SqlPara(PlantID), '1=2')"/>
                                        </Filter>
                                    </ItemFilter>
                                </Dict>
                                <Dict Key="GlobalValuationTypeID__mirror2" Caption="评估类型" X="4" Y="0" Visible="Macro_isActivateSplitValuation()" Enable="!ReadOnly()&amp;&amp;Macro_IsSplitValuation()&amp;&amp;!Macro_ReservationOrderHaveValuationtype()&amp;&amp;IIF(Direction==1,!(GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB31'&amp;&amp;Macro_ProductionOrderIsReceipted()),!ToBool(IsBatchManagement))&amp;&amp;IIF(GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')=='101'&amp;&amp;SrcGlobalValuationTypeID&gt;0,false,true)" BindingCellKey="Dtl_GlobalValuationTypeID" ItemKey="MM_GlobalValuationType"/>
                                <TextButton Key="BatchCode__mirror2" Caption="批次" X="0" Y="1" Visible="true" Enable="!ReadOnly()&amp;&amp;IIF(Macro_IsShowMSEG(),Macro_GetMSEGFieldEnable('BatchCode'),true)&amp;&amp;ToBool(IsBatchManagement)&amp;&amp;!Macro_ReservationOrderHaveBatchCode()&amp;&amp;!Macro_ProductOrderHaveBatchCode()" BindingCellKey="BatchCode" Case="Upper" MaxLength="30" Trim="true" XSpan="2">
                                    <OnClick>
                                        <![CDATA[Macro_SetBatchCode(Direction, PlantID, MaterialID, 'StorageLocationID', 'StoragePointID', StockType, SpecialIdentity, DynIdentityID, 'BatchCode', 'Quantity')]]>
                                    </OnClick>
                                </TextButton>
                                <DatePicker Key="LastGRGITime_mirror" Caption="入库时间" X="2" Y="1" Visible="ToBool(IsBatchManagement)&amp;&amp;!Macro_IsShowMSEG()&amp;&amp;GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')=='561'" BindingCellKey="BatchLastGRGITime" FormulaCaption="IIF(Direction==1, '入库时间', '出库时间')"/>
                                <UTCDatePicker Key="ManufactureDate__mirror3" Caption="生产日期" X="0" Y="2" Visible="Macro_IsMB31()&amp;&amp;Macro_ManufactureDateOrShelfLifeExpirationDateVisible(Dtl_MoveTypeID,PlantID,MaterialID,ToBool(IsBatchManagement))" BindingCellKey="ManufactureDate" Format="yyyy-MM-dd" XSpan="2"/>
                                <UTCDatePicker Key="ShelfLifeDate__mirror3" Caption="货架寿命到期日" X="2" Y="2" Visible="Macro_IsMB31()&amp;&amp;Macro_ManufactureDateOrShelfLifeExpirationDateVisible(Dtl_MoveTypeID,PlantID,MaterialID,ToBool(IsBatchManagement))" BindingCellKey="ShelfLifeDate" Format="yyyy-MM-dd"/>
                                <Dict Key="StoragePointID__mirror" Caption="子库" X="3" Y="1" Visible="(com.bokesoft.erp.wmsintegration.WMSIntegrationFormula.activateWMS()&amp;&amp;com.bokesoft.erp.wms.master.WMSMasterData.releationWM(StorageLocationID))||(!com.bokesoft.erp.wmsintegration.WMSIntegrationFormula.activateWMS()&amp;&amp;com.bokesoft.erp.wmsintegration.WMSIntegrationFormula.enabledWhenStoragePoint(PlantID,StorageLocationID))" Enable="!ReadOnly()&amp;&amp;(com.bokesoft.erp.wmsintegration.WMSIntegrationFormula.activateWMS()&amp;&amp;com.bokesoft.erp.wms.master.WMSMasterData.releationWM(StorageLocationID))||(!com.bokesoft.erp.wmsintegration.WMSIntegrationFormula.activateWMS()&amp;&amp;com.bokesoft.erp.wmsintegration.WMSIntegrationFormula.enabledWhenStoragePoint(PlantID,StorageLocationID))" BindingCellKey="StoragePointID" ItemKey="StoragePoint"/>
                                <RowDefCollection RowGap="24">
                                    <RowDef Height="32px"/>
                                    <RowDef Height="32px"/>
                                    <RowDef Height="32px"/>
                                </RowDefCollection>
                                <ColumnDefCollection ColumnGap="16">
                                    <ColumnDef Width="10%"/>
                                    <ColumnDef Width="6%"/>
                                    <ColumnDef Width="16%"/>
                                    <ColumnDef Width="17%"/>
                                    <ColumnDef Width="17%"/>
                                    <ColumnDef Width="17%"/>
                                    <ColumnDef Width="17%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </SubDetail>
                        <SubDetail Key="QuantitySubDetail" Caption="数量" BindingGridKey="MaterialDocumentDtl">
                            <GridLayoutPanel Key="QuantityGridLayoutPanel" Caption="数量" Padding="8px" OverflowY="Auto" TopPadding="24px" Visible="(Macro_IsShowMSEG()&amp;&amp;GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')!='121')||UnitID!=BaseUnitID">
                                <NumberEditor Key="Quantity__mirror1" Caption="数量" X="0" Y="0" Visible="true" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('Quantity')" BindingCellKey="Quantity" Scale="3"/>
                                <Dict Key="UnitID__mirror3" Caption="单位" X="1" Y="0" Visible="true" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('UnitID')" BindingCellKey="UnitID" ItemKey="Unit"/>
                                <Dict Key="PlantID__mirror6" Caption="工厂" X="2" Y="0" Visible="!(GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MIGO'||GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB31')" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('PlantID')" BindingCellKey="PlantID" ItemKey="Plant"/>
                                <Dict Key="StorageLocationID__mirror3" Caption="库存地点" X="3" Y="0" Visible="true" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('StorageLocationID')&amp;&amp;GRBlockedStock!='S'&amp;&amp;MaterialID&gt;0&amp;&amp;GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'Code')!='K'&amp;&amp;GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')!='121'&amp;&amp;(SpecialIdentity=='_'||SpecialIdentity=='E'||SpecialIdentity=='K')" BindingCellKey="StorageLocationID" ItemKey="StorageLocation">
                                    <ItemFilter ItemKey="StorageLocation">
                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="IIF(PlantID&gt;0, 'PlantID='&amp;SqlPara(PlantID), '1=2')"/>
                                        </Filter>
                                    </ItemFilter>
                                </Dict>
                                <TextButton Key="BatchCode__mirror3" Caption="批次" X="2" Y="1" Visible="ToBool(IsBatchManagement)&amp;&amp;BatchCode!=''&amp;&amp;BatchCode!='_'" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('BatchCode')" BindingCellKey="BatchCode" Case="Upper" MaxLength="30" Trim="true">
                                    <OnClick>
                                        <![CDATA[Macro_SetBatchCode(Direction, PlantID, MaterialID, 'StorageLocationID', 'StoragePointID', StockType, SpecialIdentity, DynIdentityID, 'BatchCode', 'Quantity')]]>
                                    </OnClick>
                                </TextButton>
                                <TextEditor Key="SrcReservationDocNo__mirror1" Caption="预留编号" X="2" Y="2" Visible="SrcReservationDocNo!=''" Enable="false" BindingCellKey="SrcReservationDocNo" MaxLength="100" Trim="true"/>
                                <CheckBox Key="IsDeliveryCompleted__mirror1" Caption="交货已完成" X="4" Y="2" Visible="IsDeliveryCompleted==1" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('IsDeliveryCompleted')" BindingCellKey="IsDeliveryCompleted"/>
                                <Dict Key="SrcStoragePointID__mirror" Caption="子库" X="3" Y="1" Visible="SrcStoragePointID&gt;0" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('StoragePointID')" BindingCellKey="SrcStoragePointID" ItemKey="StoragePoint"/>
                                <NumberEditor Key="BaseQuantity__mirror" Caption="基本数量" X="0" Y="1" Visible="UnitID!=BaseUnitID" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('BaseQuantity')" BindingCellKey="BaseQuantity" Scale="3"/>
                                <Dict Key="BaseUnitID__mirror" Caption="基本单位" X="1" Y="1" Visible="UnitID!=BaseUnitID" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('BaseUnitID')" BindingCellKey="BaseUnitID" ItemKey="Unit"/>
                                <Dict Key="SrcUBPurchaseOrderSOID__mirror" Caption="采购订单" X="3" Y="2" Visible="Dtl_MoveTypeID&gt;0&amp;&amp;SrcUBPurchaseOrderSOID&gt;0&amp;&amp;GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')!='121'" Enable="false" BindingCellKey="SrcUBPurchaseOrderSOID" ItemKey="MM_PurchaseOrder__Dic" StateMask="Enable|Disable|Discard"/>
                                <UTCDatePicker Key="ManufactureDate__mirror5" Caption="生产日期" X="4" Y="0" Visible="(ManufactureDate&gt;0||ShelfLifeDate&gt;0)&amp;&amp;Macro_IsShowMSEG()||(ToBool(IsFromReverse)&amp;&amp;IsNew()&amp;&amp;Macro_ManufactureDateOrShelfLifeExpirationDateVisible(Dtl_MoveTypeID,PlantID,MaterialID,ToBool(IsBatchManagement)))" Enable="(IsNew()&amp;&amp;Direction==1)||!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('OfManufactureDate')" BindingCellKey="ManufactureDate">
                                    <DataBinding/>
                                </UTCDatePicker>
                                <UTCDatePicker Key="ShelfLifeDate__mirror5" Caption="货架寿命到期日" X="4" Y="1" Visible="(ManufactureDate&gt;0||ShelfLifeDate&gt;0)&amp;&amp;Macro_IsShowMSEG()||(ToBool(IsFromReverse)&amp;&amp;IsNew()&amp;&amp;Macro_ManufactureDateOrShelfLifeExpirationDateVisible(Dtl_MoveTypeID,PlantID,MaterialID,ToBool(IsBatchManagement)))" Enable="(IsNew()&amp;&amp;Direction==1)||!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('ShelfLifeDate')" BindingCellKey="ShelfLifeDate">
                                    <DataBinding/>
                                </UTCDatePicker>
                                <NumberEditor Key="LogisticsAssistQuantity__mirror" Caption="物流辅助数量" X="0" Y="2" Visible="true" BindingCellKey="LogisticsAssistQuantity">
                                    <DataBinding/>
                                    <Format HAlign="Right"/>
                                </NumberEditor>
                                <Dict Key="LogisticsAssistUnitID__mirror" Caption="物流辅助单位" X="1" Y="2" Visible="true" ItemKey="Unit" BindingCellKey="LogisticsAssistUnitID">
                                    <DataBinding/>
                                </Dict>
                                <RowDefCollection RowGap="24">
                                    <RowDef Height="32px"/>
                                    <RowDef Height="32px"/>
                                    <RowDef Height="32px"/>
                                </RowDefCollection>
                                <ColumnDefCollection ColumnGap="16">
                                    <ColumnDef Width="10%"/>
                                    <ColumnDef Width="6%"/>
                                    <ColumnDef Width="16%"/>
                                    <ColumnDef Width="17%"/>
                                    <ColumnDef Width="17%"/>
                                    <ColumnDef Width="17%"/>
                                    <ColumnDef Width="17%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </SubDetail>
                        <SubDetail Key="ReservationSubDetail" Caption="预留" BindingGridKey="MaterialDocumentDtl">
                            <GridLayoutPanel Key="ReservationGridLayoutPanel" Caption="预留" Padding="8px" OverflowY="Auto" TopPadding="24px" Visible="IsFromReservation">
                                <TextEditor Key="SrcReservationDocNo__mirror2" Caption="预留编号" X="0" Y="0" Visible="true" Enable="false" BindingCellKey="SrcReservationDocNo" MaxLength="100" Trim="true"/>
                                <UTCDatePicker Key="SrcReservationRequirementDate__mirror2" Caption="需求日期" X="0" Y="1" Visible="true" Enable="false" Format="yyyy-MM-dd" BindingCellKey="SrcReservationRequirementDate"/>
                                <NumberEditor Key="SrcReservationBaseQuantity__mirror2" Caption="需求数量" X="1" Y="0" Visible="true" Enable="false" Scale="3" BindingCellKey="SrcReservationBaseQuantity"/>
                                <Dict Key="BaseUnitID__mirror2" Caption="需求单位" X="2" Y="0" Visible="true" Enable="false" ItemKey="Unit" BindingCellKey="BaseUnitID"/>
                                <NumberEditor Key="SrcReservationPickupBaseQuantity__mirror2" Caption="提货数量" X="1" Y="1" Visible="true" Enable="false" Scale="3" BindingCellKey="SrcReservationPickupBaseQuantity"/>
                                <CheckBox Key="IsFinalSendGoods__mirror2" Caption="最后发货" X="2" Y="1" Visible="true" Enable="!ReadOnly()&amp;&amp;IsFromReservation" BindingCellKey="IsFinalSendGoods"/>
                                <RowDefCollection RowGap="24">
                                    <RowDef Height="32px"/>
                                    <RowDef Height="32px"/>
                                    <RowDef Height="32px"/>
                                </RowDefCollection>
                                <ColumnDefCollection ColumnGap="16">
                                    <ColumnDef Width="25%"/>
                                    <ColumnDef Width="17%"/>
                                    <ColumnDef Width="8%"/>
                                    <ColumnDef Width="25%"/>
                                    <ColumnDef Width="25%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </SubDetail>
                        <SubDetail Key="AccountAssignSubDetail" Caption="科目分配" BindingGridKey="MaterialDocumentDtl" Height="pref">
                            <FlexGridLayoutPanel Key="AccountAssignDtl" Caption="科目分配" ColumnCount="6" ColumnGap="16" Height="pref" OverflowY="Auto" Padding="8px" RowGap="24" Visible="!Macro_IsMB31()&amp;&amp;!Macro_IsShowMSEG()" TopPadding="24px">
                                <Dict Key="GLAccountID__mirror" Caption="总账科目" X="0" Y="0" Visible="Macro_GetDtlFieldVisibleByHead('AccountControl')" BindingCellKey="GLAccountID" ItemKey="Account"/>
                                <Dict Key="PartnerBusinessAreaID__mirror" Caption="业务范围" X="1" Y="1" Visible="Macro_GetDtlFieldVisibleByList('BusinessArea')" BindingCellKey="PartnerBusinessAreaID" ItemKey="BusinessArea"/>
                                <Dict Key="PartnerProfitCenterID__mirror" Caption="利润中心" X="0" Y="1" Visible="Macro_GetDtlFieldVisibleByHead('AccountControl')||Macro_GetDtlFieldVisibleByList('BusinessArea')" BindingCellKey="PartnerProfitCenterID" ItemKey="ProfitCenter"/>
                                <Dict Key="ProfitSegmentSOID__mirror" Caption="获利能力段" X="1" Y="2" Visible="com.bokesoft.erp.copa.masterdata.OperatingConcernFormula.isActiveOperatingConcern(CompanyCodeID)" Enable="false" BindingCellKey="ProfitSegmentSOID" ItemKey="COPA_ProfitSegment__Dic" StateMask="Enable|Disable|Discard"/>
                                <Button Key="BtnProfitSegment" Caption="获利能力段" X="2" Y="2" Visible="com.bokesoft.erp.copa.masterdata.OperatingConcernFormula.isActiveOperatingConcern(CompanyCodeID)" Enable="true" Type="Normal">
                                    <OnClick>
                                        <![CDATA[SetPara('BusinessFiledType','ProfitSegmentSOID');IIF(Dtl_OID>0,ERPShowModal('COPA_ProfitSegment',GetCallFormula('Macro_OpenProfitSegment_ShowEvent',ProfitSegmentSOID,Dtl_OID)),true)]]>
                                    </OnClick>
                                </Button>
                                <TextEditor Key="DynOrderIDDEKey__mirror" Caption="订单字典标识" X="1" Y="0" Visible="false" BindingCellKey="DynOrderIDDEKey"/>
                                <DynamicDict Key="DynOrderID__mirror" Caption="订单" BindingCellKey="DynOrderID" Enable="!ReadOnly()&amp;&amp;IIF(SrcProductionOrderBOMOID&gt;0, false, true)" IsDynamic="true" RefDataElementKey="DynOrderIDDEKey" Visible="Macro_GetDtlFieldVisibleByHead('PPOrderNo')" X="1" Y="0" StateMask="Enable|Disable|Discard"/>
                                <Dict Key="VendorID__mirror" Caption="供应商" X="0" Y="0" Visible="SpecialIdentity!='M'&amp;&amp;Macro_GetDtlFieldVisibleByHead('Vendor')" BindingCellKey="VendorID" ItemKey="Vendor"/>
                                <Dict Key="CustomerID__mirror" Caption="客户" X="1" Y="0" Visible="Macro_GetDtlFieldVisibleByHead('Customer')" BindingCellKey="CustomerID" ItemKey="Customer"/>
                                <Dict Key="SrcSaleOrderDtlOID__mirror1" Caption="销售订单-行号" X="2" Y="0" Visible="Macro_GetDtlFieldVisibleByList('SaleOrder')&amp;&amp;SpecialIdentity!='E'" BindingCellKey="SrcSaleOrderDtlOID" ItemKey="SD_SaleOrderDtl__Dic" StateMask="Enable|Disable|Discard"/>
                                <Dict Key="Dtl_CostCenterID__mirror" Caption="成本中心" X="0" Y="0" Visible="Macro_GetDtlFieldVisibleByList('CostCenter')" BindingCellKey="Dtl_CostCenterID" ItemKey="CostCenter"/>
                                <UTCDatePicker Key="ManufactureDate__mirror2" Caption="生产日期" X="1" Y="0" Visible="!Macro_IsMB31()&amp;&amp;Macro_ManufactureDateOrShelfLifeExpirationDateVisible(Dtl_MoveTypeID,PlantID,MaterialID,ToBool(IsBatchManagement))" Enable="!ReadOnly()&amp;&amp;Direction==1" BindingCellKey="ManufactureDate" Format="yyyy-MM-dd"/>
                                <UTCDatePicker Key="ShelfLifeDate__mirror2" Caption="货架寿命到期日" X="2" Y="0" Visible="!Macro_IsMB31()&amp;&amp;Macro_ManufactureDateOrShelfLifeExpirationDateVisible(Dtl_MoveTypeID,PlantID,MaterialID,ToBool(IsBatchManagement))" Enable="!ReadOnly()&amp;&amp;Direction==1" BindingCellKey="ShelfLifeDate" Format="yyyy-MM-dd"/>
                                <Dict Key="WBSElementID__mirror" Caption="WBS元素" X="0" Y="0" Visible="Macro_GetDtlFieldVisibleByHead('PS_WBSElement')&amp;&amp;SpecialIdentity!='Q'" BindingCellKey="WBSElementID" ItemKey="PS_WBSElement"/>
                                <Dict Key="NetworkID__mirror" Caption="网络" X="1" Y="0" Visible="Macro_GetDtlFieldVisibleByHead('Network')" BindingCellKey="NetworkID" ItemKey="PS_Network"/>
                                <Dict Key="AssetCardSOID__mirror" Caption="资产" X="2" Y="0" Visible="Macro_GetDtlFieldVisibleByHead('AssetsCard')" BindingCellKey="AssetCardSOID" ItemKey="AM_AssetCard__Dic" StateMask="Enable|Disable|Discard"/>
                                <TextEditor Key="Dtl_Notes__mirror" Caption="文本" X="1" Y="0" Visible="true" BindingCellKey="Dtl_Notes" MaxLength="100" Trim="true"/>
                                <NumberEditor Key="Money561__mirror2" Caption="金额" X="0" Y="0" Visible="Macro_GetDTlFieldVisibleByCheck('IsInitMoneyDisplay')" BindingCellKey="Money561"/>
                                <Dict Key="Reason4MovementID__mirror" Caption="移动原因" X="2" Y="0" Visible="Macro_GetDtlFieldVisibleByHead('ControlReason')" BindingCellKey="Reason4MovementID" ItemKey="MM_Reason4Movement">
                                    <ItemFilter ItemKey="MM_Reason4Movement">
                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="IIF(Dtl_MoveTypeID&gt;0, 'EMM_Reason4Movement.soid in(Select soid from EMM_Reason4MovementDtl where MoveTypeID='&amp;SqlPara(Dtl_MoveTypeID)&amp;')', '1=2')"/>
                                        </Filter>
                                    </ItemFilter>
                                </Dict>
                            </FlexGridLayoutPanel>
                        </SubDetail>
                        <SubDetail Key="CustomerAccountAssignSubDetail" Caption="科目分配" BindingGridKey="MaterialDocumentDtl">
                            <FlexGridLayoutPanel Key="CustomerAccountAssignDtl" Caption="科目分配" ColumnCount="6" ColumnGap="16" OverflowY="Auto" Padding="8px" RowGap="24" Visible="Dtl_OID&gt;0&amp;&amp;Macro_IsShowMSEG()&amp;&amp;!Macro_GetnotShowAssign(GetDictValue('MoveType', Dtl_MoveTypeID, 'Code'))&amp;&amp;!IIF(GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MBST',GetDictValue('TCode', SrcTCodeID, 'Code')=='MIGO'||GetDictValue('TCode', SrcTCodeID, 'Code')=='ML81N'||(GetDictValue('TCode', SrcTCodeID, 'Code')=='MB31'&amp;&amp;DynOrderID==0),GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MIGO'||GetDictValue('TCode', Dtl_TCodeID, 'Code')=='ML81N'||(GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB31'&amp;&amp;DynOrderID==0))" TopPadding="24px">
                                <Dict Key="CustomerID__mirror2" Caption="客户" X="0" Y="0" Visible="GetDictValue('MoveType', Dtl_MoveTypeID, 'Customer')!=2&amp;&amp;SpecialIdentity!='W'&amp;&amp;SpecialIdentity!='V'" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('CustomerID')" BindingCellKey="CustomerID" ItemKey="Customer"/>
                                <TextEditor Key="DynOrderIDDEKey__mirror3" Caption="订单字典标识" X="0" Y="1" Visible="false" BindingCellKey="DynOrderIDDEKey"/>
                                <DynamicDict Key="DynOrderID__mirror3" Caption="订单" BindingCellKey="DynOrderID" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('OrderNo')" IsDynamic="true" RefDataElementKey="DynOrderIDDEKey" Visible="GetDictValue('MoveType', Dtl_MoveTypeID, 'PPOrderNo')!=2||(AccountAssignmentCategoryID&gt;0&amp;&amp;DynOrderID&gt;0&amp;&amp;GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'InternalCode')=='F')" X="0" Y="1" StateMask="Enable|Disable|Discard"/>
                                <TextEditor Key="Dtl_Notes__mirror1" Caption="备注" X="2" Y="1" Visible="true" BindingCellKey="Dtl_Notes" MaxLength="100" Trim="true"/>
                                <Dict Key="PartnerBusinessAreaID__mirror1" Caption="业务范围" X="1" Y="3" Visible="Macro_GetDtlFieldVisibleByList('BusinessArea')&amp;&amp;PartnerBusinessAreaID&gt;0" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('BusinessAreaID')" BindingCellKey="PartnerBusinessAreaID" ItemKey="BusinessArea"/>
                                <Dict Key="GLAccountID__mirror1" Caption="总账科目" X="0" Y="2" Visible="Macro_GetDtlFieldVisibleByHead('AccountControl')" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('GLAccountID')" BindingCellKey="GLAccountID" ItemKey="Account"/>
                                <Dict Key="Dtl_CostCenterID__mirror1" Caption="成本中心" X="1" Y="2" Visible="Macro_GetDtlFieldVisibleByList('CostCenter')" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('CostCenterID')" BindingCellKey="Dtl_CostCenterID" ItemKey="CostCenter"/>
                                <Dict Key="WBSElementID__mirror1" Caption="WBS元素" X="0" Y="4" Visible="Macro_GetDtlFieldVisibleByHead('PS_WBSElement')&amp;&amp;SpecialIdentity!='Q'" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('WBSElementID')" BindingCellKey="WBSElementID" ItemKey="PS_WBSElement"/>
                                <Dict Key="NetworkID__mirror1" Caption="网络" X="1" Y="4" Visible="Macro_GetDtlFieldVisibleByHead('Network')" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('NetworkID')" BindingCellKey="NetworkID" ItemKey="PS_Network"/>
                                <Dict Key="ActivityID__mirror1" Caption="作业" X="2" Y="4" Visible="Macro_GetDtlFieldVisibleByHead('Network')" Enable="false" BindingCellKey="ActivityID" ItemKey="PS_Activity"/>
                                <Dict Key="AssetCardSOID__mirror1" Caption="资产" X="0" Y="5" Visible="Macro_GetDtlFieldVisibleByHead('AssetsCard')" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('AssetID')" BindingCellKey="AssetCardSOID" ItemKey="AM_AssetCard__Dic" StateMask="Enable|Disable|Discard"/>
                                <Dict Key="FromMaterialID__mirror" Caption="收货物料" X="1" Y="5" Visible="Direction==-1&amp;&amp;GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB1B'&amp;&amp;Macro_GetDtlFieldVisibleByList('Material')" Enable="false" BindingCellKey="FromMaterialID" ItemKey="Material"/>
                                <Dict Key="FromMaterialID__mirror1" Caption="发货物料" X="1" Y="5" Visible="Direction==1&amp;&amp;GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB1B'&amp;&amp;Macro_GetDtlFieldVisibleByList('Material')" Enable="false" BindingCellKey="FromMaterialID" ItemKey="Material"/>
                                <NumberEditor Key="Money561__mirror" Caption="金额" X="2" Y="5" Visible="Macro_GetDtlFieldVisibleByList('IsInitMoneyDisplay')&amp;&amp;Money561&gt;0" Enable="false" BindingCellKey="Money561"/>
                                <Dict Key="FromPlantID__mirror" Caption="收货工厂" X="0" Y="6" Visible="Direction==-1&amp;&amp;(GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB1B'||GetDictValue('TCode', SrcTCodeID, 'Code')=='MB1B')" Enable="false" BindingCellKey="FromPlantID" ItemKey="Plant"/>
                                <Dict Key="FromPlantID__mirror1" Caption="发货工厂" X="0" Y="6" Visible="Direction==1&amp;&amp;(GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB1B'||GetDictValue('TCode', SrcTCodeID, 'Code')=='MB1B')" Enable="false" BindingCellKey="FromPlantID" ItemKey="Plant"/>
                                <Dict Key="FromStorageLocationID__mirror" Caption="收货地点" X="1" Y="6" Visible="Direction==-1&amp;&amp;(GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB1B'||GetDictValue('TCode', SrcTCodeID, 'Code')=='MB1B')" Enable="false" BindingCellKey="FromStorageLocationID" ItemKey="StorageLocation"/>
                                <Dict Key="FromStorageLocationID__mirror1" Caption="发货地点" X="1" Y="6" Visible="Direction==1&amp;&amp;(GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB1B'||GetDictValue('TCode', SrcTCodeID, 'Code')=='MB1B')" Enable="false" BindingCellKey="FromStorageLocationID" ItemKey="StorageLocation"/>
                                <Dict Key="FromStoragePointID__mirror" Caption="子库" X="2" Y="3" Visible="com.bokesoft.erp.wmsintegration.WMSIntegrationFormula.enabledWhenStoragePoint(FromPlantID,FromStorageLocationID)" Enable="false" BindingCellKey="FromStoragePointID" ItemKey="StoragePoint"/>
                                <TextButton Key="FromBatchCode__mirror" Caption="收货批次" X="2" Y="6" Visible="Direction==-1&amp;&amp;GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB1B'" Enable="false" BindingCellKey="FromBatchCode" MaxLength="30" Trim="true"/>
                                <TextButton Key="FromBatchCode__mirror1" Caption="发货批次" X="2" Y="6" Visible="Direction==1&amp;&amp;GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB1B'" Enable="false" BindingCellKey="FromBatchCode" MaxLength="30" Trim="true"/>
                                <Dict Key="SrcSaleOrderDtlOID__mirror" Caption="销售订单-行号" X="1" Y="1" Visible="Macro_GetDtlFieldVisibleByList('SaleOrder')&amp;&amp;SpecialIdentity!='E'" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('SalesOrderNo')" BindingCellKey="SrcSaleOrderDtlOID" ItemKey="SD_SaleOrderDtl__Dic" StateMask="Enable|Disable|Discard"/>
                                <TextEditor Key="IdentityIDDEKey__mirror2" Caption="特殊库存字典标识" X="1" Y="0" Visible="false" BindingCellKey="DynIdentityIDDEKey"/>
                                <DynamicDict Key="DynIdentityID__mirror2" Caption="特殊库存" BindingCellKey="DynIdentityID" Enable="!ReadOnly()&amp;&amp;Macro_GetMSEGFieldEnable('IdentityID')" FormulaCaption="IIFS(SpecialIdentity=='E', '现有订单', SpecialIdentity=='K', '(寄售)供应商', SpecialIdentity=='P', '(管道)供应商', SpecialIdentity=='O', '分包供应商', SpecialIdentity=='Q', '项目库存', SpecialIdentity=='W', '(寄售)客户', SpecialIdentity=='V', '(可回收包装物)客户',SpecialIdentity=='M','供应商', true,'特殊库存标签')" IsDynamic="true" RefDataElementKey="DynIdentityIDDEKey" Visible="SpecialIdentity!='_'" X="1" Y="0"/>
                                <Dict Key="ShipToPartyID__mirror" Caption="收货方" X="2" Y="0" BindingCellKey="ShipToPartyID" ItemKey="Customer"/>
                                <Dict Key="PartnerProfitCenterID__mirror1" Caption="利润中心" X="0" Y="3" BindingCellKey="PartnerProfitCenterID" ItemKey="ProfitCenter"/>
                            </FlexGridLayoutPanel>
                        </SubDetail>
                        <SubDetail Key="AccountAssign" Caption="科目分配" BindingGridKey="MaterialDocumentDtl">
                            <GridLayoutPanel Key="AccountAssignGridLayoutPanel" Caption="科目分配" OverflowY="Auto" Visible="Dtl_OID&gt;0&amp;&amp;GetRowCount('AccountAssignDtl2')&gt;1">
                                <Grid Key="AccountAssignDtl2" Caption="科目分配" Visible="Macro_IsFMAADerivation(CompanyCodeID)&gt;0||AccountAssignmentCategoryID&gt;0" SerialSeq="true" X="0" XSpan="3" Y="0" Padding="8px">
                                    <GridColumnCollection>
                                        <GridColumn Key="PA_POID" Caption="PA_POID" Visible="false" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_Quantity" Caption="数量" LabelType="H" Enable="false" Width="100px"/>
                                        <GridColumn Key="PA_BaseQuantity" Caption="基本数量" LabelType="M" Visible="Macro_DebugMode()" Enable="false" Width="100px"/>
                                        <GridColumn Key="PA_Percentage" Caption="百分比" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_Money" Caption="金额" LabelType="H" Enable="false" Width="100px"/>
                                        <GridColumn Key="PA_NetMoney" Caption="净值" LabelType="M" Visible="false" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_CostCenterID" Caption="成本中心" LabelType="H" Visible="GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'Code')=='K'||GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'Code')=='N'||GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'Code')=='F'" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_ProfitCenterID" Caption="利润中心" LabelType="H" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_GLAccountID" Caption="总账科目" LabelType="H" Visible="IIF(Macro_IsFMAADerivation(CompanyCodeID)&gt;0&amp;&amp;AccountAssignmentCategoryID==0,false,true)" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_WBSElementID" Caption="WBS要素" Visible="GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'Code')=='Q'||GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'InternalCode')=='P'" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_NetworkID" Caption="网络" LabelType="H" Visible="GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'InternalCode')=='P'||GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'InternalCode')=='N'||GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'InternalCode')=='F'" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_ActivityID" Caption="作业" LabelType="H" Visible="GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'InternalCode')=='P'||GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'InternalCode')=='N'||GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'InternalCode')=='F'" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_ControllingAreaID" Caption="成本控制范围" Visible="GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'Code')=='P'||GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'Code')=='N'||GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'Code')=='F'||GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'Code')=='Q'" Enable="false" Width="120px"/>
                                        <GridColumn Key="PA_BusinessAreaID" Caption="业务范围" LabelType="M" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_AssetCardSOID" Caption="资产" LabelType="H" Visible="GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'InternalCode')=='A'" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_SrcSaleOrderDtlOID" Caption="销售订单-行号" LabelType="M" Visible="GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'Code')=='E'||GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'Code')=='M'||GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'Code')=='1'" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_SrcScheduleLineIndex" Caption="交货计划行号" LabelType="M" Visible="GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'Code')=='1'" Enable="false" Width="120px"/>
                                        <GridColumn Key="PA_SrcSaleOrderSOID" Caption="销售订单" LabelType="H" Visible="Macro_DebugMode()" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_OrderCategory" Caption="订单类别" LabelType="M" Visible="GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'Code')=='F'" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_DynOrderID" Caption="订单" LabelType="H" Visible="GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'Code')=='F'" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_DynOrderIDDEKey" Caption="订单字典Key" Visible="false" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_OID" Visible="false" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_SOID" Visible="false" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_SrcPRSOID" Caption="源采购申请单据SOID" Visible="Macro_DebugMode()" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_SrcPROID" Caption="源采购申请明细OID" Visible="Macro_DebugMode()" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_SrcPRAccountAssignOID" Caption="源采购申请科目分配明细OID" LabelType="H" Visible="Macro_DebugMode()" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_CommitmentItemID" Caption="承诺项目" LabelType="H" Visible="Macro_IsFMAADerivation(CompanyCodeID)&gt;0" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_FundCenterID" Caption="基金中心" LabelType="M" Visible="Macro_IsFMAADerivation(CompanyCodeID)&gt;0" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_FundID" Caption="基金" LabelType="H" Visible="Macro_IsFMAADerivation(CompanyCodeID)&gt;0&amp;&amp;Macro_IsFundActive()" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_FunctionalAreaID" Caption="功能范围" LabelType="H" Visible="Macro_IsFMAADerivation(CompanyCodeID)&gt;0&amp;&amp;Macro_IsFunctionAreaActive()" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_EarmarkedFundVoucherSOID" Caption="专项基金" LabelType="H" Visible="Macro_IsFMAADerivation(CompanyCodeID)&gt;0" Enable="false" Width="80px"/>
                                        <GridColumn Key="PA_EarmarkedFundVoucherDtlOID" Caption="专项基金明细" LabelType="H" Visible="Macro_IsFMAADerivation(CompanyCodeID)&gt;0" Enable="false" Width="120px"/>
                                        <GridColumn Key="PA_ProfitSegmentSOID" Caption="获利能力段" LabelType="H" Visible="com.bokesoft.erp.copa.masterdata.OperatingConcernFormula.isActiveOperatingConcern(CompanyCodeID)" Enable="false" Width="100px"/>
                                        <GridColumn Key="PA_PMRoutingID" Caption="PM工序" LabelType="H" Visible="false" Enable="false" Width="80px"/>
                                    </GridColumnCollection>
                                    <GridRowCollection>
                                        <GridRow Key="AccountAssignDtlRow" TableKey="EMM_MD_AccountAssignDtl">
                                            <GridCell Key="PA_POID" Caption="PA_POID" CellType="NumberEditor" CopyNew="false" Scale="0" UseGroupingSeparator="false">
                                                <DataBinding ColumnKey="POID"/>
                                            </GridCell>
                                            <GridCell Key="PA_Quantity" Caption="数量" CellType="NumberEditor" Scale="3">
                                                <DataBinding ColumnKey="Quantity"/>
                                                <CellFormat HAlign="Right"/>
                                            </GridCell>
                                            <GridCell Key="PA_BaseQuantity" Caption="基本数量" CellType="NumberEditor" Scale="3">
                                                <DataBinding ColumnKey="BaseQuantity">
                                                    <DefaultFormulaValue>
                                                        <![CDATA[IIF(isWFMapping(),PA_BaseQuantity,IIF(BaseUnitDenominator>0,PA_Quantity*BaseUnitNumerator/BaseUnitDenominator,0))]]>
                                                    </DefaultFormulaValue>
                                                </DataBinding>
                                                <CellFormat HAlign="Right"/>
                                            </GridCell>
                                            <GridCell Key="PA_Percentage" Caption="百分比" CellType="NumberEditor" Scale="3">
                                                <DataBinding ColumnKey="Percentage"/>
                                                <CellFormat HAlign="Right"/>
                                            </GridCell>
                                            <GridCell Key="PA_Money" Caption="金额" CellType="NumberEditor">
                                                <DataBinding ColumnKey="Money"/>
                                                <CellFormat HAlign="Right"/>
                                            </GridCell>
                                            <GridCell Key="PA_NetMoney" Caption="净值" CellType="NumberEditor">
                                                <DataBinding ColumnKey="NetMoney"/>
                                                <CellFormat HAlign="Right"/>
                                            </GridCell>
                                            <GridCell Key="PA_CostCenterID" Caption="成本中心" CellType="Dict" ItemKey="CostCenter">
                                                <DataBinding ColumnKey="CostCenterID"/>
                                                <ItemFilter>
                                                    <Filter Key="F1_Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                        <FilterValue Index="1" ParaValue="IIF(PA_ControllingAreaID&gt;0, ' ControllingAreaID='&amp;SqlPara(PA_ControllingAreaID), '1=2')"/>
                                                    </Filter>
                                                </ItemFilter>
                                            </GridCell>
                                            <GridCell Key="PA_ProfitCenterID" Caption="利润中心" CellType="Dict" ItemKey="ProfitCenter">
                                                <DataBinding ColumnKey="ProfitCenterID"/>
                                                <ItemFilter ItemKey="ProfitCenter">
                                                    <Filter Key="F1_Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                        <FilterValue Index="1" ParaValue="IIF(CompanyCodeID&gt;0, ' ControllingAreaID='&amp;SqlPara(com.bokesoft.erp.mm.purchase.PurchaseOrderFormula.getControllingAreaByCompanyCodeID(CompanyCodeID)), '1=2')"/>
                                                    </Filter>
                                                </ItemFilter>
                                            </GridCell>
                                            <GridCell Key="PA_GLAccountID" Caption="总账科目" CellType="Dict" ItemKey="Account">
                                                <DataBinding ColumnKey="GLAccountID">
                                                    <CheckRule>
                                                        <![CDATA[IIFS(Macro_IsFMAADerivation(CompanyCodeID)>0&&AccountAssignmentCategoryID==0, true, PA_GLAccountID>0&&GetDictValue('Account', PA_GLAccountID, 'NodeType')!=0, '不能选择汇总节点', !PA_AssetCardSOID>0&&PA_GLAccountID<=0, MessageFacade('MM_PURCHASEORDER034','请输入总账科目'), true, true)]]>
                                                    </CheckRule>
                                                </DataBinding>
                                                <ItemFilter ItemKey="Account">
                                                    <Filter Key="F1_Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                        <FilterValue Index="1" ParaValue="IIF(GetDictValue('CompanyCode', CompanyCodeID, 'AccountChartID')&gt;0,' AccountChartID='&amp;SqlPara(GetDictValue('CompanyCode', CompanyCodeID, 'AccountChartID'))&amp;' And soid IN(SELECT soid from EFI_Account_CpyCodeDtl where CompanyCodeID='&amp;SqlPara(CompanyCodeID)&amp;') ',' soid IN(SELECT soid from EFI_Account_CpyCodeDtl where CompanyCodeID='&amp;SqlPara(CompanyCodeID)&amp;') ')"/>
                                                    </Filter>
                                                </ItemFilter>
                                            </GridCell>
                                            <GridCell Key="PA_WBSElementID" Caption="WBS要素" CellType="Dict" ItemKey="PS_WBSElement">
                                                <DataBinding ColumnKey="WBSElementID"/>
                                                <ItemFilter ItemKey="PS_WBSElement">
                                                    <Filter Key="F1_Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                        <FilterValue Index="1" ParaValue="IIF(CompanyCodeID&gt;0, 'CompanyCodeID='&amp;SqlPara(CompanyCodeID), '1=2')"/>
                                                    </Filter>
                                                </ItemFilter>
                                            </GridCell>
                                            <GridCell Key="PA_NetworkID" Caption="网络" CellType="Dict" ItemKey="PS_Network">
                                                <DataBinding ColumnKey="NetworkID"/>
                                                <ItemFilter ItemKey="PS_Network">
                                                    <Filter Key="F1_Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                        <FilterValue Index="1" ParaValue="IIF(CompanyCodeID&gt;0, 'CompanyCodeID='&amp;SqlPara(CompanyCodeID), '1=2')"/>
                                                    </Filter>
                                                </ItemFilter>
                                            </GridCell>
                                            <GridCell Key="PA_ActivityID" Caption="作业" CellType="Dict" ItemKey="PS_Activity">
                                                <DataBinding ColumnKey="ActivityID"/>
                                                <ItemFilter>
                                                    <Filter Key="F1_Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                        <FilterValue Index="1" ParaValue="IIF(PA_NetworkID&gt;0, 'NetworkID='&amp;SqlPara(PA_NetworkID), '1=2')"/>
                                                    </Filter>
                                                </ItemFilter>
                                            </GridCell>
                                            <GridCell Key="PA_ControllingAreaID" Caption="成本控制范围" CellType="Dict" ItemKey="ControllingArea">
                                                <DataBinding ColumnKey="ControllingAreaID"/>
                                            </GridCell>
                                            <GridCell Key="PA_BusinessAreaID" Caption="业务范围" CellType="Dict" ItemKey="BusinessArea">
                                                <DataBinding ColumnKey="BusinessAreaID"/>
                                            </GridCell>
                                            <GridCell Key="PA_AssetCardSOID" Caption="资产" CellType="Dict" ItemKey="AM_AssetCard__Dic" StateMask="Enable|Disable|Discard">
                                                <DataBinding ColumnKey="AssetCardSOID">
                                                    <CheckRule>
                                                        <![CDATA[IIFS(GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'InternalCode')=='A', IIFS(PA_AssetCardSOID>0, true, true, MessageFacade('MM_PURCHASEORDER037','请输入资产')), true, true)]]>
                                                    </CheckRule>
                                                </DataBinding>
                                                <ItemFilter ItemKey="AM_AssetCard__Dic">
                                                    <Filter Key="F1_Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                        <FilterValue Index="1" ParaValue="IIF(CompanyCodeID&gt;0, 'AssetCardStatus&lt;'&amp;SqlPara(2)&amp;' and IsBlock = '&amp;SqlPara(0)&amp;' and CompanyCodeID='&amp;SqlPara(CompanyCodeID), '1=2')"/>
                                                    </Filter>
                                                </ItemFilter>
                                            </GridCell>
                                            <GridCell Key="PA_SrcSaleOrderDtlOID" Caption="销售订单-行号" CellType="Dict" ItemKey="SD_SaleOrderDtl__Dic" StateMask="Enable|Disable|Discard">
                                                <DataBinding ColumnKey="SrcSaleOrderDtlOID"/>
                                            </GridCell>
                                            <GridCell Key="PA_SrcScheduleLineIndex" Caption="交货计划行号" CellType="NumberEditor" Precision="9" Scale="0" UseGroupingSeparator="false">
                                                <DataBinding ColumnKey="SrcScheduleLineIndex"/>
                                            </GridCell>
                                            <GridCell Key="PA_SrcSaleOrderSOID" Caption="销售订单" CellType="Dict" ItemKey="SD_SaleOrder__Dic" StateMask="Enable|Disable|Discard">
                                                <DataBinding ColumnKey="SrcSaleOrderSOID">
                                                    <DefaultFormulaValue>
                                                        <![CDATA[GetDictValue('SD_SaleOrderDtl__Dic', PA_SrcSaleOrderDtlOID, 'SOID')]]>
                                                    </DefaultFormulaValue>
                                                </DataBinding>
                                            </GridCell>
                                            <GridCell Key="PA_OrderCategory" Caption="订单类别" CellType="ComboBox" GroupKey="OrderCategoryGroup" SourceType="ParaGroup">
                                                <DataBinding ColumnKey="OrderCategory"/>
                                                <ComboFilter SourceType="Formula">
                                                    <FormulaItems>
                                                        <![CDATA[Macro_GetOrderCategory('')]]>
                                                    </FormulaItems>
                                                </ComboFilter>
                                            </GridCell>
                                            <GridCell Key="PA_DynOrderID" Caption="订单" CellType="DynamicDict" IsDynamic="true" RefDataElementKey="PA_DynOrderIDDEKey">
                                                <DataBinding ColumnKey="DynOrderID">
                                                    <ValueChangeAction>
                                                        <![CDATA[IIF(PA_OrderCategory=='01'&&GetValue('PA_CostCenterID')==0,SetValue('PA_CostCenterID',GetDictValue('CO_CostOrder',PA_DynOrderID,'PostingCostCenterID')),true)]]>
                                                    </ValueChangeAction>
                                                </DataBinding>
                                                <ItemFilter>
                                                    <Filter Key="F1_Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                        <FilterValue Index="1" ParaValue="IIF(PA_OrderCategory=='01','ControllingAreaID='&amp;SqlPara(PA_ControllingAreaID),'1=1')"/>
                                                    </Filter>
                                                </ItemFilter>
                                            </GridCell>
                                            <GridCell Key="PA_DynOrderIDDEKey" Caption="订单字典Key" CellType="TextEditor">
                                                <DataBinding ColumnKey="DynOrderIDDEKey">
                                                    <DefaultFormulaValue>
                                                        <![CDATA[com.bokesoft.erp.mm.purchase.MigoFormula.getOrdeDataElementKey(PA_OrderCategory)]]>
                                                    </DefaultFormulaValue>
                                                </DataBinding>
                                            </GridCell>
                                            <GridCell Key="PA_OID" CellType="NumberEditor" CopyNew="false" Scale="0">
                                                <DataBinding ColumnKey="OID"/>
                                            </GridCell>
                                            <GridCell Key="PA_SOID" CellType="NumberEditor" CopyNew="false" Scale="0">
                                                <DataBinding ColumnKey="SOID"/>
                                            </GridCell>
                                            <GridCell Key="PA_SrcPRSOID" Caption="源采购申请单据SOID" CellType="NumberEditor" Scale="0">
                                                <DataBinding ColumnKey="SrcPRSOID"/>
                                            </GridCell>
                                            <GridCell Key="PA_SrcPROID" Caption="源采购申请明细OID" CellType="NumberEditor" Scale="0">
                                                <DataBinding ColumnKey="SrcPROID"/>
                                            </GridCell>
                                            <GridCell Key="PA_SrcPRAccountAssignOID" Caption="源采购申请科目分配明细OID" CellType="NumberEditor" Scale="0">
                                                <DataBinding ColumnKey="SrcPRAccountAssignOID"/>
                                            </GridCell>
                                            <GridCell Key="PA_CommitmentItemID" Caption="承诺项目" CellType="Dict" ItemKey="FM_CommitmentItem">
                                                <DataBinding ColumnKey="CommitmentItemID">
                                                    <CheckRule>
                                                        <![CDATA[IIFS(Macro_IsFMAADerivation(CompanyCodeID)>0&&PA_CommitmentItemID<=0,MessageFacade('MM_PURCHASEORDER046','科目分配页：承诺项目未输入'));]]>
                                                    </CheckRule>
                                                </DataBinding>
                                            </GridCell>
                                            <GridCell Key="PA_FundCenterID" Caption="基金中心" CellType="Dict" ItemKey="FM_FundCenter">
                                                <DataBinding ColumnKey="FundCenterID">
                                                    <DefaultFormulaValue>
                                                        <![CDATA[IIF(GetDictValue('FM_CommitmentItem', GetValue('PA_CommitmentItemID'), 'EFM_CommitmentItemHead.DefaultFundCenterID' ) > 0,  GetDictValue('FM_CommitmentItem', GetValue('PA_CommitmentItemID'), 'EFM_CommitmentItemHead.DefaultFundCenterID' ), GetValue('PA_FundCenterID'))]]>
                                                    </DefaultFormulaValue>
                                                </DataBinding>
                                            </GridCell>
                                            <GridCell Key="PA_FundID" Caption="基金" CellType="Dict" ItemKey="FM_Fund">
                                                <DataBinding ColumnKey="FundID"/>
                                            </GridCell>
                                            <GridCell Key="PA_FunctionalAreaID" Caption="功能范围" CellType="Dict" ItemKey="FunctionalArea">
                                                <DataBinding ColumnKey="FunctionalAreaID"/>
                                            </GridCell>
                                            <GridCell Key="PA_EarmarkedFundVoucherSOID" Caption="专项基金" CellType="Dict" ItemKey="FM_EarmarkedFundVoucher__Dic" StateMask="Enable|Disable|Discard">
                                                <DataBinding ColumnKey="EarmarkedFundVoucherSOID"/>
                                            </GridCell>
                                            <GridCell Key="PA_EarmarkedFundVoucherDtlOID" Caption="专项基金明细" CellType="Dict" ItemKey="FM_EarmarkedFundVoucherDtl__Dic" StateMask="Enable|Disable|Discard">
                                                <DataBinding ColumnKey="EarmarkedFundVoucherDtlOID">
                                                    <CheckRule>
                                                        <![CDATA[IIF(PA_EarmarkedFundVoucherSOID!=0&&PA_EarmarkedFundVoucherDtlOID==0,MessageFacade('MM_PURCHASEORDER040','未选择专项基金明细'),true)]]>
                                                    </CheckRule>
                                                </DataBinding>
                                                <ItemFilter>
                                                    <Filter Key="F1_Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                        <FilterValue Index="1" ParaValue="'SOID='&amp;SqlPara(PA_EarmarkedFundVoucherSOID)"/>
                                                    </Filter>
                                                </ItemFilter>
                                            </GridCell>
                                            <GridCell Key="PA_ProfitSegmentSOID" Caption="获利能力段" CellType="Dict" ItemKey="COPA_ProfitSegment__Dic" StateMask="Enable|Disable|Discard">
                                                <DataBinding ColumnKey="ProfitSegmentSOID"/>
                                            </GridCell>
                                            <GridCell Key="PA_PMRoutingID" Caption="PM工序" CellType="NumberEditor" Scale="0">
                                                <DataBinding ColumnKey="PMRoutingID"/>
                                                <CellFormat HAlign="Right"/>
                                            </GridCell>
                                        </GridRow>
                                    </GridRowCollection>
                                    <OnRowDelete>
                                        <![CDATA[if(IIF(Macro_IsServiceRow()||Macro_IsFromSaleOrder()||PushedGIQuantity1>0,false,!ReadOnly())){DeleteRow();}]]>
                                    </OnRowDelete>
                                </Grid>
                                <RowDefCollection RowGap="24">
                                    <RowDef Height="100%"/>
                                </RowDefCollection>
                                <ColumnDefCollection ColumnGap="16">
                                    <ColumnDef Width="33%"/>
                                    <ColumnDef Width="33%"/>
                                    <ColumnDef Width="34%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </SubDetail>
                        <SubDetail Key="DetailedInformationSubDetail" Caption="详细信息" BindingGridKey="MaterialDocumentDtl">
                            <GridLayoutPanel Key="DetailedInformationGridLayoutPanel" Caption="详细信息" Padding="8px" OverflowY="Auto" TopPadding="24px" Visible="Macro_IsMB31()&amp;&amp;!Macro_IsShowMSEG()||(Macro_IsShowMSEG()&amp;&amp;IIF(GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MBST',GetDictValue('TCode', SrcTCodeID, 'Code')=='MIGO'||GetDictValue('TCode', SrcTCodeID, 'Code')=='ML81N'||GetDictValue('TCode', SrcTCodeID, 'Code')=='MB31',GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MIGO'||GetDictValue('TCode', Dtl_TCodeID, 'Code')=='ML81N'||GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB31'))">
                                <CheckBox Key="IsDeliveryCompleted__mirror" Caption="交货已完成标识" X="1" Y="1" Visible="Macro_IsMB31()&amp;&amp;!Macro_IsShowMSEG()" Enable="IIF(IsNew(),true,false)" BindingCellKey="IsDeliveryCompleted"/>
                                <Dict Key="CompanyCodeID__mirror" Caption="公司代码" X="0" Y="0" Visible="true" Enable="false" BindingCellKey="CompanyCodeID" ItemKey="CompanyCode"/>
                                <NumberEditor Key="FiscalYear__mirror" Caption="会计年度" X="1" Y="0" Visible="true" Enable="false" BindingCellKey="FiscalYear" IntegerValue="true" Scale="0" UseGroupingSeparator="false"/>
                                <Dict Key="Reason4MovementID__mirror2" Caption="移动原因" X="2" Y="0" Visible="Macro_GetDtlFieldVisibleByHead('ControlReason')" BindingCellKey="Reason4MovementID" ItemKey="MM_Reason4Movement">
                                    <ItemFilter ItemKey="MM_Reason4Movement">
                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                            <FilterValue Index="1" ParaValue="IIF(Dtl_MoveTypeID&gt;0, 'EMM_Reason4Movement.soid in(Select soid from EMM_Reason4MovementDtl where MoveTypeID='&amp;SqlPara(Dtl_MoveTypeID)&amp;')', '1=2')"/>
                                        </Filter>
                                    </ItemFilter>
                                </Dict>
                                <TextEditor Key="Dtl_Notes__mirror2" Caption="文本" X="0" Y="1" Visible="Macro_IsMB31()&amp;&amp;!Macro_IsShowMSEG()" BindingCellKey="Dtl_Notes" MaxLength="100" Trim="true"/>
                                <RowDefCollection RowGap="24">
                                    <RowDef Height="32px"/>
                                    <RowDef Height="32px"/>
                                </RowDefCollection>
                                <ColumnDefCollection ColumnGap="16">
                                    <ColumnDef Width="33%"/>
                                    <ColumnDef Width="33%"/>
                                    <ColumnDef Width="34%"/>
                                </ColumnDefCollection>
                            </GridLayoutPanel>
                        </SubDetail>
                    </TabPanel>
                    <SplitSize Size="236px"/>
                    <SplitSize Size="100%"/>
                    <SplitSize Size="216px"/>
                </SplitPanel>
            </FlexFlowLayoutPanel>
        </Block>
    </Body>
    <OnPostShow>
        <![CDATA[if(GetPara('_SetNewEmptyRow')=='false') {SetNewEmptyRow('MaterialDocumentDtl', false)} else {true};IIFS(GetPara('HeadMoveTypeID') == '',SetPara('HeadMoveTypeID',MoveTypeID_NODB4Other));]]>
    </OnPostShow>
    <MacroCollection>
        <Macro Key="Macro_CheckData">
            <![CDATA[if (ToInt(IsEditBill)) {true} else {com.bokesoft.erp.mm.period.MaterialPeriod.checkDateIsValidByGrid('EMM_MaterialDocument','PlantID',HeadPostingDate);com.bokesoft.erp.mm.stock.MSEGFormula.checkIsHasInvoiceInPurchaseOrder4MBST();com.bokesoft.erp.mm.batchcode.BatchCodeFormula.automaticSetValue4DocumentBatchCode();com.bokesoft.erp.mm.stock.MSEGFormula.reverseMSEG()};com.bokesoft.erp.mm.stock.MSEGFormula.modifyIdentityIDDataElementKey();]]>
        </Macro>
        <Macro Key="Macro_MidSave_PreTriggers">
            <![CDATA[com.bokesoft.erp.mm.stock.MSEGFormula.checkSystemStatus();Macro_checkIsNoProjectStock();Macro_CheckStorageLocationForWM();IIF(GetRowCount('MaterialDocumentDtl')>0,'',RaiseErrMsg('MM_MSEG035','单据没有明细，请输入'));Macro_CheckProductionOrder();com.bokesoft.erp.mm.stock.MSEGFormula.setTCode2();if (ToInt(IsEditBill)) {true} else {com.bokesoft.erp.mm.stock.MSEGFormula.automaticSetValue4DocumentBatchCode();com.bokesoft.erp.mm.stock.MSEGFormula.documentSaveDoValuationType();com.bokesoft.erp.mm.stock.MSEGFormula.checkRevGRdespiteIR();com.bokesoft.erp.mm.stock.MSEGFormula.autoCreateInventoryView();com.bokesoft.erp.mm.stock.MSEGFormula.appendMSEGFields();com.bokesoft.erp.mm.stock.MSEGFormula.updateGroupInValue();com.bokesoft.erp.mm.stock.MSEGFormula.setFiscalYearPeriod();com.bokesoft.erp.mm.stock.MSEGFormula.appendIntegrationFields();com.bokesoft.erp.mm.stock.MSEGFormula.checkMSEG();com.bokesoft.erp.mm.stock.MSEGFormula.checkOverPush();com.bokesoft.erp.qm.function.InspectionLotFormula.createInspectionLot();com.bokesoft.erp.mm.batchcode.BatchCodeFormula.appendCharacteristicValue2BatchCode();com.bokesoft.erp.mm.stock.MSEGFormula.checkMSEGSplitValuationData();com.bokesoft.erp.mm.stock.MSEGFormula.clearStoragePointIDFor561();com.bokesoft.erp.mm.masterdata.SerialNumberFormula.addAutoSNNumberInMSEG();com.bokesoft.erp.mm.stock.MSEGFormula.autoSetMSEGCompletedIndicator();com.bokesoft.erp.basis.integration.pohis.UpdatePOHistory.update();com.bokesoft.erp.basis.integration.stock.StockAccouting.update();com.bokesoft.erp.copa.formula.CopaVoucherFormula.genProfitSegment4Mseg();com.bokesoft.erp.mm.stock.MSEGFormula.setPartnerProfitCenterID4MSEG();com.bokesoft.erp.pp.function.MRPScopeFormula.autoExpandMrpScope()};]]>
        </Macro>
        <Macro Key="Macro_MidSave_PostTriggers">
            <![CDATA[if (ToInt(IsEditBill)) {com.bokesoft.erp.mm.masterdata.SerialNumberFormula.checkMDSNNumber();com.bokesoft.erp.mm.masterdata.SerialNumberFormula.updateMSEGSNNumber();} else {com.bokesoft.erp.mm.stock.PhysicalInventoryFormula.checkInventoryDocumentBlock('EMM_MaterialDocument','PlantID,MaterialID,StorageLocationID,StockType,SpecialIdentity,DynIdentityID,BatchCode');com.bokesoft.erp.mm.stock.MSEGFormula.checkStorage('EMM_MaterialDocument');com.bokesoft.erp.basis.integration.function.MakeGLVoucher.genVoucher();com.bokesoft.erp.mm.stock.MSEGFormula.feedBack();IIF(IsCreatedByBatchCodeConversion==0,com.bokesoft.erp.mm.batchcode.BatchCodeFormula.batchCodeCheckSave(),'');IIF(GetEntryPara('TCode')=='MI07',true,com.bokesoft.erp.mm.masterdata.SerialNumberFormula.checkMDSNNumber());com.bokesoft.erp.mm.masterdata.SerialNumberFormula.updateMSEGSNNumber();com.bokesoft.erp.mm.stock.MSEGFormula.feedBackBoundDelivery();com.bokesoft.erp.mm.stock.MSEGFormula.setActiveValuationType();com.bokesoft.erp.pp.function.MRPPlanFormula.setMRPPlanProfile_MSEG()};com.bokesoft.erp.mm.stock.MSEGFormula.setDocumentPara();com.bokesoft.erp.pp.mrp.Reduction.reductionPIR();]]>
        </Macro>
        <Macro Key="Macro_MidSave">
            <![CDATA[Macro_CheckData();com.bokesoft.erp.sd.function.OutboundDeliveryFormula.checkAuthorityPostAndReverseData();com.bokesoft.erp.documentNumber.DocumentNumber.genDocNumber();Macro_MidSave_PreTriggers();com.bokesoft.erp.function.DocumentFunction.saveObject();Macro_MidSave_PostTriggers();com.bokesoft.erp.dictionary.DataCopyRelationMidFunction.copyRelationData()]]>
        </Macro>
        <Macro Key="Macro_ShowInfo">
            <![CDATA[if (ToInt(IsEditBill)) {true} else {if (GetPara('IOOPERATOR')!=1) {ConfirmMsg('MM_MSEG036','物料凭证 {1} 已记账',{{GetPara('DocumentNumber_Para')}}, 'OK', {OK: {Close('OK')}});} else {Close('OK')}}]]>
        </Macro>
        <Macro Key="Macro_IsSplitValuation">
            <![CDATA[com.bokesoft.erp.mm.function.SplitValuationFormula.isSplitValuationMaterial(PlantID,MaterialID)]]>
        </Macro>
        <Macro Key="Macro_Plant_Material_Enablewhen">
            <![CDATA[!ReadOnly()&&GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')!='101'&&GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')!='122'&&IIF(GetDictValue('MoveType', Dtl_MoveTypeID, 'MoveTypeInnerCode')=='261',SrcSOID==0,true)]]>
        </Macro>
        <Macro Key="Macro_AutoSetValuationType">
            <![CDATA[com.bokesoft.erp.mm.function.SplitValuationFormula.getValuationCategoryPropValue(Macro_GetOrgProp2AllowNull('MaterialID', 'GlobalCategoryID', PlantID, 0),'IsAutoSetValuationType',PlantID)]]>
        </Macro>
        <Macro Key="Macro_ProductionOrderIsReceipted">
            <![CDATA[com.bokesoft.erp.mm.purchase.MigoFormula.productionOrderIsReceipted(SrcProductionOrderSOID)]]>
        </Macro>
        <Macro Key="Macro_IsATPcheck">
            <![CDATA[IIF(Direction==-1&&PlantID>0&&MaterialID>0&&CheckingGroupID>0&&GetDictValue('SD_CheckingGroup', CheckingGroupID , 'IsATPNoCheck')<=0&&CheckingRuleID>0,true,false)]]>
        </Macro>
        <Macro Key="Macro_ATPCheck">
            <![CDATA[ERPShowModal('MM_ATPOverView_Rpt',GetCallFormula('Macro_MM_MSEG_ShowEvent',PlantID,MaterialID,CheckingRuleID,CheckingGroupID,HeadPostingDate,BaseUnitDenominator,BaseQuantity,BaseUnitNumerator,StorageLocationID,SpecialIdentity,DynIdentityID))]]>
        </Macro>
        <Macro Key="Macro_ATP4Error">
            <![CDATA[com.bokesoft.erp.sd.function.ATPControlFormula.findAllocateControlRule(Dtl_MoveTypeID,IsUpdateQuantity,IsValueUpdate,SpecialIdentity,MovementIndicator,ReceiptIndicator,ConsumptionIndicator)==2||com.bokesoft.erp.sd.function.ATPControlFormula.findAllocateControlRule(Dtl_MoveTypeID,IsUpdateQuantity,IsValueUpdate,SpecialIdentity,MovementIndicator,ReceiptIndicator,ConsumptionIndicator)==4]]>
        </Macro>
        <Macro Key="Macro_ATP4Warn">
            <![CDATA[com.bokesoft.erp.sd.function.ATPControlFormula.findAllocateControlRule(Dtl_MoveTypeID,IsUpdateQuantity,IsValueUpdate,SpecialIdentity,MovementIndicator,ReceiptIndicator,ConsumptionIndicator)==1||com.bokesoft.erp.sd.function.ATPControlFormula.findAllocateControlRule(Dtl_MoveTypeID,IsUpdateQuantity,IsValueUpdate,SpecialIdentity,MovementIndicator,ReceiptIndicator,ConsumptionIndicator)==3]]>
        </Macro>
        <Macro Key="Macro_ReservationOrderHaveBatchCode">
            <![CDATA[IIF(com.bokesoft.erp.mm.reservation.ReservationFormula.billDtlIDHaveDataByKey(SrcReservationDtlOID,'BatchCode'),true,false)]]>
        </Macro>
        <Macro Key="Macro_ReservationOrderHaveValuationtype">
            <![CDATA[IIF(com.bokesoft.erp.mm.reservation.ReservationFormula.billDtlIDHaveDataByKey(SrcReservationDtlOID,'GlobalValuationTypeID'),true,false)]]>
        </Macro>
        <Macro Key="Macro_ATPWarnMsg">
            <![CDATA[IIF(Quantity>0&&Macro_IsATPcheck()&&Macro_ATP4Warn(),com.bokesoft.erp.sd.function.ATPControlFormula.warnATPQuantity(PlantID,MaterialID,StorageLocationID,BatchCode,HeadPostingDate,Dtl_OID,SrcReservationDtlOID,CheckingRuleID,Quantity,BaseUnitNumerator,BaseUnitDenominator,'MB1A',Dtl_SOID,SpecialIdentity,DynIdentityID),false)]]>
        </Macro>
        <Macro Key="Macro_ATPWarnMsgConfirm">
            <![CDATA[if(Quantity>0&&Macro_IsATPcheck()&&Macro_ATP4Warn()){
            SetPara('_WarmMsg',Macro_ATPWarnMsgTrans());
            }else{SetPara('_WarmMsg','');}]]>
        </Macro>
        <Macro Key="Macro_ATPWarnMsgTrans">
            <![CDATA[com.bokesoft.erp.sd.function.ATPControlFormula.warnATPQuantity(PlantID,MaterialID,StorageLocationID,BatchCode,HeadPostingDate,Dtl_OID,SrcReservationDtlOID,CheckingRuleID,Quantity,BaseUnitNumerator,BaseUnitDenominator,'MB1A',Dtl_SOID,SpecialIdentity,DynIdentityID);]]>
        </Macro>
        <Macro Key="Macro_IsMB31">
            <![CDATA[GetDictValue('TCode', Dtl_TCodeID, 'Code')=='MB31']]>
        </Macro>
        <Macro Key="Macro_GetHeadFieldVisibleByList" Args="para1">
            <![CDATA[MoveTypeID_NODB4Other>0&&Macro_GetFieldValueByMoveTypeID(MoveTypeID_NODB4Other,SpecialIdentity_NODB4Other,para1)!=2]]>
        </Macro>
        <Macro Key="Macro_ShowReservationBill">
            <![CDATA[ERPShowModal('MM_DocumentLeadBill',GetCallFormula('Macro_MM_MSEG_ShowEvent',HeadPlantID,HeadStorageLocationID,TCodeID,MoveTypeID_NODB4Other,ToInt(IsHeadSuggestZeroLines)),'Edit')]]>
        </Macro>
        <Macro Key="Macro_PP_ReferenceBillShowEvent">
            <![CDATA[ERPShowModal('PP_ReferenceBill',GetCallFormula('Macro_PP_ReferenceBillShowEvent',SpecialIdentity_NODB4Other,HeadStorageLocationID,HeadPlantID,HeadDocumentDate,HeadPostingDate,ToInt(IsHeadSuggestZeroLines),TCodeID,MoveTypeID_NODB4Other))]]>
        </Macro>
        <Macro Key="Macro_IsVestBill">
            <![CDATA[com.bokesoft.erp.mm.purchase.MigoFormula.isVestBill()]]>
        </Macro>
        <Macro Key="Macro_LeadProductionOrder">
            <![CDATA[ERPShowModal('MM_DocumentLeadBill',GetCallFormula('Macro_MM_MSEG_ShowEvent2',HeadPlantID,HeadStorageLocationID,TCodeID,MoveTypeID_NODB4Other,Head_OrderCategory,HeadReason4MovementID,IsHeadSuggestZeroLines),'','Edit')]]>
        </Macro>
        <Macro Key="Macro_GetMSEGFieldEnable" Args="FieldKey">
            <![CDATA[IndexOf(Macro_MSEGEnableFields(),','&FieldKey&',')>=0]]>
        </Macro>
        <Macro Key="Macro_MSEGEnableFields">
            <![CDATA[',Notes,MaterialSlip,NotesDtl,']]>
        </Macro>
        <Macro Key="Macro_TwoStepMoveType">
            <![CDATA[',305,306,315,316,']]>
        </Macro>
        <Macro Key="Macro_GetnotShowAssign" Args="MoveTypeCode">
            <![CDATA[IndexOf(Macro_TwoStepMoveType(),','&MoveTypeCode&',')>=0]]>
        </Macro>
        <Macro Key="Macro_BillEdit">
            <![CDATA[if (ToInt(IsShowMSEG)==1) {SetNewEmptyRow('MaterialDocumentDtl', false)} else {true};EditBill();ShowData();SetValue('IsEditBill', 1);SetValue('Head_Reference2ReservationID', 0,false);]]>
        </Macro>
        <Macro Key="Macro_IsShowMSEG">
            <![CDATA[IIF(ToInt(IsShowMSEG)==0,false,true)]]>
        </Macro>
        <Macro Key="Macro_ValuationCheckRule">
            <![CDATA[com.bokesoft.erp.mm.function.SplitValuationFormula.getMaterialCheckRule(PlantID,MaterialID,Dtl_MoveTypeID,StockType,Direction,Dtl_GlobalValuationTypeID,SpecialIdentity)]]>
        </Macro>
        <Macro Key="Macro_GetHeadFieldVisibleByHead" Args="para1">
            <![CDATA[MoveTypeID_NODB4Other>0&&GetDictValue('MoveType', MoveTypeID_NODB4Other, para1)!=2]]>
        </Macro>
        <Macro Key="Macro_GetDtlFieldVisibleByHead" Args="para1">
            <![CDATA[Dtl_MoveTypeID>0&&GetDictValue('MoveType', Dtl_MoveTypeID, para1)!=2]]>
        </Macro>
        <Macro Key="Macro_GetDtlFieldVisibleByList" Args="para1">
            <![CDATA[Dtl_MoveTypeID>0&&Macro_GetFieldValueByMoveTypeID(Dtl_MoveTypeID,SpecialIdentity,para1)!=2]]>
        </Macro>
        <Macro Key="Macro_GetDTlFieldVisibleByCheck" Args="para1">
            <![CDATA[Dtl_MoveTypeID>0&&Macro_GetFieldValueByMoveTypeID(Dtl_MoveTypeID,SpecialIdentity,para1)==1]]>
        </Macro>
        <Macro Key="Macro_ProductOrderHaveBatchCode">
            <![CDATA[com.bokesoft.erp.mm.stock.MSEGFormula.productOrderHaveBatchCode()]]>
        </Macro>
        <Macro Key="Macro_StorageLocationIDCheckRule">
            <![CDATA[IIFS(Macro_IsShowMSEG(), true, (SpecialIdentity=='_'||SpecialIdentity=='E'||SpecialIdentity=='K'||SpecialIdentity=='Q'||SpecialIdentity=='M')&&StorageLocationID<=0&&StockType!=21&&StockType!=8&&StockType!=9&&StockType!=5, MessageFacade('MM_MSEG037','请输入库存地点'), true, true)]]>
        </Macro>
        <Macro Key="Macro_PP_GoodsMovmentList_ShowEvent" Args="BillID">
            <![CDATA[Macro_OpenBill_ShowEvent(BillID)]]>
        </Macro>
        <Macro Key="Macro_PP_GoodsMovementInfor_ShowEvent" Args="MSEGID">
            <![CDATA[SetPara('_Refresh', false);Macro_OpenBill_ShowEvent(MSEGID)]]>
        </Macro>
        <Macro Key="Macro_MM_PhysicalInventory_ShowEvent" Args="BillID">
            <![CDATA[Macro_OpenBill_ShowEvent(BillID);ShowData();SetPara('TCode', parent.GetEntryPara('TCode'))]]>
        </Macro>
        <Macro Key="Macro_MM_MSEGList_ShowEvent" Args="BillID">
            <![CDATA[Macro_OpenBill_ShowEvent(BillID)]]>
        </Macro>
        <Macro Key="Macro_MM_ServiceConfirmation_ShowEvent" Args="trgtMSEGBillID">
            <![CDATA[Macro_OpenBill_ShowEvent(trgtMSEGBillID);ShowData();SetPara('_Refresh', false)]]>
        </Macro>
        <Macro Key="Macro_MM_PRExecuteStatus_ShowEvent" Args="GR_BillID">
            <![CDATA[Macro_OpenBill_ShowEvent(GR_BillID);ShowData();SetPara('_Refresh', false)]]>
        </Macro>
        <Macro Key="Macro_SD_ThirdSaleExecuteStatuts_Rpt_ShowEvent" Args="MR_BillID">
            <![CDATA[Macro_OpenBill_ShowEvent(MR_BillID)]]>
        </Macro>
        <Macro Key="Macro_QM_InspectionLot_ShowEvent" Args="MSEGBillID">
            <![CDATA[Macro_OpenBill_ShowEvent(MSEGBillID);ShowData();SetPara('TCode', parent.GetEntryPara('TCode'))]]>
        </Macro>
        <Macro Key="Macro_QueryInspectionLot_RunAsExp">
            <![CDATA[com.bokesoft.erp.qm.function.InspectionLotFormula.checkInspectionLotIDOnlyOne4MM_MSEG(Dtl_SOID,Dtl_OID)]]>
        </Macro>
        <Macro Key="Macro_CreateBatchCodeNumber_ButtonClickTrg">
            <![CDATA[com.bokesoft.erp.mm.batchcode.BatchCodeFormula.automaticGenerationBatchCode(Dtl_MoveTypeID)]]>
        </Macro>
        <Macro Key="Macro_UseThose_ButtonClickTrg">
            <![CDATA[com.bokesoft.erp.mm.batchcode.BatchCodeFormula.batchcodeDataCopy4Document(OutstandingQuantity)]]>
        </Macro>
        <Macro Key="Macro_AutoCreateSNNumber_ButtonClickTrg">
            <![CDATA[com.bokesoft.erp.mm.masterdata.SerialNumberFormula.setMDAutoSNNumbers()]]>
        </Macro>
        <Macro Key="Macro_BatchCode_Trigger">
            <![CDATA[com.bokesoft.erp.mm.function.SplitValuationFormula.getBatchCodeValuationTypeID(PlantID,MaterialID,BatchCode)]]>
        </Macro>
        <Macro Key="Macro_BatchCode_Trigger3">
            <![CDATA[ClearAllRows('BS_MateralBatchCodeSplitDtl')]]>
        </Macro>
        <Macro Key="Macro_DisposeCostCenter">
            <![CDATA[IIFS(IsVisible('CostCenterID') && Head_PPOrderNoIDDEKey == 'CostOrderID' && ToBool(GetDictValue('CO_CostOrder',GetDictOID('CO_CostOrder', 'UseCode', SrcDoNumber),'ECO_CostOrder.IsStaticalOrder')), SetValue('CostCenterID', GetDictValue('CO_CostOrder',GetDictOID('CO_CostOrder','UseCode', SrcDoNumber),'ECO_CostOrder.PostingCostCenterID')), IsVisible('CostCenterID') && Head_PPOrderNoIDDEKey == 'CostOrderID' && Length(SrcDoNumber) == 0, SetValue('CostCenterID',0));]]>
        </Macro>
        <Macro Key="Macro_BatchCode_Trigger4">
            <![CDATA[com.bokesoft.erp.mm.batchcode.BatchCodeFormula.batchCodeSplit(Dtl_MoveTypeID,PlantID,MaterialID,StorageLocationID,StoragePointID,HeadPostingDate,Quantity,UnitID,BaseQuantity,BaseUnitNumerator,BaseUnitDenominator,BatchCode,SpecialIdentity,DynIdentityID,Dtl_OID,com.bokesoft.erp.mm.batchcode.BatchCodeFormula.searchProcedureIDforMaterialDocument(),BatchOutboundSequence,IsChangeBatchOutboundSequence)]]>
        </Macro>
        <Macro Key="Macro_BatchCode_Trigger8">
            <![CDATA[com.bokesoft.erp.sd.vc.ConfigurableMaterialForSaleOrderFormula.insertBatchCodeCharacteristic2Grid(Dtl_CategoryTypeID,Dtl_OID,BatchCodeSOID)]]>
        </Macro>
        <Macro Key="Macro_BatchCode_GetDateOfManufacture">
            <![CDATA[com.bokesoft.erp.mm.batchcode.BatchCodeFormula.getDateOfManufacture(PlantID,MaterialID,BatchCode)]]>
        </Macro>
        <Macro Key="Macro_BatchCode_GetShelfLifeDate">
            <![CDATA[com.bokesoft.erp.mm.batchcode.BatchCodeFormula.getShelfLifeDate(PlantID,MaterialID,BatchCode)]]>
        </Macro>
        <Macro Key="Macro_BatchOutboundSequence_Trigger">
            <![CDATA[ClearAllRows('BS_MateralBatchCodeSplitDtl');com.bokesoft.erp.mm.batchcode.BatchCodeFormula.batchCodeSplit(Dtl_MoveTypeID,PlantID,MaterialID,StorageLocationID,StoragePointID,HeadPostingDate,Quantity,UnitID,BaseQuantity,BaseUnitNumerator,BaseUnitDenominator,BatchCode,SpecialIdentity,DynIdentityID,Dtl_OID,com.bokesoft.erp.mm.batchcode.BatchCodeFormula.searchProcedureIDforMaterialDocument(),BatchOutboundSequence,IsChangeBatchOutboundSequence)]]>
        </Macro>
        <Macro Key="Macro_MM_MSEGgetMaterial">
            <![CDATA[com.bokesoft.erp.mm.stock.MSEGFormula.getMaterial(MaterialID_Btn);]]>
        </Macro>
        <Macro Key="Macro_SetMSEGSubParentBillDtlID">
            <![CDATA[com.bokesoft.erp.mm.purchase.MigoFormula.setMSEGSubParentBillDtlID()]]>
        </Macro>
        <Macro Key="Macro_ShowCharacteristicGrid">
            <![CDATA[if (Direction==1&&com.bokesoft.erp.mm.batchcode.BatchCodeFormula.showCharacteristicGrid(PlantID,MaterialID)) {com.bokesoft.erp.sd.vc.ConfigurableMaterialForSaleOrderFormula.insertCharacteristic2Grid(MaterialID,PlantID,Dtl_CategoryTypeID,Dtl_OID,'Characteristic_');if (GetEntryPara('TCode')=='MB31'&&GetDictValue('Material', MaterialID, 'IsConfigurableMaterial')==1) {com.bokesoft.erp.mm.batchcode.BatchCodeFormula.updateCharacteristicValueByProductionReception(Head_PPOrderNoID)} else {true}} else {true};]]>
        </Macro>
        <Macro Key="Macro_SetDtlStorageLocationID" Args="StorageLocationID">
            <![CDATA[com.bokesoft.erp.mm.stock.MSEGFormula.setDtlStorageLocationID(StorageLocationID)]]>
        </Macro>
        <Macro Key="Macro_isActivateSplitValuation">
            <![CDATA[com.bokesoft.erp.mm.function.SplitValuationFormula.isActivateSplitValuation()]]>
        </Macro>
        <Macro Key="Macro_DeleteAndFill">
            <![CDATA[ClearAllRows('MaterialDocumentDtl');com.bokesoft.erp.function.DocumentFunction.FillData('MaterialDocumentDtl',0,'PlantID:MaterialID:SrcProductionOrderSOID:Quantity',Macro_CostOrderQuery(),true);]]>
        </Macro>
        <Macro Key="Macro_LeadPPOrderNoID">
            <![CDATA[if (isWFMapping()) {true} else {if (LeadOrderCategory=='04') {if (Macro_JudgeMoveType(MoveTypeID_NODB4Other,'101',1)||Macro_JudgeMoveType(MoveTypeID_NODB4Other,'101',-1)||Macro_JudgeMoveType(MoveTypeID_NODB4Other,'122',-1)) {SetPara('_SetNewEmptyRow','false');Macro_DeleteAndFill();}} else {if (LeadOrderCategory=='30') {if (Macro_JudgeMoveType(GetDictOID('MoveType', 'Code', MoveTypeCode_NODB4Other),'261',-1)) {com.bokesoft.erp.function.MapFunction.focusMap('PM_MaintenanceOrder2MM_MSEG261', LeadPPOrderNoID, 'IsAllowedMovment='&SqlPara(1)&' and IsBackflush='&SqlPara(0)&' '&IIF(ToInt(IsHeadSuggestZeroLines)==0,' and IsFinalDelivery='&SqlPara(0),'')&' and MoveTypeID='&SqlPara(GetDictOID('MoveType','Code', '261'))&IIF(LeadPPOrderNoProcess!='',' and refProcessNo in('&LeadPPOrderNoProcess&')',''))} else {if (Macro_JudgeMoveType(GetDictOID('MoveType', 'Code', MoveTypeCode_NODB4Other),'261',1)) {com.bokesoft.erp.function.MapFunction.focusMap('PM_MaintenanceOrder2MM_MSEG261', LeadPPOrderNoID, 'IsAllowedMovment='&SqlPara(1)&' and IsBackflush='&SqlPara(0)&' and WithdrawnQuantity>'&SqlPara(0)&' and MovementID='&SqlPara(GetDictOID('MoveType','Code', '261'))&IIF(LeadPPOrderNoProcess!='',' and refProcessNo in('&GetNormalValues4SqlString(LeadPPOrderNoProcess)&')',''))} else {if (Macro_JudgeMoveType(GetDictOID('MoveType', 'Code', MoveTypeCode_NODB4Other),'101',1)) {SetPara('_SetNewEmptyRow','false');com.bokesoft.erp.function.MapFunction.focusMap('PM_MaintenanceOrder2MM_MSEG101', LeadPPOrderNoID);} else {if (Macro_JudgeMoveType(GetDictOID('MoveType', 'Code', MoveTypeCode_NODB4Other),'101',-1)) {SetPara('_SetNewEmptyRow','false');com.bokesoft.erp.function.MapFunction.focusMap('PM_MaintenanceOrder2MM_MSEG102', LeadPPOrderNoID);} else {if (Macro_JudgeMoveType(GetDictOID('MoveType', 'Code', MoveTypeCode_NODB4Other),'122',-1)) {SetPara('_SetNewEmptyRow','false');com.bokesoft.erp.function.MapFunction.focusMap('PM_MaintenanceOrder2MM_MSEG122', LeadPPOrderNoID);} else {''}}}}}} else {if (Macro_JudgeMoveType(GetDictOID('MoveType', 'Code', MoveTypeCode_NODB4Other),'261',-1)) {com.bokesoft.erp.function.MapFunction.focusMap('PP_ProductionOrder2MM_MSEG261', LeadPPOrderNoID, 'IsAllowMove='&SqlPara(1)&' and IsBacklash='&SqlPara(0)&' and IsVirtualAssembly='&SqlPara(0)&' '&com.bokesoft.erp.pp.function.ProductionOrderFormula.getAlreadyIssued(LeadPPOrderNoID)&' and MoveTypeID='&SqlPara(GetDictOID('MoveType','Code', '261'))&IIF(ToInt(IsHeadSuggestZeroLines)==0,' and IsCompleteShipment='&SqlPara(0),'')&IIF(LeadPPOrderNoProcess!='',' and ProcessNo in('&LeadPPOrderNoProcess&')',''))} else {if (Macro_JudgeMoveType(GetDictOID('MoveType', 'Code', MoveTypeCode_NODB4Other),'261',1)) {com.bokesoft.erp.function.MapFunction.focusMap('PP_ProductionOrder2MM_MSEG261', LeadPPOrderNoID, 'IsAllowMove='&SqlPara(1)&' and IsBacklash='&SqlPara(0)&' and IsVirtualAssembly='&SqlPara(0)&' and RequisiteQuantity>'&SqlPara(0)&' and MoveTypeID='&SqlPara(GetDictOID('MoveType','Code','261'))&IIF(LeadPPOrderNoProcess!='',' and ProcessNo in('&GetNormalValues4SqlString(LeadPPOrderNoProcess)&')',''))} else {if (Macro_JudgeMoveType(GetDictOID('MoveType', 'Code', MoveTypeCode_NODB4Other),'101',1)) {if(Macro_is_existCoByPPOrder()){SetPara('_SetNewEmptyRow','false');com.bokesoft.erp.function.MapFunction.focusMap('PP_ProductionOrder2MM_MSEG101Co', LeadPPOrderNoID);} else{ SetPara('_SetNewEmptyRow','false');com.bokesoft.erp.function.MapFunction.focusMap('PP_ProductionOrder2MM_MSEG101', LeadPPOrderNoID);}} else {if (Macro_JudgeMoveType(GetDictOID('MoveType', 'Code', MoveTypeCode_NODB4Other),'101',-1)) { if(Macro_is_existCoByPPOrder()) {SetPara('_SetNewEmptyRow','false');com.bokesoft.erp.function.MapFunction.focusMap('PP_ProductionOrder2MM_MSEG101Co', LeadPPOrderNoID);} else {SetPara('_SetNewEmptyRow','false');com.bokesoft.erp.function.MapFunction.focusMap('PP_ProductionOrder2MM_MSEG101', LeadPPOrderNoID);}} else {if (Macro_JudgeMoveType(GetDictOID('MoveType', 'Code', MoveTypeCode_NODB4Other),'122',-1)) { if(Macro_is_existCoByPPOrder()) {SetPara('_SetNewEmptyRow','false');com.bokesoft.erp.function.MapFunction.focusMap('PP_ProductionOrder2MM_MSEG101Co', LeadPPOrderNoID);} else {SetPara('_SetNewEmptyRow','false');com.bokesoft.erp.function.MapFunction.focusMap('PP_ProductionOrder2MM_MSEG101', LeadPPOrderNoID);} } else {if (Macro_JudgeMoveType(GetDictOID('MoveType', 'Code', MoveTypeCode_NODB4Other),'531',1)) {SetPara('_SetNewEmptyRow','false');com.bokesoft.erp.function.MapFunction.focusMap('PP_ProductionOrder2MM_MSEG531', LeadPPOrderNoID);} else { if (Macro_JudgeMoveType(GetDictOID('MoveType', 'Code', MoveTypeCode_NODB4Other),'531',-1)) {SetPara('_SetNewEmptyRow','false');com.bokesoft.erp.function.MapFunction.focusMap('PP_ProductionOrder2MM_MSEG531', LeadPPOrderNoID);} else {''}}}}}}};if (HeadStorageLocationID>0) {Macro_SetDtlStorageLocationID(HeadStorageLocationID)} else {''}}}};]]>
        </Macro>
        <Macro Key="Macro_HeadOrderCategorySelect">
            <![CDATA[IIFS(Head_OrderCategory=='01', 'CO_CostOrder_Dic_Brower', Head_OrderCategory=='04', 'CO_ProductionOrder__Dic_Browser', Head_OrderCategory=='06', 'QM_QualityManagementOrder_Dic_Brower', Head_OrderCategory=='10', 'PP_ProductionOrder__Dic_Browser', Head_OrderCategory=='30', 'PM_MaintenanceOrder__Dic_Browser',Head_OrderCategory=='40','PP_ProductionOrder__Dic_Browser');]]>
        </Macro>
        <Macro Key="Macro_Filter">
            <![CDATA[com.bokesoft.erp.mm.purchase.MigoFormula.getMSEGPPOrderFilter(Head_OrderCategory,HeadPlantID,TCodeID,MoveTypeID_NODB4Other)]]>
        </Macro>
        <Macro Key="Macro_CommonFilter_Rst">
            <![CDATA[var sql_filter = Macro_Filter(); IIFS(OrderCategory=='04', 'select soid from ECO_ProductionOrder where '&Macro_ReturnFilter(sql_filter),(OrderCategory=='10' || OrderCategory=='40'), 'SELECT soid FROM EPP_ProductionOrder where Category = '&SqlPara(OrderCategory)&' and '&Macro_ReturnFilter(sql_filter),OrderCategory=='30','select SOID from EPM_MaintenanceOrderHead where '&Macro_ReturnFilter(sql_filter))]]>
        </Macro>
        <Macro Key="Macro_ReturnFilter" Args="sql_filter">
            <![CDATA[IIF(Length(sql_filter) == 0, ' 1 = 1 ', sql_filter)]]>
        </Macro>
        <Macro Key="Macro_MMFilter_Rst">
            <![CDATA["select soid from EMM_PurchaseOrderHead where BillType="&SqlPara('F')]]>
        </Macro>
        <Macro Key="Macro_Is_Show">
            <![CDATA[IIF(GetEntryPara('T_Sign')=='SIGN', false, true);]]>
        </Macro>
        <Macro Key="Macro_is_existCoByPPOrder">
            <![CDATA[com.bokesoft.erp.pp.function.CoProductFormula.isExistCoProductByPPOrder(LeadPPOrderNoID);]]>
        </Macro>
        <Macro Key="Macro_CheckStorageLocationForWM">
            <![CDATA[com.bokesoft.erp.wms.master.WMSMasterData.checkStorageLocationForWM()]]>
        </Macro>
        <Macro Key="Macro_Ub351Allocate">
            <![CDATA[IIF(com.bokesoft.erp.mm.purchase.MigoFormula.checkUb351Allocate(),com.bokesoft.erp.function.MapFunction.focusMap('MM_PurchaseOrder2MM_Allocate'&MoveTypeCode_NODB4Other,Head_SrcUBPurchaseOrderSOID),true);]]>
        </Macro>
        <Macro Key="Macro_CheckProductionOrder">
            <![CDATA[com.bokesoft.erp.pp.push.ProductionOrderPush.CheckProductionOrder()]]>
        </Macro>
        <Macro Key="Macro_checkIsNoProjectStock">
            <![CDATA[com.bokesoft.erp.mm.stock.MSEGFormula.checkIsNoProjectStock(Head_IdentityID)]]>
        </Macro>
        <Macro Key="Macro_CostOrderQuery">
            <![CDATA[IIFS(Macro_JudgeMoveType(MoveTypeID_NODB4Other,'101',1),'Select PlantID,materialID,SOID as SrcProductionOrderSOID,BaseQuantity-ReceiptBaseQuantity as Quantity from ECO_ProductionOrder Where soid='&SqlPara(LeadPPOrderNoID)&' and BaseQuantity-ReceiptBaseQuantity>'&SqlPara(0),Macro_JudgeMoveType(MoveTypeID_NODB4Other,'101',-1)||Macro_JudgeMoveType(MoveTypeID_NODB4Other,'122',-1),'Select PlantID,materialID,SOID as SrcProductionOrderSOID,ReceiptBaseQuantity as Quantity from ECO_ProductionOrder Where soid='&SqlPara(LeadPPOrderNoID)&' and ReceiptBaseQuantity>'&SqlPara(0),true,RaiseErrMsg('MM_MSEG038','错误的移动类型'))]]>
        </Macro>
        <Macro Key="Macro_BatchCode_ValueChange">
            <![CDATA[if (Macro_BatchCode_Trigger()>0) {SetValue('Dtl_GlobalValuationTypeID', Macro_BatchCode_Trigger())} else {true};if (Direction==-1&&(BatchCode=='*'||BatchCode=='**')) {Macro_BatchCode_Trigger3();Macro_BatchCode_Trigger4();SetValue('OutstandingQuantity', GetPara('_UnDeliveryQuantity'));if (GetPara('_DialogBatchDeterm')==0) {if (GetPara('_UnDeliveryQuantity')>0) {RaiseErrMsg('MM_MSEG022','对所需数量 {1}, {2} {3} 仍然未清',GetDictValue('Material', MaterialID, 'Code'),GetDictValue('Unit', UnitID, 'Code'),GetPara('_UnDeliveryQuantity'))} else {Macro_UseThose_OnClick()}} else {true}} else {if (Direction==-1) {SetValue('ManufactureDate', Macro_BatchCode_GetDateOfManufacture());SetValue('ShelfLifeDate', Macro_BatchCode_GetShelfLifeDate());} else {if (Direction==1&&BatchCodeSOID>0) {Macro_BatchCode_Trigger8();} else {true}}};if (Direction==-1&&BatchCodeSOID>0) {Macro_BatchCode_Trigger8()} else {true};SetValue('ShelfLifeDate', IIFS(Direction==-1||(ManufactureDate<=0&&ShelfLifeDate<=0), Macro_BatchCode_GetShelfLifeDate(), ManufactureDate>0&&ShelfLifeDate<=0, DateLongAdd(ManufactureDate, 'd', GetDictValue('Material', MaterialID, 'TotalShelfLife')), true, ShelfLifeDate));SetValue('ManufactureDate', IIFS(Direction==-1||ManufactureDate<=0, Macro_BatchCode_GetDateOfManufacture(), true, ManufactureDate));Macro_CharacteristicValueChange(Dtl_OID);]]>
        </Macro>
        <Macro Key="Macro_UseThose_OnClick">
            <![CDATA[Macro_UseThose_ButtonClickTrg();SetValue('OutstandingQuantity', 0);]]>
        </Macro>
        <Macro Key="Macro_SetVCVariable4Input">
            <![CDATA['']]>
        </Macro>
        <Macro Key="Macro_GetFieldValueByMoveTypeID" Args="MoveTypeID,SpecialIdentity,FieldKey">
            <![CDATA[com.bokesoft.erp.mm.stock.MovementTypeFormula.getFieldSelectionByMoveTypeID(MoveTypeID,SpecialIdentity,FieldKey)]]>
        </Macro>
        <Macro Key="Macro_OrderCategoryCode" Args="OrderCategory">
            <![CDATA[IIF(OrderCategory =='01', 'UseCode', 'Code')]]>
        </Macro>
        <Macro Key="Macro_GetOrderType">
            <![CDATA[GetValue('Head_OrderCategory')]]>
        </Macro>
        <Macro Key="Macro_GetReservationInfo" Args="ColumnKey">
            <![CDATA[IIF(SrcReservationDtlOID>0,com.bokesoft.erp.mm.reservation.ReservationFormula.getReservationInfo(SrcReservationSOID, SrcReservationDtlOID, ColumnKey),0);]]>
        </Macro>
    </MacroCollection>
</Form>
