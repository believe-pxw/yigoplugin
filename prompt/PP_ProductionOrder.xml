<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="PP_ProductionOrder" Caption="生产订单" FormType="Entity" FormulaCaption="IIFS(GetEntryPara('Category')=='10','生产订单',GetEntryPara('Category')=='40','流程订单',parent.GetEntryPara('Category')=='40','流程订单',true,'生产订单')" InitState="New" Version="1021">
    <DataSource RefObjectKey="PP_ProductionOrder"/>
    <OperationCollection>
        <Operation Key="ShowBill" Caption="显示其他单据" RefKey="ShowBill"/>
        <Operation Key="BillNew" Caption="新增" Enable="ReadOnly()" TCode="IIFS(GetEntryTCode()=='CO03','CO01',GetEntryTCode()=='COR3','COR1')" Activity="01">
            <Action>
                <![CDATA[SetPara('Category',Category);NewBill();]]>
            </Action>
        </Operation>
        <Operation Key="BillCopyNew" Caption="复制新增" RefKey="BillCopyNew" TCode="IIFS(GetEntryTCode()=='CO03','CO01',GetEntryTCode()=='COR3','COR1')" Activity="01"/>
        <Operation Key="BillEdit" Caption="修改" Enable="IIF(Macro_IsStatusActive('I0046,I0076,I0045'),false, ReadOnly())" TCode="IIFS(GetEntryTCode()=='CO03','CO02',GetEntryTCode()=='COR3','COR2')" Activity="02">
            <Action>
                <![CDATA[var ErrorInfo = Macro_CheckMaterialStatus(PlantID, MaterialID, 'ProductOrder', BasicStartDate, 'EPP_ProductionOrder', 'MaterialID');
                         if (Length(ErrorInfo) > 0) {
                             RaiseErrMsg('PP_PRODUCTIONORDER067','{1}',ErrorInfo);
                         }
                         Macro_RecordRoutingsAndBoms();
                         SetValue('IsCheckedSystemStatusText', 0);
                         EditBill();]]>
            </Action>
        </Operation>
        <Operation Key="BillSave" Caption="保存" Enable="!ReadOnly()">
            <Action>
                <![CDATA[UICheck();if (GetDictValue('MaterialType', GetDictValue('Material', MaterialID, 'MaterialTypeID'), 'ProductOrder')==1) {ConfirmMsg('PP_PRODUCTIONORDER001','物料为外部采购件，是否继续创建生产订单',{}, 'YES_NO', {
                YES: {Macro_UIOpt_BillSave_Exp()},NO:{Close('OK')}
            })} else {Macro_UIOpt_BillSave_Exp()}]]>
            </Action>
        </Operation>
        <Operation Key="BillCancel" Caption="取消" RefKey="BillCancel"/>
        <Operation Key="GoodsMovementList_Opt" Caption="货物移动列表" Enable="ReadOnly()">
            <Action>
                <![CDATA[UICheck();ERPShowModal('PP_GoodsMovmentList', 'Macro_SetTableFilterAndLoad()')]]>
            </Action>
        </Operation>
        <Operation Key="Issued_Opt" Caption="下达" Enable="Macro_IsStatusActive('I0001,I0042') &amp;&amp; !Macro_IsStatusActive('I0076')" Activity="02">
            <Action>
                <![CDATA[Macro_PreReleaseAndRelease();RefreshOperation();]]>
            </Action>
        </Operation>
        <Operation Key="ProductionOrderTeco_Opt" Caption="技术性完成" Enable="ReadOnly()&amp;&amp;!Macro_IsStatusActive('I0045,I0046,I0076')&amp;&amp;ToInt(IsProduct4Mes)==0" Activity="02">
            <Action>
                <![CDATA[UICheck();SetValue('Operate_NODB4Other', 'ProductionOrderTeco_Opt');if (Length(Macro_CheckDate())>0) {ERPShowModal('PP_SelectDate');} else {Macro_ProductOrdOperationTECO(DateLong());ShowData()};RefreshOperation();]]>
            </Action>
        </Operation>
        <Operation Key="ProductionOrderCancelTeco_Opt" Caption="撤销技术性完成" Enable="ReadOnly()&amp;&amp;Macro_IsStatusActive('I0045')&amp;&amp;!Macro_IsStatusActive('I0046,I0076')" Activity="02">
            <Action>
                <![CDATA[UICheck();Macro_ProductOrdOperation('CancelTeco',0);RefreshOperation();]]>
            </Action>
        </Operation>
        <Operation Key="ProductionOrderClose_Opt" Caption="订单关闭" Enable="ReadOnly()&amp;&amp;!Macro_IsStatusActive('I0001,I0046,I0076')&amp;&amp;ToInt(IsProduct4Mes)==0" Activity="02">
            <Action>
                <![CDATA[UICheck();Macro_CheckInspectionLot();SetValue('Operate_NODB4Other', 'ProductionOrderClose_Opt');if (Length(Macro_CheckDate())>0) {ERPShowModal('PP_SelectDate');} else {Macro_ProductOrdOperationAndLTP('Close',DateLong());ShowData()};RefreshOperation();]]>
            </Action>
        </Operation>
        <Operation Key="ProductionOrderCancelClose_Opt" Caption="撤销订单关闭" Enable="ReadOnly()&amp;&amp;Macro_IsStatusActive('I0046')&amp;&amp;!Macro_IsStatusActive('I0076')" Activity="02">
            <Action>
                <![CDATA[UICheck();Macro_ProductOrdOperationAndLTP('CancelClose',0);RefreshOperation();]]>
            </Action>
        </Operation>
        <Operation Key="ProductionOrderDelete_Opt" Caption="订单删除" Enable="ReadOnly()&amp;&amp;!Macro_IsStatusActive('I0076')" Activity="02">
            <Action>
                <![CDATA[UICheck();Macro_CheckInspectLotAndProductOrdOperatAndLTP('Delete',GetPara('OrderOperatorDate'));RefreshOperation();]]>
            </Action>
        </Operation>
        <Operation Key="ProductionOrderDeletedRecover_Opt" Caption="订单删除恢复" Enable="ReadOnly()&amp;&amp;Macro_IsStatusActive('I0076')" Activity="02">
            <Action>
                <![CDATA[UICheck();Macro_ProductOrdOperationAndLTP('DeletedRecover',GetPara('OrderOperatorDate'));RefreshOperation();]]>
            </Action>
        </Operation>
        <OperationCollection Key="ScheduleOrderDate" Caption="订单排程" Enable="!ReadOnly()" SelfDisable="true">
            <Operation Key="ExecuteSchedule" Caption="执行" Enable="!ReadOnly()" Activity="02">
                <Action>
                    <![CDATA[UICheck();Macro_PlanOrderDate()]]>
                </Action>
            </Operation>
            <Operation Key="ShowScheduleLog" Caption="日志查看" Enable="!ReadOnly()" Activity="03">
                <Action>
                    <![CDATA[UICheck();ERPShowModal('PP_ScheduleDateLog')]]>
                </Action>
            </Operation>
        </OperationCollection>
        <OperationCollection Key="InspectionLot" Caption="检验批" SelfDisable="true">
            <Operation Key="InspectionLotCreate" Caption="创建" Enable="ReadOnly()&amp;&amp;!Macro_IsStatusActive('I0046,I0076,I0045')&amp;&amp;InspectionLotSOID&lt;=0" Activity="01">
                <Action>
                    <![CDATA[Macro_CreateInspectionLot(true);RefreshOperation()]]>
                </Action>
            </Operation>
            <Operation Key="InspectionLotDelete" Caption="删除" Enable="ReadOnly()&amp;&amp;!Macro_IsStatusActive('I0046,I0076,I0045')&amp;&amp;InspectionLotSOID&gt;0" Activity="06">
                <Action>
                    <![CDATA[Macro_DeleteInspectionLot();RefreshOperation()]]>
                </Action>
            </Operation>
        </OperationCollection>
        <Operation Key="AvailabilityCheck" Caption="可用性检查" Enable="!ReadOnly()" Activity="02">
            <Action>
                <![CDATA[UICheck();SetVisible('ProductionOrderOverviewShortageItemGridLayoutPanel', true);SetNewEmptyRow('ProductionOrderOverviewShortageItemGrid', false);GridRefresh('ProductionOrderOverviewShortageItemGrid');Macro_AvailabilityCheck()]]>
            </Action>
        </Operation>
        <Operation Key="ProcessIssued" Caption="工序下达" Enable="!ReadOnly()&amp;&amp;Macro_IsStatusActive('I0001,I0042')&amp;&amp;!Macro_IsStatusActive('I0076')">
            <Action>
                <![CDATA[if(Length(GetSelDtlFldValue('RT_OID', ','))<=0){ConfirmMsg('CO603','请选择需要下达的工序')}else{SetValue('Issued_NODB4Other', 1);Macro_PreReleaseAndRelease();RefreshOperation();SetValue('Issued_NODB4Other', 0);}]]>
            </Action>
        </Operation>
        <Operation Key="ReadMasterData" Caption="读取生产计划主数据" Enable="!ReadOnly() &amp;&amp; BasicStartDate&gt;0 &amp;&amp; BasicEndDate&gt;0" Activity="02">
            <Action>
                <![CDATA[IIF(Macro_IsCanStatus(), RaiseErrMsg('PP_PRODUCTIONORDER003','存在业务操作，不允许重读主数据'), ERPShowModal('Cond_PP_ReadMasterData', GetCallFormula('Macro_ReadMasterData_ShowEvent', RoutExplosionDate, BOMExplosionDate)))]]>
            </Action>
        </Operation>
        <Operation Key="ComponentSort" Caption="动态排序" Enable="!ReadOnly()">
            <Action>
                <![CDATA[ERPShowModal('PP_ComponentSort')]]>
            </Action>
        </Operation>
        <Operation Key="GeneraMethodActive" Caption="激活采购申请/预留" Enable="!ReadOnly()" Activity="02">
            <Action>
                <![CDATA[UICheck();IIF(Length(GetSelDtlFldValue('Dtl_OID', ','))>0, ConfirmMsg('PP_PRODUCTIONORDER067','{1}',{{Macro_GeneraMethodActive(GetSelDtlFldValue('Dtl_OID', ','))}}), ConfirmMsg('PP_PRODUCTIONORDER004','请选择明细行'))]]>
            </Action>
        </Operation>
        <Operation Key="SettlementRule" Caption="结算规则" Enable="ReadOnly()">
            <Action>
                <![CDATA[UICheck();Macro_SettlementRule_RunAsExp()]]>
            </Action>
        </Operation>
        <Operation Key="Lock" Caption="锁定" Enable="ReadOnly()&amp;&amp;!Macro_IsStatusActive('I0043,I0076')">
            <Action>
                <![CDATA[UICheck();Macro_ProductOrdOperation('Lock',0);RefreshOperation();]]>
            </Action>
        </Operation>
        <Operation Key="UnLock" Caption="取消锁定" Enable="ReadOnly()&amp;&amp;Macro_IsStatusActive('I0043')">
            <Action>
                <![CDATA[UICheck();Macro_ProductOrdOperation('UnLock',0);RefreshOperation()]]>
            </Action>
        </Operation>
        <Operation Key="QueryBalance" Caption="余额">
            <Action>
                <![CDATA[SetPara('OrderID',GetOID());ERPShowModal('CO_PPOrderBalance','Macro_CostOrder_ShowEvent()')]]>
            </Action>
        </Operation>
        <Operation Key="ViewCostDetail" Caption="查看成本明细" Enable="ReadOnly()">
            <Action>
                <![CDATA[UICheck();IIF(PlanCostCalculation==0||PlanCostCalculation==3||(PlanCostCalculation==2&&FactIssuedDate>0),Macro_ViewCostDetail_Open(), ConfirmMsg('PP_PRODUCTIONORDER005','当前订单没有生成成本数据',{}, 'OK'));]]>
            </Action>
        </Operation>
        <Operation Key="QueryStockOverview" Caption="查询库存" Activity="03">
            <Action>
                <![CDATA[Macro_UIOpt_QueryStockOverview_Exp();]]>
            </Action>
        </Operation>
        <Operation Key="ShowBillFlow" Caption="显示凭证流" Enable="!IsNew()">
            <Action>
                <![CDATA[ERPShowModal('V_DocumentVoucherFlow', GetCallFormula('Macro_CommonDef__ShowEvent_Formula2', GetSourceFormKey(), GetOID(), RT_OID), 'newtab')]]>
            </Action>
        </Operation>
        <OperationCollection Key="NewPrint" Caption="打印" SelfDisable="true">
            <Operation Key="NewPrintDefault" Caption="默认模板打印" RefKey="NewPrintDefault" Activity="04"/>
            <Operation Key="NewPrintSelect" Caption="其他模板选择" RefKey="NewPrintSelect" Activity="04"/>
            <Operation Key="ManagePrint" Caption="打印模板管理" RefKey="ManagePrint" Activity="04"/>
        </OperationCollection>
        <OperationCollection Key="NewPrePrint" Caption="打印预览" SelfDisable="true">
            <Operation Key="NewPrePrintDefault" Caption="默认模板预览" RefKey="NewPrePrintDefault" Activity="Y09"/>
            <Operation Key="NewPrePrintSelect" Caption="其他模板选择" RefKey="NewPrePrintSelect" Activity="Y09"/>
        </OperationCollection>
        <Operation Key="ERPExportExcel" Caption="导出" RefKey="ERPExportExcel" Activity="Y11"/>
        <Operation Key="Attachment" Caption="附件" RefKey="Attachment" Activity="Y12"/>
        <Operation Key="ShowDataLog" Caption="查看数据日志" RefKey="ShowDataLog" Activity="Y08"/>
        <Operation Key="UIClose" Caption="关闭" RefKey="UIClose"/>
    </OperationCollection>
    <Body>
        <Block>
            <FlexFlowLayoutPanel Key="root">
                <ToolBar Key="ToolBar" Caption="ToolBar1" Height="pref">
                    <ToolBarItemCollection/>
                </ToolBar>
                <GridLayoutPanel Key="ProductionOrderBasicInformationGridLayoutPanel" Caption="基本信息" Padding="8px" TopPadding="24px" BorderColor="#E4E7ED" BorderRadius="0" BorderStyle="solid">
                    <Dict Key="ProductPlantID" Caption="生产工厂" X="0" Y="0" Visible="true" Enable="!ReadOnly()&amp;&amp;IsNew()&amp;&amp;ProductPlantID&lt;=0" ItemKey="Plant">
                        <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ProductPlantID">
                            <CheckRule>
                                <![CDATA[IIFS(IsNew()&&ProductPlantID<=0, MessageFacade('CO020','请输入生产工厂'), true, true)]]>
                            </CheckRule>
                        </DataBinding>
                    </Dict>
                    <Dict Key="ProductOrderTypeID" Caption="订单类型" X="1" Y="0" Visible="true" Enable="!ReadOnly()&amp;&amp;ProductOrderTypeID&lt;=0" ItemKey="PP_ProductOrderType">
                        <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ProductOrderTypeID" Required="true">
                            <DefaultFormulaValue>
                                <![CDATA[
                                if (ProductOrderTypeID > 0) {
                                    return ProductOrderTypeID;
                                }
                                var byParent = GetPara('ProductOrderTypeID_Parent');
                                if (byParent != '') {
Le
                                    return byParent;
                                }
                                var var_mode = IIFS(
                                        GetEntryPara('TCode') == 'CO07', 0
                                        , GetEntryPara('TCode') == 'CO08', 1
                                        , true, 2
                                );
                                /** 0 表示无物料, 1 表示按单, 2 表示按库存 */
                                var var_ProfileID = ProductSchedulingProfileID;
                                if (var_mode == 0 && var_ProfileID <= 0 && ProductionSchedulerID > 0) {
                                    var_ProfileID = GetDictValue('PP_ProductionScheduler', ProductionSchedulerID, 'ProductSchedulingProfileID');
                                }
                                if (var_ProfileID > 0) {
                                    var bySchedulingProfile = com.bokesoft.erp.pp.function.ProductionOrderFormula.getDefaultOrderType(var_ProfileID, var_mode, Category);
                                    if (bySchedulingProfile > 0) {
                                        return bySchedulingProfile;
                                    }
                                }
                                return ProductOrderTypeID;]]>
                            </DefaultFormulaValue>
                        </DataBinding>
                        <ItemFilter ItemKey="PP_ProductOrderType">
                            <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                <FilterValue Index="1" ParaValue="IIF(ProductPlantID&gt;0, 'EPP_ProductOrderType.OID in(select ProductOrderTypeID from EPP_ProductOrderType_Paras where plantID='&amp;SqlPara(ProductPlantID)&amp;' and Category ='&amp;SqlPara(Category)&amp;')', '1=2')"/>
                            </Filter>
                        </ItemFilter>
                    </Dict>
                    <TextEditor Key="DocumentNumber" Caption="订单号" X="2" Y="0" Visible="true" Enable="!ReadOnly()&amp;&amp;com.bokesoft.erp.documentNumber.DocumentNumber.docNumberFieldEnable('DocumentNumber')" CopyNew="false" MaxLength="100" Trim="true">
                        <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="DocumentNumber">
                            <CheckRule>
                                <![CDATA[IIFS(com.bokesoft.erp.documentNumber.DocumentNumber.docNumberFieldEnable('DocumentNumber')&&DocumentNumber=='', '采用外部给号编码规则，请输入代码', true, true)]]>
                            </CheckRule>
                        </DataBinding>
                    </TextEditor>
                    <Dict Key="PlanPlantID" Caption="计划工厂" X="3" Y="0" Visible="true" Enable="!ReadOnly()&amp;&amp;IsNew()" ItemKey="Plant">
                        <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="PlanPlantID" DefaultFormulaValue="ProductPlantID">
                            <CheckRule>
                                <![CDATA[IIF(PlanPlantID>0&&MaterialID>0&&PlanFactory_CheckMaterial==2,MessageFacade('PP_PRODUCTIONORDER006','该物料未在计划工厂中维护'),true)]]>
                            </CheckRule>
                        </DataBinding>
                    </Dict>
                    <Dict Key="MRPAreaID" Caption="MRP范围" X="4" Y="0" Visible="true" Enable="false" ItemKey="PP_MRPScope">
                        <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="MRPAreaID">
                            <DefaultFormulaValue>
                                <![CDATA[Macro_GetMRPScopeIDByStorageLocationID(ProductPlantID,MaterialID,StorageLocationID);]]>
                            </DefaultFormulaValue>
                        </DataBinding>
                        <ItemFilter>
                            <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                <FilterValue Index="1" ParaValue="'PlantID = '&amp;SqlPara(ProductPlantID)"/>
                            </Filter>
                        </ItemFilter>
                    </Dict>
                    <TextEditor Key="UserStatusText" Caption="用户状态" X="5" Y="0" Visible="true" Enable="false" CopyNew="false">
                        <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="UserStatusText" ValueDependency="US_ERPUserStatusID,US_IsActive,ProductOrderTypeID,WU_ERPUserStatusID,WU_IsActive">
                            <DefaultFormulaValue>
                                <![CDATA[com.bokesoft.erp.basis.status.StatusFormula.getUserStatusLineHead('ORH')]]>
                            </DefaultFormulaValue>
                        </DataBinding>
                    </TextEditor>
                    <Dict Key="MaterialID" Caption="物料" X="0" Y="1" Visible="true" Enable="!ReadOnly()&amp;&amp;GetDictValue('TCode', TCodeID, 'Code')!='CO07'&amp;&amp;IsNew()&amp;&amp;MaterialID&lt;=0" XSpan="2" ItemKey="Material">
                        <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="MaterialID">
                            <ValueChanged>
                                <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.checkPipeMaterial(MaterialID)]]>
                            </ValueChanged>
                            <CheckRule>
                                <![CDATA[IIF(MaterialID>0,IIF(Macro_GetOrgProp('MaterialID', 'StatusWorkingPlan', ProductPlantID)==0, MessageFacade('CO070','物料未维护工作计划视图,不可以创建生产订单'), Macro_CheckMaterialStatus(ProductPlantID, MaterialID, 'ProductOrder', BasicStartDate, 'EPP_ProductionOrder', 'MaterialID')),IIF(GetDictValue('TCode', TCodeID, 'Code')!='CO07',MessageFacade('PP_PRODUCTIONORDER007','物料不可以为空'),true));]]>
                            </CheckRule>
                        </DataBinding>
                        <ItemFilter>
                            <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                <FilterValue Index="1" ParaValue="IIF(ProductPlantID&gt;0, &quot;OID IN ( Select BK_Material.OID FROM BK_Material  left join EGS_Material_Plant on BK_Material.SOID = EGS_Material_Plant.SOID  where EGS_Material_Plant.PlantID=&quot;&amp;SqlPara(ProductPlantID)&amp;&quot; And StatusMRP=&quot;&amp;SqlPara(1)&amp;&quot; and BK_Material.MaterialTypeID in(select soid from BK_MaterialType where ProductOrder is not null) )&quot;, '1=2')"/>
                            </Filter>
                        </ItemFilter>
                    </Dict>
                    <Dict Key="ProductionVersionID" Caption="生产版本" X="2" Y="1" Visible="true" Enable="!ReadOnly()&amp;&amp;(ProductVersionSelect==0||ProductVersionSelect==1)&amp;&amp;SourcePlanOrderSOID&lt;=0&amp;&amp;(Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)==2||Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)==3)" ItemKey="PP_ProductionVersion">
                        <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ProductionVersionID">
                            <ValueChanged>
                                <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.isModifyProductionVersion();IIF(Category=='40',SetValue('RoutingID',com.bokesoft.erp.pp.function.ProcessOrderFormula.getProcessOrderRoutingID()),true)]]>
                            </ValueChanged>
                            <CheckRule>
                                <![CDATA[IIF(Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)==3&&ProductionVersionID<=0,MessageFacade('PP_PRODUCTIONORDER008','按版本选择，请选择生产版本'),true)]]>
                            </CheckRule>
                            <DefaultFormulaValue>
                                <![CDATA[IIF(GetRowCount('ProductionOrderProcessListGrid')==0&&GetRowCount('ProductionOrderAssemblyGrid')==0&&IsHasProductVersion==0&&((Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)>=2&&ProductVersionSelect==0)||Macro_IsProcessOrder())&&ProductPlantID>0&&MaterialID>0&&TotalBaseQuantity>0&&BasicStartDate>0,com.bokesoft.erp.pp.masterdata.BOMSelectFormula.getProductionVersionID(ProductPlantID,MaterialID,TotalBaseQuantity,BasicStartDate),ProductionVersionID)]]>
                            </DefaultFormulaValue>
                        </DataBinding>
                        <ItemFilter ItemKey="PP_ProductionVersion">
                            <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom" FilterDependency="TotalQuantity">
                                <FilterValue Index="1" ParaValue="'PLANTID='&amp;SqlPara(ProductPlantID)&amp;' and MaterialID='&amp;SqlPara(MaterialID)&amp;' and ValidStartDate&lt;='&amp;SqlPara(ProductVersionExplosionDate)&amp;' and ValidEndDate&gt;='&amp;SqlPara(ProductVersionExplosionDate)"/>
                            </Filter>
                        </ItemFilter>
                    </Dict>
                    <CheckBox Key="IsMultiProject" Caption="多重项目" X="3" Y="1" Enable="false">
                        <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsMultiProject"/>
                    </CheckBox>
                    <CheckBox Key="IsShowStatus" Caption="状态显示" X="4" Y="1" Visible="true" Enable="true">
                        <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsShowStatus"/>
                    </CheckBox>
                    <TextEditor Key="SystemStatusText" Caption="系统状态" X="5" Y="1" Visible="true" Enable="false" CopyNew="false">
                        <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SystemStatusText" ValueDependency="SS_IsActive,SS_ERPSystemStatusID">
                            <DefaultFormulaValue>
                                <![CDATA[com.bokesoft.erp.basis.status.StatusFormula.getSysStatusLineHead('ORH')]]>
                            </DefaultFormulaValue>
                        </DataBinding>
                    </TextEditor>
                    <RowDefCollection RowGap="24">
                        <RowDef Height="32px"/>
                        <RowDef Height="32px"/>
                    </RowDefCollection>
                    <ColumnDefCollection ColumnGap="16">
                        <ColumnDef Width="16%"/>
                        <ColumnDef Width="16%"/>
                        <ColumnDef Width="17%"/>
                        <ColumnDef Width="17%"/>
                        <ColumnDef Width="17%"/>
                        <ColumnDef Width="17%"/>
                    </ColumnDefCollection>
                </GridLayoutPanel>
                <TabPanel Key="ProductionOrderMainTabPanel" Height="100%">
                    <GridLayoutPanel Key="GeneralInfo_Basic" Caption="常规" Height="pref" Padding="8px" OverflowY="Auto">
                        <Label Key="GeneralInfo_Basic_Label" Caption="基本信息" X="0" Y="0" Class="erp-group-title" XSpan="6"/>
                        <NumberEditor Key="TotalQuantity" Caption="订单数量" X="0" Y="1" Visible="true" Enable="IIF(GetDictValue('TCode', TCodeID, 'Code')=='CO07',!ReadOnly(),!ReadOnly()&amp;&amp;MaterialID&gt;0)" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="TotalQuantity">
                                <ValueChanged>
                                    <![CDATA[SetPara('lastVersionID',ProductionVersionID);if (Quantity==0) {SetValue('Quantity', TotalQuantity,false);SetValue('BaseQuantity',Macro_SetScaleByUnit(Quantity*BaseUnitNumerator/BaseUnitDenominator,BaseUnitID,4),false);SetValue('ScrapQuantity', Macro_SetScaleByUnit(Quantity*ScrapRate/100,UnitID,Macro_getRoundingMode()));SetValue('ScrapBaseQuantity', Macro_SetScaleByUnit(ScrapQuantity*BaseUnitNumerator/BaseUnitDenominator,BaseUnitID,4));SetValue('TotalQuantity', Quantity+ScrapQuantity,false);SetValue('TotalBaseQuantity', Quantity+ScrapBaseQuantity,true)}else {com.bokesoft.erp.pp.function.ProductionOrderFormula.caculateProductionOrderQuantityByBusinessTotalQuantity();};Macro_ReceiptChange();]]>
                                </ValueChanged>
                                <CheckRule>
                                    <![CDATA[if ((IsNew()||Macro_IsStatusActive('I0001'))&&TotalQuantity<=0) {if (!GetDictValue('TCode', TCodeID, 'Code')=='CO07'&&MaterialID>0) {MessageFacade('PP_PRODUCTIONORDER011','请输入总数量')} else {if (GetDictValue('TCode', TCodeID, 'Code')=='CO07') {MessageFacade('PP_PRODUCTIONORDER011','请输入总数量')} else {true}}} else {if (ToInt(IsWithoutLimitDelivery)==0&&TotalQuantity*(1+ExcessiveDelivery/100)<HasReceiptQuantity) {MessageFacade('CO120','订单总数量必须大于已交货数量')} else {if((TotalQuantity>0)&&Macro_CheckScaleByUnitID(TotalQuantity,UnitID)){MessageFacade('RU303','计量单位:{1}的小数位不正确',GetDictValue('Unit', UnitID, 'Name'))}else{true}}};]]>
                                </CheckRule>
                            </DataBinding>
                        </NumberEditor>
                        <Dict Key="UnitID" Caption="单位" X="1" Y="1" Visible="true" Enable="IIF(GetDictValue('TCode', TCodeID, 'Code')=='CO07',!ReadOnly(),!ReadOnly()&amp;&amp;MaterialID&gt;0&amp;&amp;FactIssuedDate&lt;=0)" ItemKey="Unit">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="UnitID">
                                <ValueChanged>
                                    <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.productionOrderUnitIDChange();]]>
                                </ValueChanged>
                                <CheckRule>
                                    <![CDATA[IIFS(!GetDictValue('TCode', TCodeID, 'Code')=='CO07'&&UnitID<=0&&MaterialID>0, MessageFacade('PP_PRODUCTIONORDER012','单位不能为空'), GetDictValue('TCode', TCodeID, 'Code')=='CO07'&&UnitID<=0, MessageFacade('PP_PRODUCTIONORDER012','单位不能为空'), true, true)]]>
                                </CheckRule>
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(GetDictValue('TCode', TCodeID, 'Code')=='CO07',GetDictOID('Unit','Code', 'PC'),GetDictValue('Material', MaterialID, 'BaseUnitID'))]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                            <ItemFilter ItemKey="Unit">
                                <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                    <FilterValue Index="1" ParaValue="IIF(MaterialID&gt;0,'soid in ('&amp;com.bokesoft.erp.basis.unit.UnitFormula.getUnitFmMaterial(MaterialID)&amp;')','1=1')"/>
                                </Filter>
                            </ItemFilter>
                        </Dict>
                        <NumberEditor Key="ScrapQuantity" Caption="废品数量" X="2" Y="1" Visible="IIF(Macro_IsProcessOrder()&amp;&amp;ScrapQuantity&lt;=0,false,true)" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ScrapQuantity">
                                <ValueChanged>
                                    <![CDATA[SetValue('Quantity',TotalQuantity-ScrapQuantity);SetValue('BaseQuantity', Macro_SetScaleByUnit(Quantity*BaseUnitNumerator/BaseUnitDenominator,BaseUnitID,4),false);SetValue('ScrapRate', IIF(Quantity<=0,0,Round(ScrapQuantity/Quantity,5)*100));SetValue('ScrapBaseQuantity', Macro_SetScaleByUnit(ScrapQuantity*BaseUnitNumerator/BaseUnitDenominator,BaseUnitID,4));SetValue('TotalBaseQuantity', Macro_SetScaleByUnit(TotalQuantity*BaseUnitNumerator/BaseUnitDenominator,BaseUnitID,4),true);com.bokesoft.erp.pp.function.ProductionOrderFormula.calculationBomQuantity(false);]]>
                                </ValueChanged>
                                <CheckRule>
                                    <![CDATA[if((ScrapQuantity>0)&&Macro_CheckScaleByUnitID(ScrapQuantity,UnitID)){MessageFacade('RU303','计量单位:{1}的小数位不正确',GetDictValue('Unit', UnitID, 'Name'))}else{true};]]>
                                </CheckRule>
                            </DataBinding>
                        </NumberEditor>
                        <NumberEditor Key="ScrapRate" Caption="废品率(%)" X="3" Y="1" Visible="IIF(Macro_IsProcessOrder()&amp;&amp;ScrapQuantity&lt;=0,false,true)" Enable="false" Precision="5">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ScrapRate">
                                <DefaultFormulaValue>
                                    <![CDATA[Macro_GetOrgProp('MaterialID', 'PPAssemblyScrapRate', ProductPlantID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </NumberEditor>
                        <NumberEditor Key="TotalBaseQuantity" Caption="总数量" X="4" Y="1" Visible="BaseUnitID!=UnitID" Enable="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="TotalBaseQuantity">
                                <ValueChanged>
                                    <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.modifyProcessQuantityByOrderQuantity();com.bokesoft.erp.pp.function.ProductionOrderFormula.calculationBomQuantity(true);if (GetRowCount('ProductionOrderAssemblyGrid')>0) {com.bokesoft.erp.mm.atp.formula.ATPFormula.availabilityCheck4ProductionOrder(IsNew(),false,false,true,false,false);}Macro_GenExplosionDateTrig();]]>
                                </ValueChanged>
                            </DataBinding>
                        </NumberEditor>
                        <Dict Key="BaseUnitID" Caption="单位" X="5" Y="1" Visible="BaseUnitID!=UnitID" Enable="false" ItemKey="Unit">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BaseUnitID">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(GetDictValue('TCode', TCodeID, 'Code')=='CO07',GetDictOID ('Unit','Code','PC'),GetDictValue ('Material', MaterialID, 'BaseUnitID'))]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Dict>
                        <NumberEditor Key="HasReceiptQuantity" Caption="已交货" X="0" Y="2" Enable="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ReceiptQuantity">
                                <CheckRule>
                                    <![CDATA[IIF(HasReceiptQuantity<0,MessageFacade('PP_PRODUCTIONORDER010','已交货数量小于0,请检查数据!'),'')]]>
                                </CheckRule>
                            </DataBinding>
                        </NumberEditor>
                        <NumberEditor Key="LackOrExcessiveQuantity" Caption="缺量/过量收货" X="2" Y="2" Visible="true" Enable="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="LackOrExcessiveQuantity"/>
                        </NumberEditor>
                        <Label Key="GeneralInfo_Date_Label" Caption="日期/时间" X="0" Y="3" Class="erp-group-title" XSpan="6"/>
                        <UTCDatePicker Key="BasicStartDate" Caption="基本开始日期" X="0" Y="4" Visible="true" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BasicStartDate">
                                <ValueChanged>
                                    <![CDATA[Macro_SelectProductionVersion();Macro_CheckAndSetBasicEndDate();]]>
                                </ValueChanged>
                                <CheckRule>
                                    <![CDATA[IIFS(GetDictValue('PP_SchedulingType', SchedulingTypeID, 'IsForward')==1&&BasicStartDate<=0, MessageFacade('CO027','向后模式请输入基本结束日期'), GetDictValue('PP_SchedulingType', SchedulingTypeID, 'IsOnlyCapacityRequirement')==1&&BasicStartDate<=0, MessageFacade('PP_PRODUCTIONORDER009','无提前期计划，开始日期不能为空'), true, true)]]>
                                </CheckRule>
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(isWFMapping()==false,IIF(GetDictValue('PP_SchedulingType', SchedulingTypeID, 'IsCurrentDate')==1,DateLong(),BasicStartDate),BasicStartDate)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </UTCDatePicker>
                        <TextEditor Key="BasicStartTime" Caption="基本开始时间" X="1" Y="4" Visible="true" Enable="!ReadOnly()&amp;&amp;GetDictValue('PP_SchedulingType', SchedulingTypeID, 'IsContainTime')==1" InvalidChars=" " MaxLength="10" Trim="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BasicStartTime"/>
                        </TextEditor>
                        <UTCDatePicker Key="BasicEndDate" Caption="基本结束日期" X="2" Y="4" Visible="true" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BasicEndDate">
                                <ValueChanged>
                                    <![CDATA[Macro_GenExplosionDateTrig();Macro_CheckAndSetBasicStartDate();IIF(GetDictValue('PP_SchedulingType', SchedulingTypeID, 'IsOnlyCapacityRequirement')==1&&BasicStartDate>0&&BasicEndDate>0,true);]]>
                                </ValueChanged>
                                <CheckRule>
                                    <![CDATA[IIFS(GetDictValue('PP_SchedulingType', SchedulingTypeID, 'IsBackward')==1&&BasicEndDate<=0, MessageFacade('CO028','向前模式请输入基本开始日期'), GetDictValue('PP_SchedulingType', SchedulingTypeID, 'IsOnlyCapacityRequirement')==1&&BasicEndDate<=0, MessageFacade('CO029','无提前期计划，开始日期不能为空'), BasicEndDate>0&&BasicEndDate<BasicStartDate, MessageFacade('CO030','开始日期不能迟于结束日期'),true, true)]]>
                                </CheckRule>
                            </DataBinding>
                        </UTCDatePicker>
                        <TextEditor Key="BasicEndTime" Caption="基本结束时间" X="3" Y="4" Visible="true" Enable="!ReadOnly()&amp;&amp;GetDictValue('PP_SchedulingType', SchedulingTypeID, 'IsContainTime')==1" InvalidChars=" " MaxLength="10" Trim="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BasicEndTime">
                                <ValueChanged>
                                    <![CDATA[IIF(GetDictValue('PP_SchedulingType', SchedulingTypeID, 'IsOnlyCapacityRequirement')==1&&BasicStartDate>0&&BasicEndDate>0,true);]]>
                                </ValueChanged>
                            </DataBinding>
                        </TextEditor>
                        <UTCDatePicker Key="ProductStartDate" Caption="生产开始日期" X="0" Y="5" Visible="true" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ProductStartDate"/>
                        </UTCDatePicker>
                        <TextEditor Key="ProductStartTime" Caption="生产开始时间" X="1" Y="5" Visible="true" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ProductStartTime"/>
                        </TextEditor>
                        <UTCDatePicker Key="ProductEndDate" Caption="生产结束日期" X="2" Y="5" Visible="true" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ProductEndDate"/>
                        </UTCDatePicker>
                        <TextEditor Key="ProductEndTime" Caption="生产结束时间" X="3" Y="5" Visible="true" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ProductEndTime"/>
                        </TextEditor>
                        <UTCDatePicker Key="PlanIssuedDate" Caption="计划下达日期" X="4" Y="5" Visible="true" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="PlanIssuedDate">
                                <DefaultFormulaValue>
                                    <![CDATA[com.bokesoft.erp.pp.function.CommonFormulaUtils.calcAndSkipRestDay(BasicStartDate,ReleasePeriod,ProductPlantID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </UTCDatePicker>
                        <UTCDatePicker Key="ConfirmStartDate" Caption="确认开始日期" X="0" Y="6" Visible="true" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ConfirmStartDate"/>
                        </UTCDatePicker>
                        <UTCDatePicker Key="ConfirmEndDate" Caption="确认结束日期" X="2" Y="6" Visible="true" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ConfirmEndDate"/>
                        </UTCDatePicker>
                        <UTCDatePicker Key="FactIssuedDate" Caption="实际下达日期" X="4" Y="6" Visible="true" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="FactIssuedDate"/>
                        </UTCDatePicker>
                        <Label Key="GeneralInfo_Plan_Label" Caption="计划参数" X="0" Y="7" Class="erp-group-title" XSpan="6"/>
                        <Dict Key="SchedulingMarginKeyID" Caption="计划边际码" X="0" Y="8" Visible="true" Enable="!ReadOnly()" ItemKey="PP_SchedulingMarginKey">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SchedulingMarginKeyID">
                                <DefaultFormulaValue>
                                    <![CDATA[Macro_GetOrgProp('MaterialID', 'SchedulingMarginKeyID', ProductPlantID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                            <ItemFilter>
                                <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                    <FilterValue Index="1" ParaValue="IIF(ProductPlantID&gt;0, 'oid in (select oid from EPP_SchedulingMarginKey where plantid = '&amp;SqlPara(ProductPlantID)&amp;')', '1=2')"/>
                                </Filter>
                            </ItemFilter>
                        </Dict>
                        <NumberEditor Key="ReleasePeriod" Caption="下达缓冲(天)" X="1" Y="8" Visible="true" IntegerValue="true" Precision="9" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ReleasePeriod">
                                <DefaultFormulaValue>
                                    <![CDATA[GetDictValue('PP_SchedulingMarginKey', SchedulingMarginKeyID, 'ReleasePeriod')]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </NumberEditor>
                        <NumberEditor Key="FloatBeforeDays" Caption="产前缓冲(天)" X="2" Y="8" Visible="true" IntegerValue="true" Precision="9" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="FloatBeforeDays">
                                <DefaultFormulaValue>
                                    <![CDATA[GetDictValue('PP_SchedulingMarginKey', SchedulingMarginKeyID, 'FloatBeforeProduction')]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </NumberEditor>
                        <NumberEditor Key="FloatAfterDays" Caption="产后缓冲(天)" X="3" Y="8" Visible="true" IntegerValue="true" Precision="9" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="FloatAfterDays">
                                <DefaultFormulaValue>
                                    <![CDATA[GetDictValue('PP_SchedulingMarginKey', SchedulingMarginKeyID, 'FloatAfterProduction')]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </NumberEditor>
                        <Dict Key="SchedulingTypeID" Caption="计划类型" X="0" Y="9" Visible="true" ItemKey="PP_SchedulingType">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SchedulingTypeID">
                                <ValueChanged>
                                    <![CDATA[IIFS(GetDictValue('PP_SchedulingType', SchedulingTypeID, 'IsCurrentDate')==1,SetValue('BasicStartDate',DateLong(),True))]]>
                                </ValueChanged>
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(SchedulingTypeID<=0&&ProductPlantID>0&&ProductOrderTypeID>0,com.bokesoft.erp.pp.crp.SchedulingParameters.getSchedulingTypesID4ProductionOrder(ProductPlantID,ProductOrderTypeID,ProductionSchedulerID),SchedulingTypeID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Dict>
                        <TextEditor Key="ReduceTxt" Caption="缩减" X="1" Y="9" Visible="true" Enable="false" MaxLength="100" Trim="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ReduceText" DefaultValue="没有执行缩减"/>
                        </TextEditor>
                        <TextEditor Key="Notes" Caption="注释" X="2" Y="9" Visible="true" Enable="false" MaxLength="100" Trim="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="TextNotes" DefaultValue="无计划附注"/>
                        </TextEditor>
                        <Label Key="GeneralInfo_Sale_Label" Caption="销售相关" X="0" Y="10" Visible="SaleOrderDtlOID &gt; 0" Class="erp-group-title" XSpan="6"/>
                        <Dict Key="SaleOrderSOID" Caption="销售订单" X="0" Y="11" Visible="false" Enable="false" ItemKey="SD_SaleOrder__Dic" StateMask="Enable|Disable|Discard">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SaleOrderSOID"/>
                        </Dict>
                        <Dict Key="SaleOrderDtlOID" Caption="销售订单-行号" X="0" Y="11" Visible="SaleOrderDtlOID &gt; 0" Enable="false" ItemKey="SD_SaleOrderDtl__Dic" StateMask="Enable|Disable|Discard">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SaleOrderItemID"/>
                            <ItemFilter ItemKey="SD_SaleOrderDtl__Dic">
                                <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                    <FilterValue Index="1" ParaValue="'SpecialIdentity='&amp;SqlPara('E')"/>
                                </Filter>
                            </ItemFilter>
                        </Dict>
                        <UTCDatePicker Key="DeliveryDate" Caption="请求交货日期" X="1" Y="11" Visible="SaleOrderDtlOID &gt; 0" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="DeliveryDate">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(SaleOrderSOID>0,com.bokesoft.erp.pp.function.ProductionOrderFormula.getDeliveryDate(),0)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </UTCDatePicker>
                        <NumberEditor Key="Quantity" Caption="订单数量" X="1" Y="1" Visible="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="Quantity"/>
                        </NumberEditor>
                        <NumberEditor Key="BaseQuantity" Caption="订单数量" X="1" Y="1" Visible="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BaseQuantity"/>
                        </NumberEditor>
                        <NumberEditor Key="ScrapBaseQuantity" Caption="废品数量" X="1" Y="1" Visible="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ScrapBaseQuantity"/>
                        </NumberEditor>
                        <NumberEditor Key="LackOrExcessiveBaseQuantity" Caption="缺量/过量收货" X="1" Y="1" Visible="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="LackOrExcessiveBaseQuantity"/>
                        </NumberEditor>
                        <NumberEditor Key="BaseUnitNumerator" Caption="订单到基本单位-分子" X="1" Y="1" Visible="false" IntegerValue="true" Precision="9" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BaseUnitNumerator">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(BaseUnitID>0&&UnitID>0&&MaterialID>0,com.bokesoft.erp.basis.unit.UnitFormula.getNume4MaTunit(UnitID,BaseUnitID,MaterialID),1)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </NumberEditor>
                        <NumberEditor Key="BaseUnitDenominator" Caption="订单到基本单位-分母" X="1" Y="1" Visible="false" IntegerValue="true" Precision="9" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BaseUnitDenominator">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(BaseUnitID>0&&UnitID>0&&MaterialID>0,com.bokesoft.erp.basis.unit.UnitFormula.getDeno4MaTunit(UnitID,BaseUnitID,MaterialID),1)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </NumberEditor>
                        <Dict Key="CompanyCodeID" Caption="公司代码" X="1" Y="1" Visible="false" ItemKey="CompanyCode">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="CompanyCodeID">
                                <DefaultFormulaValue>
                                    <![CDATA[GetDictValue('Plant', ProductPlantID, 'CompanyCodeID')]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Dict>
                        <Dict Key="DivisionID" Caption="产品部门" X="1" Y="2" Visible="false" ItemKey="Division">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="DivisionID">
                                <DefaultFormulaValue>
                                    <![CDATA[GetDictValue('Material', MaterialID, 'DivisionID')]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Dict>
                        <RowDefCollection RowGap="24">
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                        </RowDefCollection>
                        <ColumnDefCollection ColumnGap="16">
                            <ColumnDef Width="16%"/>
                            <ColumnDef Width="16%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                        </ColumnDefCollection>
                    </GridLayoutPanel>
                    <FlexFlowLayoutPanel Key="StatusHead" Caption="状态管理" Height="pref" Visible="ToInt(IsShowStatus)==1" Padding="8px">
                        <Embed Key="HeadStatusManage" FormKey="HeadStatusManage" RootKey="HeadStatusManageRoot" Height="100%"/>
                    </FlexFlowLayoutPanel>
                    <GridLayoutPanel Key="ProductionOrderAllocationGridLayoutPanel" Caption="分配" Height="pref" Padding="8px" OverflowY="Auto">
                        <Dict Key="Distrib_ProductPlantID" Caption="生产工厂(待删除)" X="0" Y="0" Visible="false" Enable="false" ItemKey="Plant">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="Distrib_ProductPlantID" DefaultFormulaValue="ProductPlantID"/>
                        </Dict>
                        <Dict Key="Distrib_PlanPlantID" Caption="计划工厂(待删除)" X="0" Y="0" Visible="false" Enable="false" ItemKey="Plant">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="Distrib_PlanPlantID" DefaultFormulaValue="PlanPlantID"/>
                        </Dict>
                        <Label Key="Responsibility" Caption="责任" X="0" Y="0" Class="erp-group-title" XSpan="6"/>
                        <Dict Key="MRPControllerID" Caption="MRP 管理员" X="0" Y="1" ItemKey="PP_MRPController">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="MRPControllerID">
                                <DefaultFormulaValue>
                                    <![CDATA[Macro_GetOrgProp('MaterialID', 'MRPControllerID', PlanPlantID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                            <ItemFilter ItemKey="PP_MRPController">
                                <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                    <FilterValue Index="1" ParaValue="IIF(ProductPlantID&gt;0, 'oid in (select oid from EPP_MRPController where plantid = '&amp;SqlPara(PlanPlantID)&amp;')', '1=2')"/>
                                </Filter>
                            </ItemFilter>
                        </Dict>
                        <Dict Key="ProductionSchedulerID" Caption="生产管理员" X="1" Y="1" ItemKey="PP_ProductionScheduler">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ProductionSchedulerID">
                                <DefaultFormulaValue>
                                    <![CDATA[Macro_GetOrgProp('MaterialID', 'WorkingPlan_ProductionSchedulerID', ProductPlantID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                            <ItemFilter>
                                <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                    <FilterValue Index="1" ParaValue="IIF(ProductPlantID&gt;0, 'oid in (select oid from EPP_ProductionScheduler where plantid = '&amp;SqlPara(ProductPlantID)&amp;')', '1=2')"/>
                                </Filter>
                            </ItemFilter>
                        </Dict>
                        <Label Key="LblDistribution" Caption="分配" X="0" Y="2" Class="erp-group-title" XSpan="6"/>
                        <Dict Key="BusinessAreaID" Caption="业务范围" X="0" Y="3" ItemKey="BusinessArea">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BusinessAreaID">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(MaterialID>0,com.bokesoft.erp.pp.function.ProductionOrderFormula.getBusinessAreaID(ProductPlantID,DivisionID),BusinessAreaID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Dict>
                        <Dict Key="ProfitCenterID" Caption="利润中心" X="1" Y="3" ItemKey="ProfitCenter">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ProfitCenterID">
                                <DefaultFormulaValue>
                                    <![CDATA[com.bokesoft.erp.mm.purchase.ProfitCenterFormula.getProfitCenterID(ProductPlantID, MaterialID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Dict>
                        <Dict Key="Distrib_SaleOrderSOID" Caption="销售订单" X="2" Y="3" Visible="Macro_DebugMode()" Enable="false" ItemKey="SD_SaleOrder__Dic" StateMask="Enable|Disable|Discard">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="Distrib_SaleOrderSOID" DefaultFormulaValue="SaleOrderSOID"/>
                        </Dict>
                        <Dict Key="Distrib_SaleOrderDtlOID" Caption="销售订单" X="2" Y="3" ItemKey="SD_SaleOrderDtl__Dic" StateMask="Enable|Disable|Discard">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="Distrib_SaleOrderDtlOID" DefaultFormulaValue="SaleOrderDtlOID"/>
                        </Dict>
                        <Dict Key="WBSElementID" Caption="WBS元素" X="3" Y="3" Enable="!ReadOnly()&amp;&amp;GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'InternalCode')=='Q'" ItemKey="PS_WBSElement">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="WBSElementID">
                                <CheckRule>
                                    <![CDATA[IIF(GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'InternalCode')=='Q'&&WBSElementID<=0,MessageFacade('PP_PRODUCTIONORDER013','项目库存必须录入WBS项目，请检查！'),true)]]>
                                </CheckRule>
                            </DataBinding>
                        </Dict>
                        <TextEditor Key="BOMDevelopCode" Caption="BOM展开号" X="4" Y="3" Enable="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BOMDevelopCode"/>
                        </TextEditor>
                        <Dict Key="FunctionalAreaID" Caption="功能范围" X="5" Y="3" ItemKey="FunctionalArea">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="FunctionalAreaID">
                                <DefaultFormulaValue>
                                    <![CDATA[GetDictValue('PP_ProductOrderType', ProductOrderTypeID, 'FunctionalAreaID')]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Dict>
                        <Dict Key="SourcePlanOrderSOID" Caption="计划订单" X="0" Y="4" Enable="false" ItemKey="PP_PlanOrder__Dic" StateMask="Enable|Disable|Discard">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SourcePlanOrderSOID"/>
                        </Dict>
                        <NumberEditor Key="ReservationID" Caption="预留ID" X="1" Y="4" Visible="false" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ReservationSOID"/>
                        </NumberEditor>
                        <TextEditor Key="ReservationNumber" Caption="预留号" X="1" Y="4" Enable="false" MaxLength="100" Trim="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ReservationDocNo"/>
                        </TextEditor>
                        <Dict Key="InspectionLotSOID" Caption="检验批" X="2" Y="4" Visible="InspectionLotSOID&gt;0" Enable="false" ItemKey="QM_InspectionLot__Dic" StateMask="Enable|Disable|Discard">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="InspectionLotSOID"/>
                        </Dict>
                        <Dict Key="SuperiorOrderID" Caption="上级订单" X="3" Y="4" Visible="SuperiorOrderID&gt;0" Enable="false" ItemKey="PP_ProductionOrder__Dic" StateMask="Enable|Disable|Discard">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SuperiorOrderOID"/>
                        </Dict>
                        <NumberEditor Key="ItemDeliverySchedule_Distrib" X="4" Y="4" Visible="false" Enable="false" IntegerValue="true" Precision="9" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ItemDeliverySchedule_Distrib"/>
                        </NumberEditor>
                        <RowDefCollection RowGap="24">
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                        </RowDefCollection>
                        <ColumnDefCollection ColumnGap="16">
                            <ColumnDef Width="16%"/>
                            <ColumnDef Width="16%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                        </ColumnDefCollection>
                    </GridLayoutPanel>
                    <GridLayoutPanel Key="ProductionOrderReceiptGridLayoutPanel" Caption="收货" Height="pref" Padding="8px" OverflowY="Auto">
                        <Label Key="LblControl" Caption="控制" X="0" Y="0" Class="erp-group-title" XSpan="6"/>
                        <ComboBox Key="StockType" Caption="库存类型" X="0" Y="1" SourceType="ParaGroup" GroupKey="StockTypeGroup" IntegerValue="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="StockType">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(MaterialID>0&&Macro_GetOrgProp('MaterialID', 'IsPosttoInspectionStock', ProductPlantID)==1,2,com.bokesoft.erp.mm.stock.MovementTypeFormula.getStockTypeByMoveTypeID(GetDictOID('MoveType', 'Code', '101')))]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </ComboBox>
                        <NumberEditor Key="ReceiptHandleTime" Caption="收货处理时间" X="1" Y="1" Enable="false" IntegerValue="true" Precision="9" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ReceiptProcessingDays">
                                <DefaultFormulaValue>
                                    <![CDATA[Macro_GetOrgProp('MaterialID', 'PPInspectionTime', ProductPlantID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </NumberEditor>
                        <CheckBox Key="IsReceive" Caption="收货" X="2" Y="1" Enable="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsReceive" DefaultFormulaValue="IIF(GetEntryPara('TCode')=='CO07',0,1)"/>
                        </CheckBox>
                        <CheckBox Key="IsCompleteReceipt" Caption="已全部交货" X="3" Y="1" Enable="!ReadOnly() &amp;&amp; com.bokesoft.erp.pp.function.ProductionOrderFormula.ProductionOrderdeliveryedit()">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsCompleteReceipt"/>
                        </CheckBox>
                        <NumberEditor Key="LackOfDelivery" Caption="不足发货率(%)" X="0" Y="2" Precision="3" Scale="1" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="LackOfDelivery">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(LackOfDelivery<=0,Macro_GetOrgProp('MaterialID','WorkingPlan_UnderdelyTolerance',PlanPlantID),LackOfDelivery)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </NumberEditor>
                        <NumberEditor Key="ExcessiveDelivery" Caption="过量交货率(%)" X="1" Y="2" Precision="3" Scale="1" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ExcessiveDelivery">
                                <CheckRule>
                                    <![CDATA[IIF(IsWithoutLimitDelivery==1&&ExcessiveDelivery!=0,MessageFacade('CO141','过量交货与未限制过量交货不允许同时维护'),true)]]>
                                </CheckRule>
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(ExcessiveDelivery<=0,Macro_GetOrgProp('MaterialID','WorkingPlan_OverdelyTolerance',PlanPlantID),ExcessiveDelivery)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </NumberEditor>
                        <CheckBox Key="IsWithoutLimitDelivery" Caption="未限制过量交货" X="2" Y="2">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsWithoutLimitDelivery">
                                <CheckRule>
                                    <![CDATA[IIF(IsWithoutLimitDelivery==1&&ExcessiveDelivery!=0,MessageFacade('CO141','过量交货与未限制过量交货不允许同时维护'),true)]]>
                                </CheckRule>
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(IsWithoutLimitDelivery<=0,Macro_GetOrgProp('MaterialID','WorkingPlan_IsUnlimited',PlanPlantID),IsWithoutLimitDelivery)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </CheckBox>
                        <Label Key="LblReceive" Caption="收货" X="0" Y="3" Class="erp-group-title" XSpan="6"/>
                        <Dict Key="StorageLocationID" Caption="库存地点" X="0" Y="4" ItemKey="StorageLocation">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="StorageLocationID">
                                <DefaultFormulaValue>
                                    <![CDATA[IIFS(ProductionVersionID>0&&GetDictValue('PP_ProductionVersion', ProductionVersionID, 'StorageLocationID')>0, GetDictValue('PP_ProductionVersion', ProductionVersionID, 'StorageLocationID'),StorageLocationID>0,StorageLocationID,true, Macro_GetOrgProp('MaterialID', 'PPProductStorageLocationID', ProductPlantID))]]>
                                </DefaultFormulaValue>
                                <ValueChangeAction>
                                    <![CDATA[Macro_CheckStorageLocation(GetOldValue('StorageLocationID'));Macro_ConfirmMRPScopeMessage();]]>
                                </ValueChangeAction>
                            </DataBinding>
                            <ItemFilter ItemKey="StorageLocation">
                                <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                    <FilterValue Index="1" ParaValue="IIF(ProductPlantID&gt;0, 'PlantID='&amp;SqlPara(ProductPlantID), '1=2')"/>
                                </Filter>
                            </ItemFilter>
                        </Dict>
                        <Dict Key="StoragePointID" Caption="子库" X="1" Y="4" Enable="!ReadOnly()&amp;&amp;com.bokesoft.erp.wmsintegration.WMSIntegrationFormula.enabledWhenStoragePoint(ProductPlantID,StorageLocationID)" ItemKey="StoragePoint">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="StoragePointID"/>
                            <ItemFilter ItemKey="StoragePoint">
                                <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                    <FilterValue Index="1" ParaValue="IIF(StorageLocationID&gt;0, 'soid in ('&amp;com.bokesoft.erp.wmsintegration.WMSIntegrationFormula.getStoragePointFilter4StorageLocation(ProductPlantID,StorageLocationID)&amp;')', '1=2')"/>
                                </Filter>
                            </ItemFilter>
                        </Dict>
                        <TextButton Key="BatchCode" Caption="批次" X="2" Y="4" Enable="!ReadOnly()" Case="Upper" MaxLength="30" Trim="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BatchCode" DefaultValue="_">
                                <ValueChangeAction>
                                    <![CDATA[SetValue('BatchCodeType', 1);IIF(Macro_CheckAndCreateBatchCode()=='',ConfirmMsg('PP_PRODUCTIONORDER072','该批次不存在,您是否需要创建该批次?',{},'YES_NO',{YES:{true},NO:{SetValue('BatchCode','')}}),true)]]>
                                </ValueChangeAction>
                            </DataBinding>
                            <OnClick>
                                <![CDATA[Macro_SetBatchCode(1, PlantID, MaterialID, 'StorageLocationID', 'StoragePointID', 1, '_', 'BatchCode', 'BatchCode','TotalBaseQuantity')]]>
                            </OnClick>
                        </TextButton>
                        <Button Key="AutoBatchCode" Caption="创建批次" X="3" Y="4" Enable="!ReadOnly()" Type="Normal">
                            <OnClick>
                                <![CDATA[Macro_ClickCreateBatch();]]>
                            </OnClick>
                        </Button>
                        <NumberEditor Key="BatchCodeType" Caption="批次生成来源" X="4" Y="4" Visible="false" Precision="9" ShowZero="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BatchCodeType" DefaultValue="1"/>
                            <Format HAlign="Right"/>
                        </NumberEditor>
                        <CheckBox Key="IsBatchManagement" Caption="批次管理" X="5" Y="4" Visible="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsBatchManagement">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(ProductPlantID>0&&MaterialID>0&&Macro_MaterialIsBatchManagement(ProductPlantID,MaterialID),1,0)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </CheckBox>
                        <Dict Key="GlobalValuationTypeID" Caption="评估类型" X="0" Y="5" Visible="com.bokesoft.erp.mm.function.SplitValuationFormula.isSplitValuationMaterial(ProductPlantID,MaterialID)" Enable="!ReadOnly()&amp;&amp;ReceiptQuantity==0&amp;&amp;com.bokesoft.erp.mm.function.SplitValuationFormula.getValuationCategoryPropValue(Macro_GetOrgProp2('MaterialID', 'GlobalCategoryID', ProductPlantID, 0),'IsExtPOMandatory',ProductPlantID)==0&amp;&amp;!com.bokesoft.erp.mm.function.SplitValuationFormula.getBatchCodeValuationTypeID(ProductPlantID,MaterialID,BatchCode)&gt;0" ItemKey="MM_GlobalValuationType">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="GlobalValuationTypeID">
                                <CheckRule>
                                    <![CDATA[IIF(GlobalValuationTypeID>0,IIF(com.bokesoft.erp.mm.function.SplitValuationFormula.getValuationTypePropValue(GlobalValuationTypeID,'InternalPOAllowed',ProductPlantID)==2,MessageFacade('PP_PRODUCTIONORDER014','内部订单未被允许'),true),true)]]>
                                </CheckRule>
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(ReceiptQuantity>0,GlobalValuationTypeID,IIF(com.bokesoft.erp.mm.function.SplitValuationFormula.getDefaultValuationTypeID(MaterialID,Macro_GetOrgProp2('MaterialID', 'GlobalCategoryID', ProductPlantID, 0),'IntPOGlobalValuationTypeID',ProductPlantID)>0,com.bokesoft.erp.mm.function.SplitValuationFormula.getDefaultValuationTypeID(MaterialID,Macro_GetOrgProp2('MaterialID', 'GlobalCategoryID', ProductPlantID, 0),'IntPOGlobalValuationTypeID',ProductPlantID),GlobalValuationTypeID))]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                            <ItemFilter ItemKey="MM_GlobalValuationType">
                                <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                    <FilterValue Index="1" ParaValue="IIF(MaterialID&gt;0, com.bokesoft.erp.mm.function.SplitValuationFormula.getMaterialValuationTypeDicFilter(ProductPlantID,MaterialID), '1=2')"/>
                                </Filter>
                            </ItemFilter>
                        </Dict>
                        <RowDefCollection RowGap="24">
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                        </RowDefCollection>
                        <ColumnDefCollection ColumnGap="16">
                            <ColumnDef Width="16%"/>
                            <ColumnDef Width="16%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                        </ColumnDefCollection>
                    </GridLayoutPanel>
                    <GridLayoutPanel Key="ProductionOrderControlGridLayoutPanel" Caption="控制" Height="pref" Padding="8px" OverflowY="Auto">
                        <Label Key="LblOrder" Caption="生产" X="0" Y="0" Class="erp-group-title" XSpan="6"/>
                        <ComboBox Key="GeneratorMethod" Caption="生成方式" X="0" Y="1" Enable="false" SourceType="ParaGroup" IntegerValue="true" GroupKey="GenerateControl">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="GeneratorMethod">
                                <DefaultFormulaValue>
                                    <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.getFieldValueFromProductionOrderTypeParas('GeneratorMethod',ProductPlantID,ProductOrderTypeID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </ComboBox>
                        <Dict Key="ProductSchedulingProfileID" Caption="参数文件" X="1" Y="1" ItemKey="PP_ProductSchedulingProfile">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ProductSchedulingProfileID">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(ProductPlantID>0&&MaterialID>0,com.bokesoft.erp.pp.function.ProcessOrderFormula.getProductSchedulingProfileID(ProductPlantID,MaterialID),ProductSchedulingProfileID);]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                            <ItemFilter>
                                <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                    <FilterValue Index="1" ParaValue="IIF(ProductPlantID&gt;0, 'oid in (select oid from EPP_ProScheduleProfile where plantid = '&amp;SqlPara(ProductPlantID)&amp;')', '1=2')"/>
                                </Filter>
                            </ItemFilter>
                        </Dict>
                        <CheckBox Key="IsChechAutoRel" Caption="自动下达" X="2" Y="1">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsChechAutoRel">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(ProductSchedulingProfileID>0, GetDictValue('PP_ProductSchedulingProfile', ProductSchedulingProfileID, 'IsReleaseInCreate'))]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </CheckBox>
                        <CheckBox Key="IsProduct4Mes" Caption="下达MES" X="3" Y="1">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsProduct4Execute"/>
                        </CheckBox>
                        <Label Key="LblScheduling" Caption="计划" X="0" Y="2" Class="erp-group-title" XSpan="6"/>
                        <CheckBox Key="IsComputPowerRequirements" Caption="计算能力需求" X="0" Y="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsComputPowerRequirement">
                                <DefaultFormulaValue>
                                    <![CDATA[com.bokesoft.erp.pp.crp.SchedulingParameters.getSchedulingValue4ProductionOrder('IsGeneratorCapacityReqDtl',ProductPlantID,ProductOrderTypeID,ProductionSchedulerID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </CheckBox>
                        <CheckBox Key="IsSchedulingAllowing4Breaks" Caption="精确的休息时间" X="1" Y="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsSchedulingAllowing4Break">
                                <DefaultFormulaValue>
                                    <![CDATA[com.bokesoft.erp.pp.crp.SchedulingParameters.getSchedulingValue4ProductionOrder('IsSchedulingWithBreak',ProductPlantID,ProductOrderTypeID,ProductionSchedulerID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </CheckBox>
                        <CheckBox Key="IsScheduleAutomatically" Caption="自动计划" X="2" Y="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsScheduleAutomatically">
                                <DefaultFormulaValue>
                                    <![CDATA[com.bokesoft.erp.pp.crp.SchedulingParameters.getSchedulingValue4ProductionOrder('IsAutomaticScheduling',ProductPlantID,ProductOrderTypeID,ProductionSchedulerID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </CheckBox>
                        <Label Key="LblCostingInfo" Caption="成本核算" X="0" Y="4" Class="erp-group-title" XSpan="6"/>
                        <Dict Key="PlanCostingVariantID" Caption="计划成本变式" X="0" Y="5" Enable="false" ItemKey="CO_CostingVariant">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="PlanCostVariantID">
                                <DefaultFormulaValue>
                                    <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.getFieldValueFromProductionOrderTypeParas('PlanCostingVariantID',ProductPlantID,ProductOrderTypeID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Dict>
                        <Dict Key="ActualCostingVariantID" Caption="实际成本变式" X="1" Y="5" Enable="false" ItemKey="CO_CostingVariant">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ActualCostingVariantID">
                                <DefaultFormulaValue>
                                    <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.getFieldValueFromProductionOrderTypeParas('ActualCostingVariantID',ProductPlantID,ProductOrderTypeID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Dict>
                        <Dict Key="CostingSheetID" Caption="成本核算单" X="2" Y="5" Enable="false" ItemKey="CO_CostingSheet">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="CostingSheetID"/>
                        </Dict>
                        <Dict Key="ResultAnalysisKeyID" Caption="结果分析码" X="3" Y="5" Enable="false" ItemKey="CO_ResultAnalysisKey">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ResultAnalysisKeyID">
                                <DefaultFormulaValue>
                                    <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.getFieldValueFromProductionOrderTypeParas('ResultAnalysisKeyID',ProductPlantID,ProductOrderTypeID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Dict>
                        <ComboBox Key="PlanCostCalculation" Caption="计划成本计算" X="4" Y="5" Enable="false" SourceType="ParaGroup" GroupKey="PlanCostCalculation">
                            <DataBinding>
                                <DefaultFormulaValue>
                                    <![CDATA[if(ProductPlantID>0 && ProductOrderTypeID >0){ com.bokesoft.erp.pp.function.ProductionOrderFormula.getFieldValueFromProductionOrderTypeParas('PlanCostCalculation',ProductPlantID,ProductOrderTypeID); }]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </ComboBox>
                        <Dict Key="CurrencyID" Caption="币种" X="0" Y="0" Visible="false" ItemKey="Currency">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="CurrencyID"/>
                        </Dict>
                        <ComboBox Key="DistributionRule" Caption="分配规则" X="0" Y="0" Visible="false" SourceType="ParaGroup" GroupKey="DistributionRule">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="DistributionRule">
                                <DefaultFormulaValue>
                                    <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.getFieldValueFromProductionOrderTypeParas('DistributionRule',ProductPlantID,ProductOrderTypeID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </ComboBox>
                        <RowDefCollection RowGap="24">
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                        </RowDefCollection>
                        <ColumnDefCollection ColumnGap="16">
                            <ColumnDef Width="16%"/>
                            <ColumnDef Width="16%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                        </ColumnDefCollection>
                    </GridLayoutPanel>
                    <GridLayoutPanel Key="ProductionOrderDateQuantityGridLayoutPanel" Caption="日期/数量" Height="pref" Padding="8px" OverflowY="Auto">
                        <Label Key="ProductionOrderDateAndQuantityArea" Caption="日期/时间" X="0" Y="0" Class="erp-group-title" XSpan="6"/>
                        <UTCDatePicker Key="PlanOrderStartDate" Caption="计划订单开始日期" X="0" Y="1" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="PlanOrderStartDate"/>
                        </UTCDatePicker>
                        <UTCDatePicker Key="PlanOrderEndDate" Caption="计划订单结束日期" X="2" Y="1" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="PlanOrderEndDate"/>
                        </UTCDatePicker>
                        <UTCDatePicker Key="DateTab_PromiseDate" Caption="承诺结束日期" X="4" Y="1" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="DateTab_PromiseDate"/>
                        </UTCDatePicker>
                        <UTCDatePicker Key="DateTab_BasicStartDate" Caption="基本开始日期" X="0" Y="2" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="DateTab_BasicStartDate" DefaultFormulaValue="BasicStartDate"/>
                        </UTCDatePicker>
                        <TextEditor Key="BasicStartTime_DateTab" Caption="基本开始时间" X="1" Y="2" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BasicStartTime_DateTab" DefaultFormulaValue="BasicStartTime"/>
                        </TextEditor>
                        <UTCDatePicker Key="DateTab_BasicEndDate" Caption="基本结束日期" X="2" Y="2" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="DateTab_BasicEndDate" DefaultFormulaValue="BasicEndDate"/>
                        </UTCDatePicker>
                        <TextEditor Key="BasicEndTime_DateTab" Caption="基本结束时间" X="3" Y="2" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BasicEndTime_DateTab" DefaultFormulaValue="BasicEndTime"/>
                        </TextEditor>
                        <UTCDatePicker Key="DateTab_ProductStartDate" Caption="生产开始日期" X="0" Y="3" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="DateTab_ProductStartDate" DefaultFormulaValue="ProductStartDate"/>
                        </UTCDatePicker>
                        <TextEditor Key="ProductStartTime_DateTab" Caption="生产开始时间" X="1" Y="3" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ProductStartTime_DateTab" DefaultFormulaValue="ProductStartTime"/>
                        </TextEditor>
                        <UTCDatePicker Key="DateTab_ProductEndDate" Caption="生产结束日期" X="2" Y="3" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="DateTab_ProductEndDate" DefaultFormulaValue="ProductEndDate"/>
                        </UTCDatePicker>
                        <TextEditor Key="ProductEndTime_DateTab" Caption="生产结束时间" X="3" Y="3" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ProductEndTime_DateTab" DefaultFormulaValue="ProductEndTime"/>
                        </TextEditor>
                        <UTCDatePicker Key="DateTab_PlanIssuedDate" Caption="计划下达日期" X="5" Y="3" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="DateTab_PlanIssuedDate" DefaultFormulaValue="PlanIssuedDate"/>
                        </UTCDatePicker>
                        <UTCDatePicker Key="ProcessConfirmStartDate" Caption="确认开始日期" X="0" Y="4" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ProcessConfirmStartDate"/>
                        </UTCDatePicker>
                        <UTCDatePicker Key="ProcessConfirmEndDate" Caption="确认结束日期" X="2" Y="4" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ProcessConfirmEndDate"/>
                        </UTCDatePicker>
                        <UTCDatePicker Key="DateTab_FactIssuedDate" Caption="实际下达" X="5" Y="4" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="DateTab_FactIssuedDate" DefaultFormulaValue="FactIssuedDate"/>
                        </UTCDatePicker>
                        <Label Key="ProductionOrderPlanQuantity" Caption="数量" X="0" Y="5" Class="erp-group-title" XSpan="6"/>
                        <NumberEditor Key="PlanOrderQuantity" Caption="计划订单数量" X="0" Y="6" Enable="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="PlanOrderQuantity"/>
                        </NumberEditor>
                        <Dict Key="PlanOrderUnitID" Caption="单位" X="1" Y="6" Enable="false" ItemKey="Unit">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="PlanOrderUnitID" DefaultFormulaValue="BaseUnitID"/>
                        </Dict>
                        <NumberEditor Key="PlanOrderScrapQuantity" Caption="计划订单报废量" X="3" Y="6" Enable="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="PlanOrderScrapQuantity"/>
                        </NumberEditor>
                        <NumberEditor Key="OrderQuantity" Caption="生产订单数量" X="0" Y="7" Enable="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="OrderQuantity"/>
                        </NumberEditor>
                        <Dict Key="OrderUnitID" Caption="订单单位" X="1" Y="7" Enable="false" ItemKey="Unit">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="OrderUnitID" DefaultFormulaValue="BaseUnitID"/>
                        </Dict>
                        <NumberEditor Key="OrderScrapQuantity" Caption="生产订单报废量" X="3" Y="7" Visible="IIF(Macro_IsProcessOrder()&amp;&amp;ScrapQuantity&lt;=0,false,true)" Enable="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="OrderScrapQuantity"/>
                        </NumberEditor>
                        <NumberEditor Key="HasConfirmScrapQuantity" Caption="已确认废品量" X="4" Y="7" Enable="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="HasConfirmScrapQuantity"/>
                        </NumberEditor>
                        <NumberEditor Key="ReceiptQuantity" Caption="收货数量" X="0" Y="8" Enable="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ReceiptQuantity"/>
                        </NumberEditor>
                        <NumberEditor Key="HasConfirmQuantity" Caption="已确认数量" X="1" Y="8" Enable="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="HasConfirmQuantity"/>
                        </NumberEditor>
                        <NumberEditor Key="ConfirmReworkQuantity" Caption="返工数量" X="2" Y="8" Enable="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ConfirmReworkQuantity"/>
                            <Format HAlign="Right"/>
                        </NumberEditor>
                        <NumberEditor Key="ReceiptBaseQuantity" Caption="基本收货数量" X="3" Y="8" Visible="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ReceiptBaseQuantity"/>
                        </NumberEditor>
                        <RowDefCollection RowGap="24">
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                        </RowDefCollection>
                        <ColumnDefCollection ColumnGap="16">
                            <ColumnDef Width="16%"/>
                            <ColumnDef Width="16%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                        </ColumnDefCollection>
                    </GridLayoutPanel>
                    <GridLayoutPanel Key="ProductionOrderMasterDataGridLayoutPanel" Caption="主数据" Height="pref" Padding="8px" OverflowY="Auto" Visible="true">
                        <Label Key="LblRouting" Caption="工艺路线" X="0" Y="0" Class="erp-group-title" XSpan="6">
                            <DataBinding DefaultFormulaValue="IIF(Macro_IsProcessOrder(),'主配方','工艺路线')"/>
                        </Label>
                        <Dict Key="RoutingID" Caption="工艺路线ID" X="0" Y="1" Visible="IIF(!Macro_IsProcessOrder(),true,false)" Enable="false" ItemKey="PP_Routing">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="RoutingID">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(Macro_IsProcessOrder(),Macro_GetRoutingID_40(),Macro_GetRoutingID_10())]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Dict>
                        <TextEditor Key="TaskListGroup" Caption="组" X="1" Y="1" Visible="true" Enable="false" FormulaCaption="IIF(Macro_IsProcessOrder(),'配方组','组')" MaxLength="30" Trim="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="TaskListGroup"/>
                        </TextEditor>
                        <NumberEditor Key="GroupCounter" Caption="组计数器" X="2" Y="1" Visible="true" Enable="false" FormulaCaption="IIF(Macro_IsProcessOrder(),'配方','组计数器')" IntegerValue="true" Precision="9" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="GroupCounter"/>
                        </NumberEditor>
                        <UTCDatePicker Key="RoutingValidStartDate" Caption="生效日期" X="3" Y="1" Visible="true" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="RoutingValidStartDate"/>
                        </UTCDatePicker>
                        <NumberEditor Key="RoutingLotSizeFrom" Caption="批量(从)" X="4" Y="1" Visible="true" Enable="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="RoutingLotSizeFrom">
                                <CheckRule>
                                    <![CDATA[IIF(RoutingLotSizeFrom>RoutingLotSizeTo,MessageFacade('PP_PRODUCTIONORDER015','批量大小开始批量必须小于等于结束批量'),true)]]>
                                </CheckRule>
                            </DataBinding>
                        </NumberEditor>
                        <NumberEditor Key="RoutingLotSizeTo" Caption="批量(到)" X="5" Y="1" Visible="true" Enable="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="RoutingLotSizeTo" DefaultValue="999999999">
                                <CheckRule>
                                    <![CDATA[IIF(RoutingLotSizeFrom>RoutingLotSizeTo,MessageFacade('PP_PRODUCTIONORDER015','批量大小开始批量必须小于等于结束批量'),true)]]>
                                </CheckRule>
                            </DataBinding>
                        </NumberEditor>
                        <UTCDatePicker Key="RoutExplosionDate" Caption="工艺展开日期" X="0" Y="2" Visible="true" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="RoutExplosionDate">
                                <ValueChanged>
                                    <![CDATA[IIF(Macro_IsProcessOrder(),true,Macro_RoutExplosionDate_10())]]>
                                </ValueChanged>
                            </DataBinding>
                        </UTCDatePicker>
                        <ComboBox Key="TaskListType" Caption="任务清单类型" X="1" Y="2" Visible="true" Enable="false" SourceType="ParaGroup" GroupKey="RoutingListType">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="TaskListType" DefaultValue="_"/>
                        </ComboBox>
                        <Dict Key="TaskListUnitID" Caption="工艺路线单位" X="2" Y="2" Visible="true" Enable="false" ItemKey="Unit">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="TaskListUnitID" DefaultFormulaValue="BaseUnitID"/>
                        </Dict>
                        <Dict Key="PlannerGroupID" Caption="计划员组" X="3" Y="2" Enable="false" ItemKey="PM_PlannerGroup">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="PlannerGroupID"/>
                        </Dict>
                        <Dict Key="RoutingUsageID" Caption="用途" X="4" Y="2" Visible="IIF(Macro_IsProcessOrder(),true,false)" Enable="false" ItemKey="PP_RoutingUsage">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="RoutingUsageID"/>
                        </Dict>
                        <CheckBox Key="IsRoutingDeploy" Caption="展开工艺路线" X="5" Y="2" Visible="Macro_DebugMode()">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsRoutingDeploy">
                                <ValueChanged>
                                    <![CDATA[Macro_SetDefaultRouting();SetValue('IsRoutingDeploy', 0)]]>
                                </ValueChanged>
                            </DataBinding>
                        </CheckBox>
                        <Label Key="LblBOM" Caption="物料清单" X="0" Y="3" Class="erp-group-title" XSpan="6"/>
                        <Dict Key="MaterialBOMID" Caption="BOM ID" X="0" Y="4" Visible="true" Enable="false" ItemKey="PP_MaterialBOM__Dic">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="MaterialBOMSOID">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(MaterialID<=0,-1, IIFS(isWFMapping()==true, MaterialBOMID,  Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)>=2&&ProductionVersionID>0,  GetDictValue('PP_ProductionVersion', ProductionVersionID, 'MaterialBOMSOID'),  Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)==2&&ProductionVersionID<=0,  Macro_BOMExplosionDate_Trigger(),  Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)<2&&ProductionVersionID<=0&&MaterialBOMID>0,  MaterialBOMID))]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Dict>
                        <Dict Key="BOMUsageID" Caption="BOM用途" X="1" Y="4" Visible="true" Enable="false" ItemKey="PP_BOMUsage">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BOMUsageID"/>
                        </Dict>
                        <NumberEditor Key="SelectBOM" Caption="可选BOM" X="2" Y="4" Visible="true" Enable="false" IntegerValue="true" Precision="9" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SelectBOM"/>
                        </NumberEditor>
                        <UTCDatePicker Key="BOMValidStartDate" Caption="生效日期" X="3" Y="4" Visible="true" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BOMValidStartDate"/>
                        </UTCDatePicker>
                        <NumberEditor Key="BOMLotSizeFrom" Caption="批量(从)" X="4" Y="4" Visible="true" Enable="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BOMLotSizeFrom">
                                <CheckRule>
                                    <![CDATA[IIF(RoutingLotSizeFrom>RoutingLotSizeTo,MessageFacade('PP_PRODUCTIONORDER015','批量大小开始批量必须小于等于结束批量'),true)]]>
                                </CheckRule>
                            </DataBinding>
                        </NumberEditor>
                        <NumberEditor Key="BOMLotSizeTo" Caption="批量(到)" X="5" Y="4" Visible="true" Enable="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BOMLotSizeTo" DefaultValue="999999999">
                                <CheckRule>
                                    <![CDATA[IIF(RoutingLotSizeFrom>RoutingLotSizeTo,MessageFacade('PP_PRODUCTIONORDER015','批量大小开始批量必须小于等于结束批量'),true)]]>
                                </CheckRule>
                            </DataBinding>
                        </NumberEditor>
                        <UTCDatePicker Key="ProductVersionExplosionDate" Caption="生产版本展开日期" Visible="false" Format="yyyy-MM-dd" X="0" Y="5">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ProductVersionExplosionDate"/>
                        </UTCDatePicker>
                        <UTCDatePicker Key="BOMExplosionDate" Caption="BOM展开日期" X="0" Y="5" Visible="true" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BOMExplosionDate">
                                <ValueChanged>
                                    <![CDATA[if (Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID) <= 2 && ProductPlantID > 0 && ProductOrderTypeID > 0 && MaterialID > 0 && TotalBaseQuantity > 0 && BOMExplosionDate > 0 && !isWFMapping() && SourcePlanOrderSOID <= 0 && GetRowCount('ProductionOrderAssemblyGrid') == 0 && MaterialBOMID <= 0) {var BOMID = Macro_BOMExplosionDate_Trigger();if (BOMID > 0) {SetValue('MaterialBOMID', BOMID);} else {ERPShowModal('PP_BOMCondChange', 'EditBill(false)')}}]]>
                                </ValueChanged>
                            </DataBinding>
                        </UTCDatePicker>
                        <NumberEditor Key="BOMBaseQuantity" Caption="基本数量" X="1" Y="5" Visible="true" Enable="false" Scale="3">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BOMBaseQuantity"/>
                        </NumberEditor>
                        <Dict Key="BOMUnitID" Caption="基本单位" X="2" Y="5" Visible="true" Enable="false" ItemKey="Unit">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="BOMBaseUnitID" DefaultFormulaValue="BaseUnitID"/>
                        </Dict>
                        <CheckBox Key="IsReadMasterData" Caption="重读主数据" X="3" Y="5" Visible="Macro_DebugMode()">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsReadMasterData">
                                <ValueChanged>
                                    <![CDATA[if (GetPara('_IsHasVersionID')>0) {Macro_ReadMasterData4VersionID();} else {Macro_ReadMasterData4NoVersionID();}if (GetPara('_NewRoute') == 1) {com.bokesoft.erp.pp.function.ProductionOrderFormula.changeStatus4readMasterData();}SetValue('IsReadMasterData', 0,false);]]>
                                </ValueChanged>
                            </DataBinding>
                        </CheckBox>
                        <Dict Key="MainTab_ProductionVersionID" Caption="生产版本(待删除)" X="4" Y="5" Visible="false" Enable="false" ItemKey="PP_ProductionVersion">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="MainTab_ProductionVersionID" DefaultFormulaValue="ProductionVersionID"/>
                        </Dict>
                        <ComboBox Key="ProductVersionSelect" Caption="生产版本选择" X="5" Y="5" Visible="false" Enable="false" SourceType="ParaGroup" Cache="false" GroupKey="ProductVersionSelect">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ProductVersionSelect">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(SourcePlanOrderSOID<=0,com.bokesoft.erp.pp.function.ProductionOrderFormula.getFieldValueFromProductionOrderTypeParas('ProductVersionSelect',ProductPlantID,ProductOrderTypeID),ProductVersionSelect)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </ComboBox>
                        <RowDefCollection RowGap="24">
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                            <RowDef Height="32px"/>
                        </RowDefCollection>
                        <ColumnDefCollection ColumnGap="16">
                            <ColumnDef Width="16%"/>
                            <ColumnDef Width="16%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                            <ColumnDef Width="17%"/>
                        </ColumnDefCollection>
                    </GridLayoutPanel>
                    <SplitPanel Key="ProductionOrderAssemblySplitPanel" Caption="组件" Orientation="Vertical" Height="pref" Visible="true">
                        <Grid Key="ProductionOrderAssemblyGrid" Caption="组件" SerialSeq="true" Padding="8px">
                            <GridColumnCollection>
                                <GridColumn Key="IsSelect" Width="32px"/>
                                <GridColumn Key="Dtl_OID" Caption="Dtl_OID" Visible="false" Width="80px"/>
                                <GridColumn Key="ItemCategoryID" Caption="项目类别" Enable="!ReadOnly()&amp;&amp;ItemCategoryID&lt;=0" Width="80px"/>
                                <GridColumn Key="Dtl_PlantID" Caption="工厂" Width="80px"/>
                                <GridColumn Key="MaterialBOMDtlOID" Caption="MaterialBOMDtlOID" Visible="false" Width="80px"/>
                                <GridColumn Key="Dtl_MaterialID" Caption="物料" Width="80px"/>
                                <GridColumn Key="Description" Caption="描述" Width="80px"/>
                                <GridColumn Key="Dtl_BaseUnitID" Caption="基本单位" Width="80px"/>
                                <GridColumn Key="Dtl_DivisionID" Caption="产品部门" Visible="Macro_DebugMode()" Width="80px"/>
                                <GridColumn Key="Dtl_UnitID" Caption="业务单位" Width="80px"/>
                                <GridColumn Key="Dtl_BOMBaseQuantity" Caption="BOM基本单位换算比例" Visible="Macro_DebugMode()" Width="100px"/>
                                <GridColumn Key="BOMQuantity" Caption="BOM业务单位换算比例" Visible="Macro_DebugMode()" Width="100px"/>
                                <GridColumn Key="DemandBaseQuantity" Caption="需求数量" Visible="Macro_DebugMode()" Width="100px"/>
                                <GridColumn Key="DemandQuantity" Caption="需求数量" Width="100px"/>
                                <GridColumn Key="Dtl_BaseUnitNumerator" Caption="订单到基本单位-分子" Visible="Macro_DebugMode()" Width="80px"/>
                                <GridColumn Key="Dtl_BaseUnitDenominator" Caption="订单到基本单位-分母" Visible="Macro_DebugMode()" Width="80px"/>
                                <GridColumn Key="CommittedQuantity" Caption="允许数量" Visible="false" Width="100px"/>
                                <GridColumn Key="AllowQuantity" Caption="允许数量" Enable="false" Width="100px"/>
                                <GridColumn Key="ProcessSelect_Btn" Caption="工序选择" Width="80px"/>
                                <GridColumn Key="IsPhaseIndicator" Caption="阶段指示符" Visible="Macro_IsProcessOrder();" Enable="false" Width="100px"/>
                                <GridColumn Key="SuperiorItemNo" Caption="上级工序" Visible="Macro_IsProcessOrder();" Enable="false" Width="80px"/>
                                <GridColumn Key="WorkCenterID" Caption="工作中心" Visible="Macro_DebugMode()" Width="80px"/>
                                <GridColumn Key="IsCore" Caption="关键物料" Enable="!ReadOnly()&amp;&amp;IsDeleted==0" Width="120px"/>
                                <GridColumn Key="IsAssembly" Caption="组件" Width="80px"/>
                                <GridColumn Key="IsDeleted" Caption="已删除" Width="80px"/>
                                <GridColumn Key="IsDirectPurchase" Caption="直接采购" Width="80px"/>
                                <GridColumn Key="IsVirtualAssembly" Caption="虚拟件" Width="80px"/>
                                <GridColumn Key="SortItem" Caption="排序字符串" Enable="!ReadOnly()&amp;&amp;IsDeleted==0" Width="100px"/>
                                <GridColumn Key="Dtl_StorageLocationID" Caption="库存地点" Enable="!ReadOnly()&amp;&amp;IsDeleted==0" Width="80px"/>
                                <GridColumn Key="Dtl_StoragePointID" Caption="子库" Width="80px"/>
                                <GridColumn Key="BatchCode_Btn" Caption="批次" Width="80px"/>
                                <GridColumn Key="IsAlternativeItem" Caption="备选项目" Width="80px"/>
                                <GridColumn Key="SubstituteProjectGroup" Caption="替代项目组" Enable="false" Width="100px"/>
                                <GridColumn Key="ProcessLossRate" Caption="工序废品按(%)" Width="80px"/>
                                <GridColumn Key="IsNetID" Caption="净ID" Enable="!ReadOnly()&amp;&amp;IsDeleted==0" Width="80px"/>
                                <GridColumn Key="AssemblyLossRate" Caption="部件废品(%)" Width="80px"/>
                                <GridColumn Key="IsCoProduct" Caption="联产品" Width="80px"/>
                                <GridColumn Key="IsBulkMaterial" Caption="散装物料" Width="80px"/>
                                <GridColumn Key="DiscontinuationType" Caption="中止" Enable="false" Width="80px"/>
                                <GridColumn Key="IsQuantityFixed" Caption="固定数量" Enable="!ReadOnly()&amp;&amp;IsDeleted==0" Width="80px"/>
                                <GridColumn Key="IsAllowMove" Caption="允许移动" Width="80px"/>
                                <GridColumn Key="RequisiteQuantity" Caption="领料数量" Width="100px"/>
                                <GridColumn Key="RequisiteBaseQuantity" Caption="领料数量(基本)" Width="100px"/>
                                <GridColumn Key="RequirementDate" Caption="需求日期" Enable="false" Width="100px"/>
                                <GridColumn Key="PickingApplyQuantity" Caption="领料申请数量" Visible="false" Width="120px"/>
                                <GridColumn Key="ReturnApplyQuantity" Caption="退料申请数量" Visible="false" Width="120px"/>
                                <GridColumn Key="MoveTypeID" Caption="移动类型" Width="80px"/>
                                <GridColumn Key="IsBacklash" Caption="反冲" Width="80px"/>
                                <GridColumn Key="MaterialSupplyIndicator" Caption="物料供应标识" Width="120px"/>
                                <GridColumn Key="RelevancyToCostingID" Caption="成本核算相关" Visible="Macro_DebugMode()" Width="120px"/>
                                <GridColumn Key="PurchasingOrganizationID" Caption="采购组织" Width="80px"/>
                                <GridColumn Key="PurchasingGroupID" Caption="采购组" Width="80px"/>
                                <GridColumn Key="Price" Caption="价格" Width="80px"/>
                                <GridColumn Key="Dtl_CurrencyID" Caption="币种" Width="80px"/>
                                <GridColumn Key="PriceQuantity" Caption="价格数量" Width="100px"/>
                                <GridColumn Key="PriceUnitID" Caption="价格单位" Width="80px"/>
                                <GridColumn Key="VendorID" Caption="供应商" Width="80px"/>
                                <GridColumn Key="MaterialGroupID" Caption="物料组" Width="80px"/>
                                <GridColumn Key="CostElementID" Caption="成本要素" Width="80px"/>
                                <GridColumn Key="Size1" Caption="尺寸1" Width="80px"/>
                                <GridColumn Key="Size2" Caption="尺寸2" Width="80px"/>
                                <GridColumn Key="Size3" Caption="尺寸3" Width="80px"/>
                                <GridColumn Key="SizeUnitID" Caption="计量单位" Width="80px"/>
                                <GridColumn Key="FormulaID" Caption="公式码" Width="80px"/>
                                <GridColumn Key="SizeCount" Caption="尺寸可变项数目" Width="80px"/>
                                <GridColumn Key="SizeCount1" Caption="可变尺寸项数目" Width="100px"/>
                                <GridColumn Key="IsCompleteShipment" Caption="发料完成" Width="80px"/>
                                <GridColumn Key="PlanOrderComponentBillOID" Caption="SourcePlannedOrderDtlId" Visible="false" Width="80px"/>
                                <GridColumn Key="ReservationDtlOID" Caption="预留明细ID" Visible="false" Width="100px"/>
                                <GridColumn Key="ReservationItemNo" Caption="预留项目号" Visible="false" Width="100px"/>
                                <GridColumn Key="IsExistPurchaseOrder" Caption="存在采购订单" Enable="false" Width="100px"/>
                                <GridColumn Key="PurchaseReqSOID" Caption="采购申请" Width="80px"/>
                                <GridColumn Key="Dtl_GeneratorMethod" Caption="预留/采购申请" Width="80px"/>
                                <GridColumn Key="PurchaseRequisitionDtlOID" Caption="采购申请详情" Visible="false" Width="120px"/>
                                <GridColumn Key="PurchaseOrderItemNo" Caption="行号" Width="80px"/>
                                <GridColumn Key="Dtl_SpecialIdentity" Caption="特殊库存标识" Enable="!ReadOnly()&amp;&amp;IsDeleted==0" Width="120px"/>
                                <GridColumn Key="DynIdentityID" Caption="特殊库存" Width="80px"/>
                                <GridColumn Key="DynIdentityIDDEKey" Caption="特殊库存字典Key" Visible="false" Width="80px"/>
                                <GridColumn Key="CurrentItemLevel" Caption="当前级次" Visible="Macro_DebugMode()" Width="80px"/>
                                <GridColumn Key="CurrentItemRoute" Caption="当前路径" Visible="Macro_DebugMode()" Width="80px"/>
                                <GridColumn Key="ParentItemLevel" Caption="上级级次" Visible="Macro_DebugMode()" Width="80px"/>
                                <GridColumn Key="ParentItemRoute" Caption="上级路径" Visible="Macro_DebugMode()" Width="80px"/>
                                <GridColumn Key="BusinessNetScale" Caption="净业务数量比例" Visible="false" Width="100px"/>
                                <GridColumn Key="ManualFlag" Caption="人工修改标识" Visible="false" Width="120px"/>
                                <GridColumn Key="OriginalQuantity" Caption="原始数量" Visible="false" Width="100px"/>
                                <GridColumn Key="AfterCalcOriginalQuantity" Caption="原始数量" Visible="false" Width="100px"/>
                                <GridColumn Key="FollowupItem" Caption="后继项目" Visible="false" Width="80px"/>
                                <GridColumn Key="EndGroup" Caption="中止组" Visible="false" Width="80px"/>
                                <GridColumn Key="FollowupGroup" Caption="后继组" Visible="false" Width="80px"/>
                                <GridColumn Key="Priority" Caption="优先级" Visible="false" Width="80px"/>
                                <GridColumn Key="Strategy" Caption="策略" Visible="false" Width="80px"/>
                                <GridColumn Key="EnablePercent" Caption="使用可能性" Visible="false" Width="100px"/>
                                <GridColumn Key="Dtl_SrcSOID" Caption="SrcSOID" Visible="Macro_DebugMode()" Width="80px"/>
                                <GridColumn Key="Dtl_SrcOID" Caption="SrcOID" Visible="Macro_DebugMode()" Width="80px"/>
                                <GridColumn Key="Dtl_SrcDocumentNumber" Caption="SrcDocumentNumber" Visible="Macro_DebugMode()" Width="100px"/>
                                <GridColumn Key="Dtl_SrcFormKey" Caption="SrcFormKey" Visible="Macro_DebugMode()" Width="80px"/>
                                <GridColumn Key="Dtl_MapKey" Caption="MapKey" Visible="Macro_DebugMode()" Width="80px"/>
                                <GridColumn Key="Dtl_SOID" Visible="false" Width="80px"/>
                                <GridColumn Key="Dtl_Notes" Caption="项目文本" Visible="false" Enable="!ReadOnly()&amp;&amp;IsDeleted==0" Width="80px"/>
                                <GridColumn Key="Dtl_LackOfDelivery" Caption="发货不足" Visible="false" Width="80px"/>
                                <GridColumn Key="Dtl_ExcessiveDelivery" Caption="过量交货" Visible="false" Width="80px"/>
                                <GridColumn Key="IsBOMWithoutLimitDelivery" Caption="未限制过量交货" Visible="false" Width="80px"/>
                                <GridColumn Key="IsBOMCompleteReceipt" Caption="交货已完成" Visible="false" Width="100px"/>
                                <GridColumn Key="QuantityEnable" Caption="数量可用性控制" Visible="false" Width="80px"/>
                                <GridColumn Key="IsPIPE" Caption="管道物料" Visible="false" Width="80px"/>
                                <GridColumn Key="BO_IsLocked4MRP" Caption="锁定LKD" Visible="false" Width="80px"/>
                                <GridColumn Key="IsNewComponent" Caption="新增的组件" Visible="false" Width="80px"/>
                                <GridColumn Key="MaterialBOMDtlItemNo" Caption="BOM明细序号" Enable="false" Width="80px"/>
                                <GridColumn Key="Dtl_ExternalSystemPrimaryKey" Caption="外部系统关键字" Visible="false" Width="100px"/>
                            </GridColumnCollection>
                            <GridRowCollection>
                                <GridRow Key="ProductionOrderAssemblyGridRow" TableKey="EPP_ProductionOrder_BOM">
                                    <GridCell Key="IsSelect" Caption="选择" CellType="CheckBox" IsSelect="true"/>
                                    <GridCell Key="Dtl_OID" Caption="Dtl_OID" CellType="NumberEditor" CopyNew="false" Scale="0">
                                        <DataBinding ColumnKey="OID"/>
                                    </GridCell>
                                    <GridCell Key="ItemCategoryID" Caption="项目类别" CellType="Dict" ItemKey="PP_ItemCategory">
                                        <DataBinding ColumnKey="ItemCategoryID" Required="true">
                                            <ValueChanged>
                                                <![CDATA[com.bokesoft.erp.pp.masterdata.MaterialBOMFormula.checkPipeMaterialIsEnable(Dtl_MaterialID, ItemCategoryID)]]>
                                            </ValueChanged>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="Dtl_PlantID" Caption="工厂" CellType="Dict" Enable="false" ItemKey="Plant">
                                        <DataBinding ColumnKey="PlantID">
                                            <DefaultFormulaValue>
                                                <![CDATA[IIFS(IsDirectPurchase == 1, ProductPlantID, IsDirectPurchase == 0&&Dtl_MaterialID>0, com.bokesoft.erp.pp.function.CommonFormulaUtils.getPlantID_Issue(ProductPlantID,Dtl_MaterialID), true, 0)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="MaterialBOMDtlOID" Caption="MaterialBOMDtlOID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                        <DataBinding ColumnKey="MaterialBOMDtlOID"/>
                                    </GridCell>
                                    <GridCell Key="Dtl_MaterialID" Caption="物料" CellType="Dict" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;IIF(GetDictValue('PP_ItemCategory',ItemCategoryID, 'IsMaterial')==0,false,true)&amp;&amp;RequisiteQuantity&lt;=0&amp;&amp;IIF(IsCoProduct==1&amp;&amp;Dtl_MaterialID&gt;0&amp;&amp;Macro_GetOrgProp('Dtl_MaterialID', 'IsPPCoProduct', Dtl_PlantID)==1,false,true)" ItemKey="Material">
                                        <DataBinding ColumnKey="MaterialID">
                                            <ValueChanged>
                                                <![CDATA[com.bokesoft.erp.pp.masterdata.MaterialBOMFormula.checkPipeMaterialIsEnable(Dtl_MaterialID, ItemCategoryID);com.bokesoft.erp.pp.function.ProductionOrderFormula.AssemblyAttributetoProcessNo();IIF(IsCoProduct==1&&IsMultiProject==0&&Macro_GetOrgProp('Dtl_MaterialID', 'IsPPCoProduct', Dtl_PlantID)==1,com.bokesoft.erp.pp.function.ProductionOrderFormula.dealCoProduct(),true)]]>
                                            </ValueChanged>
                                            <CheckRule>
                                                <![CDATA[IIFS(GetDictValue('PP_ItemCategory', ItemCategoryID, 'IsMaterial')==1&&Dtl_MaterialID<=0,MessageFacade('PP_PRODUCTIONORDER016','必须输入物料，请检查'),IsCoProduct==1&&QuantityEnable==0&&Dtl_MaterialID>0&&Dtl_PlantID>0&&Macro_GetOrgProp('Dtl_MaterialID', 'IsPPCoProduct', Dtl_PlantID)==0,MessageFacade('29089','联产品不支持物料 ',GetDictValue('Material', Dtl_MaterialID, 'Code')),true,Macro_CheckMaterialStatus(ProductPlantID, Dtl_MaterialID, 'PONetItem', BasicStartDate, 'EPP_ProductionOrder_BOM', 'MaterialID'))]]>
                                            </CheckRule>
                                        </DataBinding>
                                        <ItemFilter ItemKey="Material">
                                            <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                <FilterValue Index="1" ParaValue="IIF(ProductPlantID&gt;0, 'OID IN ( Select EGS_Material_Plant.SOID FROM EGS_Material_Plant where  EGS_Material_Plant.PlantID='&amp;SqlPara(ProductPlantID)&amp;' and EGS_Material_Plant.Status_Plant&lt;&gt;'&amp;SqlPara(2)&amp;' )', '1=2')"/>
                                            </Filter>
                                        </ItemFilter>
                                    </GridCell>
                                    <GridCell Key="Description" Caption="描述" CellType="TextEditor" Enable="false">
                                        <DataBinding ColumnKey="ShortText">
                                            <DefaultFormulaValue>
                                                <![CDATA[IIFS(Dtl_MaterialID > 0, GetDictValue('Material', Dtl_MaterialID, 'Name'), GetDictValue('PP_ItemCategory', ItemCategoryID, 'IsTextProject') > 0 || IsDirectPurchase == 1, Dtl_Notes)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="Dtl_BaseUnitID" Caption="基本单位" CellType="Dict" Enable="false" ItemKey="Unit">
                                        <DataBinding ColumnKey="BaseUnitID">
                                            <DefaultFormulaValue>
                                                <![CDATA[IIF(Dtl_MaterialID>0,GetDictValue('Material', Dtl_MaterialID, 'BaseUnitID'),Dtl_BaseUnitID)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="Dtl_DivisionID" Caption="产品部门" CellType="Dict" ItemKey="Division">
                                        <DataBinding ColumnKey="DivisionID">
                                            <DefaultFormulaValue>
                                                <![CDATA[GetDictValue('Material', Dtl_MaterialID, 'DivisionID')]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="Dtl_UnitID" Caption="业务单位" CellType="Dict" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;IIF(IsCoProduct==1&amp;&amp;Dtl_UnitID&gt;0,false,true)" ItemKey="Unit">
                                        <DataBinding ColumnKey="UnitID">
                                            <ValueChanged>
                                                <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.calculationDemandBaseQuantityByUnitID(Dtl_OID)]]>
                                            </ValueChanged>
                                            <CheckRule>
                                                <![CDATA[IIFS(Dtl_UnitID==0&&IsDirectPurchase == 1, MessageFacade('PP_PRODUCTIONORDER068','请输入业务单位'),Dtl_UnitID>0&&!com.bokesoft.erp.pp.function.ProductionOrderFormula.businessUnitIDIsValid4Material(Dtl_MaterialID,Dtl_UnitID),MessageFacade('CO764','业务单位在物料主数据基本信息视图的计量单位表格中没有维护'),true,true)]]>
                                            </CheckRule>
                                            <DefaultFormulaValue>
                                                <![CDATA[IIFS(Dtl_MaterialID>0&&Macro_GetOrgProp('Dtl_MaterialID', 'IssueUnitID', Dtl_PlantID)>0, Macro_GetOrgProp('Dtl_MaterialID', 'IssueUnitID', Dtl_PlantID), Dtl_MaterialID>0, GetDictValue('Material', Dtl_MaterialID, 'BaseUnitID'), true, Dtl_UnitID)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                        <ItemFilter>
                                            <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                <FilterValue Index="1" ParaValue="IIF(Dtl_MaterialID&gt;0,'soid in ('&amp;com.bokesoft.erp.basis.unit.UnitFormula.getUnitFmMaterial(Dtl_MaterialID)&amp;')','1=1')"/>
                                            </Filter>
                                        </ItemFilter>
                                    </GridCell>
                                    <GridCell Key="Dtl_BOMBaseQuantity" Caption="BOM基本单位换算比例" CellType="NumberEditor" Enable="false" Scale="10">
                                        <DataBinding ColumnKey="BOMBaseQuantity"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="BOMQuantity" Caption="BOM业务单位换算比例" CellType="NumberEditor" Enable="false" Scale="10">
                                        <DataBinding ColumnKey="BOMQuantity" DefaultValue="1"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="DemandBaseQuantity" Caption="需求数量" CellType="NumberEditor" Enable="false" Scale="3">
                                        <DataBinding ColumnKey="DemandBaseQuantity"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="DemandQuantity" Caption="需求数量" CellType="NumberEditor" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;SubstituteProjectGroup==''&amp;&amp;!(DiscontinuationType==1 &amp;&amp; FollowupItem=='X')&amp;&amp;QuantityEnable==0" Scale="3">
                                        <DataBinding ColumnKey="DemandQuantity">
                                            <ValueChanged>
                                                <![CDATA[IIF(ItemCategoryID > 0, Macro_CheckDemandQty(ItemCategoryID, DemandQuantity, true, false), true); IIF(Abs(CommittedQuantity)>Abs(DemandQuantity),SetValue('CommittedQuantity',DemandQuantity));IIF(Dtl_BaseUnitNumerator!=0&&Dtl_BaseUnitDenominator!=0, SetPara('ChangeQuantity',Macro_SetScaleByUnit(DemandQuantity*Dtl_BaseUnitNumerator/Dtl_BaseUnitDenominator,Dtl_BaseUnitID,0)-DemandBaseQuantity), SetPara('ChangeQuantity',ToDecimal(0)));if(!isWFMapping()){IIFS(DiscontinuationType==0 && SubstituteProjectGroup=='', Macro_ModifyBusinessBOMDemandQuantity(),(SubstituteProjectGroup!=''||DiscontinuationType>0) && GetPara('ChangeQuantity')!=0,ConfirmMsg('PP_PRODUCTIONORDER018','是否调整原始数量',{{GetPara('ChangeQuantity')}}, 'YES_NO', {YES:{Macro_UpdateDmdQtyAndOrlQty(Dtl_OID,GetPara('ChangeQuantity'),false);},NO:{Macro_UpdateDmdQtyAndOrlQty(Dtl_OID,0,false);}}))};IIF(IsCoProduct==1,Macro_ReceiptChange());]]>
                                            </ValueChanged>
                                            <CheckRule>
                                                <![CDATA[IIFS(IsCoProduct==1&&DemandQuantity>0,MessageFacade('29088','勾选联产品时，数量应为负数'),SubstituteProjectGroup!=''&&ManualFlag==1&&OriginalQuantity*EnablePercent/100>Macro_SetScaleByUnit(OriginalQuantity,Dtl_UnitID,0),MessageFacade('PP_PRODUCTIONORDER017','需求数量不能大于原始数量'),((DiscontinuationType==1 && FollowupItem=='')||DiscontinuationType>1)&& DemandBaseQuantity>Macro_SetScaleByUnit(OriginalQuantity,Dtl_BaseUnitID,0),MessageFacade('PP_PRODUCTIONORDER017','需求数量不能大于原始数量'),true,true);]]>
                                            </CheckRule>
                                        </DataBinding>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="Dtl_BaseUnitNumerator" Caption="订单到基本单位-分子" CellType="NumberEditor" Precision="9" Scale="0" UseGroupingSeparator="false">
                                        <DataBinding ColumnKey="BaseUnitNumerator">
                                            <DefaultFormulaValue>
                                                <![CDATA[IIF(!isWFMapping(),IIF(Dtl_MaterialID>0&&Dtl_BaseUnitID>0&&Dtl_UnitID>0,com.bokesoft.erp.basis.unit.UnitFormula.getNume4MaTunit(Dtl_UnitID,Dtl_BaseUnitID,Dtl_MaterialID),1),Dtl_BaseUnitNumerator)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="Dtl_BaseUnitDenominator" Caption="订单到基本单位-分母" CellType="NumberEditor" Precision="9" Scale="0" UseGroupingSeparator="false">
                                        <DataBinding ColumnKey="BaseUnitDenominator">
                                            <DefaultFormulaValue>
                                                <![CDATA[IIF(!isWFMapping(),IIF(Dtl_MaterialID>0&&Dtl_BaseUnitID>0&&Dtl_UnitID>0,com.bokesoft.erp.basis.unit.UnitFormula.getDeno4MaTunit(Dtl_UnitID,Dtl_BaseUnitID,Dtl_MaterialID),1),Dtl_BaseUnitNumerator)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="CommittedQuantity" Caption="允许数量" CellType="NumberEditor" Enable="false" Scale="3">
                                        <DataBinding ColumnKey="CommittedQuantity"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="AllowQuantity" Caption="允许数量" CellType="NumberEditor" Scale="3">
                                        <DataBinding ColumnKey="AllowQuantity">
                                            <DefaultFormulaValue>
                                                <![CDATA[IIF(Dtl_BaseUnitDenominator!=0&&Dtl_BaseUnitNumerator!=0,Macro_SetScaleByUnit(CommittedQuantity*Dtl_BaseUnitDenominator/Dtl_BaseUnitNumerator,Dtl_UnitID,0),CommittedQuantity)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="ProcessSelect_Btn" Caption="工序选择" CellType="TextButton" Enable="!ReadOnly() &amp;&amp; IsDeleted == 0 &amp;&amp; ((IsBOMCompleteReceipt == 0 &amp;&amp; RequisiteBaseQuantity &lt;= 0) || (ProcessSelect_Btn == ''))" InvalidChars="%*\&quot;+?&gt;&lt;:'" MaxLength="100" Trim="true">
                                        <DataBinding ColumnKey="ProcessSelect">
                                            <ValueChanged>
                                                <![CDATA[IIF(IsVirtualAssembly == 1, com.bokesoft.erp.pp.function.ProductionOrderFormula.setProcessNo2VirtualMaterial(Dtl_OID,GetValue('ItemNoOld')), true);
                                                         IIF(
                                                                 Length(Trim(ProcessSelect_Btn))>0 && Length(Trim(GetValue('ItemNoOld'))),
                                                                 com.bokesoft.erp.pp.function.ProductionOrderFormula.setIsComponentAllocation(ProcessSelect_Btn,GetValue('ItemNoOld'))
                                                         );
                                                         IIF(Macro_IsProcessOrder(),Macro_SetSuperiorProcessNo2BOM(ProcessSelect_Btn))]]>
                                            </ValueChanged>
                                            <CheckRule>
                                                <![CDATA[IIF(Dtl_MaterialID>0||IsDirectPurchase == 1,com.bokesoft.erp.pp.function.ProductionOrderFormula.checkAttributeAssemblytoProcess(ProcessSelect_Btn),true)]]>
                                            </CheckRule>
                                        </DataBinding>
                                        <OnClick>
                                            <![CDATA[SetPara('ProcessSelectResult', 0);ERPShowModal('PP_ProductProcessSelect');]]>
                                        </OnClick>
                                    </GridCell>
                                    <GridCell Key="IsPhaseIndicator" Caption="阶段指示符" CellType="CheckBox">
                                        <DataBinding ColumnKey="IsPhaseIndicator"/>
                                    </GridCell>
                                    <GridCell Key="SuperiorItemNo" Caption="上级工序" CellType="TextEditor" MaxLength="30">
                                        <DataBinding ColumnKey="SuperiorItemNo"/>
                                    </GridCell>
                                    <GridCell Key="WorkCenterID" Caption="工作中心" CellType="Dict" Enable="false" ItemKey="WorkCenter">
                                        <DataBinding ColumnKey="WorkCenterID">
                                            <DefaultFormulaValue>
                                                <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.getWorkCenterIDByProcessNo(ProcessSelect_Btn)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="IsCore" Caption="关键物料" CellType="CheckBox">
                                        <DataBinding ColumnKey="IsCore"/>
                                    </GridCell>
                                    <GridCell Key="IsAssembly" Caption="组件" CellType="CheckBox" Enable="false">
                                        <DataBinding ColumnKey="IsAssembly">
                                            <DefaultFormulaValue>
                                                <![CDATA[GetDictValue('Material', Dtl_MaterialID, 'IsHasAssembly')]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="IsDeleted" Caption="已删除" CellType="CheckBox" Enable="!ReadOnly()&amp;&amp;IsDeleted==0">
                                        <DataBinding ColumnKey="IsDeleted" ValueChanged="Macro_CheckBeforeDeleteComponent()"/>
                                    </GridCell>
                                    <GridCell Key="IsDirectPurchase" Caption="直接采购" CellType="CheckBox" Enable="false">
                                        <DataBinding ColumnKey="IsDirectPurchase" DefaultFormulaValue="IsPIPE==0&amp;&amp;Macro_IsNonStockItem(ItemCategoryID)"/>
                                    </GridCell>
                                    <GridCell Key="IsVirtualAssembly" Caption="虚拟件" CellType="CheckBox" Enable="false">
                                        <DataBinding ColumnKey="IsVirtualAssembly">
                                            <DefaultFormulaValue>
                                                <![CDATA[com.bokesoft.erp.pp.masterdata.MaterialBOMFormula.getVirtualAssemblyByMaterial(Dtl_PlantID,Dtl_MaterialID)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="SortItem" Caption="排序字符串" CellType="TextEditor">
                                        <DataBinding ColumnKey="SortItem"/>
                                    </GridCell>
                                    <GridCell Key="Dtl_StorageLocationID" Caption="库存地点" CellType="Dict" ItemKey="StorageLocation">
                                        <DataBinding ColumnKey="StorageLocationID" ValueChanged="SetValue('CommittedQuantity',0)">
                                            <DefaultFormulaValue>
                                                <![CDATA[IIF(Dtl_StorageLocationID<=0,Macro_GetOrgProp('Dtl_MaterialID', IIF(Macro_GetOrgProp('Dtl_MaterialID','PPPurType',Dtl_PlantID)=='F'&&Macro_GetOrgProp('Dtl_MaterialID','PPProductStorageLocationID',Dtl_PlantID)<=0,'PPPurStorageLocationID','PPProductStorageLocationID'), Dtl_PlantID),Dtl_StorageLocationID)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                        <ItemFilter ItemKey="StorageLocation">
                                            <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                <FilterValue Index="1" ParaValue="IIF(Dtl_PlantID&gt;0, 'PlantID='&amp;SqlPara(Dtl_PlantID), '1=2')"/>
                                            </Filter>
                                        </ItemFilter>
                                    </GridCell>
                                    <GridCell Key="Dtl_StoragePointID" Caption="子库" CellType="Dict" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;com.bokesoft.erp.wmsintegration.WMSIntegrationFormula.enabledWhenStoragePoint(Dtl_PlantID,Dtl_StorageLocationID)" ItemKey="StoragePoint">
                                        <DataBinding ColumnKey="StoragePointID"/>
                                        <ItemFilter ItemKey="StoragePoint">
                                            <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                <FilterValue Index="1" ParaValue="IIF(Dtl_StorageLocationID&gt;0, 'soid in ('&amp;com.bokesoft.erp.wmsintegration.WMSIntegrationFormula.getStoragePointFilter4StorageLocation(Dtl_PlantID,Dtl_StorageLocationID)&amp;')', '1=2')"/>
                                            </Filter>
                                        </ItemFilter>
                                    </GridCell>
                                    <GridCell Key="BatchCode_Btn" Caption="批次" CellType="TextButton" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;Macro_MaterialIsBatchManagement(Dtl_PlantID,Dtl_MaterialID)&amp;&amp;RequisiteQuantity&lt;=0" Case="Upper" MaxLength="30" Trim="true">
                                        <DataBinding ColumnKey="BatchCode" DefaultValue="_">
                                            <CheckRule>
                                                <![CDATA[IIF(
                                                                 BatchCode_Btn!='_'&&Length(BatchCode_Btn)>0, IIF(
                                                            com.bokesoft.erp.mm.batchcode.BatchCodeFormula.displayBatchcodeByStorageLocation(Dtl_MaterialID,Dtl_PlantID,Dtl_StorageLocationID,Dtl_StoragePointID,BatchCode_Btn,Dtl_SpecialIdentity,com.bokesoft.erp.mm.stock.MovementTypeFormula.getStockTypeByMoveTypeID(GetDictOID('MoveType', 'Code', '261')))==0,
                                                            MessageFacade('PP_PRODUCTIONORDER019','物料没有该库存地点的批次库存'),true),true)]]>
                                            </CheckRule>
                                        </DataBinding>
                                        <OnClick>
                                            <![CDATA[Macro_SetBatchCode(-1, Dtl_PlantID, Dtl_MaterialID, 'Dtl_StorageLocationID', 'Dtl_StoragePointID', 1, '_', DynIdentityID,'BatchCode_Btn', 'DemandBaseQuantity')]]>
                                        </OnClick>
                                    </GridCell>
                                    <GridCell Key="IsAlternativeItem" Caption="备选项目" CellType="CheckBox" Enable="false">
                                        <DataBinding ColumnKey="IsAlternativeItem" DefaultFormulaValue="IIF(SubstituteProjectGroup!='', 1, 0)"/>
                                    </GridCell>
                                    <GridCell Key="SubstituteProjectGroup" Caption="替代项目组" CellType="TextEditor">
                                        <DataBinding ColumnKey="SubstituteProjectGroup">
                                            <ValueChanged>
                                                <![CDATA[if(!isWFMapping()){IIF(SubstituteProjectGroup!='',SetValue('DemandQuantity',OriginalQuantity*EnablePercent/100,false),false);}]]>
                                            </ValueChanged>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="ProcessLossRate" Caption="工序废品按(%)" CellType="NumberEditor" Enable="false" Precision="5">
                                        <DataBinding ColumnKey="ProcessLossRate"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="IsNetID" Caption="净ID" CellType="CheckBox">
                                        <DataBinding ColumnKey="IsNetID"/>
                                    </GridCell>
                                    <GridCell Key="AssemblyLossRate" Caption="部件废品(%)" CellType="NumberEditor" Enable="false" Precision="5">
                                        <DataBinding ColumnKey="AssemblyLossRate">
                                            <DefaultFormulaValue>
                                                <![CDATA[Macro_GetOrgProp('Dtl_MaterialID', 'PPComponentsScrapRate', Dtl_PlantID)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="IsCoProduct" Caption="联产品" CellType="CheckBox" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;ItemCategoryID&lt;=0">
                                        <DataBinding ColumnKey="IsCoProduct"/>
                                    </GridCell>
                                    <GridCell Key="IsBulkMaterial" Caption="散装物料" CellType="CheckBox" Enable="!ReadOnly()&amp;&amp;IsDeleted==0">
                                        <DataBinding ColumnKey="IsBulkMaterial"/>
                                    </GridCell>
                                    <GridCell Key="DiscontinuationType" Caption="中止" CellType="ComboBox" TextShowType="Caption" GroupKey="DiscontinuationTypeGroup" SourceType="ParaGroup">
                                        <DataBinding ColumnKey="DiscontinuationType"/>
                                    </GridCell>
                                    <GridCell Key="IsQuantityFixed" Caption="固定数量" CellType="CheckBox">
                                        <DataBinding ColumnKey="IsFixedQuantity"/>
                                    </GridCell>
                                    <GridCell Key="IsAllowMove" Caption="允许移动" CellType="CheckBox" Enable="false">
                                        <DataBinding ColumnKey="IsAllowMove">
                                            <DefaultFormulaValue>
                                                <![CDATA[IIF(DemandQuantity>0 && IsVirtualAssembly==0, com.bokesoft.erp.pp.function.ProductionOrderFormula.calcIsAllowMoveDefaultValue(Dtl_OID), 0)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="RequisiteQuantity" Caption="领料数量" CellType="NumberEditor" Enable="false" Scale="3">
                                        <DataBinding ColumnKey="RequisiteQuantity"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="RequisiteBaseQuantity" Caption="领料数量（基本）" CellType="NumberEditor" Enable="false" Scale="3">
                                        <DataBinding ColumnKey="RequisiteBaseQuantity"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="RequirementDate" Caption="需求日期" CellType="UTCDatePicker">
                                        <DataBinding ColumnKey="RequirementDate" DefaultFormulaValue="BasicStartDate"/>
                                    </GridCell>
                                    <GridCell Key="PickingApplyQuantity" Caption="领料申请数量" CellType="NumberEditor" Scale="3">
                                        <DataBinding ColumnKey="PickingApplyQuantity"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="ReturnApplyQuantity" Caption="退料申请数量" CellType="NumberEditor" Scale="3">
                                        <DataBinding ColumnKey="ReturnApplyQuantity"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="MoveTypeID" Caption="移动类型" CellType="Dict" Enable="false" ItemKey="MoveType">
                                        <DataBinding ColumnKey="MoveTypeID" ValueDependency="RT_ItemNo, RT_IsOutsourcing, RT_ControlCodeID">
                                            <DefaultFormulaValue>
                                                <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.getMoveTypeIDByProcess(ProcessSelect_Btn, IsCoProduct, DemandQuantity)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="IsBacklash" Caption="反冲" CellType="CheckBox" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;IsVirtualAssembly==0&amp;&amp;IsCoProduct&lt;=0&amp;&amp;IIF(Macro_IsProcessOrder(),IsPhaseIndicator&gt;0,true)&amp;&amp;IsBulkMaterial==0">
                                        <DataBinding ColumnKey="IsBacklash">
                                            <DefaultFormulaValue>
                                                <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.getBlackFlush(ProcessSelect_Btn,Dtl_MaterialID,Dtl_OID)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="MaterialSupplyIndicator" Caption="物料供应标识" CellType="ComboBox" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;IsDirectPurchase == 1" GroupKey="MaterialSupplyLogo" SourceType="ParaGroup">
                                        <DataBinding ColumnKey="MaterialSupplyIndicator"/>
                                    </GridCell>
                                    <GridCell Key="RelevancyToCostingID" Caption="成本核算相关" CellType="Dict" Enable="false" ItemKey="PP_RelevancyToCosting">
                                        <DataBinding ColumnKey="RelevancyToCostingID"/>
                                    </GridCell>
                                    <GridCell Key="PurchasingOrganizationID" Caption="采购组织" CellType="Dict" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;IsDirectPurchase == 1" ItemKey="PurchasingOrganization">
                                        <DataBinding ColumnKey="PurchasingOrganizationID"/>
                                        <ItemFilter ItemKey="PurchasingOrganization">
                                            <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                <FilterValue Index="1" ParaValue="IIF(Dtl_PlantID&gt;0, ' soid IN(Select  purchasingorganizationid from EMM_PurchasingOrgPlantRelation where plantid='&amp;SqlPara(Dtl_PlantID)&amp;')', '1=2')"/>
                                            </Filter>
                                        </ItemFilter>
                                    </GridCell>
                                    <GridCell Key="PurchasingGroupID" Caption="采购组" CellType="Dict" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;IsDirectPurchase == 1" ItemKey="PurchasingGroup">
                                        <DataBinding ColumnKey="PurchasingGroupID">
                                            <CheckRule>
                                                <![CDATA[IIF(IsPIPE == 1 || IsDirectPurchase == 0||(IsDirectPurchase == 1&&PurchasingGroupID>0),true,MessageFacade('PP_PRODUCTIONORDER021','非库存项目请输入采购组'))]]>
                                            </CheckRule>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="Price" Caption="价格" CellType="NumberEditor" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;IsDirectPurchase == 1" Scale="6">
                                        <DataBinding ColumnKey="Price">
                                            <CheckRule>
                                                <![CDATA[IIF(IsDirectPurchase == 0||(IsDirectPurchase == 1&&Price>0),true,MessageFacade('PP_PRODUCTIONORDER022','非库存项目请输入价格'))]]>
                                            </CheckRule>
                                        </DataBinding>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="Dtl_CurrencyID" Caption="币种" CellType="Dict" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;IsDirectPurchase == 1" ItemKey="Currency">
                                        <DataBinding ColumnKey="CurrencyID">
                                            <CheckRule>
                                                <![CDATA[IIF(IsDirectPurchase == 1&&Dtl_CurrencyID<=0,MessageFacade('PP_PRODUCTIONORDER023','非库存项目，请输入币种'),true)]]>
                                            </CheckRule>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="PriceQuantity" Caption="价格数量" CellType="NumberEditor" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;IsDirectPurchase == 1" Scale="3">
                                        <DataBinding ColumnKey="PriceQuantity" CheckRule="IIF(IsDirectPurchase == 1,PriceQuantity&gt;0,true)"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="PriceUnitID" Caption="价格单位" CellType="Dict" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;IsDirectPurchase == 1" ItemKey="Unit">
                                        <DataBinding ColumnKey="PriceUnitID">
                                            <CheckRule>
                                                <![CDATA[IIF(IsDirectPurchase == 1 && PriceUnitID == 0, MessageFacade('PP_PRODUCTIONORDER070', '请输入价格单位'), true)]]>
                                            </CheckRule>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="VendorID" Caption="供应商" CellType="Dict" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;IsDirectPurchase == 1" ItemKey="Vendor">
                                        <DataBinding ColumnKey="VendorID"/>
                                    </GridCell>
                                    <GridCell Key="MaterialGroupID" Caption="物料组" CellType="Dict" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;IsDirectPurchase == 1" ItemKey="MaterialGroup">
                                        <DataBinding ColumnKey="MaterialGroupID">
                                            <CheckRule>
                                                <![CDATA[IIF(IsDirectPurchase == 0||(IsDirectPurchase == 1&&MaterialGroupID>0),true,MessageFacade('PP_PRODUCTIONORDER024','非库存项目请输入物料组'))]]>
                                            </CheckRule>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="CostElementID" Caption="成本要素" CellType="Dict" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;IsDirectPurchase == 1" ItemKey="CO_CostElement">
                                        <DataBinding ColumnKey="CostElementID">
                                            <CheckRule>
                                                <![CDATA[IIF(IsDirectPurchase == 0||(IsDirectPurchase == 1&&CostElementID>0),true,MessageFacade('PP_PRODUCTIONORDER025','非库存项目请输入成本要素'))]]>
                                            </CheckRule>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="Size1" Caption="尺寸1" CellType="NumberEditor" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;GetDictValue('PP_ItemCategory', ItemCategoryID, 'Code')=='IsR'" Scale="3">
                                        <DataBinding ColumnKey="Size1">
                                            <CheckRule>
                                                <![CDATA[IIF(GetDictValue('PP_ItemCategory', ItemCategoryID, 'Code')!='IsR'||(GetDictValue('PP_ItemCategory', ItemCategoryID, 'Code')=='IsR'&&Size1>0),true,MessageFacade('PP_PRODUCTIONORDER026','可变项目请输入尺寸'))]]>
                                            </CheckRule>
                                        </DataBinding>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="Size2" Caption="尺寸2" CellType="NumberEditor" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;GetDictValue('PP_ItemCategory', ItemCategoryID, 'Code')=='IsR'" Scale="3">
                                        <DataBinding ColumnKey="Size2">
                                            <CheckRule>
                                                <![CDATA[IIF(GetDictValue('PP_ItemCategory', ItemCategoryID, 'Code')!='IsR'||(GetDictValue('PP_ItemCategory', ItemCategoryID, 'Code')=='IsR'&&Size2>0),true,MessageFacade('PP_PRODUCTIONORDER026','可变项目请输入尺寸'))]]>
                                            </CheckRule>
                                        </DataBinding>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="Size3" Caption="尺寸3" CellType="NumberEditor" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;GetDictValue('PP_ItemCategory', ItemCategoryID, 'Code')=='IsR'" Scale="3">
                                        <DataBinding ColumnKey="Size3">
                                            <CheckRule>
                                                <![CDATA[IIF(GetDictValue('PP_ItemCategory', ItemCategoryID, 'Code')!='IsR'||(GetDictValue('PP_ItemCategory', ItemCategoryID, 'Code')=='IsR'&&Size3>0),true,MessageFacade('PP_PRODUCTIONORDER026','可变项目请输入尺寸'))]]>
                                            </CheckRule>
                                        </DataBinding>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="SizeUnitID" Caption="计量单位" CellType="Dict" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;GetDictValue('PP_ItemCategory', ItemCategoryID, 'Code')=='IsR'" ItemKey="Unit">
                                        <DataBinding ColumnKey="SizeUnitID">
                                            <CheckRule>
                                                <![CDATA[IIF(GetDictValue('PP_ItemCategory', ItemCategoryID, 'Code')!='IsR'||(GetDictValue('PP_ItemCategory', ItemCategoryID, 'Code')=='IsR'&&SizeUnitID>0),true,MessageFacade('PP_PRODUCTIONORDER029','可变项目请输入计量单位'))]]>
                                            </CheckRule>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="FormulaID" Caption="公式码" CellType="Dict" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;GetDictValue('PP_ItemCategory', ItemCategoryID, 'Code')=='IsR'" ItemKey="PP_Formula">
                                        <DataBinding ColumnKey="FormulaID">
                                            <ValueChanged>
                                                <![CDATA[SetValue('SizeCount1', Macro_CalculatorSizeResult(Dtl_MaterialID, Dtl_BaseUnitID));]]>
                                            </ValueChanged>
                                            <CheckRule>
                                                <![CDATA[IIF(GetDictValue('PP_ItemCategory', ItemCategoryID, 'Code')!='IsR'||(GetDictValue('PP_ItemCategory', ItemCategoryID, 'Code')=='IsR'&&FormulaID>0),true,MessageFacade('PP_PRODUCTIONORDER030','可变项目请输入公式码'))]]>
                                            </CheckRule>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="SizeCount" Caption="尺寸可变项数目" CellType="NumberEditor" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;GetDictValue('PP_ItemCategory', ItemCategoryID, 'Code')=='IsR'" Scale="3">
                                        <DataBinding ColumnKey="SizeCount" DefaultValue="1"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="SizeCount1" Caption="可变尺寸项数量" CellType="NumberEditor" Enable="false" Scale="3">
                                        <DataBinding ColumnKey="SizeCount1"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="IsCompleteShipment" Caption="发料完成" CellType="CheckBox" Enable="false">
                                        <DataBinding ColumnKey="IsCompleteShipment"/>
                                    </GridCell>
                                    <GridCell Key="PlanOrderComponentBillOID" Caption="SourcePlannedOrderDtlId" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                        <DataBinding ColumnKey="PlanOrderComponentBillOID"/>
                                    </GridCell>
                                    <GridCell Key="ReservationDtlOID" Caption="预留明细ID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                        <DataBinding ColumnKey="ReservationDtlOID"/>
                                    </GridCell>
                                    <GridCell Key="ReservationItemNo" Caption="预留项目号" CellType="NumberEditor" Precision="9" Scale="0" UseGroupingSeparator="false">
                                        <DataBinding ColumnKey="ReservationItemNo"/>
                                    </GridCell>
                                    <GridCell Key="IsExistPurchaseOrder" Caption="存在采购订单" CellType="CheckBox">
                                        <DataBinding ColumnKey="IsExistPurchaseOrder">
                                            <DefaultFormulaValue>
                                                <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.isExistPurchaseOrder(PurchaseReqSOID, PurchaseOrderItemNo)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="PurchaseReqSOID" Caption="采购申请" CellType="Dict" Enable="false" ItemKey="MM_PurchaseRequisition__Dic" StateMask="Enable|Disable|Discard">
                                        <DataBinding ColumnKey="PurchaseReqSOID"/>
                                    </GridCell>
                                    <GridCell Key="Dtl_GeneratorMethod" Caption="预留/采购申请" CellType="ComboBox" Enable="false" GroupKey="GenerateControl" SourceType="ParaGroup">
                                        <DataBinding ColumnKey="GeneratorMethod">
                                            <DefaultFormulaValue>
                                                <![CDATA[IIF(IsHasRelease>0 && GeneratorMethod!=1, 3, GeneratorMethod)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="PurchaseRequisitionDtlOID" Caption="采购申请详情" CellType="NumberEditor" Scale="0">
                                        <DataBinding ColumnKey="PurchaseRequisitionDtlOID"/>
                                    </GridCell>
                                    <GridCell Key="PurchaseOrderItemNo" Caption="行号" CellType="NumberEditor" Enable="false" Precision="9" Scale="0" UseGroupingSeparator="false">
                                        <DataBinding ColumnKey="PurchaseOrderItemNo"/>
                                    </GridCell>
                                    <GridCell Key="Dtl_SpecialIdentity" Caption="特殊库存标识" CellType="ComboBox" GroupKey="SpecialIdentity" SourceType="ParaGroup">
                                        <DataBinding ColumnKey="SpecialIdentity">
                                            <DefaultFormulaValue>
                                                <![CDATA[IIFS(
                                                                 Macro_GetOrgProp('Dtl_MaterialID', 'IndividualOrCollective', Dtl_PlantID) == 2, '_',
                                                                 GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'InternalCode')=='Q', 'Q',
                                                                 IsPIPE > 0, 'P',
                                                                 SaleOrderSOID > 0 && Dtl_MaterialID > 0 && Dtl_PlantID > 0 && Macro_GetOrgProp('Dtl_MaterialID', 'IndividualOrCollective', Dtl_PlantID) != 2, SpecialIdentity,
                                                                 MaterialSupplyIndicator == 'K', 'B',
                                                                 true,'_')]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="DynIdentityID" Caption="特殊库存" CellType="DynamicDict" Enable="IsDeleted==0&amp;&amp;IIF(!ReadOnly()&amp;&amp;(Dtl_SpecialIdentity=='B' || Dtl_SpecialIdentity=='Q'),true,false)" IsDynamic="true" RefDataElementKey="DynIdentityIDDEKey">
                                        <DataBinding ColumnKey="DynIdentityID" CheckRule="Macro_SpecialStockCheckRule()">
                                            <DefaultFormulaValue>
                                                <![CDATA[IIF((Dtl_SpecialIdentity=='E'||Dtl_SpecialIdentity=='Q')&&Dtl_MaterialID>0&&Dtl_PlantID>0&&Macro_GetOrgProp('Dtl_MaterialID', 'IndividualOrCollective', Dtl_PlantID)!=2,IIFS(Dtl_SpecialIdentity=='E', SaleOrderDtlOID, Dtl_SpecialIdentity=='Q', WBSElementID, true, 0),0)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="DynIdentityIDDEKey" Caption="特殊库存字典Key" CellType="TextEditor">
                                        <DataBinding ColumnKey="DynIdentityIDDEKey" DefaultFormulaValue="Macro_GetIdentityDataElementKey(Dtl_SpecialIdentity)"/>
                                    </GridCell>
                                    <GridCell Key="CurrentItemLevel" Caption="当前级次" CellType="NumberEditor" Enable="false" Precision="9" Scale="0" UseGroupingSeparator="false">
                                        <DataBinding ColumnKey="CurrentItemLevel"/>
                                    </GridCell>
                                    <GridCell Key="CurrentItemRoute" Caption="当前路径" CellType="NumberEditor" Enable="false" Precision="9" Scale="0" UseGroupingSeparator="false">
                                        <DataBinding ColumnKey="CurrentItemRoute"/>
                                    </GridCell>
                                    <GridCell Key="ParentItemLevel" Caption="上级级次" CellType="NumberEditor" Enable="false" Precision="9" Scale="0" UseGroupingSeparator="false">
                                        <DataBinding ColumnKey="ParentItemLevel"/>
                                    </GridCell>
                                    <GridCell Key="ParentItemRoute" Caption="上级路径" CellType="NumberEditor" Enable="false" Precision="9" Scale="0" UseGroupingSeparator="false">
                                        <DataBinding ColumnKey="ParentItemRoute"/>
                                    </GridCell>
                                    <GridCell Key="BusinessNetScale" Caption="净业务数量比例" CellType="NumberEditor" Scale="10">
                                        <DataBinding ColumnKey="BusinessNetScale"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="ManualFlag" Caption="人工修改标识">
                                        <DataBinding ColumnKey="ManualFlag"/>
                                    </GridCell>
                                    <GridCell Key="OriginalQuantity" Caption="原始数量" CellType="NumberEditor" Enable="!ReadOnly()&amp;&amp;IIF(FollowupItem!='' &amp;&amp; FollowupGroup=='',false,true)&amp;&amp;(SubstituteProjectGroup!='' || DiscontinuationType&gt;0 || FollowupItem=='X')" Scale="3">
                                        <DataBinding ColumnKey="OriginalQuantity">
                                            <ValueChanged>
                                                <![CDATA[if(!isWFMapping()){Macro_UpdateDmdQtyAndOrlQty(Dtl_OID,0,true)};]]>
                                            </ValueChanged>
                                            <DefaultFormulaValue>
                                                <![CDATA[IIF(DiscontinuationType==1&&FollowupItem=='X', 0, OriginalQuantity)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="AfterCalcOriginalQuantity" Caption="原始数量" CellType="NumberEditor" Scale="3">
                                        <DataBinding ColumnKey="AfterCalcOriginalQuantity">
                                            <ValueChanged>
                                                <![CDATA[SetValue('OriginalQuantity', AfterCalcOriginalQuantity, true);SetValue('AfterCalcOriginalQuantity', Macro_SetScaleByUnit(AfterCalcOriginalQuantity,Dtl_BaseUnitID,0), false);]]>
                                            </ValueChanged>
                                            <DefaultFormulaValue>
                                                <![CDATA[IIF(ManualFlag==1, Macro_SetScaleByUnit(OriginalQuantity,Dtl_BaseUnitID,0), OriginalQuantity)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="FollowupItem" Caption="后继项目" CellType="TextEditor">
                                        <DataBinding ColumnKey="FollowupItem"/>
                                    </GridCell>
                                    <GridCell Key="EndGroup" Caption="中止组" CellType="TextEditor">
                                        <DataBinding ColumnKey="EndGroup"/>
                                    </GridCell>
                                    <GridCell Key="FollowupGroup" Caption="后继组" CellType="TextEditor">
                                        <DataBinding ColumnKey="FollowupGroup"/>
                                    </GridCell>
                                    <GridCell Key="Priority" Caption="优先级" CellType="NumberEditor" Enable="!ReadOnly()&amp;&amp;SubstituteProjectGroup!=''" Precision="9" Scale="0">
                                        <DataBinding ColumnKey="Priority"/>
                                    </GridCell>
                                    <GridCell Key="Strategy" Caption="策略" CellType="ComboBox" GroupKey="CheckStrategy" SourceType="ParaGroup">
                                        <DataBinding ColumnKey="Strategy"/>
                                    </GridCell>
                                    <GridCell Key="EnablePercent" Caption="使用可能性" CellType="NumberEditor" Precision="3" Scale="0">
                                        <DataBinding ColumnKey="EnablePercent">
                                            <ValueChanged>
                                                <![CDATA[if(!isWFMapping()){Macro_CheckSumEnablePercent();};]]>
                                            </ValueChanged>
                                            <CheckRule>
                                                <![CDATA[IIF(EnablePercent<0,MessageFacade('PP_PRODUCTIONORDER037','输入内容不在有效范围0到100'),true)]]>
                                            </CheckRule>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="Dtl_SrcSOID" Caption="SrcSOID" CellType="NumberEditor" Enable="false" Scale="0">
                                        <DataBinding ColumnKey="SrcSOID"/>
                                    </GridCell>
                                    <GridCell Key="Dtl_SrcOID" Caption="SrcOID" CellType="NumberEditor" Enable="false" Scale="0">
                                        <DataBinding ColumnKey="SrcOID"/>
                                    </GridCell>
                                    <GridCell Key="Dtl_SrcDocumentNumber" Caption="SrcDocumentNumber" CellType="TextEditor" Enable="false">
                                        <DataBinding ColumnKey="SrcDocumentNumber"/>
                                    </GridCell>
                                    <GridCell Key="Dtl_SrcFormKey" Caption="SrcFormKey" CellType="TextEditor" Enable="false">
                                        <DataBinding ColumnKey="SrcFormKey"/>
                                    </GridCell>
                                    <GridCell Key="Dtl_MapKey" Caption="MapKey" CellType="TextEditor" Enable="false">
                                        <DataBinding ColumnKey="MapKey"/>
                                    </GridCell>
                                    <GridCell Key="Dtl_SOID" CellType="NumberEditor" CopyNew="false" Scale="0">
                                        <DataBinding ColumnKey="SOID"/>
                                    </GridCell>
                                    <GridCell Key="Dtl_Notes" Caption="项目文本" CellType="TextEditor">
                                        <DataBinding ColumnKey="Notes">
                                            <CheckRule>
                                                <![CDATA[IIF(Dtl_MaterialID == 0 && Length(Dtl_Notes) == 0 && IsDirectPurchase == 1, MessageFacade('PP_PRODUCTIONORDER069','请输入项目文本'), true)]]>
                                            </CheckRule>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="Dtl_LackOfDelivery" Caption="发货不足" CellType="NumberEditor" Precision="3" Scale="1">
                                        <DataBinding ColumnKey="LackOfDelivery">
                                            <ValueChanged>
                                                <![CDATA[IIF(Dtl_MaterialID==MaterialID, SetValue('LackOfDelivery',Dtl_LackOfDelivery))]]>
                                            </ValueChanged>
                                            <DefaultFormulaValue>
                                                <![CDATA[IIF(Dtl_MaterialID==MaterialID,LackOfDelivery,Macro_GetOrgProp('Dtl_MaterialID','WorkingPlan_UnderdelyTolerance',Dtl_PlantID))]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="Dtl_ExcessiveDelivery" Caption="过量交货" CellType="NumberEditor" Precision="3" Scale="1">
                                        <DataBinding ColumnKey="ExcessiveDelivery">
                                            <ValueChanged>
                                                <![CDATA[IIF(Dtl_MaterialID==MaterialID, SetValue('ExcessiveDelivery',Dtl_ExcessiveDelivery))]]>
                                            </ValueChanged>
                                            <CheckRule>
                                                <![CDATA[IIF(IsBOMWithoutLimitDelivery==1&&Dtl_ExcessiveDelivery!=0,MessageFacade('CO141','过量交货与未限制过量交货不允许同时维护'),true)]]>
                                            </CheckRule>
                                            <DefaultFormulaValue>
                                                <![CDATA[IIF(Dtl_MaterialID==MaterialID,ExcessiveDelivery,Macro_GetOrgProp('Dtl_MaterialID','WorkingPlan_OverdelyTolerance',Dtl_PlantID))]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="IsBOMWithoutLimitDelivery" Caption="未限制过量交货" CellType="CheckBox">
                                        <DataBinding ColumnKey="IsBOMWithoutLimitDelivery">
                                            <ValueChanged>
                                                <![CDATA[IIF(Dtl_MaterialID==MaterialID, SetValue('IsWithoutLimitDelivery',IsBOMWithoutLimitDelivery))]]>
                                            </ValueChanged>
                                            <CheckRule>
                                                <![CDATA[IIF(IsBOMWithoutLimitDelivery==1&&Dtl_ExcessiveDelivery!=0,MessageFacade('CO141','过量交货与未限制过量交货不允许同时维护'),true)]]>
                                            </CheckRule>
                                            <DefaultFormulaValue>
                                                <![CDATA[IIF(Dtl_MaterialID==MaterialID,IsWithoutLimitDelivery,Macro_GetOrgProp('Dtl_MaterialID','WorkingPlan_IsUnlimited',Dtl_PlantID))]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="IsBOMCompleteReceipt" Caption="交货已完成" CellType="CheckBox">
                                        <DataBinding ColumnKey="IsBOMCompleteReceipt">
                                            <ValueChanged>
                                                <![CDATA[IIF(Dtl_MaterialID==MaterialID,SetValue('IsCompleteReceipt',IsBOMCompleteReceipt))]]>
                                            </ValueChanged>
                                            <DefaultFormulaValue>
                                                <![CDATA[IIF(Dtl_MaterialID==MaterialID,IsCompleteReceipt,IsBOMCompleteReceipt)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="QuantityEnable" Caption="数量可用性控制" CellType="ComboBox">
                                        <DataBinding ColumnKey="QuantityEnable"/>
                                        <Item Key="0" Caption="可以修改" Value="0"/>
                                        <Item Key="1" Caption="不能修改" Value="1"/>
                                    </GridCell>
                                    <GridCell Key="IsPIPE" Caption="管道物料" CellType="CheckBox">
                                        <DataBinding ColumnKey="IsPIPE">
                                            <DefaultFormulaValue>
                                                <![CDATA[IIF(Dtl_MaterialID>0&&com.bokesoft.erp.mm.masterdata.MaterialFormula.isPipelineMaterial(Dtl_MaterialID),1,0)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="BO_IsLocked4MRP" Caption="在MRP中锁定" CellType="CheckBox">
                                        <DataBinding ColumnKey="IsLocked4MRP"/>
                                    </GridCell>
                                    <GridCell Key="IsNewComponent" Caption="新增的组件" CellType="CheckBox">
                                        <DataBinding ColumnKey="IsNewComponent">
                                            <DefaultFormulaValue>
                                                <![CDATA[IIF(IsNewComponent == 1, 1, com.bokesoft.erp.pp.function.ProductionOrderFormula.condIfNewComponent(Dtl_OID))]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                    </GridCell>
                                    <GridCell Key="MaterialBOMDtlItemNo" Caption="BOM明细序号" CellType="TextEditor">
                                        <DataBinding ColumnKey="MaterialBOMDtlItemNo"/>
                                    </GridCell>
                                    <GridCell Key="Dtl_ExternalSystemPrimaryKey" Caption="外部系统关键字" CellType="TextEditor">
                                        <DataBinding ColumnKey="ExternalSystemPrimaryKey"/>
                                    </GridCell>
                                </GridRow>
                            </GridRowCollection>
                            <RowDblClick>
                                <![CDATA[if(Macro_IsATPCheck()){ERPShowModal('MM_ATPOverView_Rpt','Macro_PP_ProductionOrder_ShowEvent('&'"'&ATPPlantID&'","'&ATPMaterialID&'","'&ProductOrderTypeID&'","'&ProductPlantID&'","'&PlantID&'","'&MaterialID&'","'&CheckingGroupID&'","'&CheckingRuleID&'","'&ATPRequirementDate&'","'&ATPRequirementQuantity&'","'&ATPStorageLocationID&'","'&RelationBillDtlID&'","'&SOID&'","'&Dtl_SpecialIdentity&'","'&DynIdentityID&'"'&')')}]]>
                            </RowDblClick>
                            <OnRowDelete>
                                <![CDATA[if (!IsDeleted && Macro_CheckBeforeDeleteComponent()) {
                                if (FactIssuedDate > 0) {
                                    if (IsNewComponent == 1) {
                                        DeleteRow();
                                    } else {
                                        SetValue('IsDeleted', 1);
                                    }
                                } else {
                                    DeleteRow();
                                }
                            }]]>
                            </OnRowDelete>
                        </Grid>
                        <TabPanel Key="ProductionOrderGeneralDataTabPanel" Caption="TabPanel1">
                            <SubDetail Key="ProductionOrderGeneralDataSubDetail" Caption="常规数据" BindingGridKey="ProductionOrderAssemblyGrid">
                                <GridLayoutPanel Key="ProductionOrderGeneralDataGridLayoutPanel" Caption="常规数据" Padding="8px" OverflowY="Auto" TopPadding="24px">
                                    <NumberEditor Key="BusinessDemandQuantity__mirror" Caption="需求数量" X="0" Y="0" Visible="true" Enable="!ReadOnly()&amp;&amp;IsDeleted==0&amp;&amp;IIF(FollowupItem!='' &amp;&amp; FollowupGroup=='',false,true)&amp;&amp;QuantityEnable==0;" BindingCellKey="DemandQuantity" Scale="3"/>
                                    <Dict Key="UnitID__mirror" Caption="业务单位" X="1" Y="0" BindingCellKey="Dtl_UnitID" ItemKey="Unit"/>
                                    <Dict Key="BaseUnitID__mirror" Caption="基本单位" X="1" Y="0" Visible="false" BindingCellKey="Dtl_BaseUnitID" ItemKey="Unit"/>
                                    <CheckBox Key="IsQuantityFixed__mirror" Caption="固定数量" X="2" Y="0" BindingCellKey="IsQuantityFixed"/>
                                    <CheckBox Key="IsNetID__mirror" Caption="净废品" X="3" Y="0" BindingCellKey="IsNetID"/>
                                    <NumberEditor Key="ProcessLossRate__mirror" Caption="工序废品率(%)" X="4" Y="0" BindingCellKey="ProcessLossRate"/>
                                    <NumberEditor Key="AssemblyLossRate__mirror" Caption="部件废品率(%)" X="5" Y="0" BindingCellKey="AssemblyLossRate"/>
                                    <NumberEditor Key="CommittedQuantity__mirror" Caption="允许数量" X="0" Y="1" Visible="true" Enable="false" BindingCellKey="AllowQuantity" Scale="3"/>
                                    <NumberEditor Key="RequisiteQty__mirror" Caption="领料数量" X="1" Y="1" BindingCellKey="RequisiteQuantity" Scale="3"/>
                                    <NumberEditor Key="DemandBaseQuantity__mirror" Caption="基本数量" X="2" Y="1" Visible="IIF(Dtl_UnitID&gt;0&amp;&amp;Dtl_BaseUnitID&gt;0&amp;&amp;Dtl_UnitID!=Dtl_BaseUnitID, true, false)" Enable="false" BindingCellKey="DemandBaseQuantity" Scale="3"/>
                                    <TextEditor Key="Notes__mirror" Caption="项目摘要" X="3" Y="1" Visible="true" Enable="IsDeleted==0&amp;&amp;!ReadOnly()" BindingCellKey="Dtl_Notes" XSpan="3"/>
                                    <Label Key="LblComponent" Caption="组件" X="0" Y="2" Class="erp-group-title" XSpan="6"/>
                                    <Dict Key="MoveTypeID__mirror" Caption="移动类型" X="0" Y="3" BindingCellKey="MoveTypeID" ItemKey="MoveType"/>
                                    <TextEditor Key="MaterialBOMDtlItemNo__mirror" Caption="BOM明细序号" X="1" Y="3" Visible="true" Enable="false" BindingCellKey="MaterialBOMDtlItemNo"/>
                                    <TextEditor Key="DtlReservationNumber" Caption="预留号" X="2" Y="3" Visible="true" Enable="false" MaxLength="100" Trim="true">
                                        <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="DtlReservationNumber" DefaultFormulaValue="ReservationNumber"/>
                                    </TextEditor>
                                    <NumberEditor Key="ReservationItemNo__mirror" Caption="预留明细" X="3" Y="3" Visible="true" Enable="false" BindingCellKey="ReservationItemNo" Precision="9" Scale="0" UseGroupingSeparator="false"/>
                                    <Label Key="LblGenerallogo" Caption="一般标识" X="0" Y="4" Class="erp-group-title" XSpan="6"/>
                                    <CheckBox Key="IsBacklash__mirror" Caption="反冲" X="0" Y="5" BindingCellKey="IsBacklash"/>
                                    <CheckBox Key="IsCoProduct__mirror" Caption="联产品" X="1" Y="5" BindingCellKey="IsCoProduct"/>
                                    <ComboBox Key="DiscontinuationType__mirror" Caption="中止" X="0" Y="6" SourceType="ParaGroup" BindingCellKey="DiscontinuationType" TextShowType="Caption" GroupKey="DiscontinuationTypeGroup"/>
                                    <TextEditor Key="EndGroup__mirror" Caption="中止组" X="1" Y="6" Visible="true" Enable="false" BindingCellKey="EndGroup"/>
                                    <TextEditor Key="FollowupGroup__mirror" Caption="后继组" X="2" Y="6" Visible="true" Enable="false" BindingCellKey="FollowupGroup"/>
                                    <NumberEditor Key="OriginalQuantity__mirror" Caption="原始数量" X="3" Y="6" Visible="IIF(DiscontinuationType&gt;0 || FollowupItem!='' || EndGroup!='' || FollowupGroup!='',true,false)" Enable="!ReadOnly()&amp;&amp;IIF(FollowupItem!='' &amp;&amp; FollowupGroup=='',false,true)&amp;&amp;(SubstituteProjectGroup!='' || DiscontinuationType&gt;0 || FollowupItem=='X')" BindingCellKey="OriginalQuantity" Scale="3"/>
                                    <NumberEditor Key="AfterCalcOriginalQuantity__mirror" Caption="原始数量" X="3" Y="6" Visible="IIF(SubstituteProjectGroup!='', true, false)" Enable="IsDeleted==0&amp;&amp;!ReadOnly()" BindingCellKey="AfterCalcOriginalQuantity" Scale="3"/>
                                    <TextEditor Key="SubstituteProjectGroup__mirror" Caption="替代项目组" X="0" Y="7" Visible="true" Enable="false" BindingCellKey="SubstituteProjectGroup"/>
                                    <NumberEditor Key="Priority__mirror" Caption="优先级" X="1" Y="7" Visible="true" Enable="!ReadOnly()&amp;&amp;SubstituteProjectGroup!=''" BindingCellKey="Priority" Scale="0"/>
                                    <ComboBox Key="Strategy__mirror" Caption="策略" X="2" Y="7" Visible="true" Enable="!ReadOnly()&amp;&amp;SubstituteProjectGroup!=''" SourceType="ParaGroup" BindingCellKey="Strategy" GroupKey="CheckStrategy"/>
                                    <NumberEditor Key="EnablePercent__mirror" Caption="使用可能性" X="3" Y="7" Visible="SubstituteProjectGroup!=''" Enable="!ReadOnly()&amp;&amp;SubstituteProjectGroup!=''" BindingCellKey="EnablePercent" Precision="3" Scale="0"/>
                                    <RowDefCollection RowGap="24">
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                    </RowDefCollection>
                                    <ColumnDefCollection ColumnGap="16">
                                        <ColumnDef Width="16%"/>
                                        <ColumnDef Width="16%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="17%"/>
                                    </ColumnDefCollection>
                                </GridLayoutPanel>
                            </SubDetail>
                            <SubDetail Key="ProductionOrderPurchaseDataSubDetail" Caption="SubDetail2" BindingGridKey="ProductionOrderAssemblyGrid">
                                <GridLayoutPanel Key="ProductionOrderPurchaseDataGridLayoutPanel" Caption="采购数据" Padding="8px" OverflowY="Auto" TopPadding="24px">
                                    <Dict Key="VendorID__mirror" Caption="供应商" X="0" Y="0" BindingCellKey="VendorID" ItemKey="Vendor" XSpan="4"/>
                                    <Dict Key="PurchasingGroupID__mirror" Caption="采购组" X="4" Y="0" BindingCellKey="PurchasingGroupID" ItemKey="PurchasingGroup"/>
                                    <Dict Key="MaterialGroupID__mirror" Caption="物料组" X="5" Y="0" BindingCellKey="MaterialGroupID" ItemKey="MaterialGroup"/>
                                    <Dict Key="CostElementID__mirror" Caption="成本要素" X="6" Y="0" Visible="true" BindingCellKey="CostElementID" ItemKey="CO_CostElement" XSpan="2"/>
                                    <NumberEditor Key="Price__mirror" Caption="价格" X="0" Y="1" BindingCellKey="Price"/>
                                    <Dict Key="CurrencyID__mirror" Caption="币种" X="1" Y="1" BindingCellKey="Dtl_CurrencyID" ItemKey="Currency"/>
                                    <NumberEditor Key="PriceQuantity__mirror" Caption="价格数量" X="2" Y="1" BindingCellKey="PriceQuantity"/>
                                    <Dict Key="PriceUnitID__mirror" Caption="单位" X="3" Y="1" BindingCellKey="PriceUnitID" ItemKey="Unit"/>
                                    <Dict Key="PurchaseReqSOID__mirror" Caption="采购申请" X="4" Y="1" Visible="true" Enable="false" BindingCellKey="PurchaseReqSOID" ItemKey="MM_PurchaseRequisition__Dic" StateMask="Enable|Disable|Discard"/>
                                    <NumberEditor Key="PurchaseOrderItemNo__mirror" Caption="采购申请行号" X="5" Y="1" Visible="true" Enable="false" BindingCellKey="PurchaseOrderItemNo" Scale="0"/>
                                    <NumberEditor Key="RequisiteQuantity__mirror" Caption="收货数量" X="6" Y="1" Visible="true" Enable="false" BindingCellKey="RequisiteQuantity"/>
                                    <CheckBox Key="IsGeneratedPO" Caption="存在采购订单" X="7" Y="1" Visible="true" Enable="false" BindingCellKey="IsExistPurchaseOrder"/>
                                    <RowDefCollection RowGap="24">
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                    </RowDefCollection>
                                    <ColumnDefCollection ColumnGap="16">
                                        <ColumnDef Width="8%"/>
                                        <ColumnDef Width="8%"/>
                                        <ColumnDef Width="8%"/>
                                        <ColumnDef Width="8%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="17%"/>
                                    </ColumnDefCollection>
                                </GridLayoutPanel>
                            </SubDetail>
                            <SubDetail Key="ProductionOrderCoProductSubDetail" Caption="联产品" BindingGridKey="ProductionOrderAssemblyGrid">
                                <GridLayoutPanel Key="ProductionOrderCoProductGridLayoutPanel" Caption="联产品" Padding="8px" OverflowY="Auto" Visible="IsCoProduct==1">
                                    <Dict Key="MaterialID__mirror" Caption="物料" X="0" Y="1" Enable="false" BindingCellKey="Dtl_MaterialID" ItemKey="Material"/>
                                    <NumberEditor Key="DemandQuantity__mirror" Caption="数量" X="0" Y="2" Enable="false" BindingCellKey="DemandQuantity">
                                        <Format HAlign="Left"/>
                                    </NumberEditor>
                                    <NumberEditor Key="ReceivedQuantity__mirror" Caption="收到货物的数量" X="1" Y="2" Enable="false" BindingCellKey="RequisiteQuantity" Scale="3">
                                        <DataBinding/>
                                        <Format HAlign="Left"/>
                                    </NumberEditor>
                                    <Label Key="LblOrderItem" Caption="订单项目" X="0" Y="0" Class="erp-group-title" XSpan="6">
                                        <DataBinding/>
                                    </Label>
                                    <CheckBox Key="IsBOMCompleteReceipt__mirror" Caption="交货已完成" X="0" Y="4" Visible="true" Enable="IsDeleted==0&amp;&amp;!ReadOnly()" BindingCellKey="IsBOMCompleteReceipt">
                                        <DataBinding/>
                                    </CheckBox>
                                    <Label Key="LblBOMControl" Caption="控制" X="0" Y="3" Class="erp-group-title" XSpan="6">
                                        <DataBinding/>
                                    </Label>
                                    <NumberEditor Key="LackOfDelivery__mirror" Caption="发货不足" X="0" Y="6" Visible="true" Enable="IsDeleted==0&amp;&amp;!ReadOnly()" BindingCellKey="Dtl_LackOfDelivery">
                                        <DataBinding/>
                                        <Format HAlign="Left"/>
                                    </NumberEditor>
                                    <NumberEditor Key="Dtl_ExcessiveDelivery__mirror" Caption="过量交货" X="0" Y="7" Visible="true" Enable="IsDeleted==0&amp;&amp;!ReadOnly()" BindingCellKey="Dtl_ExcessiveDelivery">
                                        <DataBinding/>
                                        <Format HAlign="Left"/>
                                    </NumberEditor>
                                    <Label Key="LblBOMTolerance" Caption="容差" X="0" Y="5" Class="erp-group-title" XSpan="6">
                                        <DataBinding/>
                                    </Label>
                                    <Label Key="LblBOMLackOfDelivery" Caption="%" X="1" Y="6">
                                        <DataBinding/>
                                    </Label>
                                    <CheckBox Key="IsBOMWithoutLimitDelivery__mirror" Caption="未限制过量交货" X="2" Y="6" Visible="true" Enable="IsDeleted==0&amp;&amp;!ReadOnly()" BindingCellKey="IsBOMWithoutLimitDelivery">
                                        <DataBinding/>
                                    </CheckBox>
                                    <Dict Key="PlantID__mirror" Caption="工厂" X="1" Y="1" Enable="false" BindingCellKey="Dtl_PlantID" ItemKey="Plant">
                                        <DataBinding/>
                                    </Dict>
                                    <Label Key="LblBOMExcessiveDelivery" Caption="%" X="1" Y="7">
                                        <DataBinding/>
                                    </Label>
                                    <RowDefCollection RowHeight="30" RowGap="24">
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                    </RowDefCollection>
                                    <ColumnDefCollection ColumnGap="16">
                                        <ColumnDef Width="16%"/>
                                        <ColumnDef Width="16%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="17%"/>
                                    </ColumnDefCollection>
                                </GridLayoutPanel>
                            </SubDetail>
                        </TabPanel>
                        <SplitSize Size="100%"/>
                        <SplitSize Size="140px"/>
                    </SplitPanel>
                    <SplitPanel Key="ProductionOrderRoutingSplitPanel" Caption="工序" Orientation="Vertical" Height="pref" Visible="true">
                        <Activate>
                            <![CDATA[Macro_SetFocusRow('ProductionOrderProcessInputGrid')]]>
                        </Activate>
                        <FlexFlowLayoutPanel Key="ProductionOrderProcessPanel">
                            <Grid Key="ProductionOrderProcessInputGrid" Caption="工序输入" Visible="IIF(Category=='40', false, true)" Enable="!ReadOnly()&amp;&amp;!Macro_IsProcessOrder()" DefaultFitWidth="true" SerialSeq="true" Padding="8px">
                                <GridColumnCollection>
                                    <GridColumn Key="SE_IsSelect" Width="32px"/>
                                    <GridColumn Key="SE_SequenceType" Caption="序列类别" Width="80px"/>
                                    <GridColumn Key="SE_ItemNo" Caption="序列号" Width="80px"/>
                                    <GridColumn Key="SE_OID" Caption="SE_OID" Visible="false" Width="80px"/>
                                    <GridColumn Key="SE_SequenceText" Caption="序列名称" Width="80px"/>
                                    <GridColumn Key="SE_ReferenceItemNo" Caption="参考序列" Width="80px"/>
                                    <GridColumn Key="SE_BeginItemNo" Caption="开始工序" Width="80px"/>
                                    <GridColumn Key="SE_EndItemNo" Caption="结束工序" Width="80px"/>
                                    <GridColumn Key="SE_SOID" Visible="false" Width="80px"/>
                                </GridColumnCollection>
                                <GridRowCollection>
                                    <GridRow Key="ProductionOrderProcessInputGridRow" TableKey="EPP_ProductionOrder_Sequence">
                                        <GridCell Key="SE_IsSelect" Caption="选择" CellType="CheckBox" IsSelect="true"/>
                                        <GridCell Key="SE_SequenceType" Caption="序列类别" CellType="ComboBox" Enable="!ReadOnly()&amp;&amp;GetRowIndex('ProductionOrderProcessInputGrid')&gt;1" IntegerValue="true" GroupKey="SequenceType" SourceType="ParaGroup">
                                            <DataBinding ColumnKey="SequenceType" DefaultValue="1">
                                                <CheckRule>
                                                    <![CDATA[IIF(GetRowIndex('ProductionOrderProcessInputGrid')>1&&SE_SequenceType==0,MessageFacade('PP_PRODUCTIONORDER040','标准序列必须唯一'),true)]]>
                                                </CheckRule>
                                            </DataBinding>
                                        </GridCell>
                                        <GridCell Key="SE_ItemNo" Caption="序列号" CellType="TextEditor" Enable="!ReadOnly()&amp;&amp;GetRowIndex('ProductionOrderProcessInputGrid')&gt;1" MaxLength="100" Trim="true">
                                            <DataBinding ColumnKey="ItemNo">
                                                <ValueChanged>
                                                    <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.checkRefSequenceNoAfterSequenceNoChange();]]>
                                                </ValueChanged>
                                                <CheckRule>
                                                    <![CDATA[IIFS(SE_ItemNo=='', MessageFacade('PP_PRODUCTIONORDER038','序列号不能为空'), !com.bokesoft.erp.pp.function.ProductionOrderFormula.checkRepeatSequenceNo(), MessageFacade('PP_PRODUCTIONORDER039','序列号不能重复'), true, true)]]>
                                                </CheckRule>
                                            </DataBinding>
                                        </GridCell>
                                        <GridCell Key="SE_OID" Caption="SE_OID" CellType="NumberEditor" Enable="false" Scale="0">
                                            <DataBinding ColumnKey="OID"/>
                                        </GridCell>
                                        <GridCell Key="SE_SequenceText" Caption="序列名称" CellType="TextEditor" MaxLength="100" Trim="true">
                                            <DataBinding ColumnKey="SequenceText"/>
                                        </GridCell>
                                        <GridCell Key="SE_ReferenceItemNo" Caption="参考序列" CellType="TextEditor" MaxLength="100" Trim="true">
                                            <DataBinding ColumnKey="ReferenceItemNo">
                                                <CheckRule>
                                                    <![CDATA[IIFS(GetRowIndex('ProductionOrderProcessInputGrid')>1&&SE_ReferenceItemNo=='', MessageFacade('PP_PRODUCTIONORDER041','并行序列或替代序列的参考序列不能为空'), GetRowIndex('ProductionOrderProcessInputGrid')>1&&!com.bokesoft.erp.pp.function.ProductionOrderFormula.checkReferenceSequenceNo(), MessageFacade('PP_PRODUCTIONORDER042','参考序列不合法，可能是参考序列不存在，也可能是参考序列设置为自己'), true, true)]]>
                                                </CheckRule>
                                            </DataBinding>
                                        </GridCell>
                                        <GridCell Key="SE_BeginItemNo" Caption="开始工序" CellType="TextEditor" Enable="!ReadOnly()&amp;&amp;GetRowIndex('ProductionOrderProcessInputGrid')&gt;1" MaxLength="100" Trim="true">
                                            <DataBinding ColumnKey="BeginItemNo" CheckDependency="ReferenceSequence,ControlCodeID">
                                                <CheckRule>
                                                    <![CDATA[IIFS(GetRowIndex('ProductionOrderProcessInputGrid')>1&&SE_BeginItemNo=='', MessageFacade('PP_PRODUCTIONORDER043','并行序列或替代序列的开始工序不能为空'), GetRowIndex('ProductionOrderProcessInputGrid')>1&&!com.bokesoft.erp.pp.function.ProductionOrderFormula.checkProcessNoInRefSequence(true), MessageFacade('PP_PRODUCTIONORDER044','开始工序在指定参考序列中不存在'), SE_BeginItemNo!=''&&SE_EndItemNo!=''&&SE_BeginItemNo>SE_EndItemNo, MessageFacade('CO234','开始工序应该小于等于结束工序'), true, true)]]>
                                                </CheckRule>
                                            </DataBinding>
                                        </GridCell>
                                        <GridCell Key="SE_EndItemNo" Caption="结束工序" CellType="TextEditor" Enable="!ReadOnly()&amp;&amp;GetRowIndex('ProductionOrderProcessInputGrid')&gt;1" MaxLength="100" Trim="true">
                                            <DataBinding ColumnKey="EndItemNo" CheckDependency="ReferenceSequence,ControlCodeID">
                                                <CheckRule>
                                                    <![CDATA[IIFS(GetRowIndex('ProductionOrderProcessInputGrid')>1&&SE_EndItemNo=='', MessageFacade('PP_PRODUCTIONORDER045','并行序列或替代序列的开始工序不能为空'), GetRowIndex('ProductionOrderProcessInputGrid')>1&&!com.bokesoft.erp.pp.function.ProductionOrderFormula.checkProcessNoInRefSequence(false), MessageFacade('CO231','开始工序在指定参考序列中不存在'), SE_BeginItemNo!=''&&SE_EndItemNo!=''&&SE_BeginItemNo>SE_EndItemNo, MessageFacade('PP_PRODUCTIONORDER046','结束工序应该大于等于开始工序'), true, true)]]>
                                                </CheckRule>
                                            </DataBinding>
                                        </GridCell>
                                        <GridCell Key="SE_SOID" CellType="NumberEditor" Scale="0">
                                            <DataBinding ColumnKey="SOID"/>
                                        </GridCell>
                                    </GridRow>
                                </GridRowCollection>
                                <RowDblClick>
                                    <![CDATA[if(!ReadOnly()&&Macro_IsATPCheck()){ERPShowModal('MM_ATPOverView_Rpt','Macro_PP_ProductionOrder_ShowEvent('&'"'&ATPPlantID&'","'&ATPMaterialID&'","'&ProductOrderTypeID&'","'&ProductPlantID&'","'&PlantID&'","'&MaterialID&'","'&CheckingGroupID&'","'&CheckingRuleID&'","'&ATPRequirementDate&'","'&ATPRequirementQuantity&'","'&ATPStorageLocationID&'","'&RelationBillDtlID&'","'&SOID&'","'&Dtl_SpecialIdentity&'","'&DynIdentityID&'"'&')')}]]>
                                </RowDblClick>
                                <OnRowDelete>
                                    <![CDATA[if(GetRowIndex('ProductionOrderProcessInputGrid')>1){if (Macro_DeleteDtl_1_ButtonClickTrg()) {RaiseErrMsg('PP_PRODUCTIONORDER047','待删除序列被其他序列引用，不能删除')} else {DeleteRow();};}]]>
                                </OnRowDelete>
                            </Grid>
                            <TabPanel Key="ProductionOrderProcessListTabPanel" Height="100%">
                                <SubDetail Key="ProductionOrderProcessListSubDetail" Caption="工序列表" BindingGridKey="ProductionOrderProcessInputGrid">
                                    <Grid Key="ProductionOrderProcessListGrid" Caption="工序列表" SerialSeq="true" Padding="8px">
                                        <GridColumnCollection>
                                            <GridColumn Key="RT_IsSelect" Width="32px"/>
                                            <GridColumn Key="RT_OID" Caption="RT_OID" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_POID" Caption="RT_POID" Visible="false" Width="80px"/>
                                            <GridColumn Key="BeforeProcessNo" Caption="原工序" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_ItemNo" Caption="工序" Enable="Macro_RoutingEditable()&amp;&amp;Length(RT_SubItemNo) == 0" Width="80px"/>
                                            <GridColumn Key="RT_SubItemNo" Caption="子工序" Visible="!Macro_IsProcessOrder();" Enable="Macro_RoutingEditable()&amp;&amp;com.bokesoft.erp.pp.function.ProductionOrderFormula.isAvailable4SubProcessNo('EPP_ProductionOrder_Routing',RT_ItemNo,RT_OID)" Width="80px"/>
                                            <GridColumn Key="RT_IsPhaseIndicator" Caption="阶段指示符" Visible="Macro_IsProcessOrder();" Enable="Macro_RoutingEditable()&amp;&amp;(RT_IsPhaseIndicator==0&amp;&amp;Length(Trim(RT_ItemNo))==0)||(RT_IsPhaseIndicator==1&amp;&amp;Length(Trim(RT_SuperiorItemNo))==0&amp;&amp;Length(Trim(BeforeSuperiorProcessNo_Routing))==0)" Width="100px"/>
                                            <GridColumn Key="BeforeSuperiorProcessNo_Routing" Caption="原上级工序" Visible="false" Width="100px"/>
                                            <GridColumn Key="RT_SuperiorItemNo" Caption="上级工序" Visible="Macro_IsProcessOrder();" Enable="Macro_RoutingEditable()&amp;&amp;!(RT_IsPhaseIndicator==0&amp;&amp;Length(Trim(RT_ItemNo))&gt;0)" Width="80px"/>
                                            <GridColumn Key="RT_ParentItemNo" Caption="工序序列号" Enable="false" Width="100px"/>
                                            <GridColumn Key="RT_SequenceType" Caption="序列类别" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_PlantID" Caption="工厂" Enable="Macro_RoutingEditable()" Width="80px"/>
                                            <GridColumn Key="RT_WorkCenterID" Caption="工作中心" Enable="Macro_RoutingEditable()&amp;&amp;(RT_IsPhaseIndicator==0||(RT_IsPhaseIndicator==1&amp;&amp;Length(Trim(RT_SuperiorItemNo))==0))" Width="80px"/>
                                            <GridColumn Key="RT_CapacityID" Caption="工作中心对应的计划能力字典" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_ControlCodeID" Caption="控制码" Enable="Macro_RoutingEditable()" Width="80px"/>
                                            <GridColumn Key="RT_StandardTextKeyID" Caption="标准文本码" Enable="Macro_RoutingEditable()" Width="100px"/>
                                            <GridColumn Key="RT_Notes" Caption="描述" Enable="Macro_RoutingEditable()" Width="80px"/>
                                            <GridColumn Key="RT_SystemStatusText" Caption="系统状态" Enable="false" Width="80px"/>
                                            <GridColumn Key="RT_UserStatusText" Caption="用户状态" Enable="false" Width="80px"/>
                                            <GridColumn Key="RT_BaseQuantity" Caption="基本单位数量" Visible="false" Width="120px"/>
                                            <GridColumn Key="RT_BaseUnitID" Caption="基本单位" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_UnitID" Caption="工序单位" Enable="false" Width="80px"/>
                                            <GridColumn Key="RT_IsComponentAllocation" Caption="物料" Visible="Macro_IsProcessOrder();" Enable="false" Width="80px"/>
                                            <GridColumn Key="RT_IsAssembleTriggerPoint" Caption="触发点" Enable="false" Width="80px"/>
                                            <GridColumn Key="RT_BaseUnitNumerator" Caption="工序分子" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_BaseUnitDenominator" Caption="工序分母" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_ProcessBaseQuantity" Caption="工序数量" Visible="false" Width="100px"/>
                                            <GridColumn Key="RT_ProcessQuantity" Caption="工序数量" Enable="false" Width="100px"/>
                                            <GridColumn Key="RT_DemandConfirmBaseQuantity" Caption="需要确认数量" Visible="false" Enable="false" Width="120px"/>
                                            <GridColumn Key="RT_DemandConfirmQuantity" Caption="需要确认数量" Visible="false" Width="120px"/>
                                            <GridColumn Key="RT_ConfirmBaseQuantity" Caption="确认数量" Visible="false" Width="100px"/>
                                            <GridColumn Key="RT_ConfirmQuantity" Caption="确认数量" Enable="false" Width="100px"/>
                                            <GridColumn Key="RT_ProcessScrapRate" Caption="工序报废率(%)" Enable="Macro_RoutingEditable()" Width="80px"/>
                                            <GridColumn Key="RT_ProcessScrapeBaseQuantity" Caption="废品数" Visible="false" Width="100px"/>
                                            <GridColumn Key="RT_ProcessScrapeQuantity" Caption="废品数" Enable="false" Width="100px"/>
                                            <GridColumn Key="RT_ConfirmScrapeBaseQuantity" Caption="确认废品数" Visible="false" Width="100px"/>
                                            <GridColumn Key="RT_ConfirmScrapeQuantity" Caption="确认废品数" Enable="false" Width="100px"/>
                                            <GridColumn Key="RT_MaterialID" Caption="物料" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_HeadEndDate" Caption="结束日期" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_ConfirmReworkQuantity" Caption="返工" Enable="false" Width="100px"/>
                                            <GridColumn Key="RT_StandardValueKeyID" Caption="标准值码" Enable="false" Width="80px"/>
                                            <GridColumn Key="RT_IsOutsourcing" Caption="外协组件" Enable="Macro_RoutingEditable()" Width="80px"/>
                                            <GridColumn Key="RT_PurchasingOrganizationID" Caption="采购组织" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'" Width="80px"/>
                                            <GridColumn Key="RT_PurchaseInfoRecordID" Caption="采购信息记录" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'" Width="120px"/>
                                            <GridColumn Key="RT_CostElementID" Caption="成本要素" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'" Width="80px"/>
                                            <GridColumn Key="RT_SortItem" Caption="排序字符串" Visible="false" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" Width="100px"/>
                                            <GridColumn Key="RT_MaterialGroupID" Caption="物料组" Visible="false" Enable="Macro_RoutingEditable()&amp;&amp;IsDirectPurchase == 0&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" Width="80px"/>
                                            <GridColumn Key="RT_VendorID" Caption="供应商" Visible="false" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" Width="80px"/>
                                            <GridColumn Key="RT_PurchaseUnitID" Caption="订单单位" Visible="false" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" Width="80px"/>
                                            <GridColumn Key="RT_PurchasingGroupID" Caption="采购组" Visible="false" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" Width="80px"/>
                                            <GridColumn Key="RT_PlannedDeliveryDays" Caption="计划交付时间(天)" Visible="false" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" Width="80px"/>
                                            <GridColumn Key="RT_PriceQuantity" Caption="价格数量" Visible="false" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" Width="100px"/>
                                            <GridColumn Key="RT_NetPrice" Caption="净价" Visible="false" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" Width="80px"/>
                                            <GridColumn Key="RT_CurrencyID" Caption="币种" Visible="false" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" Width="80px"/>
                                            <GridColumn Key="RT_IsRequiredSplitting" Caption="所需分解" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_MaxSplittingNumber" Caption="最大拆分数" Visible="false" Width="100px"/>
                                            <GridColumn Key="RT_ActualSplittingNumber" Caption="实际拆分数" Enable="Macro_RoutingEditable()" Width="100px"/>
                                            <GridColumn Key="RT_MinProcessingTime" Caption="最短处理时间" Visible="false" Width="120px"/>
                                            <GridColumn Key="RT_CapacityUnitID" Caption="能力单位" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_IsHasPurchaseOrder" Caption="存在采购订单" Enable="false" Width="120px"/>
                                            <GridColumn Key="RT_PurchaseReqSOID" Caption="采购申请" Enable="false" Width="80px"/>
                                            <GridColumn Key="RT_PurchaseRequisitionDtlOID" Caption="采购申请详情" Visible="false" Width="120px"/>
                                            <GridColumn Key="RT_PurchaseOrderItemNo" Caption="行号" Enable="false" Width="80px"/>
                                            <GridColumn Key="RT_RoutingProcessDtlOID" Caption="RT_RoutingProcessDtlOID" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_StandardQueueSpendTime" Enable="false" Caption="标准排队时间" Width="80px"/>
                                            <GridColumn Key="RT_StandardQueueTimeUnitID" Enable="false" Caption="单位" Width="80px"/>
                                            <GridColumn Key="RT_MinimumQueueSpendTime" Visible="false" Caption="最少排队时间(未实现功能)" Width="80px"/>
                                            <GridColumn Key="RT_MinimumQueueTimeUnitID" Visible="false" Caption="单位" Width="80px"/>
                                            <GridColumn Key="RT_MaximumWaitSpendTime" Visible="false" Caption="最大等待时间(未实现功能)" Width="80px"/>
                                            <GridColumn Key="RT_MaximumWaitTimeUnitID" Visible="false" Caption="单位" Width="80px"/>
                                            <GridColumn Key="RT_MinimumWaitSpendTime" Enable="false" Caption="最少等待时间" Width="80px"/>
                                            <GridColumn Key="RT_MinimumWaitTimeUnitID" Enable="false" Caption="单位" Width="80px"/>
                                            <GridColumn Key="RT_StandardMoveSpendTime" Enable="false" Caption="标准转运时间" Width="80px"/>
                                            <GridColumn Key="RT_StandardMoveTimeUnitID" Enable="false" Caption="单位" Width="80px"/>
                                            <GridColumn Key="RT_MinimumMoveSpendTime" Visible="false" Caption="最少转运时间(未实现功能)" Width="80px"/>
                                            <GridColumn Key="RT_MinimumMoveTimeUnitID" Visible="false" Caption="单位" Width="80px"/>
                                            <GridColumn Key="RT_StartDate" Caption="工序开始日期" Width="100px"/>
                                            <GridColumn Key="RT_StartTime" Caption="工序开始时间" Width="80px"/>
                                            <GridColumn Key="RT_EndDate" Caption="工序结束日期" Width="100px"/>
                                            <GridColumn Key="RT_EndTime" Caption="工序结束时间" Width="80px"/>
                                            <GridColumn Key="RT_ProcessSpendTime" Caption="工序耗时" Width="80px"/>
                                            <GridColumn Key="RT_ProcessTimeUnitID" Caption="单位" Enable="false" Width="80px"/>
                                            <GridColumn Key="RT_QueueSpendTime" Caption="等待耗时" Width="80px"/>
                                            <GridColumn Key="RT_QueueTimeUnitID" Caption="单位" Width="80px"/>
                                            <GridColumn Key="RT_EarliestSetupDate" Caption="最早设置日期" Width="120px"/>
                                            <GridColumn Key="RT_EarliestSetupTime" Caption="最早设置时间" Width="120px"/>
                                            <GridColumn Key="RT_LatestSetupDate" Caption="最晚设置日期" Width="120px"/>
                                            <GridColumn Key="RT_LatestSetupTime" Caption="最晚设置时间" Width="120px"/>
                                            <GridColumn Key="RT_SetupSpendTime" Caption="设置耗时" Width="80px"/>
                                            <GridColumn Key="RT_SetupTimeUnitID" Caption="单位" Enable="false" Width="80px"/>
                                            <GridColumn Key="RT_EarliestProcessingDate" Caption="最早加工日期" Width="120px"/>
                                            <GridColumn Key="RT_EarliestProcessingTime" Caption="最早加工时间" Width="120px"/>
                                            <GridColumn Key="RT_LatestProcessingDate" Caption="最晚加工日期" Width="120px"/>
                                            <GridColumn Key="RT_LatestProcessingTime" Caption="最晚加工时间" Width="120px"/>
                                            <GridColumn Key="RT_ProcessingSpendTime" Caption="加工耗时" Width="80px"/>
                                            <GridColumn Key="RT_ProcessingTimeUnitID" Caption="单位" Width="80px"/>
                                            <GridColumn Key="RT_EarliestTearDownStartDate" Caption="最早拆卸开始日期" Width="120px"/>
                                            <GridColumn Key="RT_EarliestTearDownStartTime" Caption="最早拆卸开始时间" Width="120px"/>
                                            <GridColumn Key="RT_EarliestTearDownEndDate" Caption="最早拆卸结束日期" Width="120px"/>
                                            <GridColumn Key="RT_EarliestTearDownEndTime" Caption="最早拆卸结束时间" Width="120px"/>
                                            <GridColumn Key="RT_LatestTearDownStartDate" Caption="最晚拆卸开始日期" Width="120px"/>
                                            <GridColumn Key="RT_LatestTearDownStartTime" Caption="最晚拆卸开始时间" Width="120px"/>
                                            <GridColumn Key="RT_LatestTearDownEndDate" Caption="最晚拆卸结束日期" Width="120px"/>
                                            <GridColumn Key="RT_LatestTearDownEndTime" Caption="最晚拆卸结束时间" Width="120px"/>
                                            <GridColumn Key="RT_TearDownSpendTime" Caption="拆卸耗时" Width="80px"/>
                                            <GridColumn Key="RT_TearDownTimeUnitID" Caption="单位" Enable="false" Width="80px"/>
                                            <GridColumn Key="RT_EarliestWaitStartDate" Caption="最早等待开始日期" Width="120px"/>
                                            <GridColumn Key="RT_EarliestWaitStartTime" Caption="最早等待开始时间" Width="120px"/>
                                            <GridColumn Key="RT_EarliestWaitEndDate" Caption="最早等待结束日期" Width="120px"/>
                                            <GridColumn Key="RT_EarliestWaitEndTime" Caption="最早等待结束时间" Width="120px"/>
                                            <GridColumn Key="RT_LatestWaitStartDate" Caption="最晚等待开始日期" Width="120px"/>
                                            <GridColumn Key="RT_LatestWaitStartTime" Caption="最晚等待开始时间" Width="120px"/>
                                            <GridColumn Key="RT_LatestWaitEndDate" Caption="最晚等待结束日期" Width="120px"/>
                                            <GridColumn Key="RT_LatestWaitEndTime" Caption="最晚等待结束时间" Width="120px"/>
                                            <GridColumn Key="RT_WaitSpendTime" Caption="等待耗时" Width="80px"/>
                                            <GridColumn Key="RT_WaitTimeUnitID" Caption="单位" Width="80px"/>
                                            <GridColumn Key="MoveSpendTime" Caption="转运耗时" Width="80px"/>
                                            <GridColumn Key="MoveTimeUnitID" Caption="单位" Width="80px"/>
                                            <GridColumn Key="RT_IsCapacityRelevant" Caption="能力相关" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_ConfirmType" Caption="确认方式" Enable="Macro_RoutingEditable()" Width="80px"/>
                                            <GridColumn Key="WorkCenter_CheckRule" Caption="工作中心检查规则辅助字段" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_SOID" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_CostCenterID" Caption="成本中心" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_ControllingAreaID" Caption="控制范围" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_CostValidID" Caption="成本核算有效期" Visible="false" Width="80px"/>
                                            <GridColumn Key="RT_IsNewRouting" Caption="新增的工序" Visible="Macro_DebugMode()" Width="80px"/>
                                            <GridColumn Key="RT_IsDeleted" Caption="工序已被删除" Visible="false" Width="80px"/>
                                        </GridColumnCollection>
                                        <GridRowCollection>
                                            <GridRow Key="ProductionOrderProcessListGridRow" TableKey="EPP_ProductionOrder_Routing">
                                                <GridCell Key="RT_IsSelect" Caption="选择" CellType="CheckBox" IsSelect="true"/>
                                                <GridCell Key="RT_OID" Caption="RT_OID" CellType="NumberEditor" CopyNew="false" Scale="0">
                                                    <DataBinding ColumnKey="OID"/>
                                                </GridCell>
                                                <GridCell Key="RT_POID" Caption="RT_POID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                                    <DataBinding ColumnKey="POID"/>
                                                </GridCell>
                                                <GridCell Key="BeforeProcessNo" Caption="原工序" CellType="TextEditor">
                                                    <DataBinding ColumnKey="BeforeProcessNo"/>
                                                </GridCell>
                                                <GridCell Key="RT_ItemNo" Caption="工序" CellType="TextEditor" InvalidChars="+-." MaxLength="4" Trim="true">
                                                    <DataBinding ColumnKey="ItemNo" Required="true">
                                                        <ValueChanged>
                                                            <![CDATA[Macro_CheckAndFixProcessNo(RT_ItemNo, 'ProcessNo'); com.bokesoft.erp.pp.function.ProductionOrderFormula.setRouting_ProcessQuantity(BeforeProcessNo, RT_ItemNo);com.bokesoft.erp.pp.function.ProductionOrderFormula.sortRouting()]]>
                                                        </ValueChanged>
                                                        <CheckRule>
                                                            <![CDATA[Macro_CheckIfProcessNoDup(RT_POID, 'RT_ItemNo', 'ItemNo', 'SubItemNo', RT_SubItemNo)]]>
                                                        </CheckRule>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_SubItemNo" Caption="子工序" CellType="TextEditor" InvalidChars="+-." MaxLength="4">
                                                    <DataBinding ColumnKey="SubItemNo">
                                                        <CheckRule>
                                                            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.isRepeat4SubProcessNo('EPP_ProductionOrder_Routing', RT_ItemNo, RT_SubItemNo, RT_OID);com.bokesoft.erp.pp.function.ProductionOrderFormula.sortRouting()]]>
                                                        </CheckRule>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_IsPhaseIndicator" Caption="阶段指示符" CellType="CheckBox">
                                                    <DataBinding ColumnKey="IsPhaseIndicator" ValueDependency="RT_SuperiorItemNo">
                                                        <DefaultFormulaValue>
                                                            <![CDATA[IIF(Length(Trim(RT_SuperiorItemNo))>0,1,RT_IsPhaseIndicator)]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="BeforeSuperiorProcessNo_Routing" Caption="原上级工序" CellType="TextEditor">
                                                    <DataBinding ColumnKey="BeforeSuperiorProcessNo_Routing"/>
                                                </GridCell>
                                                <GridCell Key="RT_SuperiorItemNo" Caption="上级工序" CellType="TextEditor" Trim="true">
                                                    <DataBinding ColumnKey="SuperiorItemNo">
                                                        <ValueChanged>
                                                            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.updateBOMProcess(RT_ItemNo,RT_IsPhaseIndicator,RT_SuperiorItemNo);IIF(RT_IsPhaseIndicator==1&&Length(Trim(RT_SuperiorItemNo))>0,SetValue('RT_WorkCenterID',com.bokesoft.erp.pp.function.ProductionOrderFormula.getWorkCenterIDForPhase(RT_SuperiorItemNo),true))]]>
                                                        </ValueChanged>
                                                        <CheckRule>
                                                            <![CDATA[IIFS(RT_IsPhaseIndicator==1&&Length(Trim(RT_SuperiorItemNo))==0, MessageFacade('40004','必须为阶段指定上级工序'), RT_IsPhaseIndicator==1&&!com.bokesoft.erp.pp.function.ProductionOrderFormula.checkSuperiorProcessNoForRouting(RT_SuperiorItemNo), MessageFacade('40005','上级工序必须从已有的工序中选择,且工序的阶段指示符不能勾选'), RT_IsPhaseIndicator==0&&Length(Trim(RT_SuperiorItemNo))>0,MessageFacade('PP_PRODUCTIONORDER048','工序无需指定上级工序'),true, true)]]>
                                                        </CheckRule>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_ParentItemNo" Caption="工序序列号" CellType="TextEditor" MaxLength="100" Trim="true">
                                                    <DataBinding ColumnKey="ParentItemNo" DefaultFormulaValue="SE_ItemNo"/>
                                                </GridCell>
                                                <GridCell Key="RT_SequenceType" Caption="序列类别" CellType="ComboBox" IntegerValue="true" GroupKey="SequenceType" SourceType="ParaGroup">
                                                    <DataBinding ColumnKey="SequenceType" DefaultFormulaValue="SE_SequenceType"/>
                                                </GridCell>
                                                <GridCell Key="RT_PlantID" Caption="工厂" CellType="Dict" ItemKey="Plant">
                                                    <DataBinding ColumnKey="PlantID" DefaultFormulaValue="ProductPlantID" Required="true"/>
                                                </GridCell>
                                                <GridCell Key="RT_WorkCenterID" Caption="工作中心" CellType="Dict" ItemKey="WorkCenter">
                                                    <DataBinding ColumnKey="WorkCenterID">
                                                        <ValueChanged>
                                                            <![CDATA[Macro_SetCostAndArea(); if (RT_WorkCenterID > 0 && RT_StandardTextKeyID <= 0) { SetValue('RT_StandardTextKeyID', GetDictValue('WorkCenter', RT_WorkCenterID, 'StandardTextKeyID'), true) }; SetValue('RT_StandardValueKeyID', GetDictValue('WorkCenter', RT_WorkCenterID, 'StandardValueKeyID'),true);if (RT_ControlCodeID<=0) {SetValue('RT_ControlCodeID', GetDictValue('WorkCenter', RT_WorkCenterID, 'ControlCodeID'),true)} else {''};com.bokesoft.erp.pp.function.ProductionOrderFormula.setBomBlackflush(RT_ItemNo,RT_WorkCenterID);if (!GetPara('New_Type')=='CopyNow') {com.bokesoft.erp.pp.masterdata.RoutingFormula.StandardValueSetByWorkCenter_ProductionOrder()} else {true};Macro_SetProcessNo();IIF(Macro_IsProcessOrder()&&RT_IsPhaseIndicator==0&&RT_WorkCenterID>0,com.bokesoft.erp.pp.function.ProductionOrderFormula.setWorkCenterIDForPhase(RT_ItemNo,RT_WorkCenterID));]]>
                                                        </ValueChanged>
                                                        <CheckRule>
                                                            <![CDATA[IIFS(RT_ControlCodeID>0&&GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')!='+'&&RT_WorkCenterID<=0, MessageFacade('PP_PRODUCTIONORDER049','工作中心不能为空'),true,true)]]>
                                                        </CheckRule>
                                                    </DataBinding>
                                                    <ItemFilter ItemKey="WorkCenter">
                                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                            <FilterValue Index="1" ParaValue="IIF(RT_PlantID&gt;0, 'soid in (select soid from BK_WorkCenter where plantID= '&amp;SqlPara(RT_PlantID)&amp;') ', '1=2')"/>
                                                        </Filter>
                                                    </ItemFilter>
                                                </GridCell>
                                                <GridCell Key="RT_CapacityID" Caption="工作中心对应的计划能力字典" CellType="Dict" ItemKey="PP_Capacity">
                                                    <DataBinding ColumnKey="CapacityID"/>
                                                </GridCell>
                                                <GridCell Key="RT_ControlCodeID" Caption="控制码" CellType="Dict" ItemKey="PP_ControlCode">
                                                    <DataBinding ColumnKey="ControlCodeID">
                                                        <ValueChanged>
                                                            <![CDATA[IIF(GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+',SetValue('RT_WorkCenterID', 0),'');Macro_SetProcessNo();]]>
                                                        </ValueChanged>
                                                        <CheckRule>
                                                            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.checkRoutingControlCode(RT_ItemNo,RT_ControlCodeID)]]>
                                                        </CheckRule>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_StandardTextKeyID" Caption="标准文本码" CellType="Dict" ItemKey="PP_StandardTextKey">
                                                    <DataBinding ColumnKey="StandardTextKeyID">
                                                        <ValueChanged>
                                                            <![CDATA[if (Length(Trim(RT_Notes)) == 0) {
                                                            SetValue('RT_Notes', GetDictValue('PP_StandardTextKey', RT_StandardTextKeyID, 'StandardText'));
                                                        } else {
                                                            if (RT_StandardTextKeyID > 0) {
                                                                ConfirmMsg('PP_PRODUCTIONRESOURCETOOL005','是否要使用标准文本码覆盖原有描述?',{}, 'YES_NO', {
                                                                    YES: { SetValue('RT_Notes', GetDictValue('PP_StandardTextKey', RT_StandardTextKeyID, 'StandardText')) }
                                                                })
                                                            }
                                                        }]]>
                                                        </ValueChanged>
                                                    </DataBinding>
                                                    <ItemFilter>
                                                        <Filter Key="F1_Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                            <FilterValue Index="1" ParaValue="'PlantID = '&amp;SqlPara(GetValue(Macro_GetRoutingPlantID()))"/>
                                                        </Filter>
                                                    </ItemFilter>
                                                </GridCell>
                                                <GridCell Key="RT_Notes" Caption="描述" CellType="TextEditor" MaxLength="100" Trim="true">
                                                    <DataBinding ColumnKey="Notes"/>
                                                </GridCell>
                                                <GridCell Key="RT_SystemStatusText" Caption="系统状态" CellType="TextEditor" MaxLength="100" Trim="true">
                                                    <DataBinding ColumnKey="SystemStatusText" ValueDependency="ES_IsActive,ES_ERPSystemStatusID">
                                                        <DefaultFormulaValue>
                                                            <![CDATA[com.bokesoft.erp.basis.status.StatusFormula.getSysStatusLineExtra(RT_OID, 'OVG')]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_UserStatusText" Caption="用户状态" CellType="TextEditor" MaxLength="100" Trim="true">
                                                    <DataBinding ColumnKey="UserStatusText" ValueDependency="EU_IsActive,EU_ERPUserStatusID，EW_ERPUserStatusID,EW_IsActive">
                                                        <DefaultFormulaValue>
                                                            <![CDATA[com.bokesoft.erp.basis.status.StatusFormula.getUserStatusLineExtra(RT_OID, 'OVG')]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_BaseQuantity" Caption="基本单位数量" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="BaseQuantity" Required="true">
                                                        <DefaultFormulaValue>
                                                            <![CDATA[IIF(PlantID>0&&ProductOrderTypeID>0, com.bokesoft.erp.pp.function.ProductionOrderFormula.seProcessDefaultValue(PlantID, ProductOrderTypeID,'Routing_BaseQuantity'), 1)]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_BaseUnitID" Caption="基本单位" CellType="Dict" ItemKey="Unit">
                                                    <DataBinding ColumnKey="BaseUnitID" DefaultFormulaValue="BaseUnitID"/>
                                                </GridCell>
                                                <GridCell Key="RT_UnitID" Caption="工序单位" CellType="Dict" ItemKey="Unit">
                                                    <DataBinding ColumnKey="UnitID" DefaultFormulaValue="RT_BaseUnitID">
                                                        <CheckRule>
                                                            <![CDATA[IIFS(
                                                                             GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing') == '+' && RT_UnitID <= 0,
                                                                             MessageFacade('PP_PRODUCTIONORDER056','外协工序，请输入订单单位'),
                                                                             RT_PurchaseInfoRecordID > 0 && GetDictValue('MM_PurchaseInfoRecord', RT_PurchaseInfoRecordID, 'PurchaseUnitID') != RT_UnitID,
                                                                             MessageFacade('06739','基准单位 {1} 与订货单位 {2} 不匹配', GetDictValue('Unit', RT_UnitID, 'Code'), GetDictValue('Unit', GetDictValue('MM_PurchaseInfoRecord', RT_PurchaseInfoRecordID, 'PurchaseUnitID'), 'Code')),
                                                                             true, true)]]>
                                                        </CheckRule>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_IsComponentAllocation" Caption="物料" CellType="CheckBox">
                                                    <DataBinding ColumnKey="IsComponentAllocation"/>
                                                </GridCell>
                                                <GridCell Key="RT_IsAssembleTriggerPoint" Caption="触发点" CellType="CheckBox">
                                                    <DataBinding ColumnKey="RT_IsAssembleTriggerPoint"/>
                                                </GridCell>
                                                <GridCell Key="RT_BaseUnitNumerator" Caption="工序分子" CellType="NumberEditor" Precision="9" Scale="0">
                                                    <DataBinding ColumnKey="BaseUnitNumerator">
                                                        <CheckRule>
                                                            <![CDATA[IIF(RT_BaseUnitNumerator==0, MessageFacade('PP_PRODUCTIONORDER051','工序分子不能为空'))]]>
                                                        </CheckRule>
                                                        <DefaultFormulaValue>
                                                            <![CDATA[IIF(PlantID>0&&ProductOrderTypeID>0, com.bokesoft.erp.pp.function.ProductionOrderFormula.seProcessDefaultValue(PlantID, ProductOrderTypeID,'Process2Numerator'), 1)]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_BaseUnitDenominator" Caption="工序分母" CellType="NumberEditor" Precision="9">
                                                    <DataBinding ColumnKey="BaseUnitDenominator">
                                                        <CheckRule>
                                                            <![CDATA[IIF(RT_BaseUnitDenominator==0, MessageFacade('PP_PRODUCTIONORDER052','工序分母不能为空'))]]>
                                                        </CheckRule>
                                                        <DefaultFormulaValue>
                                                            <![CDATA[IIF(PlantID>0&&ProductOrderTypeID>0, com.bokesoft.erp.pp.function.ProductionOrderFormula.seProcessDefaultValue(PlantID, ProductOrderTypeID,'Process2Denominator'), 1)]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_ProcessBaseQuantity" Caption="工序数量" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="ProcessBaseQuantity">
                                                        <DefaultFormulaValue>
                                                            <![CDATA[IIF(TotalBaseQuantity>0,com.bokesoft.erp.pp.function.ProductionOrderFormula.getDefaultProcessQuantity(),RT_ProcessBaseQuantity)]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_ProcessQuantity" Caption="工序数量" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="ProcessQuantity">
                                                        <DefaultFormulaValue>
                                                            <![CDATA[IIF(RT_BaseUnitNumerator>0&&RT_BaseUnitDenominator>0,RT_ProcessBaseQuantity*RT_BaseUnitDenominator/RT_BaseUnitNumerator)]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_DemandConfirmBaseQuantity" Caption="需要确认数量" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="DemandConfirmBaseQuantity" DefaultFormulaValue="TotalBaseQuantity"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_DemandConfirmQuantity" Caption="需要确认数量" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="DemandConfirmQuantity">
                                                        <DefaultFormulaValue>
                                                            <![CDATA[IIF(RT_BaseUnitNumerator>0&&RT_BaseUnitDenominator>0,RT_DemandConfirmBaseQuantity*RT_BaseUnitDenominator/RT_BaseUnitNumerator)]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_ConfirmBaseQuantity" Caption="确认数量" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="ConfirmBaseQuantity"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_ConfirmQuantity" Caption="确认数量" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="ConfirmQuantity"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_ProcessScrapRate" Caption="工序报废率(%)" CellType="NumberEditor" Precision="5">
                                                    <DataBinding ColumnKey="ProcessScrapRate">
                                                        <ValueChanged>
                                                            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.modifyProcessQuantityByProcessScrapeQuantity();]]>
                                                        </ValueChanged>
                                                    </DataBinding>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_ProcessScrapeBaseQuantity" Caption="废品数" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="ProcessScrapeBaseQuantity">
                                                        <DefaultFormulaValue>
                                                            <![CDATA[IIF(RT_ProcessBaseQuantity>0,com.bokesoft.erp.basis.unit.UnitFormula.setScaleByUnit(RT_ProcessBaseQuantity*RT_ProcessScrapRate/100,RT_BaseUnitID,0),0)]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_ProcessScrapeQuantity" Caption="废品数" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="ProcessScrapeQuantity">
                                                        <DefaultFormulaValue>
                                                            <![CDATA[IIF(RT_BaseUnitNumerator>0&&RT_BaseUnitDenominator>0,RT_ProcessScrapeBaseQuantity*RT_BaseUnitDenominator/RT_BaseUnitNumerator)]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_ConfirmScrapeBaseQuantity" Caption="确认废品数" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="ConfirmScrapeBaseQuantity"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_ConfirmScrapeQuantity" Caption="确认废品数" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="ConfirmScrapeQuantity"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_MaterialID" Caption="物料" CellType="Dict" ItemKey="Material">
                                                    <DataBinding ColumnKey="MaterialID" DefaultFormulaValue="MaterialID"/>
                                                </GridCell>
                                                <GridCell Key="RT_HeadEndDate" Caption="结束日期" CellType="UTCDatePicker">
                                                    <DataBinding ColumnKey="HeadEndDate"/>
                                                </GridCell>
                                                <GridCell Key="RT_ConfirmReworkQuantity" Caption="返工" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="ConfirmReworkQuantity"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_StandardValueKeyID" Caption="标准值码" CellType="Dict" ItemKey="PP_StandardValueKey">
                                                    <DataBinding ColumnKey="StandardValueKeyID"/>
                                                </GridCell>
                                                <GridCell Key="RT_IsOutsourcing" Caption="外协组件" CellType="CheckBox">
                                                    <DataBinding ColumnKey="IsOutsourcing">
                                                        <ValueChanged>
                                                            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.setOutsourcingProcess(RT_ItemNo,RT_IsOutsourcing);]]>
                                                        </ValueChanged>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_PurchasingOrganizationID" Caption="采购组织" CellType="Dict" ItemKey="PurchasingOrganization">
                                                    <DataBinding ColumnKey="PurchasingOrganizationID">
                                                        <CheckRule>
                                                            <![CDATA[IIF(RT_PurchaseInfoRecordID>0&&RT_PurchasingOrganizationID<=0,MessageFacade('PP_PRODUCTIONORDER053','请输入采购信息记录的采购组织'),true)]]>
                                                        </CheckRule>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_PurchaseInfoRecordID" Caption="采购信息记录" CellType="Dict" ItemKey="MM_PurchaseInfoRecord">
                                                    <DataBinding ColumnKey="PurchaseInfoRecordID"/>
                                                </GridCell>
                                                <GridCell Key="RT_CostElementID" Caption="成本要素" CellType="Dict" ItemKey="CO_CostElement">
                                                    <DataBinding ColumnKey="CostElementID">
                                                        <CheckRule>
                                                            <![CDATA[IIF(GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&&RT_CostElementID<=0,MessageFacade('PP_PRODUCTIONORDER054','外协工序,必须输入成本要素'),true)]]>
                                                        </CheckRule>
                                                    </DataBinding>
                                                    <ItemFilter ItemKey="CO_CostElement">
                                                        <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                            <FilterValue Index="1" ParaValue="'IsPrimaryCostEle='&amp;SqlPara(1)"/>
                                                        </Filter>
                                                    </ItemFilter>
                                                </GridCell>
                                                <GridCell Key="RT_SortItem" Caption="排序字符串" CellType="TextEditor" MaxLength="100" Trim="true">
                                                    <DataBinding ColumnKey="SortItem">
                                                        <DefaultFormulaValue>
                                                            <![CDATA[GetDictValue('MM_PurchaseInfoRecord', RT_PurchaseInfoRecordID, 'SortTerm')]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_MaterialGroupID" Caption="物料组" CellType="Dict" ItemKey="MaterialGroup">
                                                    <DataBinding ColumnKey="MaterialGroupID">
                                                        <CheckRule>
                                                            <![CDATA[IIF(GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&&RT_MaterialGroupID<=0,MessageFacade('PP_PRODUCTIONORDER055','外协工序，请输入物料组'),true)]]>
                                                        </CheckRule>
                                                        <DefaultFormulaValue>
                                                            <![CDATA[IIF(GetDictValue('MM_PurchaseInfoRecord', RT_PurchaseInfoRecordID, 'MaterialID')>0, GetDictValue('Material', GetDictValue('MM_PurchaseInfoRecord', RT_PurchaseInfoRecordID, 'MaterialID'), 'MaterialGroupID'), GetDictValue('MM_PurchaseInfoRecord', RT_PurchaseInfoRecordID, 'MaterialGroupID'))]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_VendorID" Caption="供应商" CellType="Dict" ItemKey="Vendor">
                                                    <DataBinding ColumnKey="VendorID">
                                                        <DefaultFormulaValue>
                                                            <![CDATA[GetDictValue('MM_PurchaseInfoRecord', RT_PurchaseInfoRecordID, 'VendorID')]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_PurchaseUnitID" Caption="订单单位" CellType="Dict" ItemKey="Unit">
                                                    <DataBinding ColumnKey="PurchaseUnitID" DefaultFormulaValue="RT_UnitID"/>
                                                </GridCell>
                                                <GridCell Key="RT_PurchasingGroupID" Caption="采购组" CellType="Dict" ItemKey="PurchasingGroup">
                                                    <DataBinding ColumnKey="PurchasingGroupID">
                                                        <CheckRule>
                                                            <![CDATA[IIF(GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&&RT_PurchasingGroupID<=0,MessageFacade('PP_PRODUCTIONORDER073','外协工序，请输入采购组'),true)]]>
                                                        </CheckRule>
                                                        <DefaultFormulaValue>
                                                            <![CDATA[IIF(RT_PurchaseInfoRecordID>0&&RT_PurchasingOrganizationID>0,Macro_GetPurchaseInfoRecordOrgPropAllowNull('PurchasingGroupID'),RT_PurchasingGroupID)]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_PlannedDeliveryDays" Caption="计划交付时间(天)" CellType="NumberEditor" Precision="9" Scale="0" UseGroupingSeparator="false">
                                                    <DataBinding ColumnKey="PlannedDeliveryDays">
                                                        <CheckRule>
                                                            <![CDATA[IIF(GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&&RT_PlannedDeliveryDays<0,MessageFacade('PP_PRODUCTIONORDER057','外协工序，请输入订计划交付时间'),true)]]>
                                                        </CheckRule>
                                                        <DefaultFormulaValue>
                                                            <![CDATA[IIF(RT_PurchaseInfoRecordID>0&&RT_PurchasingOrganizationID>0,Macro_GetPurchaseInfoRecordOrgPropAllowNull('PlannedDeliveryTime'),RT_PlannedDeliveryDays)]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_PriceQuantity" Caption="价格数量" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="PriceQuantity" ValueDependency="RT_ControlCodeID">
                                                        <CheckRule>
                                                            <![CDATA[IIF(GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&&RT_PriceQuantity<=0,MessageFacade('PP_PRODUCTIONORDER058','外协工序，请输入大于0的价格数量'),true)]]>
                                                        </CheckRule>
                                                        <DefaultFormulaValue>
                                                            <![CDATA[IIFS(RT_PurchaseInfoRecordID>0&&RT_PurchasingOrganizationID>0,Macro_GetPurchaseInfoRecordCondDtl('NetPriceQuantity'),RT_PriceQuantity>0,RT_PriceQuantity,true,1)]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_NetPrice" Caption="净价" CellType="NumberEditor" Scale="6">
                                                    <DataBinding ColumnKey="NetPrice">
                                                        <DefaultFormulaValue>
                                                            <![CDATA[IIF(RT_PurchaseInfoRecordID>0&&RT_PurchasingOrganizationID>0,Macro_GetPurchaseInfoRecordCondDtl('NetPrice'),RT_NetPrice)]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_CurrencyID" Caption="币种" CellType="Dict" ItemKey="Currency">
                                                    <DataBinding ColumnKey="CurrencyID">
                                                        <CheckRule>
                                                            <![CDATA[IIF(GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&&RT_CurrencyID<=0,MessageFacade('PP_PRODUCTIONORDER059','外协工序，请输入币种'),true)]]>
                                                        </CheckRule>
                                                        <DefaultFormulaValue>
                                                            <![CDATA[IIF(RT_PurchaseInfoRecordID>0&&RT_PurchasingOrganizationID>0,Macro_GetPurchaseInfoRecordCondDtl('NetPriceCurrencyID'),RT_CurrencyID)]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_IsRequiredSplitting" Caption="所需分解" CellType="CheckBox">
                                                    <DataBinding ColumnKey="IsRequiredSplitting"/>
                                                </GridCell>
                                                <GridCell Key="RT_MaxSplittingNumber" Caption="最大拆分数" CellType="NumberEditor" Precision="9" Scale="0" UseGroupingSeparator="false">
                                                    <DataBinding ColumnKey="MaxSplittingNumber"/>
                                                </GridCell>
                                                <GridCell Key="RT_ActualSplittingNumber" Caption="实际拆分数" CellType="NumberEditor" Precision="9" Scale="0" UseGroupingSeparator="false">
                                                    <DataBinding ColumnKey="ActualSplittingNumber" DefaultValue="1"/>
                                                </GridCell>
                                                <GridCell Key="RT_MinProcessingTime" Caption="最短处理时间" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="MinProcessingTime"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_CapacityUnitID" Caption="能力单位" CellType="Dict" ItemKey="Unit">
                                                    <DataBinding ColumnKey="CapacityUnitID"/>
                                                </GridCell>
                                                <GridCell Key="RT_IsHasPurchaseOrder" Caption="存在采购订单" CellType="CheckBox">
                                                    <DataBinding ColumnKey="RT_IsHasPurchaseOrder">
                                                        <DefaultFormulaValue>
                                                            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.isExistPurchaseOrder(RT_PurchaseReqSOID, RT_PurchaseOrderItemNo)]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_PurchaseReqSOID" Caption="采购申请" CellType="Dict" ItemKey="MM_PurchaseRequisition__Dic" StateMask="Enable|Disable|Discard">
                                                    <DataBinding ColumnKey="PurchaseReqSOID"/>
                                                </GridCell>
                                                <GridCell Key="RT_PurchaseRequisitionDtlOID" Caption="采购申请详情" CellType="NumberEditor" Scale="0">
                                                    <DataBinding ColumnKey="PurchaseRequisitionDtlOID"/>
                                                </GridCell>
                                                <GridCell Key="RT_PurchaseOrderItemNo" Caption="行号" CellType="NumberEditor" Precision="9" Scale="0" UseGroupingSeparator="false">
                                                    <DataBinding ColumnKey="PurchaseOrderItemNo"/>
                                                </GridCell>
                                                <GridCell Key="RT_RoutingProcessDtlOID" Caption="RT_RoutingProcessDtlOID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                                    <DataBinding ColumnKey="RoutingProcessDtlOID"/>
                                                </GridCell>
                                                <GridCell Key="RT_StandardQueueSpendTime" Caption="标准排队时间" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="StandardQueueSpendTime"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_StandardQueueTimeUnitID" Caption="单位" CellType="Dict" ItemKey="Unit">
                                                    <DataBinding ColumnKey="StandardQueueTimeUnitID"/>
                                                    <ItemFilter ItemKey="Unit">
                                                        <Filter Type="FieldValue">
                                                            <FilterValue DataType="Long" FieldKey="UnitSystemID" RefValue="SystemUnitIDOfTime" Type="Field"/>
                                                        </Filter>
                                                    </ItemFilter>
                                                </GridCell>
                                                <GridCell Key="RT_MinimumQueueSpendTime" Caption="最少排队时间" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="MinimumQueueSpendTime"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_MinimumQueueTimeUnitID" Caption="单位" CellType="Dict" ItemKey="Unit">
                                                    <DataBinding ColumnKey="MinimumQueueTimeUnitID"/>
                                                    <ItemFilter ItemKey="Unit">
                                                        <Filter Type="FieldValue">
                                                            <FilterValue DataType="Long" FieldKey="UnitSystemID" RefValue="SystemUnitIDOfTime" Type="Field"/>
                                                        </Filter>
                                                    </ItemFilter>
                                                </GridCell>
                                                <GridCell Key="RT_MaximumWaitSpendTime" Caption="最大等待时间" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="MaximumWaitSpendTime"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_MaximumWaitTimeUnitID" Caption="单位" CellType="Dict" ItemKey="Unit">
                                                    <DataBinding ColumnKey="MaximumWaitTimeUnitID"/>
                                                    <ItemFilter ItemKey="Unit">
                                                        <Filter Type="FieldValue">
                                                            <FilterValue DataType="Long" FieldKey="UnitSystemID" RefValue="SystemUnitIDOfTime" Type="Field"/>
                                                        </Filter>
                                                    </ItemFilter>
                                                </GridCell>
                                                <GridCell Key="RT_MinimumWaitSpendTime" Caption="最少等待时间" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="MinimumWaitSpendTime"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_MinimumWaitTimeUnitID" Caption="单位" CellType="Dict" ItemKey="Unit">
                                                    <DataBinding ColumnKey="MinimumWaitTimeUnitID"/>
                                                    <ItemFilter ItemKey="Unit">
                                                        <Filter Type="FieldValue">
                                                            <FilterValue DataType="Long" FieldKey="UnitSystemID" RefValue="SystemUnitIDOfTime" Type="Field"/>
                                                        </Filter>
                                                    </ItemFilter>
                                                </GridCell>
                                                <GridCell Key="RT_StandardMoveSpendTime" Caption="标准转运时间" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="StandardMoveSpendTime"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_StandardMoveTimeUnitID" Caption="单位" CellType="Dict" ItemKey="Unit">
                                                    <DataBinding ColumnKey="StandardMoveTimeUnitID"/>
                                                    <ItemFilter ItemKey="Unit">
                                                        <Filter Type="FieldValue">
                                                            <FilterValue DataType="Long" FieldKey="UnitSystemID" RefValue="SystemUnitIDOfTime" Type="Field"/>
                                                        </Filter>
                                                    </ItemFilter>
                                                </GridCell>
                                                <GridCell Key="RT_MinimumMoveSpendTime" Caption="最少转运时间" CellType="NumberEditor" Scale="3">
                                                    <DataBinding ColumnKey="MinimumMoveSpendTime"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_MinimumMoveTimeUnitID" Caption="单位" CellType="Dict" ItemKey="Unit">
                                                    <DataBinding ColumnKey="MinimumMoveTimeUnitID"/>
                                                    <ItemFilter ItemKey="Unit">
                                                        <Filter Type="FieldValue">
                                                            <FilterValue DataType="Long" FieldKey="UnitSystemID" RefValue="SystemUnitIDOfTime" Type="Field"/>
                                                        </Filter>
                                                    </ItemFilter>
                                                </GridCell>
                                                <GridCell Key="RT_StartDate" Caption="工序开始日期" CellType="UTCDatePicker" Enable="false" Format="yyyy-MM-dd">
                                                    <DataBinding ColumnKey="StartDate"/>
                                                </GridCell>
                                                <GridCell Key="RT_StartTime" Caption="工序开始时间" CellType="TextEditor" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                                                    <DataBinding ColumnKey="StartTime"/>
                                                </GridCell>
                                                <GridCell Key="RT_EndDate" Caption="工序结束日期" CellType="UTCDatePicker" Enable="false" Format="yyyy-MM-dd">
                                                    <DataBinding ColumnKey="EndDate"/>
                                                </GridCell>
                                                <GridCell Key="RT_EndTime" Caption="工序结束时间" CellType="TextEditor" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                                                    <DataBinding ColumnKey="EndTime"/>
                                                </GridCell>
                                                <GridCell Key="RT_ProcessSpendTime" Caption="工序耗时" CellType="NumberEditor" Enable="false" Scale="3" ShowZero="true">
                                                    <DataBinding ColumnKey="ProcessSpendTime"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_ProcessTimeUnitID" Caption="单位" CellType="Dict" Enable="false" ItemKey="Unit">
                                                    <DataBinding ColumnKey="ProcessTimeUnitID"/>
                                                    <ItemFilter ItemKey="Unit">
                                                        <Filter Type="FieldValue">
                                                            <FilterValue DataType="Long" FieldKey="UnitSystemID" RefValue="SystemUnitIDOfTime" Type="Field"/>
                                                        </Filter>
                                                    </ItemFilter>
                                                </GridCell>
                                                <GridCell Key="RT_QueueSpendTime" Caption="等待耗时" CellType="NumberEditor" Enable="false" Scale="3" ShowZero="true">
                                                    <DataBinding ColumnKey="QueueSpendTime"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_QueueTimeUnitID" Caption="单位" CellType="Dict" Enable="false" ItemKey="Unit">
                                                    <DataBinding ColumnKey="QueueTimeUnitID"/>
                                                    <ItemFilter ItemKey="Unit">
                                                        <Filter Type="FieldValue">
                                                            <FilterValue DataType="Long" FieldKey="UnitSystemID" RefValue="SystemUnitIDOfTime" Type="Field"/>
                                                        </Filter>
                                                    </ItemFilter>
                                                </GridCell>
                                                <GridCell Key="RT_EarliestSetupDate" Caption="最早设置日期" CellType="UTCDatePicker" Enable="false" Format="yyyy-MM-dd">
                                                    <DataBinding ColumnKey="EarliestSetupDate"/>
                                                </GridCell>
                                                <GridCell Key="RT_EarliestSetupTime" Caption="最早设置时间" CellType="TextEditor" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                                                    <DataBinding ColumnKey="EarliestSetupTime"/>
                                                </GridCell>
                                                <GridCell Key="RT_LatestSetupDate" Caption="最晚设置日期" CellType="UTCDatePicker" Enable="false" Format="yyyy-MM-dd">
                                                    <DataBinding ColumnKey="LatestSetupDate"/>
                                                </GridCell>
                                                <GridCell Key="RT_LatestSetupTime" Caption="最晚设置时间" CellType="TextEditor" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                                                    <DataBinding ColumnKey="LatestSetupTime"/>
                                                </GridCell>
                                                <GridCell Key="RT_SetupSpendTime" Caption="设置耗时" CellType="NumberEditor" Enable="false" Scale="3" ShowZero="true">
                                                    <DataBinding ColumnKey="SetupSpendTime"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_SetupTimeUnitID" Caption="单位" CellType="Dict" Enable="false" ItemKey="Unit">
                                                    <DataBinding ColumnKey="SetupTimeUnitID"/>
                                                    <ItemFilter ItemKey="Unit">
                                                        <Filter Type="FieldValue">
                                                            <FilterValue DataType="Long" FieldKey="UnitSystemID" RefValue="SystemUnitIDOfTime" Type="Field"/>
                                                        </Filter>
                                                    </ItemFilter>
                                                </GridCell>
                                                <GridCell Key="RT_EarliestProcessingDate" Caption="最早加工日期" CellType="UTCDatePicker" Enable="false" Format="yyyy-MM-dd">
                                                    <DataBinding ColumnKey="EarliestProcessingDate"/>
                                                </GridCell>
                                                <GridCell Key="RT_EarliestProcessingTime" Caption="最早加工时间" CellType="TextEditor" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                                                    <DataBinding ColumnKey="EarliestProcessingTime"/>
                                                </GridCell>
                                                <GridCell Key="RT_LatestProcessingDate" Caption="最晚加工日期" CellType="UTCDatePicker" Enable="false" Format="yyyy-MM-dd">
                                                    <DataBinding ColumnKey="LatestProcessingDate"/>
                                                </GridCell>
                                                <GridCell Key="RT_LatestProcessingTime" Caption="最晚加工时间" CellType="TextEditor" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                                                    <DataBinding ColumnKey="LatestProcessingTime"/>
                                                </GridCell>
                                                <GridCell Key="RT_ProcessingSpendTime" Caption="加工耗时" CellType="NumberEditor" Enable="false" Scale="3" ShowZero="true">
                                                    <DataBinding ColumnKey="ProcessingSpendTime"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_ProcessingTimeUnitID" Caption="单位" CellType="Dict" Enable="false" ItemKey="Unit">
                                                    <DataBinding ColumnKey="ProcessingTimeUnitID"/>
                                                    <ItemFilter ItemKey="Unit">
                                                        <Filter Type="FieldValue">
                                                            <FilterValue DataType="Long" FieldKey="UnitSystemID" RefValue="SystemUnitIDOfTime" Type="Field"/>
                                                        </Filter>
                                                    </ItemFilter>
                                                </GridCell>
                                                <GridCell Key="RT_EarliestTearDownStartDate" Caption="最早拆卸开始日期" CellType="UTCDatePicker" Enable="false" Format="yyyy-MM-dd">
                                                    <DataBinding ColumnKey="EarliestTearDownStartDate"/>
                                                </GridCell>
                                                <GridCell Key="RT_EarliestTearDownStartTime" Caption="最早拆卸开始时间" CellType="TextEditor" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                                                    <DataBinding ColumnKey="EarliestTearDownStartTime"/>
                                                </GridCell>
                                                <GridCell Key="RT_EarliestTearDownEndDate" Caption="最早拆卸结束日期" CellType="UTCDatePicker" Enable="false" Format="yyyy-MM-dd">
                                                    <DataBinding ColumnKey="EarliestTearDownEndDate"/>
                                                </GridCell>
                                                <GridCell Key="RT_EarliestTearDownEndTime" Caption="最早拆卸结束时间" CellType="TextEditor" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                                                    <DataBinding ColumnKey="EarliestTearDownEndTime"/>
                                                </GridCell>
                                                <GridCell Key="RT_LatestTearDownStartDate" Caption="最晚拆卸开始日期" CellType="UTCDatePicker" Enable="false" Format="yyyy-MM-dd">
                                                    <DataBinding ColumnKey="LatestTearDownStartDate"/>
                                                </GridCell>
                                                <GridCell Key="RT_LatestTearDownStartTime" Caption="最晚拆卸开始时间" CellType="TextEditor" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                                                    <DataBinding ColumnKey="LatestTearDownStartTime"/>
                                                </GridCell>
                                                <GridCell Key="RT_LatestTearDownEndDate" Caption="最晚拆卸结束日期" CellType="UTCDatePicker" Enable="false" Format="yyyy-MM-dd">
                                                    <DataBinding ColumnKey="LatestTearDownEndDate"/>
                                                </GridCell>
                                                <GridCell Key="RT_LatestTearDownEndTime" Caption="最晚拆卸结束时间" CellType="TextEditor" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                                                    <DataBinding ColumnKey="LatestTearDownEndTime"/>
                                                </GridCell>
                                                <GridCell Key="RT_TearDownSpendTime" Caption="拆卸耗时" CellType="NumberEditor" Enable="false" Scale="3" ShowZero="true">
                                                    <DataBinding ColumnKey="TearDownSpendTime"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_TearDownTimeUnitID" Caption="单位" CellType="Dict" Enable="false" ItemKey="Unit">
                                                    <DataBinding ColumnKey="TearDownTimeUnitID"/>
                                                    <ItemFilter ItemKey="Unit">
                                                        <Filter Type="FieldValue">
                                                            <FilterValue DataType="Long" FieldKey="UnitSystemID" RefValue="SystemUnitIDOfTime" Type="Field"/>
                                                        </Filter>
                                                    </ItemFilter>
                                                </GridCell>
                                                <GridCell Key="RT_EarliestWaitStartDate" Caption="最早等待开始日期" CellType="UTCDatePicker" Enable="false" Format="yyyy-MM-dd">
                                                    <DataBinding ColumnKey="EarliestWaitStartDate"/>
                                                </GridCell>
                                                <GridCell Key="RT_EarliestWaitStartTime" Caption="最早等待开始时间" CellType="TextEditor" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                                                    <DataBinding ColumnKey="EarliestWaitStartTime"/>
                                                </GridCell>
                                                <GridCell Key="RT_EarliestWaitEndDate" Caption="最早等待结束日期" CellType="UTCDatePicker" Enable="false" Format="yyyy-MM-dd">
                                                    <DataBinding ColumnKey="EarliestWaitEndDate"/>
                                                </GridCell>
                                                <GridCell Key="RT_EarliestWaitEndTime" Caption="最早等待结束时间" CellType="TextEditor" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                                                    <DataBinding ColumnKey="EarliestWaitEndTime"/>
                                                </GridCell>
                                                <GridCell Key="RT_LatestWaitStartDate" Caption="最晚等待开始日期" CellType="UTCDatePicker" Enable="false" Format="yyyy-MM-dd">
                                                    <DataBinding ColumnKey="LatestWaitStartDate"/>
                                                </GridCell>
                                                <GridCell Key="RT_LatestWaitStartTime" Caption="最晚等待开始时间" CellType="TextEditor" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                                                    <DataBinding ColumnKey="LatestWaitStartTime"/>
                                                </GridCell>
                                                <GridCell Key="RT_LatestWaitEndDate" Caption="最晚等待结束日期" CellType="UTCDatePicker" Enable="false" Format="yyyy-MM-dd">
                                                    <DataBinding ColumnKey="LatestWaitEndDate"/>
                                                </GridCell>
                                                <GridCell Key="RT_LatestWaitEndTime" Caption="最晚等待结束时间" CellType="TextEditor" Enable="false" InvalidChars=" " MaxLength="10" Trim="true">
                                                    <DataBinding ColumnKey="LatestWaitEndTime"/>
                                                </GridCell>
                                                <GridCell Key="RT_WaitSpendTime" Caption="等待耗时" CellType="NumberEditor" Enable="false" Scale="3" ShowZero="true">
                                                    <DataBinding ColumnKey="WaitSpendTime"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_WaitTimeUnitID" Caption="单位" CellType="Dict" Enable="false" ItemKey="Unit">
                                                    <DataBinding ColumnKey="WaitTimeUnitID"/>
                                                    <ItemFilter ItemKey="Unit">
                                                        <Filter Type="FieldValue">
                                                            <FilterValue DataType="Long" FieldKey="UnitSystemID" RefValue="SystemUnitIDOfTime" Type="Field"/>
                                                        </Filter>
                                                    </ItemFilter>
                                                </GridCell>
                                                <GridCell Key="RT_MoveSpendTime" Caption="转运耗时" CellType="NumberEditor" Enable="false" Scale="3" ShowZero="true">
                                                    <DataBinding ColumnKey="MoveSpendTime"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_MoveTimeUnitID" Caption="单位" CellType="Dict" Enable="false" ItemKey="Unit">
                                                    <DataBinding ColumnKey="MoveTimeUnitID"/>
                                                    <ItemFilter ItemKey="Unit">
                                                        <Filter Type="FieldValue">
                                                            <FilterValue DataType="Long" FieldKey="UnitSystemID" RefValue="SystemUnitIDOfTime" Type="Field"/>
                                                        </Filter>
                                                    </ItemFilter>
                                                </GridCell>
                                                <GridCell Key="RT_IsCapacityRelevant" Caption="能力相关" CellType="CheckBox">
                                                    <DataBinding ColumnKey="IsCapacityRelevant"/>
                                                </GridCell>
                                                <GridCell Key="RT_ConfirmType" Caption="确认方式" CellType="ComboBox" IntegerValue="true" GroupKey="RT_ConfirmType" SourceType="ParaGroup">
                                                    <DataBinding ColumnKey="ConfirmType" DefaultValue="0"/>
                                                </GridCell>
                                                <GridCell Key="WorkCenter_CheckRule" Caption="工作中心检查规则辅助字段" CellType="NumberEditor">
                                                    <DataBinding ColumnKey="WorkCenter_CheckRule" DefaultFormulaValue="IIF(RT_WorkCenterID&gt;0,Macro_SetCostAndArea())" ValueDependency="BasicStartDate,BasicEndDate"/>
                                                    <CellFormat HAlign="Right"/>
                                                </GridCell>
                                                <GridCell Key="RT_SOID" CellType="NumberEditor" CopyNew="false" Scale="0">
                                                    <DataBinding ColumnKey="SOID"/>
                                                </GridCell>
                                                <GridCell Key="RT_CostCenterID" Caption="成本中心" CellType="Dict" ItemKey="CostCenter">
                                                    <DataBinding ColumnKey="CostCenterID"/>
                                                </GridCell>
                                                <GridCell Key="RT_ControllingAreaID" Caption="控制范围" CellType="Dict" ItemKey="ControllingArea">
                                                    <DataBinding ColumnKey="ControllingAreaID"/>
                                                </GridCell>
                                                <GridCell Key="RT_CostValidID" Caption="成本核算有效期" CellType="NumberEditor" Scale="0">
                                                    <DataBinding ColumnKey="CostValidID"/>
                                                </GridCell>
                                                <GridCell Key="RT_IsNewRouting" Caption="新增的工序" CellType="CheckBox">
                                                    <DataBinding ColumnKey="IsNewRouting">
                                                        <DefaultFormulaValue>
                                                                <![CDATA[IIF(RT_IsNewRouting == 1, 1, com.bokesoft.erp.pp.function.ProductionOrderFormula.condIfNewRouting(RT_OID));]]>
                                                            </DefaultFormulaValue>
                                                    </DataBinding>
                                                </GridCell>
                                                <GridCell Key="RT_IsDeleted" Caption="工序已被删除" CellType="CheckBox">
                                                    <DataBinding ColumnKey="IsDeleted">
                                                        <DefaultFormulaValue>
                                                            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.isRoutingBeDeleted(RT_OID)]]>
                                                        </DefaultFormulaValue>
                                                    </DataBinding>
                                                </GridCell>
                                            </GridRow>
                                        </GridRowCollection>
                                        <RowClick>
                                            <![CDATA[SetPara('DetailStatusOID', RT_OID);IIF(Length(Trim(RT_ItemNo))>0, SetValue('BeforeProcessNo',RT_ItemNo));IIF(Length(Trim(RT_SuperiorItemNo))>0, SetValue('BeforeSuperiorProcessNo_Routing',RT_SuperiorItemNo));]]>
                                        </RowClick>
                                        <RowDblClick>
                                            <![CDATA[if(!ReadOnly()&&Macro_IsATPCheck()){ERPShowModal('MM_ATPOverView_Rpt','Macro_PP_ProductionOrder_ShowEvent('&'"'&ATPPlantID&'","'&ATPMaterialID&'","'&ProductOrderTypeID&'","'&ProductPlantID&'","'&PlantID&'","'&MaterialID&'","'&CheckingGroupID&'","'&CheckingRuleID&'","'&ATPRequirementDate&'","'&ATPRequirementQuantity&'","'&ATPStorageLocationID&'","'&RelationBillDtlID&'","'&SOID&'","'&Dtl_SpecialIdentity&'","'&DynIdentityID&'"'&')')}]]>
                                        </RowDblClick>
                                        <RowInsert>
                                            <![CDATA[Macro_OnProcessAdd()]]>
                                        </RowInsert>
                                        <OnRowDelete>
                                            <![CDATA[Macro_DeleteDtl_2_ButtonClickTrg();]]>
                                        </OnRowDelete>
                                    </Grid>
                                </SubDetail>
                            </TabPanel>
                        </FlexFlowLayoutPanel>
                        <TabPanel Key="ProductionOrderStandardValueTabPanel">
                            <SubDetail Key="ProductionOrderStandardValueSubDetail" Caption="标准值" BindingGridKey="ProductionOrderProcessListGrid">
                                <Grid Key="ProductionOrderStandardValueGrid" Caption="标准值" NewEmptyRow="false" DefaultFitWidth="true" SerialSeq="true" DisabledOption="insert,shift,delete" Padding="8px">
                                    <GridColumnCollection>
                                        <GridColumn Key="AT_IsSelect" Width="32px"/>
                                        <GridColumn Key="AT_OID" Caption="AT_OID" Visible="false" Width="80px"/>
                                        <GridColumn Key="AT_POID" Caption="AT_POID" Visible="false" Width="80px"/>
                                        <GridColumn Key="AT_ParentItemNo" Caption="工序" Width="80px"/>
                                        <GridColumn Key="AT_WorkCenterID" Caption="工作中心" Visible="Macro_DebugMode()" Width="80px"/>
                                        <GridColumn Key="AT_ParameterID" Caption="参数" Width="80px"/>
                                        <GridColumn Key="AT_ActivityTypeID" Caption="作业类型" Width="80px"/>
                                        <GridColumn Key="AT_UnitID" Caption="作业单位" Width="80px"/>
                                        <GridColumn Key="AT_ActiveTypeQuantity" Caption="作业量" Width="100px"/>
                                        <GridColumn Key="AT_MaintenanceRule" Caption="维护规则" Visible="Macro_DebugMode()" Width="80px"/>
                                        <GridColumn Key="AT_SOID" Visible="false" Width="80px"/>
                                        <GridColumn Key="AT_ControllingAreaID" Caption="控制范围" Visible="false" Width="80px"/>
                                    </GridColumnCollection>
                                    <GridRowCollection>
                                        <GridRow Key="ProductionOrderStandardValueGridRow" TableKey="EPP_ProductionOrder_ActiveType">
                                            <GridCell Key="AT_IsSelect" Caption="选择" CellType="CheckBox" IsSelect="true"/>
                                            <GridCell Key="AT_OID" Caption="AT_OID" CellType="NumberEditor" Enable="false" Scale="0">
                                                <DataBinding ColumnKey="OID"/>
                                            </GridCell>
                                            <GridCell Key="AT_POID" Caption="AT_POID" CellType="NumberEditor" Enable="false" Scale="0" UseGroupingSeparator="false">
                                                <DataBinding ColumnKey="POID"/>
                                            </GridCell>
                                            <GridCell Key="AT_ParentItemNo" Caption="工序" CellType="TextEditor" Enable="false" MaxLength="100" Trim="true">
                                                <DataBinding ColumnKey="ParentItemNo"/>
                                            </GridCell>
                                            <GridCell Key="AT_WorkCenterID" Caption="工作中心" CellType="Dict" Enable="false" ItemKey="WorkCenter">
                                                <DataBinding ColumnKey="WorkCenterID"/>
                                            </GridCell>
                                            <GridCell Key="AT_ParameterID" Caption="参数" CellType="Dict" Enable="false" ItemKey="PP_Parameter">
                                                <DataBinding ColumnKey="ParameterID"/>
                                            </GridCell>
                                            <GridCell Key="AT_ActivityTypeID" Caption="作业类型" CellType="Dict" Enable="Macro_RoutingEditable()&amp;&amp;AT_MaintenanceRule&gt;0" ItemKey="CO_ActivityType">
                                                <DataBinding ColumnKey="ActivityTypeID"/>
                                                <ItemFilter>
                                                    <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                        <FilterValue Index="1" ParaValue="IIF(AT_WorkCenterID&gt;0, 'ControllingAreaID='&amp;SqlPara(AT_ControllingAreaID), '1=1')"/>
                                                    </Filter>
                                                </ItemFilter>
                                            </GridCell>
                                            <GridCell Key="AT_UnitID" Caption="作业单位" CellType="Dict" Enable="Macro_RoutingEditable()&amp;&amp;AT_MaintenanceRule&gt;0" ItemKey="Unit">
                                                <DataBinding ColumnKey="UnitID">
                                                    <CheckRule>
                                                        <![CDATA[IIF(AT_MaintenanceRule==1&&AT_UnitID<=0||AT_MaintenanceRule==2&&AT_UnitID<=0&&AT_ActiveTypeQuantity>0,MessageFacade('PP_PRODUCTIONORDER061','作业单位不能为空'), com.bokesoft.erp.pp.masterdata.RoutingFormula.checkActivityUnit(AT_UnitID, AT_ParameterID))]]>
                                                    </CheckRule>
                                                </DataBinding>
                                                <ItemFilter ItemKey="Unit">
                                                    <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                                        <FilterValue Index="1" ParaValue="IIF(AT_ParameterID&gt;0, 'UnitsystemID = '&amp;SqlPara(com.bokesoft.erp.pp.masterdata.WorkCenterFormula.getUnitSystemOfParameterID(AT_ParameterID)), '1=2')"/>
                                                    </Filter>
                                                </ItemFilter>
                                            </GridCell>
                                            <GridCell Key="AT_ActiveTypeQuantity" Caption="作业量" CellType="NumberEditor" Enable="Macro_RoutingEditable()&amp;&amp;AT_MaintenanceRule&gt;0" Scale="3">
                                                <DataBinding ColumnKey="ActiveTypeQuantity">
                                                    <CheckRule>
                                                        <![CDATA[IIF(AT_MaintenanceRule==1&&AT_ActiveTypeQuantity<=0||AT_MaintenanceRule==2&&AT_ActiveTypeQuantity<0,MessageFacade('PP_PRODUCTIONORDER062','作业量必须大于0'),true)]]>
                                                    </CheckRule>
                                                </DataBinding>
                                                <CellFormat HAlign="Right"/>
                                            </GridCell>
                                            <GridCell Key="AT_MaintenanceRule" Caption="维护规则" CellType="ComboBox" Enable="false" IntegerValue="true" GroupKey="MaintenanceRule" SourceType="ParaGroup">
                                                <DataBinding ColumnKey="MaintenanceRule"/>
                                            </GridCell>
                                            <GridCell Key="AT_SOID" CellType="NumberEditor" Scale="0">
                                                <DataBinding ColumnKey="SOID"/>
                                            </GridCell>
                                            <GridCell Key="AT_ControllingAreaID" Caption="控制范围" CellType="Dict" ItemKey="ControllingArea">
                                                <DataBinding ColumnKey="ControllingAreaID"/>
                                            </GridCell>
                                        </GridRow>
                                    </GridRowCollection>
                                    <RowDblClick>
                                        <![CDATA[if(!ReadOnly()&&Macro_IsATPCheck()){ERPShowModal('MM_ATPOverView_Rpt','Macro_PP_ProductionOrder_ShowEvent('&'"'&ATPPlantID&'","'&ATPMaterialID&'","'&ProductOrderTypeID&'","'&ProductPlantID&'","'&PlantID&'","'&MaterialID&'","'&CheckingGroupID&'","'&CheckingRuleID&'","'&ATPRequirementDate&'","'&ATPRequirementQuantity&'","'&ATPStorageLocationID&'","'&RelationBillDtlID&'","'&SOID&'"'&')')}]]>
                                    </RowDblClick>
                                </Grid>
                            </SubDetail>
                            <SubDetail Key="ProductionOrderSplitSubDetail" Caption="拆分" BindingGridKey="ProductionOrderProcessListGrid">
                                <GridLayoutPanel Key="ProductionOrderSplitGridLayoutPanel" Caption="拆分" Padding="8px" OverflowY="Auto" TopPadding="24px">
                                    <CheckBox Key="RT_IsRequiredSplitting__mirror" Caption="所需分解" X="0" Y="0" Visible="true" Enable="Macro_RoutingEditable()" BindingCellKey="RT_IsRequiredSplitting"/>
                                    <NumberEditor Key="RT_MaxSplittingNumber__mirror" Caption="最大拆分数" X="1" Y="0" Visible="true" Enable="Macro_RoutingEditable()" BindingCellKey="RT_MaxSplittingNumber" IntegerValue="true" Scale="0" UseGroupingSeparator="false"/>
                                    <NumberEditor Key="RT_MinProcessingTime__mirror" Caption="最短处理时间" X="2" Y="0" Visible="true" Enable="Macro_RoutingEditable()" BindingCellKey="RT_MinProcessingTime" Scale="1"/>
                                    <Dict Key="RT_CapacityUnitID__mirror" Caption="能力单位" X="3" Y="0" Visible="true" Enable="Macro_RoutingEditable()" BindingCellKey="RT_CapacityUnitID" ItemKey="Unit"/>
                                    <NumberEditor Key="AutualSplittingNumber__mirror" Caption="实际拆分数" X="4" Y="0" Visible="true" Enable="Macro_RoutingEditable()" IntegerValue="true" Scale="0" UseGroupingSeparator="false">
                                        <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="AutualSplittingNumber__mirror"/>
                                    </NumberEditor>
                                    <RowDefCollection RowGap="24">
                                        <RowDef Height="32px"/>
                                    </RowDefCollection>
                                    <ColumnDefCollection ColumnGap="16">
                                        <ColumnDef Width="16%"/>
                                        <ColumnDef Width="16%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="17%"/>
                                    </ColumnDefCollection>
                                </GridLayoutPanel>
                            </SubDetail>
                            <SubDetail Key="ProductionOrderOutsourceSubDetail" Caption="外协" BindingGridKey="ProductionOrderProcessListGrid">
                                <GridLayoutPanel Key="ProductionOrderOutsourceGridLayoutPanel" Caption="外协" Padding="8px" OverflowY="Auto" TopPadding="24px">
                                    <Dict Key="RT_VendorID__mirror" Caption="供应商" X="0" Y="0" Visible="true" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" BindingCellKey="RT_VendorID" ItemKey="Vendor" XSpan="2"/>
                                    <CheckBox Key="RT_IsOutsourcing__mirror" Caption="外协" X="2" Y="0" Visible="true" Enable="Macro_RoutingEditable()" BindingCellKey="RT_IsOutsourcing"/>
                                    <Dict Key="RT_CostElementID__mirror" Caption="成本要素" X="4" Y="0" Visible="true" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'" BindingCellKey="RT_CostElementID" ItemKey="CO_CostElement" XSpan="2"/>
                                    <Dict Key="RT_PurchaseInfoRecordID__mirror" Caption="采购信息记录" X="0" Y="1" Visible="true" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'" BindingCellKey="RT_PurchaseInfoRecordID" ItemKey="MM_PurchaseInfoRecord"/>
                                    <Dict Key="RT_PurchasingOrganizationID__mirror" Caption="采购组织" X="1" Y="1" Visible="true" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'" BindingCellKey="RT_PurchasingOrganizationID" ItemKey="PurchasingOrganization"/>
                                    <Dict Key="RT_PurchasingGroupID__mirror" Caption="采购组" X="2" Y="1" Visible="true" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" BindingCellKey="RT_PurchasingGroupID" ItemKey="PurchasingGroup"/>
                                    <Dict Key="RT_MaterialGroupID__mirror" Caption="物料组" X="3" Y="1" Visible="true" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" BindingCellKey="RT_MaterialGroupID" ItemKey="MaterialGroup"/>
                                    <TextEditor Key="RT_SortItem__mirror" Caption="排序字符串" X="4" Y="1" Visible="true" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" BindingCellKey="RT_SortItem" MaxLength="100" Trim="true"/>
                                    <NumberEditor Key="RT_PriceQuantity__mirror" Caption="数量" X="0" Y="2" Visible="true" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" BindingCellKey="RT_PriceQuantity" Scale="3"/>
                                    <Dict Key="RT_PurchaseUnitID__mirror" Caption="订单单位" X="1" Y="2" Visible="true" Enable="Macro_RoutingEditable()" BindingCellKey="RT_UnitID" ItemKey="Unit"/>
                                    <NumberEditor Key="RT_NetPrice__mirror" Caption="净价" X="2" Y="2" Visible="true" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" BindingCellKey="RT_NetPrice" Scale="6"/>
                                    <Dict Key="RT_CurrencyID__mirror" Caption="币种" X="3" Y="2" Visible="true" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" BindingCellKey="RT_CurrencyID" ItemKey="Currency"/>
                                    <NumberEditor Key="RT_PlannedDeliveryDays__mirror" Caption="计划交付时间(天)" X="3" Y="0" Visible="true" Enable="Macro_RoutingEditable()&amp;&amp;GetDictValue('PP_ControlCode', RT_ControlCodeID, 'ExternalProcessing')=='+'&amp;&amp;RT_PurchaseInfoRecordID&lt;=0" BindingCellKey="RT_PlannedDeliveryDays" IntegerValue="true" Scale="0" UseGroupingSeparator="false"/>
                                    <RowDefCollection RowGap="24">
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                    </RowDefCollection>
                                    <ColumnDefCollection ColumnGap="16">
                                        <ColumnDef Width="16%"/>
                                        <ColumnDef Width="16%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="17%"/>
                                    </ColumnDefCollection>
                                </GridLayoutPanel>
                            </SubDetail>
                            <SubDetail Key="ProductionOrderInteropTimesSubDetail" Caption="工序间隔时间" BindingGridKey="ProductionOrderProcessListGrid">
                                <GridLayoutPanel Key="ProductionOrderInteropTimes" Caption="工序间隔时间" Padding="8px" OverflowX="Auto" OverflowY="Auto" TopPadding="20px">
                                    <NumberEditor Key="RT_StandardQueueSpendTime__mirror" Caption="标准排队时间" Enable="!ReadOnly()" X="0" Y="0" BindingCellKey="RT_StandardQueueSpendTime" Scale="1"/>
                                    <Dict Key="RT_StandardQueueTimeUnitID__mirror" Caption="单位" X="1" Y="0" Enable="!ReadOnly()" BindingCellKey="RT_StandardQueueTimeUnitID" ItemKey="Unit"/>
                                    <NumberEditor Key="RT_MinimumQueueSpendTime__mirror" Caption="最少排队时间" Enable="!ReadOnly()" X="2" Y="0" BindingCellKey="RT_MinimumQueueSpendTime" Scale="1"/>
                                    <Dict Key="RT_MinimumQueueTimeUnitID__mirror" Caption="单位" X="3" Y="0" Enable="!ReadOnly()" BindingCellKey="RT_MinimumQueueTimeUnitID" ItemKey="Unit"/>
                                    <NumberEditor Key="RT_MinimumWaitSpendTime__mirror" Caption="最少等待时间" Enable="!ReadOnly()" X="0" Y="1" BindingCellKey="RT_MinimumWaitSpendTime" Scale="1"/>
                                    <Dict Key="RT_MinimumWaitTimeUnitID__mirror" Caption="单位" X="1" Y="1" Enable="!ReadOnly()" BindingCellKey="RT_MinimumWaitTimeUnitID" ItemKey="Unit"/>
                                    <NumberEditor Key="RT_MaximumWaitSpendTime__mirror" Caption="最大等待时间" Enable="!ReadOnly()" X="2" Y="1" BindingCellKey="RT_MaximumWaitSpendTime" Scale="1"/>
                                    <Dict Key="RT_MaximumWaitTimeUnitID__mirror" Caption="单位" X="3" Y="1" Enable="!ReadOnly()" BindingCellKey="RT_MaximumWaitTimeUnitID" ItemKey="Unit"/>
                                    <NumberEditor Key="RT_StandardMoveSpendTime__mirror" Caption="标准转运时间" Enable="!ReadOnly()" X="0" Y="2" BindingCellKey="RT_StandardMoveSpendTime" Scale="1"/>
                                    <Dict Key="RT_StandardMoveTimeUnitID__mirror" Caption="单位" X="1" Y="2" Enable="!ReadOnly()" BindingCellKey="RT_StandardMoveTimeUnitID" ItemKey="Unit"/>
                                    <NumberEditor Key="RT_MinimumMoveSpendTime__mirror" Caption="最少转运时间" Enable="!ReadOnly()" X="2" Y="2" BindingCellKey="RT_MinimumMoveSpendTime" Scale="1"/>
                                    <Dict Key="RT_MinimumMoveTimeUnitID__mirror" Caption="单位" X="1" Y="2" Enable="!ReadOnly()" BindingCellKey="RT_MinimumMoveTimeUnitID" ItemKey="Unit"/>
                                    <RowDefCollection RowGap="24">
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                    </RowDefCollection>
                                    <ColumnDefCollection ColumnGap="16">
                                        <ColumnDef Width="25%"/>
                                        <ColumnDef Width="25%"/>
                                        <ColumnDef Width="25%"/>
                                        <ColumnDef Width="25%"/>
                                        <ColumnDef Width="100px"/>
                                    </ColumnDefCollection>
                                </GridLayoutPanel>
                            </SubDetail>
                            <SubDetail Key="ProductionOrderDateTimeSubDetail" Caption="日期/时间" BindingGridKey="ProductionOrderProcessListGrid">
                                <GridLayoutPanel Key="ProductionOrderDateTimeGridLayoutPanel" Caption="日期/时间" Padding="8px" OverflowY="Auto" TopPadding="24px">
                                    <Label Key="Label_EarliestTime" Caption="最早" X="1" Y="0" Class="erp-group-title" XSpan="2"/>
                                    <Label Key="Label_LatestTime" Caption="最晚" X="3" Y="0" Class="erp-group-title" XSpan="2"/>
                                    <Label Key="Label_SpendTime" Caption="耗时" X="5" Y="0" Class="erp-group-title" XSpan="2"/>
                                    <Label Key="Label_QueueTime" Caption="排队" X="0" Y="1" Class="erp-group-title"/>
                                    <NumberEditor Key="RT_QueueSpendTime_Mirror" Caption="排队耗时" X="5" Y="1" BindingCellKey="RT_QueueSpendTime" Scale="1" ShowZero="true"/>
                                    <Dict Key="RT_QueueTimeUnitID__mirror" Caption="单位" X="6" Y="1" BindingCellKey="RT_QueueTimeUnitID" ItemKey="Unit"/>
                                    <Separator Key="BelowQueue" Caption="BelowQueue" X="0" Y="2" XSpan="7"/>
                                    <Label Key="Label_SetupTime" Caption="设置" X="0" Y="3" Class="erp-group-title"/>
                                    <UTCDatePicker Key="RT_EarliestSetupDate__mirror" Caption="设置日期" BindingCellKey="RT_EarliestSetupDate" X="1" Y="3"/>
                                    <UTCDatePicker Key="RT_LatestSetupDate__mirror" Caption="设置日期" BindingCellKey="RT_LatestSetupDate" X="3" Y="3"/>
                                    <NumberEditor Key="RT_SetupSpendTime__mirror" Caption="设置耗时" X="5" Y="3" BindingCellKey="RT_SetupSpendTime" Scale="1" ShowZero="true"/>
                                    <Dict Key="RT_SetupTimeUnitID__mirror" Caption="单位" X="6" Y="3" BindingCellKey="RT_SetupTimeUnitID" ItemKey="Unit"/>
                                    <TextEditor Key="RT_EarliestSetupTime__mirror" Caption="设置时间" X="1" Y="4" BindingCellKey="RT_EarliestSetupTime" InvalidChars=" " MaxLength="10" Trim="true"/>
                                    <TextEditor Key="RT_LatestSetupTime__mirror" Caption="设置时间" X="3" Y="4" BindingCellKey="RT_LatestSetupTime" InvalidChars=" " MaxLength="10" Trim="true"/>
                                    <Separator Key="BelowSetUp" Caption="BelowSetUp" X="0" Y="5" XSpan="7"/>
                                    <Label Key="Label_ProcessingTime" Caption="加工" X="0" Y="6" Class="erp-group-title"/>
                                    <UTCDatePicker Key="RT_EarliestProcessingDate__mirror" Caption="加工日期" BindingCellKey="RT_EarliestProcessingDate" X="1" Y="6"/>
                                    <UTCDatePicker Key="RT_LatestProcessingDate__mirror" Caption="加工日期" BindingCellKey="RT_LatestProcessingDate" X="3" Y="6"/>
                                    <NumberEditor Key="RT_ProcessingSpendTime__mirror" Caption="加工耗时" X="5" Y="6" BindingCellKey="RT_ProcessingSpendTime" Scale="1" ShowZero="true"/>
                                    <Dict Key="RT_ProcessingTimeUnitID__mirror" Caption="单位" X="6" Y="6" BindingCellKey="RT_ProcessingTimeUnitID" ItemKey="Unit"/>
                                    <TextEditor Key="RT_EarliestProcessingTime__mirror" Caption="加工时间" X="1" Y="7" BindingCellKey="RT_EarliestProcessingTime" InvalidChars=" " MaxLength="10" Trim="true"/>
                                    <TextEditor Key="RT_LatestProcessingTime__mirror" Caption="加工时间" X="3" Y="7" BindingCellKey="RT_LatestProcessingTime" InvalidChars=" " MaxLength="10" Trim="true"/>
                                    <Separator Key="BelowProcessing" Caption="BelowProcessing" X="0" Y="8" XSpan="7"/>
                                    <Label Key="Label_TearDownTime" Caption="拆卸" X="0" Y="9" Class="erp-group-title"/>
                                    <UTCDatePicker Key="RT_EarliestTearDownStartDate__mirror" Caption="开始日期" BindingCellKey="RT_EarliestTearDownStartDate" X="1" Y="9"/>
                                    <UTCDatePicker Key="RT_EarliestTearDownEndDate__mirror" Caption="结束日期" BindingCellKey="RT_EarliestTearDownEndDate" X="2" Y="9"/>
                                    <UTCDatePicker Key="RT_LatestTearDownStartDate__mirror" Caption="开始日期" BindingCellKey="RT_LatestTearDownStartDate" X="3" Y="9"/>
                                    <UTCDatePicker Key="RT_LatestTearDownEndDate__mirror" Caption="结束日期" BindingCellKey="RT_LatestTearDownEndDate" X="4" Y="9"/>
                                    <NumberEditor Key="RT_TearDownSpendTime__mirror" Caption="拆卸耗时" X="5" Y="9" BindingCellKey="RT_TearDownSpendTime" Scale="1" ShowZero="true"/>
                                    <Dict Key="RT_TearDownTimeUnitID__mirror" Caption="单位" X="6" Y="9" BindingCellKey="RT_TearDownTimeUnitID" ItemKey="Unit"/>
                                    <TextEditor Key="RT_EarliestTearDownStartTime__mirror" Caption="开始时间" X="1" Y="10" BindingCellKey="RT_EarliestTearDownStartTime" InvalidChars=" " MaxLength="10" Trim="true"/>
                                    <TextEditor Key="RT_EarliestTearDownEndTime__mirror" Caption="结束时间" X="2" Y="10" BindingCellKey="RT_EarliestTearDownEndTime" InvalidChars=" " MaxLength="10" Trim="true"/>
                                    <TextEditor Key="RT_LatestTearDownStartTime__mirror" Caption="开始时间" X="3" Y="10" BindingCellKey="RT_LatestTearDownStartTime" InvalidChars=" " MaxLength="10" Trim="true"/>
                                    <TextEditor Key="RT_LatestTearDownEndTime__mirror" Caption="结束时间" X="4" Y="10" BindingCellKey="RT_LatestTearDownEndTime" InvalidChars=" " MaxLength="10" Trim="true"/>
                                    <Separator Key="BelowTearDown" Caption="BelowTearDown" X="0" Y="11" XSpan="7"/>
                                    <Label Key="Label_WaitTime" Caption="等待" X="0" Y="12" Class="erp-group-title"/>
                                    <UTCDatePicker Key="RT_EarliestWaitStartDate__mirror" Caption="开始日期" BindingCellKey="RT_EarliestWaitStartDate" X="1" Y="12"/>
                                    <UTCDatePicker Key="RT_EarliestWaitEndDate__mirror" Caption="结束日期" BindingCellKey="RT_EarliestWaitEndDate" X="2" Y="12"/>
                                    <UTCDatePicker Key="RT_LatestWaitStartDate__mirror" Caption="开始日期" BindingCellKey="RT_LatestWaitStartDate" X="3" Y="12"/>
                                    <UTCDatePicker Key="RT_LatestWaitEndDate__mirror" Caption="结束日期" BindingCellKey="RT_LatestWaitEndDate" X="4" Y="12"/>
                                    <NumberEditor Key="RT_WaitSpendTime__mirror" Caption="等待耗时" X="5" Y="12" BindingCellKey="RT_WaitSpendTime" Scale="1" ShowZero="true"/>
                                    <Dict Key="RT_WaitTimeUnitID__mirror" Caption="单位" X="6" Y="12" BindingCellKey="RT_WaitTimeUnitID" ItemKey="Unit"/>
                                    <TextEditor Key="RT_EarliestWaitStartTime__mirror" Caption="开始时间" X="1" Y="13" BindingCellKey="RT_EarliestWaitStartTime" InvalidChars=" " MaxLength="10" Trim="true"/>
                                    <TextEditor Key="RT_EarliestWaitEndTime__mirror" Caption="结束时间" X="2" Y="13" BindingCellKey="RT_EarliestWaitEndTime" InvalidChars=" " MaxLength="10" Trim="true"/>
                                    <TextEditor Key="RT_LatestWaitStartTime__mirror" Caption="开始时间" X="3" Y="13" BindingCellKey="RT_LatestWaitStartTime" InvalidChars=" " MaxLength="10" Trim="true"/>
                                    <TextEditor Key="RT_LatestWaitEndTime__mirror" Caption="结束时间" X="4" Y="13" BindingCellKey="RT_LatestWaitEndTime" InvalidChars=" " MaxLength="10" Trim="true"/>
                                    <Separator Key="BelowWait" Caption="BelowWait" X="0" Y="14" XSpan="7"/>
                                    <Label Key="Label_MoveTime" Caption="移动" X="0" Y="15" Class="erp-group-title"/>
                                    <NumberEditor Key="RT_MoveSpendTime__mirror" Caption="转运耗时" X="5" Y="15" BindingCellKey="RT_MoveSpendTime" Scale="1" ShowZero="true"/>
                                    <Dict Key="RT_MoveTimeUnitID__mirror" Caption="单位" X="6" Y="15" BindingCellKey="RT_MoveTimeUnitID" ItemKey="Unit"/>
                                    <RowDefCollection RowGap="24">
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                        <RowDef Height="32px"/>
                                    </RowDefCollection>
                                    <ColumnDefCollection ColumnGap="16">
                                        <ColumnDef Width="60px"/>
                                        <ColumnDef Width="16%"/>
                                        <ColumnDef Width="16%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="17%"/>
                                        <ColumnDef Width="16%"/>
                                        <ColumnDef Width="17%"/>
                                    </ColumnDefCollection>
                                </GridLayoutPanel>
                            </SubDetail>
                            <SubDetail Key="subDetail_QtyWork" Caption="数量/作业" BindingGridKey="ProductionOrderProcessListGrid">
                                <Grid Key="QtyWorkGrid" Caption="数量/作业" NewEmptyRow="false" Enable="Macro_RoutingEditable()" DefaultFitWidth="true" DisabledOption="insert" Padding="8px">
                                    <GridColumnCollection>
                                        <GridColumn Key="QW_IsSelect" Width="32px"/>
                                        <GridColumn Key="QW_ParameterID" Caption="作业" Width="80px"/>
                                        <GridColumn Key="QW_ActivityTypeID" Caption="作业类型" Width="80px"/>
                                        <GridColumn Key="QW_TotalConfirmedQuantity" Caption="总确认量" Width="100px"/>
                                        <GridColumn Key="QW_ConfirmedQuantity" Caption="已确认" Width="100px"/>
                                        <GridColumn Key="QW_ActivityTypeUnitID" Caption="作业单位" Width="80px"/>
                                        <GridColumn Key="QW_IsRegular" Caption="固定" Width="80px"/>
                                    </GridColumnCollection>
                                    <GridRowCollection>
                                        <GridRow Key="ProductionOrderQuantityWorkGridRow" TableKey="EPP_ProductionOrder_QtyWork">
                                            <GridCell Key="QW_IsSelect" Caption="选择" CellType="CheckBox" IsSelect="true"/>
                                            <GridCell Key="QW_ParameterID" Caption="作业" CellType="Dict" ItemKey="PP_Parameter">
                                                <DataBinding ColumnKey="ParameterID"/>
                                            </GridCell>
                                            <GridCell Key="QW_ActivityTypeID" Caption="作业类型" CellType="Dict" ItemKey="CO_ActivityType">
                                                <DataBinding ColumnKey="ActivityTypeID"/>
                                            </GridCell>
                                            <GridCell Key="QW_TotalConfirmedQuantity" Caption="总确认量" CellType="NumberEditor" Scale="3">
                                                <DataBinding ColumnKey="TotalConfirmedQuantity"/>
                                                <CellFormat HAlign="Right"/>
                                            </GridCell>
                                            <GridCell Key="QW_ConfirmedQuantity" Caption="已确认" CellType="NumberEditor" Scale="3">
                                                <DataBinding ColumnKey="ConfirmedQuantity"/>
                                                <CellFormat HAlign="Right"/>
                                            </GridCell>
                                            <GridCell Key="QW_ActivityTypeUnitID" Caption="作业单位" CellType="Dict" ItemKey="Unit">
                                                <DataBinding ColumnKey="ActivityTypeUnitID"/>
                                            </GridCell>
                                            <GridCell Key="QW_IsRegular" Caption="固定" CellType="CheckBox">
                                                <DataBinding ColumnKey="IsRegular"/>
                                            </GridCell>
                                        </GridRow>
                                    </GridRowCollection>
                                </Grid>
                            </SubDetail>
                            <SubDetail Key="SubExtra_Status" Caption="状态管理" BindingGridKey="ProductionOrderProcessListGrid">
                                <FlexFlowLayoutPanel Key="StatusPanel_Extral" Caption="状态管理" Padding="8px">
                                    <Embed Key="ExtraStatusManage" FormKey="ExtraStatusManage" RootKey="ExtraStatusManageRoot" Height="100%">
                                        <Var Key="SystemStatusParentKey" Value="EPP_ProductionOrder_Routing"/>
                                        <Var Key="UserStatusParentKey" Value="EPP_ProductionOrder_Routing"/>
                                    </Embed>
                                </FlexFlowLayoutPanel>
                            </SubDetail>
                            <SubDetail Key="ProductionOrderConvertUnitSubDetail" Caption="转换计量单位" BindingGridKey="ProductionOrderProcessListGrid">
                                <GridLayoutPanel Key="ProductionOrderConvertUnitGridLayoutPanel" Caption="转换计量单位" Padding="8px" TopPadding="24px">
                                    <NumberEditor Key="RT_BaseQuantity__mirror" Caption="基本数量" X="0" Y="0" Visible="true" Enable="Macro_RoutingEditable()" BindingCellKey="RT_BaseQuantity" Scale="3"/>
                                    <NumberEditor Key="RT_BaseUnitNumerator__mirror" Caption="基本单位" X="1" Y="0" Visible="true" Enable="Macro_RoutingEditable()" BindingCellKey="RT_BaseUnitNumerator" Scale="0"/>
                                    <Dict Key="RT_BaseUnitID__mirror" Caption="单位" X="2" Y="0" Visible="true" Enable="false" BindingCellKey="RT_BaseUnitID" ItemKey="Unit"/>
                                    <Label Key="Label1" Caption="       &lt;=&gt;" X="3" Y="0"/>
                                    <NumberEditor Key="RT_BaseUnitDenominator__mirror" Caption="工序单位" X="4" Y="0" Visible="true" Enable="Macro_RoutingEditable()" BindingCellKey="RT_BaseUnitDenominator" Scale="0"/>
                                    <Dict Key="RT_UnitID__mirror" Caption="单位" X="5" Y="0" Visible="true" Enable="Macro_RoutingEditable()" BindingCellKey="RT_UnitID" ItemKey="Unit"/>
                                    <RowDefCollection RowGap="24">
                                        <RowDef Height="32px"/>
                                    </RowDefCollection>
                                    <ColumnDefCollection ColumnGap="16">
                                        <ColumnDef Width="100px"/>
                                        <ColumnDef Width="80px"/>
                                        <ColumnDef Width="100px"/>
                                        <ColumnDef Width="80px"/>
                                        <ColumnDef Width="100px"/>
                                        <ColumnDef Width="100px"/>
                                    </ColumnDefCollection>
                                </GridLayoutPanel>
                            </SubDetail>
                            <SubDetail Key="ProductResourceToolArea" Caption="生产资源/工具" BindingGridKey="ProductionOrderProcessListGrid">
                                <FlexFlowLayoutPanel Key="Tab4PRT" Caption="生产资源/工具" Visible="!Macro_IsSubRouting(RT_SubItemNo)" Padding="8px">
                                    <Embed Key="PP_UseProductResourceTool" FormKey="PP_UseProductResourceTool" RootKey="UseProductResourceToolFlexFlowLayoutPanel" Height="100%">
                                        <Var Key="ParentKey" Value="EPP_ProductionOrder_Routing"/>
                                    </Embed>
                                </FlexFlowLayoutPanel>
                            </SubDetail>
                            <SubDetail Key="TriggerPointSubDetail" Caption="触发点" BindingGridKey="ProductionOrderProcessListGrid">
                                <GridLayoutPanel Key="TriggerPointGridLayoutPanel" Caption="触发点" Enable="Macro_RoutingEditable()">
                                    <FlexFlowLayoutPanel Key="TriggerPointFlexFlowLayoutPanel" Caption="触发点" Visible="true" X="0" Y="0" Padding="8px">
                                        <Embed Key="TriggerPointEmbed" Caption="触发点" FormKey="PP_TriggerPointImpl" RootKey="mainTemplate" Height="100%">
                                            <Var Key="ParentKey" Value="EPP_ProductionOrder_Routing"/>
                                        </Embed>
                                    </FlexFlowLayoutPanel>
                                    <RowDefCollection RowHeight="30" RowGap="24">
                                        <RowDef Height="90%"/>
                                    </RowDefCollection>
                                    <ColumnDefCollection ColumnGap="16">
                                        <ColumnDef Width="100%"/>
                                    </ColumnDefCollection>
                                </GridLayoutPanel>
                            </SubDetail>
                        </TabPanel>
                        <SplitSize Size="64%"/>
                        <SplitSize Size="36%"/>
                    </SplitPanel>
                    <GridLayoutPanel Key="ProductionOrderOverviewShortageItemGridLayoutPanel" Caption="短缺件总览" Height="pref" Padding="8px" OverflowY="Auto" Visible="true">
                        <CheckBox Key="IsAllComponents" Caption="全部组件" X="1" Y="0" Visible="true" Enable="!ReadOnly() &amp;&amp; IsAllComponents == 0">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsAllComponents">
                                <ValueChanged>
                                    <![CDATA[IIF(IsAllComponents==1,SetValue('IsMissingPartsOnly', 0, false),true)]]>
                                </ValueChanged>
                            </DataBinding>
                        </CheckBox>
                        <CheckBox Key="IsMissingPartsOnly" Caption="仅遗失部分" X="2" Y="0" Visible="true" Enable="!ReadOnly() &amp;&amp; IsMissingPartsOnly == 0" XSpan="2">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsMissingPartsOnly" DefaultValue="1">
                                <ValueChanged>
                                    <![CDATA[IIF(IsMissingPartsOnly==1,SetValue('IsAllComponents', 0, false), true)]]>
                                </ValueChanged>
                            </DataBinding>
                        </CheckBox>
                        <Grid Key="ProductionOrderOverviewShortageItemGrid" Caption="短缺件总览" SerialSeq="true" X="0" XSpan="16" Y="1">
                            <GridColumnCollection>
                                <GridColumn Key="IsSelect_grid4" Width="32px"/>
                                <GridColumn Key="RelationBillDtlID" Caption="RelationBillDtlID" Visible="Macro_DebugMode()" Width="80px"/>
                                <GridColumn Key="ATPPlantID" Caption="工厂" Width="80px"/>
                                <GridColumn Key="ATPMaterialID" Caption="物料" Width="80px"/>
                                <GridColumn Key="ATPRequirementDate" Caption="需求日期" Width="100px"/>
                                <GridColumn Key="ATPRequirementQuantity" Caption="需求数量" Width="100px"/>
                                <GridColumn Key="ATPBaseUnitID" Caption="计量单位" Width="120px"/>
                                <GridColumn Key="ATPBatchCode" Caption="批次" Width="80px"/>
                                <GridColumn Key="ATPStorageLocationID" Caption="库存地点" Width="80px"/>
                                <GridColumn Key="ATPCommittedQuantity" Caption="已确认数量" Width="100px"/>
                                <GridColumn Key="ATPQuantity" Caption="ATP数量" Width="100px"/>
                                <GridColumn Key="POID" Caption="POID" Visible="Macro_DebugMode()" Width="80px" Sortable="true"/>
                                <GridColumn Key="CheckingGroupID" Caption="检查组" Visible="Macro_DebugMode()" Width="80px"/>
                            </GridColumnCollection>
                            <GridRowCollection>
                                <GridRow Key="ProductionOrderOverviewShortageItemGridRow" TableKey="EPP_ProductionOrderOverviewShortageItemGrid">
                                    <GridCell Key="IsSelect_grid4" Caption="选择" CellType="CheckBox" IsSelect="true"/>
                                    <GridCell Key="RelationBillDtlID" Caption="RelationBillDtlID" CellType="NumberEditor" Scale="0" UseGroupingSeparator="false">
                                        <DataBinding ColumnKey="RelationBillDtlID"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="ATPPlantID" Caption="工厂" CellType="Dict" Enable="false" ItemKey="Plant">
                                        <DataBinding ColumnKey="ATPPlantID"/>
                                    </GridCell>
                                    <GridCell Key="ATPMaterialID" Caption="物料" CellType="Dict" Enable="false" ItemKey="Material">
                                        <DataBinding ColumnKey="ATPMaterialID"/>
                                    </GridCell>
                                    <GridCell Key="ATPRequirementDate" Caption="需求日期" CellType="UTCDatePicker" Enable="false" Format="yyyy-MM-dd">
                                        <DataBinding ColumnKey="ATPRequirementDate"/>
                                    </GridCell>
                                    <GridCell Key="ATPRequirementQuantity" Caption="需求数量" CellType="NumberEditor" Enable="false" Scale="3">
                                        <DataBinding ColumnKey="ATPRequirementQuantity"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="ATPBaseUnitID" Caption="计量单位" CellType="Dict" Enable="false" ItemKey="Unit">
                                        <DataBinding ColumnKey="ATPBaseUnitID"/>
                                    </GridCell>
                                    <GridCell Key="ATPBatchCode" Caption="批次" CellType="TextEditor" Enable="false" Case="Upper" MaxLength="30" Trim="true">
                                        <DataBinding ColumnKey="ATPBatchCode" DefaultValue="_"/>
                                    </GridCell>
                                    <GridCell Key="ATPStorageLocationID" Caption="库存地点" CellType="Dict" Enable="false" ItemKey="StorageLocation">
                                        <DataBinding ColumnKey="ATPStorageLocationID"/>
                                    </GridCell>
                                    <GridCell Key="ATPCommittedQuantity" Caption="已确认数量" CellType="NumberEditor" Enable="false" Scale="3">
                                        <DataBinding ColumnKey="ATPCommittedQuantity"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="ATPQuantity" Caption="ATP数量" CellType="NumberEditor" Enable="false" Scale="3">
                                        <DataBinding ColumnKey="ATPQuantity"/>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="POID" Caption="POID" CellType="NumberEditor">
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                    <GridCell Key="CheckingGroupID" Caption="检查组" CellType="NumberEditor" Scale="0">
                                        <DataBinding ColumnKey="CheckingGroupID">
                                            <DefaultFormulaValue>
                                                <![CDATA[Macro_GetOrgProp('MaterialID', 'SD_CheckingGroupsID', PlantID)]]>
                                            </DefaultFormulaValue>
                                        </DataBinding>
                                        <CellFormat HAlign="Right"/>
                                    </GridCell>
                                </GridRow>
                            </GridRowCollection>
                            <RowDblClick>
                                <![CDATA[if(!ReadOnly()&&Macro_IsATPCheck()){ERPShowModal('MM_ATPOverView_Rpt','Macro_PP_ProductionOrder_ShowEvent('&'"'&ATPPlantID&'","'&ATPMaterialID&'","'&ProductOrderTypeID&'","'&ProductPlantID&'","'&PlantID&'","'&MaterialID&'","'&CheckingGroupID&'","'&CheckingRuleID&'","'&ATPRequirementDate&'","'&ATPRequirementQuantity&'","'&ATPStorageLocationID&'","'&RelationBillDtlID&'","'&SOID&'","'&Dtl_SpecialIdentity&'","'&DynIdentityID&'"'&')')}]]>
                            </RowDblClick>
                            <TraceCollection>
                                <Trace Caption="检查项目可用性" Condition="!ReadOnly()&quot;&quot;Macro_IsATPCheck()">
                                    <![CDATA[ERPShowModal('MM_ATPOverView_Rpt','Macro_PP_ProductionOrder_ShowEvent('&'"'&ATPPlantID&'","'&ATPMaterialID&'","'&ProductOrderTypeID&'","'&ProductPlantID&'","'&PlantID&'","'&MaterialID&'","'&CheckingGroupID&'","'&CheckingRuleID&'","'&ATPRequirementDate&'","'&ATPRequirementQuantity&'","'&ATPStorageLocationID&'","'&RelationBillDtlID&'","'&SOID&'","'&Dtl_SpecialIdentity&'","'&DynIdentityID&'"'&')')]]>
                                </Trace>
                            </TraceCollection>
                            <GridFilter FilterDependency="IsMissingPartsOnly">
                                <FilterValue Index="1" FieldKey="ATPRequirementQuantity" RefValue="IIFS(IsMissingPartsOnly==1, ATPCommittedQuantity, 0)" Type="Field" CondSign="&gt;"/>
                            </GridFilter>
                        </Grid>
                        <RowDefCollection RowGap="24">
                            <RowDef Height="32px"/>
                            <RowDef Height="100%"/>
                        </RowDefCollection>
                        <ColumnDefCollection ColumnGap="16">
                            <ColumnDef Width="8px"/>
                            <ColumnDef Width="100px"/>
                            <ColumnDef Width="79px"/>
                            <ColumnDef Width="50px"/>
                            <ColumnDef Width="80px"/>
                            <ColumnDef Width="100px"/>
                            <ColumnDef Width="100px"/>
                            <ColumnDef Width="34%"/>
                            <ColumnDef Width="80px"/>
                            <ColumnDef Width="100px"/>
                            <ColumnDef Width="100px"/>
                            <ColumnDef Width="33%"/>
                            <ColumnDef Width="40px"/>
                            <ColumnDef Width="20px"/>
                            <ColumnDef Width="8px"/>
                            <ColumnDef Width="33%"/>
                        </ColumnDefCollection>
                    </GridLayoutPanel>
                    <FlexFlowLayoutPanel Key="HeadLongText" Caption="长文本" Height="pref">
                        <GridLayoutPanel Key="HeadLongTextPane" Caption="长文本" Height="100%" Padding="8px" TopPadding="24px" Width="100%">
                            <TextArea Key="TextField" X="0" Y="0" MaxLength="1000">
                                <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="Notes"/>
                            </TextArea>
                            <RowDefCollection RowGap="24">
                                <RowDef Height="100%"/>
                            </RowDefCollection>
                            <ColumnDefCollection ColumnGap="16">
                                <ColumnDef Width="100%"/>
                            </ColumnDefCollection>
                        </GridLayoutPanel>
                    </FlexFlowLayoutPanel>
                    <SplitPanel Key="ProductionOrderSerialNumberSplitPanel" Caption="序列号" Orientation="Vertical" Height="pref" Visible="com.bokesoft.erp.mm.masterdata.SerialNumberFormula.isSNNumberVisible(MaterialID,PlantID,'PPAU')||com.bokesoft.erp.mm.masterdata.SerialNumberFormula.isSNNumberVisible(MaterialID,PlantID,'PPRL')">
                        <GridLayoutPanel Key="ProductionOrderSerialNumberGridLayoutPanel" Padding="8px" OverflowY="Auto" TopPadding="24px">
                            <Dict Key="SNIMaterialID" Caption="物料" X="0" Y="0" Visible="true" Enable="false" ItemKey="Material">
                                <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SNIMaterialID" DefaultFormulaValue="MaterialID"/>
                            </Dict>
                            <Dict Key="PlantID" Caption="工厂" X="1" Y="0" Visible="true" Enable="false" ItemKey="Plant">
                                <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="PlantID" DefaultFormulaValue="ProductPlantID"/>
                            </Dict>
                            <Button Key="AutoCreateSNNumber" Caption="自动创建序列号" X="2" Y="0" Visible="com.bokesoft.erp.mm.masterdata.SerialNumberFormula.existReq(PlantID,MaterialID)" Type="Normal">
                                <OnClick>
                                    <![CDATA[Macro_AutoCreateSNNumber_ButtonClickTrg();]]>
                                </OnClick>
                            </Button>
                            <RowDefCollection RowGap="24">
                                <RowDef Height="32px"/>
                            </RowDefCollection>
                            <ColumnDefCollection ColumnGap="16">
                                <ColumnDef Width="100px"/>
                                <ColumnDef Width="100px"/>
                                <ColumnDef Width="33%"/>
                                <ColumnDef Width="67%"/>
                            </ColumnDefCollection>
                        </GridLayoutPanel>
                        <FlexFlowLayoutPanel Key="ProductionOrderSerialNumberFlexFlowLayoutPanel" Caption="P4" Visible="true" Padding="8px">
                            <Embed Key="MM_SNNumberInput" FormKey="MM_SNNumberInput" RootKey="MM_SNNumberInputRoot" Height="100%">
                                <Var Key="ParentKey" Value="EPP_ProductionOrder"/>
                            </Embed>
                        </FlexFlowLayoutPanel>
                        <SplitSize Size="20%"/>
                        <SplitSize Size="80%"/>
                    </SplitPanel>
                    <FlexFlowLayoutPanel Key="ProductionOrderCharacterRootFlexFlowLayoutPanel" Caption="物料特征值(Root)" Height="pref" Visible="GetDictValue('Material', MaterialID, 'IsConfigurableMaterial')==1&amp;&amp;GetRowCount('CharacteristicInputGrid')&lt;=0" Padding="8px">
                        <Embed Key="MM_CharacteristicInput" FormKey="MM_CharacteristicInput" RootKey="Charact_InputFlexFlowLayoutPanel" Height="100%">
                            <Var Key="ParentKey" Value="EPP_ProductionOrder"/>
                        </Embed>
                    </FlexFlowLayoutPanel>
                    <FlexFlowLayoutPanel Key="ProductionOrderCharacterParentFlexFlowLayoutPanel" Caption="物料特征值(Parent)" Height="pref" Visible="GetDictValue('Material', MaterialID, 'IsConfigurableMaterial')==1&amp;&amp;GetRowCount('CharacteristicInputGrid')&gt;0" Padding="8px">
                        <Embed Key="SD_CharacteristicInput_Result" FormKey="SD_CharacteristicInput_Result_Impl" RootKey="CharacteristicInputFlexFlowLayoutPanel" Height="100%">
                            <Var Key="ParentKey" Value="EPP_ProductionOrder"/>
                        </Embed>
                    </FlexFlowLayoutPanel>
                    <FlexFlowLayoutPanel Key="ProductionOrderRoughPlanFlexFlowLayoutPanel" Caption="粗计划" Height="pref" Visible="Macro_DebugMode()" Padding="8px">
                        <Embed Key="PP_Scheduling4RCCP" FormKey="PP_Scheduling4RCCP" RootKey="Scheduling4RCCPFlexFlowLayoutPanel" Height="100%"/>
                    </FlexFlowLayoutPanel>
                    <FlexFlowLayoutPanel Key="ProductionOrderDetailScheduleFlexFlowLayoutPanel" Caption="详细计划" Height="pref" Visible="Macro_DebugMode()" Padding="8px">
                        <Embed Key="PP_Scheduling4Detail" FormKey="PP_Scheduling4Detail" RootKey="Scheduling4DetailFlexFlowLayoutPanel" Height="100%"/>
                    </FlexFlowLayoutPanel>
                    <FlexFlowLayoutPanel Key="NewDocumentVoucherLinkTab" Caption="凭证链接" Height="pref" Visible="Macro_DebugMode()" Padding="8px">
                        <Embed Key="DMS_DocumentVoucherLink" FormKey="DMS_DocumentVoucherLink" RootKey="DMS_DocumentVoucherLinkRoot" Height="100%"/>
                    </FlexFlowLayoutPanel>
                    <FlexFlowLayoutPanel Key="BodySystem" Caption="系统信息" Height="pref" Padding="8px">
                        <Embed Key="BodySystemEmbed" FormKey="BodySystemEntityForm" RootKey="SystemInfoPanel">
                            <Var Key="SystemInfoTableKey" Value="EPP_ProductionOrder"/>
                        </Embed>
                    </FlexFlowLayoutPanel>
                    <FlexGridLayoutPanel Key="HiddenInformation" Caption="隐藏信息" ColumnCount="3" ColumnGap="16" OverflowY="Auto" RowGap="24" Visible="false">
                        <UTCDatePicker Key="GoodsReceiptCompleteDate" Caption="收货完成日期" X="5" Y="5" Visible="true" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="GoodsReceiptCompleteDate"/>
                        </UTCDatePicker>
                        <CheckBox Key="IsCheckedSystemStatusText" Caption="系统状态辅助字段(隐藏)" CopyNew="false" X="1" Y="2">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsCheckedSystemStatusText"/>
                        </CheckBox>
                        <UTCDatePicker Key="OrderCloseDate" Caption="订单关闭日期" X="1" Y="1" Visible="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="OrderCloseDate"/>
                        </UTCDatePicker>
                        <UTCDatePicker Key="OrderTecoDate" Caption="技术关闭日期" X="3" Y="2" Visible="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="OrderTecoDate"/>
                        </UTCDatePicker>
                        <CheckBox Key="IsChangePart" Caption="部分转换" X="1" Y="2" Visible="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsChangePart">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(GetPara('IsChangePart_Parent') != '',GetPara('IsChangePart_Parent'),0)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </CheckBox>
                        <CheckBox Key="IsSummarizePR" Caption="汇总采购申请" X="1" Y="2" Visible="false" CopyNew="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsSummarizePurchaseRequisition">
                                <DefaultFormulaValue>
                                    <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.readIsSummarizePR(PlantID, ProductOrderTypeID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </CheckBox>
                        <Dict Key="SummarizePurchaseRequisitionSOID" Caption="汇总的采购申请" X="1" Y="2" Enable="false" CopyNew="false" ItemKey="MM_PurchaseRequisition__Dic" StateMask="Enable|Disable|Discard">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SummarizePurchaseReqOID"/>
                        </Dict>
                        <Dict Key="SoldToPartyID" Caption="售达方" X="1" Y="3" Visible="SaleOrderSOID&gt;0" Enable="false" ItemKey="Customer">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SoldToPartyID">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(SaleOrderSOID>0,com.bokesoft.erp.pp.function.ProductionOrderFormula.getSoldToPartyID(),0)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Dict>
                        <ComboBox Key="SpecialIdentity" Caption="特殊库存" X="3" Y="3" Visible="SaleOrderSOID&gt;0" Enable="false" SourceType="ParaGroup" GroupKey="SpecialIdentity">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SpecialIdentity">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(AccountAssignmentCategoryID>0,GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'SpecialIdentity'),'_')]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </ComboBox>
                        <Dict Key="AccountAssignmentCategoryID" Caption="科目分配类别" X="0" Y="4" Visible="false" ItemKey="AccountAssignmentCategory">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="AccountAssignmentCategoryID"/>
                            <ItemFilter>
                                <Filter Key="Filter" Impl="com.bokesoft.yes.erp.condition.Filter" Type="Custom">
                                    <FilterValue Index="1" ParaValue="' (SpecialIdentity='&amp;SqlPara('E')&amp;' Or SpecialIdentity='&amp;SqlPara('Q')&amp;') '"/>
                                </Filter>
                            </ItemFilter>
                        </Dict>
                        <ComboBox Key="ConsumeIndicator" Caption="消耗记账" X="1" Y="4" Visible="false" Enable="false" SourceType="ParaGroup" GroupKey="ConsumeIndicator">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ConsumeIndicator">
                                <DefaultFormulaValue>
                                    <![CDATA[GetDictValue('AccountAssignmentCategory', AccountAssignmentCategoryID, 'ConsumeIndicator')]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </ComboBox>
                        <ComboBox Key="ATPStatus" Caption="ATPStatus" X="0" Y="0" Visible="true" SourceType="ParaGroup" GroupKey="ATPStatus" IntegerValue="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ATPStatus" DefaultValue="0">
                                <ValueChanged>
                                    <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.productOrderStatusAfterATPCheck();]]>
                                </ValueChanged>
                            </DataBinding>
                        </ComboBox>
                        <Label Key="AssistantField_BOMandRongting" Caption="BOM和工艺路线展开辅助字段" X="0" Y="3">
                            <DataBinding ValueDependency="RoutingID,NoRouting,MaterialBOMID,SourcePlanOrderSOID,ProductionVersionID">
                                <DefaultFormulaValue>
                                    <![CDATA[if(!isWFMapping()&&!ReadOnly()){com.bokesoft.erp.pp.function.ProductionOrderFormula.bomAndRouteDevelop();}]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Label>
                        <ComboBox Key="Status" Caption="状态" X="0" Y="2" Visible="false" Enable="false" SourceType="Status" CopyNew="false" IntegerValue="true" TextShowType="Caption">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="Status"/>
                        </ComboBox>
                        <Dict Key="TCodeID" Caption="TCodeID" X="0" Y="5" Visible="true" ItemKey="TCode">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="TCodeID">
                                <DefaultFormulaValue>
                                    <![CDATA[GetDictOID('TCode', 'Code', IIF(GetEntryPara('TCode')=='','CO01',GetEntryPara('TCode')))]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Dict>
                        <NumberEditor Key="RoutingSelect" Caption="工艺路线选择" X="3" Y="5" Visible="true" Enable="false" IntegerValue="true" Precision="9" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="RoutingSelect">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(ProductPlantID>0&&ProductOrderTypeID>0,com.bokesoft.erp.pp.function.ProductionOrderFormula.getRoutingSelect(),RoutingSelect)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </NumberEditor>
                        <Dict Key="RoutingPrioritySetID" Caption="工艺路线优先级" X="1" Y="5" Visible="true" Enable="false" ItemKey="PP_RoutingPrioritySet">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="RoutingPrioritySetID">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(ProductPlantID>0&&ProductOrderTypeID>0,com.bokesoft.erp.pp.function.ProductionOrderFormula.getRoutingPriority(),RoutingPrioritySetID)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Dict>
                        <NumberEditor Key="ReturnFromRoutSelect" Caption="ReturnFromRoutSelect" X="3" Y="4" Visible="true" Enable="false" IntegerValue="true" Precision="9" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ReturnFromRoutSelect" DefaultValue="0">
                                <ValueChanged>
                                    <![CDATA[IIF(ReturnFromRoutSelect==1,Macro_OpenRoutCondChange(),true);]]>
                                </ValueChanged>
                            </DataBinding>
                        </NumberEditor>
                        <NumberEditor Key="NoRouting" Caption="NoRouting" X="3" Y="4" Visible="true" Enable="false" IntegerValue="true" Precision="9" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="NoRouting" DefaultValue="0"/>
                        </NumberEditor>
                        <NumberEditor Key="SystemUnitIDOfTime" Caption="时间计量维度OID" X="3" Y="4" Visible="true" Enable="false" IntegerValue="true" Precision="9" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SystemUnitIDOfTime" DefaultFormulaValue="GetDictOID('UnitSystem','Code', 'TIME')"/>
                        </NumberEditor>
                        <NumberEditor Key="SrcDemandOrderSOID" Caption="需求来源计划订单" X="0" Y="6" Visible="true" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SrcDemandPlanOrderSOID"/>
                        </NumberEditor>
                        <NumberEditor Key="SrcMRPElementID" Caption="来源需求订单MRP元素ID" X="1" Y="6" Visible="true" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SrcMRPElementID"/>
                        </NumberEditor>
                        <NumberEditor Key="SrcDemandSOID" Caption="需求来源的订单ID" X="1" Y="6" Visible="true" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SrcDemandSOID"/>
                        </NumberEditor>
                        <NumberEditor Key="SrcDemandOrderBillDtlID" Caption="需求来源的订单明细ID" X="1" Y="6" Visible="true" Scale="0" UseGroupingSeparator="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SrcDemandDtlOID"/>
                        </NumberEditor>
                        <CheckBox Key="IsManuallyCreated" Caption="手工创建" X="3" Y="6" Visible="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsManuallyCreated" DefaultValue="1"/>
                        </CheckBox>
                        <CheckBox Key="Pushdown_NODB4Other" Caption="刚下推过来" X="3" Y="6" Visible="false" Enable="false" OneTimeCompute="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="Pushdown_NODB4Other"/>
                        </CheckBox>
                        <NumberEditor Key="SrcOID" Caption="源单OID" X="0" Y="8" Enable="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SrcOID"/>
                        </NumberEditor>
                        <NumberEditor Key="SrcSOID" Caption="源单SOID" X="1" Y="8" Enable="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SrcSOID"/>
                        </NumberEditor>
                        <TextEditor Key="MapKey" Caption="MapKey" X="3" Y="8" Enable="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="MapKey"/>
                        </TextEditor>
                        <TextEditor Key="SrcDocumentNumber" Caption="SrcDocumentNumber" X="0" Y="9" Enable="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SrcDocumentNumber"/>
                        </TextEditor>
                        <TextEditor Key="PlanOrderBillIDs" Caption="计划订单合并转换生产订单ID" X="3" Y="7">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="PlanOrderBillIDs"/>
                        </TextEditor>
                        <NumberEditor Key="MaterialConfigProfileID" Caption="MaterialConfigProfileID" X="3" Y="1" Scale="0">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="MaterialConfigProfileID"/>
                        </NumberEditor>
                        <CheckBox Key="IsHasRelease" Caption="下达过" X="0" Y="1">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsHasRelease"/>
                        </CheckBox>
                        <CheckBox Key="IsMRP" Caption="参与MRP" X="2" Y="6">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsMRP">
                                <DefaultFormulaValue>
                                    <![CDATA[com.bokesoft.erp.pp.function.MRPFormula.getIsMRPDefaultValue();]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </CheckBox>
                        <NumberEditor Key="RequirementTypeID" Caption="需求类型" X="3" Y="0" Scale="0">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="RequirementTypeID"/>
                        </NumberEditor>
                        <TextEditor Key="SrcFormKey" Caption="SrcFormKey" X="3" Y="9" MaxLength="30">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="SrcFormKey"/>
                        </TextEditor>
                        <TextEditor Key="ItemNoOld" Caption="旧工序号" X="5" Y="0">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="ItemNoOld"/>
                        </TextEditor>
                        <CheckBox Key="Issued_NODB4Other" Caption="已下达" X="5" Y="9" OneTimeCompute="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="Issued_NODB4Other"/>
                        </CheckBox>
                        <TextEditor Key="Operate_NODB4Other" Caption="操作集合记录标识" X="5" Y="1" OneTimeCompute="true">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="Operate_NODB4Other"/>
                        </TextEditor>
                        <Dict Key="CheckingRuleID" Caption="检查规则" X="5" Y="2" Visible="Macro_DebugMode()" Enable="false" ItemKey="MM_CheckingRule">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="CheckingRuleID">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(ProductPlantID>0&&ProductOrderTypeID>0,Macro_GetCheckingRuleID(ProductOrderTypeID,ProductPlantID,Macro_GetProductionOrderStatus()),0);]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </Dict>
                        <NumberEditor Key="PlanFactory_CheckMaterial" Caption="检查计划工厂有物料辅助字段" X="5" Y="3" Visible="false" Precision="9" Scale="0">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="PlanFactory_CheckMaterial">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(MaterialID>0&&PlanPlantID>0, Macro_ChackPlanFactory(), true)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </NumberEditor>
                        <CheckBox Key="IsHasProductVersion" Caption="有过生产版本" X="4" Y="9">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsHasProductVersion"/>
                        </CheckBox>
                        <ComboBox Key="Category" Caption="订单类别" X="5" Y="5" SourceType="ParaGroup" Cache="false" GroupKey="OrderCategoryGroup">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="Category">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(Length(GetEntryPara('Category'))>0,GetEntryPara('Category'),'10')]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </ComboBox>
                        <ComboBox Key="MainRecipeSelect" Caption="主配方选择" X="5" Y="6" SourceType="ParaGroup" Cache="false" GroupKey="MainRecipeSelect">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="MainRecipeSelect">
                                <DefaultFormulaValue>
                                    <![CDATA[IIF(ProductOrderTypeID>0,com.bokesoft.erp.pp.function.ProcessOrderFormula.getProductOrderType_ParasValueByFieldKey(ProductPlantID,ProductOrderTypeID,'MainRecipeSelect'),MainRecipeSelect)]]>
                                </DefaultFormulaValue>
                            </DataBinding>
                        </ComboBox>
                        <CheckBox Key="IsDeleted2" Caption="头删除标识" X="2" Y="0" CopyNew="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsDeleted"/>
                        </CheckBox>
                        <CheckBox Key="IsArchived" Caption="归档标识" X="2" Y="1" CopyNew="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsArchived"/>
                        </CheckBox>
                        <UTCDatePicker Key="CurrentDate" Caption="当前日期" X="0" Y="0" Visible="false" Enable="false" Format="yyyy-MM-dd">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="CurrentDate" DefaultFormulaValue="DateLong()"/>
                        </UTCDatePicker>
                        <CheckBox Key="IsLocked4MRP" Caption="锁定" X="2" Y="0" CopyNew="false">
                            <DataBinding TableKey="EPP_ProductionOrder2" ColumnKey="IsLocked4MRP"/>
                        </CheckBox>
                    </FlexGridLayoutPanel>
                </TabPanel>
            </FlexFlowLayoutPanel>
        </Block>
    </Body>
    <OnPostShow>
        <![CDATA[if (IsNew()) {
        Macro_BaseForminitalize();
    }
                 if (IsNew() && GetValue('Pushdown_NODB4Other') == 1 && RoutingID <= 0) {
                     if (GetPara('Rout') == 0) {
                         SetValue('Pushdown_NODB4Other', 0);
                         Macro_OpenRoutCondChange();
                     }
                     if (GetPara('Rout') == 2) {
                         SetValue('Pushdown_NODB4Other', 0);
                         Macro_OpenRoutSelect();
                     }
                 };Macro_SetIsAssembleTriggerPoint(0);]]>
    </OnPostShow>
    <MacroCollection>
        <Macro Key="Macro_RoutingEditable">
            <![CDATA[(!ReadOnly() && RT_IsDeleted == 0)]]>
        </Macro>
        <Macro Key="Macro_SetProductionVersion">
            <![CDATA[SetValue('ProductionVersionID', IIF(GetPara('SelectProductionVersionID')>0,GetPara('SelectProductionVersionID'),com.bokesoft.erp.pp.masterdata.BOMSelectFormula.getProductionVersionID(ProductPlantID,MaterialID,TotalBaseQuantity,BasicStartDate)));Macro_GenExplosionDateTrig();]]>
        </Macro>
        <Macro Key="Macro_SelectProductionVersion">
            <![CDATA[SetPara('ProductionVersionSize', com.bokesoft.erp.pp.masterdata.BOMSelectFormula.getProductionVersionSize(ProductPlantID,MaterialID,TotalBaseQuantity,BasicStartDate));IIF(Macro_IsProcessOrder(),Macro_SelectProductionVersion_40(),Macro_SelectProductionVersion_10());]]>
        </Macro>
        <Macro Key="Macro_SelectProductionVersion_10">
            <![CDATA[IIF(ProductPlantID>0&&MaterialID>0&&BasicStartDate>0&&TotalBaseQuantity>0&&ProductVersionSelect==1,IIFS((Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)==2&&GetPara('ProductionVersionSize')>0)||(Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)==3&&GetPara('ProductionVersionSize')>1),ERPShowModal('PP_SelectProductionVersion4Order', GetCallFormula('Macro_ShowEvent', ProductPlantID, MaterialID, BasicStartDate, TotalBaseQuantity)),(Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)==2&&GetPara('ProductionVersionSize')==0)||(Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)==3&&GetPara('ProductionVersionSize')<=1),Macro_SetProductionVersion(),true,Macro_GenExplosionDateTrig()),Macro_GenExplosionDateTrig());]]>
        </Macro>
        <Macro Key="Macro_SelectProductionVersion_40">
            <![CDATA[IIF(ProductPlantID>0&&MaterialID>0&&BasicStartDate>0&&TotalBaseQuantity&&ProductVersionSelect==1,IIF(GetPara('ProductionVersionSize')>1,ERPShowModal('PP_SelectProductionVersion4Order', GetCallFormula('Macro_ShowEvent', ProductPlantID, MaterialID, BasicStartDate, TotalBaseQuantity)),Macro_GenExplosionDateTrig()),Macro_GenExplosionDateTrig())]]>
        </Macro>
        <Macro Key="Macro_SetCompleteReceiptStatus">
            <![CDATA[com.bokesoft.erp.pp.push.ProductionOrderPush.setCompleteReceiptStatus()]]>
        </Macro>
        <Macro Key="Macro_ReceiptChange">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.receiptChange();]]>
        </Macro>
        <Macro Key="Macro_UpdateSysStatusByProcess">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.updateSystemStatusByProcess();]]>
        </Macro>
        <Macro Key="Macro_SetDefaultBOM">
            <![CDATA[ClearAllRows('ProductionOrderAssemblyGrid');
                     IIF(TotalQuantity>0, com.bokesoft.erp.pp.function.ProductionOrderFormula.ProductionOrderBOMData_Ui());
                     com.bokesoft.erp.mm.atp.formula.ATPFormula.availabilityCheck4ProductionOrder(IsNew(),false,false,true,false,false);]]>
        </Macro>
        <Macro Key="Macro_SetDefaultRouting">
            <![CDATA[if (!GetPara('New_Type')=='CopyNow') {com.bokesoft.erp.pp.function.ProductionOrderFormula.ProductionOrderRoutingData()} else {true}]]>
        </Macro>
        <Macro Key="Macro_SetDefaultRoutingByQuantityOrDate">
            <![CDATA[IIF(!GetPara('New_Type')=='CopyNow'&&!com.bokesoft.erp.pp.function.ProductionOrderFormula.manualSelectRouting(),com.bokesoft.erp.pp.function.ProductionOrderFormula.ProductionOrderRouting(),RoutingID)]]>
        </Macro>
        <Macro Key="Macro_ViewCostDetail_Open">
            <![CDATA[var P_PPOrderCostEstimateID = Macro_ViewCostDetail_Formula();
                     if (P_PPOrderCostEstimateID > 0) {
                         SetPara('ProductOrderTypeID', ProductOrderTypeID);
                         Open('CO_PPOrderCostEstimate', P_PPOrderCostEstimateID)
                     }]]>
        </Macro>
        <Macro Key="Macro_MidSave_PreTriggers">
            <![CDATA[Macro_CheckAndSetBasicEndDate();Macro_CheckAndSetBasicStartDate();com.bokesoft.erp.mm.masterdata.SerialNumberFormula.checkPPSNNumber();IIF(IsScheduleAutomatically == 1, Macro_PlanOrderDate(), true);Macro_AutoREL();com.bokesoft.erp.mm.atp.formula.ATPFormula.availabilityCheck4ProductionOrder(IsNew(),false,true,false);com.bokesoft.erp.pp.function.ProductionOrderFormula.checkProduntionOrderRouting();com.bokesoft.erp.documentNumber.DocumentNumber.genDocNumber();com.bokesoft.erp.pp.function.ProductionOrderFormula.productOrder_GenerateReservation();if (IsNew()) {com.bokesoft.erp.pp.push.PlanOrderConvertPush.planOrder2OrderFeedBack(IsChangePart)};com.bokesoft.erp.qm.function.InspectionLotFormula.createInspectionLot();com.bokesoft.erp.mm.masterdata.SerialNumberFormula.updatePPSNNumber();com.bokesoft.erp.pp.function.ProductionOrderFormula.reCalcCapacityData();Macro_SetCompleteReceiptStatus();com.bokesoft.erp.pp.masterdata.MaterialBOMFormula.getResult4Save()]]>
        </Macro>
        <Macro Key="Macro_MidSave_PostTriggers">
            <![CDATA[if ((GeneratorMethod==3&& Macro_IsStatusActive('I0001'))||(GeneratorMethod>1&& Macro_IsStatusActive('I0002'))) {com.bokesoft.erp.pp.function.ProductionOrderFormula.ProductOrder_GeneratePurchaseRequisition()};IIF(MaterialID>0,  Macro_ModifyLTPProfile(), true);if (MaterialID>0) {com.bokesoft.erp.co.cca.ProductionOrderCostEstimate.PPOrderCostEstimateAfterSave()} ;if (IsMultiProject>0) {com.bokesoft.erp.pp.function.ProductionOrderFormula.MakeCoProductOrderSettleMent()};if (SuperiorOrderID>0) {com.bokesoft.erp.pp.function.ProductionOrderFormula.makeReworkProductOrderSettleMent()} ;SetPara('_IsNew', false);Macro_CreateBatchData();]]>
        </Macro>
        <Macro Key="Macro_AvailabilityCheck">
            <![CDATA[com.bokesoft.erp.mm.atp.formula.ATPFormula.availabilityCheck4ProductionOrder(IsNew(),false,false,false,false,false)]]>
        </Macro>
        <Macro Key="Macro_IsATPCheck">
            <![CDATA[ATPPlantID>0&&ATPMaterialID>0&&ATPRequirementDate>0&&ATPRequirementQuantity>0]]>
        </Macro>
        <Macro Key="Macro_GetPurchaseInfoRecordOrgPropAllowNull" Args="para1">
            <![CDATA[com.bokesoft.erp.mm.purchase.PurchaseOrderFormula.getPurchaseInfoRecordOrgPropAllowNull(RT_PurchaseInfoRecordID,'PurchaseInfoRecordID',para1,IIF(RT_IsOutsourcing,1,3),RT_PurchasingOrganizationID,RT_PlantID)]]>
        </Macro>
        <Macro Key="Macro_GetPurchaseInfoRecordCondDtl" Args="para1">
            <![CDATA[com.bokesoft.erp.mm.masterdata.PurchaseInfoRecordFormula.getPurchaseInfoRecordCondDtlField(RT_PurchaseInfoRecordID,RT_PurchasingOrganizationID,RT_PlantID,IIF(RT_IsOutsourcing,1,3),BasicStartDate,para1,GetDictValue('MM_PurchaseInfoRecord', RT_PurchaseInfoRecordID, 'PurchaseUnitID'))]]>
        </Macro>
        <Macro Key="Macro_GenExplosionDateTrig">
            <![CDATA[/** 读取配置中的展开日期类型 1: 开始日期, 2: 结束日期, 3: 先找BOM展开号, 没有再找开始日期, 4: 先找BOM展开号, 没有再找结束日期, 由于目前没有BOM展开号功能, 所以 1 = 3, 2 = 4 */
                     var var_versionExplosionType = com.bokesoft.erp.pp.function.ProductionOrderFormula.getProductionVersionExplosionType(ProductPlantID);
                     if (RoutExplosionDate <= 0 && TotalBaseQuantity > 0 && GetDictValue('PP_SchedulingType', SchedulingTypeID, 'IsBackward') == 1 && BasicEndDate > 0) {
                         var var_result = com.bokesoft.erp.pp.function.ProductionOrderFormula.calcExplosionDate(BasicEndDate, -1);
                         SetValue('RoutExplosionDate', var_result, true);
                         SetValue('BOMExplosionDate', var_result, true);
                         if (var_versionExplosionType == 1 || var_versionExplosionType == 3) { /** 根据开始日期 */
                             SetValue('ProductVersionExplosionDate', var_result)
                         } else {
                             SetValue('ProductVersionExplosionDate', BasicEndDate)
                         }
                     } else {
                         if (RoutExplosionDate <= 0 && TotalBaseQuantity > 0 && GetDictValue('PP_SchedulingType', SchedulingTypeID, 'IsBackward') == 0 && BasicStartDate > 0) {
                             SetValue('RoutExplosionDate', BasicStartDate, true);
                             SetValue('BOMExplosionDate', BasicStartDate, true);
                             if (var_versionExplosionType == 1 || var_versionExplosionType == 3) { /** 根据开始日期 */
                                 SetValue('ProductVersionExplosionDate', BasicStartDate);
                             } else {
                                 var var_result = com.bokesoft.erp.pp.function.ProductionOrderFormula.calcExplosionDate(BasicStartDate, 1);
                                 SetValue('ProductVersionExplosionDate', var_result);
                             }
                         }
                     }]]>
        </Macro>
        <Macro Key="Macro_OpenRoutCondChange">
            <![CDATA[ERPShowModal('PP_RoutingCondChange', GetCallFormula('Macro_PP_ProductionOrder_ShowEvent', MaterialID, PlantID, TotalBaseQuantity, RoutExplosionDate, ProductOrderTypeID, RoutingPrioritySetID, RoutingSelect))]]>
        </Macro>
        <Macro Key="Macro_OpenRefRoutSetInput">
            <![CDATA[var P_RefRoutingID = Macro_OpenRefRoutSetInput_Formula();
                     if (P_RefRoutingID > 0) {
                         SetValue('RoutingID', P_RefRoutingID, true)
                     } else {
                         ERPShowModal('PP_RefRoutingSetInput', 'Macro_PP_ProductionOrder_ShowEvent(' & '"' & MaterialID & '","' & PlantID & '","' & TotalBaseQuantity & '","' & RoutExplosionDate & '","' & RoutingPrioritySetID & '","' & RoutingSelect & '"' & ')')
                     };]]>
        </Macro>
        <Macro Key="Macro_OpenRoutSelect">
            <![CDATA[ERPShowModal('PP_RoutingSelect', GetCallFormula('Macro_PP_ProductionOrder_ShowEvent2', MaterialID, ProductPlantID, TotalBaseQuantity, RoutExplosionDate, RoutingPrioritySetID, ProductOrderTypeID, IsReadMasterData, RoutingSelect, WBSElementID, SaleOrderDtlOID, SourcePlanOrderSOID))]]>
        </Macro>
        <Macro Key="Macro_BaseForminitalize">
            <![CDATA[SetNewEmptyRow('BillCharacteristicDtl', false);SetNewEmptyRow('CharacteristicInputGrid', false);EditBill();]]>
        </Macro>
        <Macro Key="Macro_UIOpt_QueryStockOverview_Exp">
            <![CDATA[IIF(Dtl_MaterialID>0,Macro_QueryStockOverview('Dtl_MaterialID', 'Dtl_PlantID'),RaiseErrMsg('PP_PRODUCTIONORDER063','未选择需要查询库存的组件物料'))]]>
        </Macro>
        <Macro Key="Macro_PP_CapacityEvaluationList_ShowEvent" Args="ProductionOrderID">
            <![CDATA[Macro_LoadObjectBySOID(ProductionOrderID)]]>
        </Macro>
        <Macro Key="Macro_PP_GoodsMovementInfor_ShowEvent" Args="ProductionOrderID">
            <![CDATA[SetPara('_Refresh', false);Macro_LoadObjectBySOID(ProductionOrderID)]]>
        </Macro>
        <Macro Key="Macro_QM_InspectionLot_ShowEvent" Args="PP_ProductionOrderID">
            <![CDATA[Macro_LoadObjectBySOID(PP_ProductionOrderID);ShowData();SetPara('TCode', parent.GetEntryPara('TCode'))]]>
        </Macro>
        <Macro Key="Macro_SettlementRule_RunAsExp">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.ProductionOrder_SettlementRule()]]>
        </Macro>
        <Macro Key="Macro_Issued_Opt_RunAsExp">
            <![CDATA[com.bokesoft.erp.mm.masterdata.SerialNumberFormula.checkPPRLSNNumber()]]>
        </Macro>
        <Macro Key="Macro_CheckDate">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderOperationFormula.checkDate(ProductPlantID,CurrentDate)]]>
        </Macro>
        <Macro Key="Macro_Issued_Opt_RunAsExp3">
            <![CDATA[com.bokesoft.erp.mm.atp.formula.ATPFormula.availabilityCheck4ProductionOrder(IsNew(),true,false,true,false,false)]]>
        </Macro>
        <Macro Key="Macro_Issued_Opt_RunAsExp4" Args="OrderOperatorDate">
            <![CDATA[com.bokesoft.erp.mm.atp.formula.ATPFormula.availabilityCheck4ProductionOrder(IsNew(),true,true,false);if (GeneratorMethod==2) {com.bokesoft.erp.pp.function.ProductionOrderFormula.ProductOrder_GeneratePurchaseRequisition()} else {true};Macro_ProductOrdOperation('Issued',OrderOperatorDate);com.bokesoft.erp.co.cca.ProductionOrderCostEstimate.PPOrderCostEstimate(SOID)]]>
        </Macro>
        <Macro Key="Macro_Issued_Opt_RunAsExp5" Args="OrderOperatorDate">
            <![CDATA[IIF(GetValue('Issued_NODB4Other') == 1,com.bokesoft.erp.pp.function.ProductionOrderFormula.produtionOrderProcessIssued(OrderOperatorDate,GetSelDtlFldValue('RT_OID', ',')),com.bokesoft.erp.pp.function.ProductionOrderFormula.produtionOrderIssued_UI(OrderOperatorDate))]]>
        </Macro>
        <Macro Key="Macro_PreAutoREL">
            <![CDATA[SetValue('Operate_NODB4Other', 'Issued_Opt');Macro_Issued_Opt_RunAsExp();if (Length(Macro_CheckDate())>0) {ERPShowModal('PP_SelectDate');}else{Macro_Issued_Opt_RunAsExp5(DateLong());}]]>
        </Macro>
        <Macro Key="Macro_AutoREL">
            <![CDATA[IIF(IsChechAutoRel==1 && Macro_IsStatusActive('I0001'), Macro_PreAutoREL(),true); Macro_UpdateSysStatusByProcess();]]>
        </Macro>
        <Macro Key="Macro_AutoBatchCode_ButtonClickTrg">
            <![CDATA[com.bokesoft.erp.mm.batchcode.BatchCodeFormula.automaticGenerationBatchCode()]]>
        </Macro>
        <Macro Key="Macro_DeleteDtl_1_ButtonClickTrg">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.checkByReferenced()]]>
        </Macro>
        <Macro Key="Macro_AutoCreateSNNumber_ButtonClickTrg">
            <![CDATA[com.bokesoft.erp.mm.masterdata.SerialNumberFormula.setPPAutoSNNumbers()]]>
        </Macro>
        <Macro Key="Macro_DeleteDtl_2_ButtonClickTrg">
            <![CDATA[Macro_DeleteDtl_2_ButtonClickTrgConfirm1();if(Macro_DeleteDtl_2_ButtonClickTrgConfirm2()){ConfirmMsg('PP_PRODUCTIONORDER064','生产订单已经有组件绑定了删除的工序，确实需要删除吗?', {},'YES_NO', {NO: {true}, YES: {SetPara('ret',1);Macro_DeleteDtl_2_ButtonClickTrg_Formula()}});}else{SetPara('ret',0);Macro_DeleteDtl_2_ButtonClickTrg_Formula()}]]>
        </Macro>
        <Macro Key="Macro_BOMExplosionDate_Trigger">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.getMaterialBOMID()]]>
        </Macro>
        <Macro Key="Macro_ViewCostDetail_Formula">
            <![CDATA[com.bokesoft.erp.co.cca.ProductionOrderCostEstimate.genProductionOrderActualCost(SOID)]]>
        </Macro>
        <Macro Key="Macro_OpenRefRoutSetInput_Formula">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.getRefRoutingID()]]>
        </Macro>
        <Macro Key="Macro_DoAfterOKClick">
            <![CDATA[IIFS(GetValue('Operate_NODB4Other') == 'Issued_Opt', Macro_DoAfterOKClick4Issued_Opt(), GetValue('Operate_NODB4Other') == 'ProductionOrderTeco_Opt', Macro_DoAfterOKClick4ProductionOrderTeco_Opt(), GetValue('Operate_NODB4Other') == 'ProductionOrderClose_Opt', Macro_DoAfterOKClick4ProductionOrderClose_Opt(),GetValue('Operate_NODB4Other') == 'ShowOtherBill', true, true, RaiseErrMsg('PP_PRODUCTIONORDER065','请对此操作实现Macro_DoAfterOKClick'))]]>
        </Macro>
        <Macro Key="Macro_DoAfterOKClick4Issued_Opt">
            <![CDATA[Macro_Issued_Opt_RunAsExp3();if (Length(GetPara('_WarmMsg'))>0) {ConfirmMsg('PP_PRODUCTIONORDER067','{1}',{{GetPara('_WarmMsg')}}, 'YES_NO', {
            NO: {SetPara('Isresult', -1)},
            YES: {SetPara('Isresult', 1);if (ReadOnly()) {Macro_Issued_Opt_RunAsExp4(GetPara('OrderOperatorDate'));ResetEditBillShow()} else {Macro_Issued_Opt_RunAsExp5(GetPara('OrderOperatorDate'));}}});return 0;} else {if (ReadOnly()) {Macro_Issued_Opt_RunAsExp4(GetPara('OrderOperatorDate'));ShowData()} else {Macro_Issued_Opt_RunAsExp5(GetPara('OrderOperatorDate'));}}]]>
        </Macro>
        <Macro Key="Macro_DoAfterOKClick4ProductionOrderTeco_Opt">
            <![CDATA[Macro_ProductOrdOperationTECO(GetPara('OrderOperatorDate'));ShowData()]]>
        </Macro>
        <Macro Key="Macro_DoAfterOKClick4ProductionOrderClose_Opt">
            <![CDATA[Macro_ProductOrdOperation('Close',GetPara('OrderOperatorDate'));ShowData()]]>
        </Macro>
        <Macro Key="Macro_SetSuperiorProcessNo2BOM" Args="bomProcessNo">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.setSuperiorProcessNo2BOM(Dtl_OID,bomProcessNo);]]>
        </Macro>
        <Macro Key="Macro_ShowPP_RoutingFilterChangeFromCondChange">
            <![CDATA[ERPShowModal('PP_RoutingFilterChange','Macro_PP_RoutingCondChange_ShowEvent()');]]>
        </Macro>
        <Macro Key="Macro_ShowPP_RefRoutingSetInputFromCondChange">
            <![CDATA[ERPShowModal('PP_RefRoutingSetInput', GetCallFormula('Macro_PP_RoutingCondChange_ShowEvent', MaterialID, PlantID, TotalBaseQuantity, RoutExplosionDate, RoutingPrioritySetID, RoutingSelect));]]>
        </Macro>
        <Macro Key="Macro_ShowPP_RoutingSelectFromRefRoutingSetInput">
            <![CDATA[ERPShowModal('PP_RoutingSelect', GetCallFormula('Macro_PP_RefRoutingSetInput_ShowEvent', MaterialID, PlantID, TotalBaseQuantity, RoutExplosionDate, TaskListGroup, RoutingSelect, RoutingPrioritySetID, WBSElementID, SaleOrderDtlOID))]]>
        </Macro>
        <Macro Key="Macro_ShowPP_RoutingSelectFromRoutingFilterChange">
            <![CDATA[ERPShowModal('PP_RoutingSelect', GetCallFormula('Macro_PP_RoutingFilterChange_ShowEvent', MaterialID, PlantID, TotalBaseQuantity, RoutExplosionDate, RoutingPrioritySetID, RoutingSelect, WBSElementID, SaleOrderDtlOID))]]>
        </Macro>
        <Macro Key="Macro_DeleteDtl_2_ButtonClickTrg_Formula">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.deleteOrderAttributeBOMDtlbyDeleteProcess();com.bokesoft.erp.pp.function.ProductionOrderFormula.modifyProcessQuantityByOrderQuantity()]]>
        </Macro>
        <Macro Key="Macro_DeleteDtl_2_ButtonClickTrgConfirm2">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.isProcessRoutAttributed();]]>
        </Macro>
        <Macro Key="Macro_DeleteDtl_2_ButtonClickTrgConfirm1">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.checkProcessRoutDelete();]]>
        </Macro>
        <Macro Key="Macro_GetCheckingRuleID" Args="ProductOrderTypeID,ProductPlantID,release">
            <![CDATA[com.bokesoft.erp.mm.atp.formula.ATPFormula.getATPCheckingRuleID(ProductOrderTypeID,ProductPlantID,release)]]>
        </Macro>
        <Macro Key="Macro_GetProductionOrderStatus">
            <![CDATA[IIF(IsNew(), false, Macro_IsStatusActive('I0002'))]]>
        </Macro>
        <Macro Key="Macro_HandleCoProduct">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.handleCoProduct()]]>
        </Macro>
        <Macro Key="Macro_AvailabilityCheck4ProductionOrder">
            <![CDATA[com.bokesoft.erp.mm.atp.formula.ATPFormula.availabilityCheck4ProductionOrder(IsNew(),False,False,True,True,False)]]>
        </Macro>
        <Macro Key="Macro_ResetRongting">
            <![CDATA[ClearAllRows('ProductionOrderProcessInputGrid');ClearAllRows('ProductionOrderProcessListGrid');ClearAllRows('ProductionOrderStandardValueGrid');]]>
        </Macro>
        <Macro Key="Macro_SetScaleByUnit" Args="Value,BaseUnitID,RoundingMode">
            <![CDATA[com.bokesoft.erp.basis.unit.UnitFormula.setScaleByUnit(Value,BaseUnitID,RoundingMode)]]>
        </Macro>
        <Macro Key="Macro_getRoundingMode">
            <![CDATA[com.bokesoft.erp.basis.unit.UnitFormula.getRoundingMode(UnitID);]]>
        </Macro>
        <Macro Key="Macro_CheckScaleByUnitID" Args="Value,BaseUnitID">
            <![CDATA[com.bokesoft.erp.basis.unit.UnitFormula.checkScaleByUnitID(Value,BaseUnitID);]]>
        </Macro>
        <Macro Key="Macro_ChackPlanFactory">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.chackPlanFactory();]]>
        </Macro>
        <Macro Key="Macro_SetCostAndArea">
            <![CDATA[com.bokesoft.erp.pp.masterdata.RoutingFormula.setCostAndArea_ProductionOrder()]]>
        </Macro>
        <Macro Key="Macro_SumEnablePercent">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.getSumEnablePercent(SubstituteProjectGroup,Dtl_OID)]]>
        </Macro>
        <Macro Key="Macro_CheckSumEnablePercent">
            <![CDATA[IIF(Macro_SumEnablePercent()>100,ConfirmMsg('CO607','总计用途可能性={1}(替代组 {2}',{{Macro_SumEnablePercent()},{SubstituteProjectGroup}}),true)]]>
        </Macro>
        <Macro Key="Macro_SetProcessNo">
            <![CDATA[IIF(Length(RT_ItemNo) == 0, SetValue('RT_ItemNo', Right('0000'&(GetRowCount('ProductionOrderProcessListGrid'))*10, 4),true))]]>
        </Macro>
        <Macro Key="Macro_UpdateDmdQtyAndOrlQty" Args="MaterialBOMDtlID,para1,para">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.calcReplaceQuantity(Dtl_OID,para1,para)]]>
        </Macro>
        <Macro Key="Macro_NeedEditSettleMent">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.NeedEditCoProductOrderSettleMent(SOID)]]>
        </Macro>
        <Macro Key="Macro_MidSaveAndProcessSettleMentAfterSave">
            <![CDATA[Macro_MidSave();Macro_ProcessSettleMentAfterSave()]]>
        </Macro>
        <Macro Key="Macro_ProcessSettleMentAfterSave">
            <![CDATA[IIF(IsMultiProject==1 && Macro_NeedEditSettleMent()==1,Macro_SettlementRule_RunAsExp(),true)]]>
        </Macro>
        <Macro Key="Macro_ProductOrdOperation" Args="Status,orderOperatorDate">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderOperationFormula.productionOperation(Status,orderOperatorDate)]]>
        </Macro>
        <Macro Key="Macro_CheckInspectLotAndProductOrdOperatAndLTP" Args="Status,orderOperatorDate">
            <![CDATA[Macro_CheckInspectionLot();Macro_ProductOrdOperation(Status,orderOperatorDate);Macro_ModifyLTPProfile();]]>
        </Macro>
        <Macro Key="Macro_ProductOrdOperationAndLTP" Args="Status,orderOperatorDate">
            <![CDATA[Macro_ProductOrdOperation(Status,orderOperatorDate);Macro_ModifyLTPProfile();]]>
        </Macro>
        <Macro Key="Macro_QueryStockOverview" Args="MaterialIDKey,PlantIDKey">
            <![CDATA[if (MaterialIDKey>0) {SetPara('_MaterialID', GetValue(MaterialIDKey));SetPara('_PlantID', GetValue(PlantIDKey));ERPShowModal('MM_StockOverview_Rpt','Macro_CommonDef__ShowEvent()','newtab')} else {''}]]>
        </Macro>
        <Macro Key="Macro_MidSave_Production">
            <![CDATA[com.bokesoft.erp.function.DocumentFunction.saveObject();]]>
        </Macro>
        <Macro Key="Macro_UIOpt_BillCopyNew_Exp">
            <![CDATA[SetPara('Category',Category);com.bokesoft.erp.pp.function.ProductionOrderFormula.CopyNewProductionOrder()]]>
        </Macro>
        <Macro Key="Macro_ConfirmAndIssued">
            <![CDATA[if (ReadOnly()) {Macro_Issued_Opt_RunAsExp4(DateLong());ShowData()} else {Macro_Issued_Opt_RunAsExp5(DateLong());}]]>
        </Macro>
        <Macro Key="Macro_GeneraMethodActive" Args="BillDtlIDs">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.generaMethodActive(BillDtlIDs)]]>
        </Macro>
        <Macro Key="Macro_PreReleaseAndRelease">
            <![CDATA[Macro_PreReleaseInspect();Macro_ReleaseOperation()]]>
        </Macro>
        <Macro Key="Macro_PreReleaseInspect">
            <![CDATA[UICheck();SetValue('Operate_NODB4Other', 'Issued_Opt');Macro_Issued_Opt_RunAsExp();]]>
        </Macro>
        <Macro Key="Macro_ReleaseOperation">
            <![CDATA[IIFS(Length(Macro_CheckDate())>0,ERPShowModal('PP_SelectDate'),Macro_Issued_Opt_RunAsExp3()==6 && Length(GetPara('_WarmMsg'))>0,ConfirmMsg('PP_PRODUCTIONORDER067','{1}',{{GetPara('_WarmMsg')}}, 'YES_NO', {NO: {true},YES: {Macro_ConfirmAndIssued()}}),true,Macro_ConfirmAndIssued());]]>
        </Macro>
        <Macro Key="Macro_IsCanStatus">
            <![CDATA[Macro_IsStatusActive('I0012,I0074,I0009,I0010,I0046,I0045,I0076,I0321')]]>
        </Macro>
        <Macro Key="Macro_RepeatDevelop">
            <![CDATA[Macro_SetDefaultRouting();Macro_SetDefaultBOM()]]>
        </Macro>
        <Macro Key="Macro_ReadMasterData4VersionID">
            <![CDATA[IIFS(GetPara('_NewRoute')>0 && GetPara('_NewBOM')>0 && IsReadMasterData>0, Macro_RepeatDevelop(),GetPara('_NewRoute')>0 && IsReadMasterData>0,Macro_SetDefaultRouting(),GetPara('_NewBOM')>0 && IsReadMasterData>0,Macro_SetDefaultBOM());]]>
        </Macro>
        <Macro Key="Macro_ReadMasterData4NoVersionID">
            <![CDATA[IIFS(GetPara('_NewRoute')>0 && IsReadMasterData>0 && GetPara('_processQuantity')==0,Macro_OpenRoutCondChange(),GetPara('_NewRoute')>0 && IsReadMasterData>0 && GetPara('_processQuantity')==1,Macro_AutoDevelopRouting(),GetPara('_NewRoute')>0 && IsReadMasterData>0 && GetPara('_processQuantity')==2,Macro_OpenRoutSelect());Macro_SetDefaultBOM();]]>
        </Macro>
        <Macro Key="Macro_AutoDevelopRouting">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.autoSetRoutingID();com.bokesoft.erp.pp.function.ProductionOrderFormula.ProductionOrderRoutingData()]]>
        </Macro>
        <Macro Key="Macro_MidSave">
            <![CDATA[Macro_MidSave_PreTriggers();Macro_MidSave_Production();Macro_MidSave_PostTriggers();]]>
        </Macro>
        <Macro Key="Macro_ModifyBusinessBOMDemandQuantity">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.modifyBusinessBOMDemandQuantity(Dtl_OID);]]>
        </Macro>
        <Macro Key="Macro_ModifyLTPProfile">
            <![CDATA[com.bokesoft.erp.pp.function.MRPPlanFormula.setMRPPlanProfile_ProductOrder();]]>
        </Macro>
        <Macro Key="Macro_OnProcessAdd">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.onProcessAdd()]]>
        </Macro>
        <Macro Key="Macro_SetVCVariable4Input">
            <![CDATA['']]>
        </Macro>
        <Macro Key="Macro_HasErrorLogData">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.productOrderHasErrorLogData(GetOID())]]>
        </Macro>
        <Macro Key="Macro_ProductOrdOperationTECO" Args="OrderOperatorDate">
            <![CDATA[SetPara('OrderOperatorDate',OrderOperatorDate);IIF(Macro_HasErrorLogData(),ConfirmMsg('PP_PRODUCTIONORDER066','订单{1}:仍有重新处理记录。是否将订单设置成技术性完成?',{{DocumentNumber}},'YES_NO',{YES:{Macro_ProductOrdOperation('Teco',GetPara('OrderOperatorDate'));},NO:{true}}),Macro_ProductOrdOperation('Teco',GetPara('OrderOperatorDate')));]]>
        </Macro>
        <Macro Key="Macro_IsProcessOrder">
            <![CDATA[IIF(Category=='40',true,false);]]>
        </Macro>
        <Macro Key="Macro_GetRoutingID_10">
            <![CDATA[IIF(MaterialID<=0,0,IIFS(Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)>=2&&ProductionVersionID>0, GetDictValue('PP_ProductionVersion', ProductionVersionID, 'RoutingID'),Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)==2&&ProductionVersionID<=0&&RoutExplosionDate>0, Macro_SetDefaultRoutingByQuantityOrDate(),Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)==3&&ProductionVersionID<=0,Macro_ResetRongting(), Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)<2&&ProductPlantID>0&&ProductOrderTypeID>0&&MaterialID>0&&TotalBaseQuantity>0&&RoutExplosionDate>0, RoutingID))]]>
        </Macro>
        <Macro Key="Macro_GetRoutingID_40">
            <![CDATA[IIF(ProductPlantID>0&&ProductOrderTypeID>0&&MaterialID>0&&TotalBaseQuantity>0&&RoutExplosionDate>0&&RoutingID==0,com.bokesoft.erp.pp.function.ProcessOrderFormula.getProcessOrderRoutingID(),RoutingID)]]>
        </Macro>
        <Macro Key="Macro_RoutExplosionDate_10">
            <![CDATA[if ((Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)>2||(Macro_GetOrgProp('MaterialID', 'DecidingBOMMethod', ProductPlantID)==2&&ProductionVersionID>0))&&ProductPlantID>0&&ProductOrderTypeID>0&&MaterialID>0&&TotalBaseQuantity>0&&RoutExplosionDate>0) {true} else {if (RoutingSelect==0) {Macro_OpenRoutCondChange()} else {if (RoutingSelect==1) {Macro_OpenRefRoutSetInput()} else {if (RoutingSelect>1) {SetPara('Rout', com.bokesoft.erp.pp.function.ProductionOrderFormula.existRouting());if (GetPara('Rout')==0) {Macro_OpenRoutCondChange()} else {if (GetPara('Rout')==1) {com.bokesoft.erp.pp.function.ProductionOrderFormula.autoSetRoutingID()} else {if (GetPara('Rout')==2) {Macro_OpenRoutSelect()} else {true}}}} else {true}}}};]]>
        </Macro>
        <Macro Key="Macro_ProcessOrder_NoMaterialShowEvent" Args="ProcessOrderPlantID,ProcessOrderTypeID,ProcessOrderRoutingID">
            <![CDATA[NewBill();SetEntryPara('Category','40');SetEntryPara('TCode','CO07');SetValue('IsReceive',0);SetPara('MainRecipeID',ToLong(ProcessOrderRoutingID));SetValue('Category','40',true);SetValue('TCodeID',GetDictOID('TCode', 'Code','CO07' ),true);SetValue('ProductPlantID',ProcessOrderPlantID,true);SetValue('ProductOrderTypeID',ProcessOrderTypeID,true);]]>
        </Macro>
        <Macro Key="Macro_DeleteInspectionLot">
            <![CDATA[com.bokesoft.erp.qm.function.InspectionLotFormula.deleteInspectionLot4ProductionOrder()]]>
        </Macro>
        <Macro Key="Macro_CheckInspectionLot">
            <![CDATA[com.bokesoft.erp.qm.function.InspectionLotFormula.checkInspectionLot4ProductionOrder()]]>
        </Macro>
        <Macro Key="Macro_IsNonStockItem" Args="argTypeID">
            <![CDATA[com.bokesoft.erp.pp.function.PlanOrderFormula.isNonStockItem(argTypeID);]]>
        </Macro>
        <Macro Key="Macro_RecordRoutingsAndBoms">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.getProductionDataDtlsBeforeSave()]]>
        </Macro>
        <Macro Key="Macro_ClickCreateBatch">
            <![CDATA[IIF(IsBatchManagement==0,ConfirmMsg('CO315','物料未启用批次管理',{{GetDictValue('Material', MaterialID, 'Code')}} ,'OK'),IIF(BatchCode=='',SetValue('BatchCode',Macro_AutoBatchCode_ButtonClickTrg()),ConfirmMsg('PP_PRODUCTIONORDER071','该批次已经存在,分配新的编号?',{},'YES_NO',{YES:{SetValue('BatchCode',Macro_AutoBatchCode_ButtonClickTrg())},NO:{true}})));]]>
        </Macro>
        <Macro Key="Macro_CheckAndCreateBatchCode">
            <![CDATA[com.bokesoft.erp.mm.batchcode.BatchCodeFormula.checkAndCreateBatchCode_ProductOrder(BatchCode);]]>
        </Macro>
        <Macro Key="Macro_CreateBatchData">
            <![CDATA[IIF(BatchCode!=''&&BatchCode!='_',com.bokesoft.erp.mm.batchcode.BatchCodeFormula.createBatchData(),true);]]>
        </Macro>
        <Macro Key="Macro_DoAfterClick4ProductProcessSelect">
            <![CDATA[if (GetPara('ProcessSelectResult')==1) {SetValue('ItemNoOld', ProcessSelect_Btn);SetValue('ProcessSelect_Btn',GetPara('ProductionProcessNo'),true);SetValue('IsPhaseIndicator',GetPara('ProductionIsPhaseIndicator'));SetValue('SuperiorItemNo',GetPara('ProductionSuperiorProcessNo'));}]]>
        </Macro>
        <Macro Key="Macro_CheckBeforeDeleteComponent">
            <![CDATA[IIFS(RequisiteQuantity>0, RaiseErrMsg('CN750','组件已发料，不允许删除'), IsCoProduct==1, RaiseErrMsg('CO587','联产品不能删除 '), true, true)]]>
        </Macro>
        <Macro Key="Macro_SpecialStockCheckRule">
            <![CDATA[IIFS(
                             Dtl_SpecialIdentity=='_', true,
                             Dtl_SpecialIdentity == 'B' && DynIdentityID <= 0, MessageFacade('PP_PRODUCTIONORDER076', '请输入有关特殊库存B的客户'),
                             Dtl_SpecialIdentity == 'E' && DynIdentityID <= 0, MessageFacade('PP_PRODUCTIONORDER031', '请输入订单'),
                             Dtl_SpecialIdentity == 'K' && DynIdentityID <= 0, MessageFacade('PP_PRODUCTIONORDER032', '请输入(寄售)供应商'),
                             Dtl_SpecialIdentity == 'O' && DynIdentityID <= 0, MessageFacade('PP_PRODUCTIONORDER033', '请输入分包供应商'),
                             Dtl_SpecialIdentity == 'Q' && DynIdentityID <= 0, MessageFacade('PP_PRODUCTIONORDER034', '请输入项目库存'),
                             Dtl_SpecialIdentity == 'W' && DynIdentityID <= 0, MessageFacade('PP_PRODUCTIONORDER035', '请输入(寄售)客户'),
                             Dtl_SpecialIdentity == 'V' && DynIdentityID <= 0, MessageFacade('PP_PRODUCTIONORDER036', '请输入(可回收包装物)客户'),
                             true, true
                     );]]>
        </Macro>
        <Macro Key="Macro_UIOpt_BillSave_Exp">
            <![CDATA[if(Length(Macro_CheckPBF())>0) {ConfirmMsg('COCOSTOBJECTUTIL006', '已存在业务数据或未清单据，请确认是否要修改？', {}, 'YES_NO', {NO: {true}, YES: {Macro_MidSaveAndProcessSettleMentAfterSave();ResetEditBill()}})} else {Macro_MidSaveAndProcessSettleMentAfterSave();ResetEditBill()}]]>
        </Macro>
        <Macro Key="Macro_SetFocusRow" Args="key">
            <![CDATA[IIF(GetRowCount(key)>0, SetFocusRow(key, 0), true);]]>
        </Macro>
        <Macro Key="Macro_CheckAndSetBasicEndDate">
            <![CDATA[IIF(BasicEndDate<=0&&BasicStartDate>0&&(GetDictValue('PP_SchedulingType', SchedulingTypeID, 'IsForward')==1||GetDictValue('PP_SchedulingType', SchedulingTypeID, 'IsCurrentDate')==1),SetValue('BasicEndDate', com.bokesoft.erp.pp.function.ProductionOrderFormula.getBasicEndDate()),BasicEndDate);]]>
        </Macro>
        <Macro Key="Macro_CheckAndSetBasicStartDate">
            <![CDATA[IIF(BasicEndDate>0&&BasicStartDate<=0&&(GetDictValue('PP_SchedulingType', SchedulingTypeID, 'IsBackward')==1||GetDictValue('PP_SchedulingType', SchedulingTypeID, 'IsCurrentDate')==1),SetValue('BasicStartDate', com.bokesoft.erp.pp.function.ProductionOrderFormula.getBasicStartDate()),BasicStartDate);]]>
        </Macro>
        <Macro Key="Macro_PlanOrderDate">
            <![CDATA[com.bokesoft.erp.pp.function.ProductionOrderFormula.planDate()]]>
        </Macro>
    </MacroCollection>
</Form>
